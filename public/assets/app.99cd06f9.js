/*! For license information please see app.99cd06f9.js.LICENSE.txt */
(()=>{var e={3166:()=>{up.compiler("#proseBody",(function(e){Array.from(e.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]")).map((function(e){var t=document.createElement("a");t.setAttribute("aria-hidden","true"),t.setAttribute("tabindex","-1"),t.setAttribute("href","#".concat(e.id)),t.setAttribute("class","hidden md:block md:absolute md:-left-8 top-2 opacity-0 group-hover:opacity-100 text-slate-600 duration-300"),t.innerHTML='<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9.243 3.03a1 1 0 01.727 1.213L9.53 6h2.94l.56-2.243a1 1 0 111.94.486L14.53 6H17a1 1 0 110 2h-2.97l-1 4H15a1 1 0 110 2h-2.47l-.56 2.242a1 1 0 11-1.94-.485L10.47 14H7.53l-.56 2.242a1 1 0 11-1.94-.485L5.47 14H3a1 1 0 110-2h2.97l1-4H5a1 1 0 110-2h2.47l.56-2.243a1 1 0 011.213-.727zM9.03 8l-1 4h2.938l1-4H9.031z" clip-rule="evenodd"></path></svg>',e.classList.add("relative"),e.classList.add("group"),e.appendChild(t)}))})),window.onTranscriptToggle=function(){var e=document.getElementById("transcriptCutoffBtn"),t=Array.from(document.querySelectorAll(".prose .transcript.cutoff"));e.parentElement.classList.toggle("active"),t.map((function(e){return e.classList.toggle("active")}))}},1014:()=>{up.network.config.autoCache=function(){return!1}},1977:function(e,t){var r;!function(n){"use strict";var i=Math.cosh||function(e){return Math.abs(e)<1e-9?1-e:.5*(Math.exp(e)+Math.exp(-e))},s=Math.sinh||function(e){return Math.abs(e)<1e-9?e:.5*(Math.exp(e)-Math.exp(-e))},a=function(){throw SyntaxError("Invalid Param")};function o(e,t){var r=Math.abs(e),n=Math.abs(t);return 0===e?Math.log(n):0===t?Math.log(r):r<3e3&&n<3e3?.5*Math.log(e*e+t*t):(e/=2,t/=2,.5*Math.log(e*e+t*t)+Math.LN2)}function l(e,t){if(!(this instanceof l))return new l(e,t);var r=function(e,t){var r={re:0,im:0};if(null==e)r.re=r.im=0;else if(void 0!==t)r.re=e,r.im=t;else switch(typeof e){case"object":if("im"in e&&"re"in e)r.re=e.re,r.im=e.im;else if("abs"in e&&"arg"in e){if(!Number.isFinite(e.abs)&&Number.isFinite(e.arg))return l.INFINITY;r.re=e.abs*Math.cos(e.arg),r.im=e.abs*Math.sin(e.arg)}else if("r"in e&&"phi"in e){if(!Number.isFinite(e.r)&&Number.isFinite(e.phi))return l.INFINITY;r.re=e.r*Math.cos(e.phi),r.im=e.r*Math.sin(e.phi)}else 2===e.length?(r.re=e[0],r.im=e[1]):a();break;case"string":r.im=r.re=0;var n=e.match(/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g),i=1,s=0;null===n&&a();for(var o=0;o<n.length;o++){var u=n[o];" "===u||"\t"===u||"\n"===u||("+"===u?i++:"-"===u?s++:"i"===u||"I"===u?(i+s===0&&a()," "===n[o+1]||isNaN(n[o+1])?r.im+=parseFloat((s%2?"-":"")+"1"):(r.im+=parseFloat((s%2?"-":"")+n[o+1]),o++),i=s=0):((i+s===0||isNaN(u))&&a(),"i"===n[o+1]||"I"===n[o+1]?(r.im+=parseFloat((s%2?"-":"")+u),o++):r.re+=parseFloat((s%2?"-":"")+u),i=s=0))}i+s>0&&a();break;case"number":r.im=0,r.re=e;break;default:a()}return isNaN(r.re)||isNaN(r.im),r}(e,t);this.re=r.re,this.im=r.im}l.prototype={re:0,im:0,sign:function(){var e=this.abs();return new l(this.re/e,this.im/e)},add:function(e,t){var r=new l(e,t);return this.isInfinite()&&r.isInfinite()?l.NAN:this.isInfinite()||r.isInfinite()?l.INFINITY:new l(this.re+r.re,this.im+r.im)},sub:function(e,t){var r=new l(e,t);return this.isInfinite()&&r.isInfinite()?l.NAN:this.isInfinite()||r.isInfinite()?l.INFINITY:new l(this.re-r.re,this.im-r.im)},mul:function(e,t){var r=new l(e,t);return this.isInfinite()&&r.isZero()||this.isZero()&&r.isInfinite()?l.NAN:this.isInfinite()||r.isInfinite()?l.INFINITY:0===r.im&&0===this.im?new l(this.re*r.re,0):new l(this.re*r.re-this.im*r.im,this.re*r.im+this.im*r.re)},div:function(e,t){var r=new l(e,t);if(this.isZero()&&r.isZero()||this.isInfinite()&&r.isInfinite())return l.NAN;if(this.isInfinite()||r.isZero())return l.INFINITY;if(this.isZero()||r.isInfinite())return l.ZERO;e=this.re,t=this.im;var n,i,s=r.re,a=r.im;return 0===a?new l(e/s,t/s):Math.abs(s)<Math.abs(a)?new l((e*(i=s/a)+t)/(n=s*i+a),(t*i-e)/n):new l((e+t*(i=a/s))/(n=a*i+s),(t-e*i)/n)},pow:function(e,t){var r=new l(e,t);if(e=this.re,t=this.im,r.isZero())return l.ONE;if(0===r.im){if(0===t&&e>0)return new l(Math.pow(e,r.re),0);if(0===e)switch((r.re%4+4)%4){case 0:return new l(Math.pow(t,r.re),0);case 1:return new l(0,Math.pow(t,r.re));case 2:return new l(-Math.pow(t,r.re),0);case 3:return new l(0,-Math.pow(t,r.re))}}if(0===e&&0===t&&r.re>0&&r.im>=0)return l.ZERO;var n=Math.atan2(t,e),i=o(e,t);return e=Math.exp(r.re*i-r.im*n),t=r.im*i+r.re*n,new l(e*Math.cos(t),e*Math.sin(t))},sqrt:function(){var e,t,r=this.re,n=this.im,i=this.abs();if(r>=0){if(0===n)return new l(Math.sqrt(r),0);e=.5*Math.sqrt(2*(i+r))}else e=Math.abs(n)/Math.sqrt(2*(i-r));return t=r<=0?.5*Math.sqrt(2*(i-r)):Math.abs(n)/Math.sqrt(2*(i+r)),new l(e,n<0?-t:t)},exp:function(){var e=Math.exp(this.re);return this.im,new l(e*Math.cos(this.im),e*Math.sin(this.im))},expm1:function(){var e=this.re,t=this.im;return new l(Math.expm1(e)*Math.cos(t)+function(e){var t=Math.PI/4;if(-t>e||e>t)return Math.cos(e)-1;var r=e*e;return r*(r*(r*(r*(r*(r*(r*(r/20922789888e3-1/87178291200)+1/479001600)-1/3628800)+1/40320)-1/720)+1/24)-.5)}(t),Math.exp(e)*Math.sin(t))},log:function(){var e=this.re,t=this.im;return new l(o(e,t),Math.atan2(t,e))},abs:function(){return e=this.re,t=this.im,r=Math.abs(e),n=Math.abs(t),r<3e3&&n<3e3?Math.sqrt(r*r+n*n):(r<n?(r=n,n=e/t):n=t/e,r*Math.sqrt(1+n*n));var e,t,r,n},arg:function(){return Math.atan2(this.im,this.re)},sin:function(){var e=this.re,t=this.im;return new l(Math.sin(e)*i(t),Math.cos(e)*s(t))},cos:function(){var e=this.re,t=this.im;return new l(Math.cos(e)*i(t),-Math.sin(e)*s(t))},tan:function(){var e=2*this.re,t=2*this.im,r=Math.cos(e)+i(t);return new l(Math.sin(e)/r,s(t)/r)},cot:function(){var e=2*this.re,t=2*this.im,r=Math.cos(e)-i(t);return new l(-Math.sin(e)/r,s(t)/r)},sec:function(){var e=this.re,t=this.im,r=.5*i(2*t)+.5*Math.cos(2*e);return new l(Math.cos(e)*i(t)/r,Math.sin(e)*s(t)/r)},csc:function(){var e=this.re,t=this.im,r=.5*i(2*t)-.5*Math.cos(2*e);return new l(Math.sin(e)*i(t)/r,-Math.cos(e)*s(t)/r)},asin:function(){var e=this.re,t=this.im,r=new l(t*t-e*e+1,-2*e*t).sqrt(),n=new l(r.re-t,r.im+e).log();return new l(n.im,-n.re)},acos:function(){var e=this.re,t=this.im,r=new l(t*t-e*e+1,-2*e*t).sqrt(),n=new l(r.re-t,r.im+e).log();return new l(Math.PI/2-n.im,n.re)},atan:function(){var e=this.re,t=this.im;if(0===e){if(1===t)return new l(0,1/0);if(-1===t)return new l(0,-1/0)}var r=e*e+(1-t)*(1-t),n=new l((1-t*t-e*e)/r,-2*e/r).log();return new l(-.5*n.im,.5*n.re)},acot:function(){var e=this.re,t=this.im;if(0===t)return new l(Math.atan2(1,e),0);var r=e*e+t*t;return 0!==r?new l(e/r,-t/r).atan():new l(0!==e?e/0:0,0!==t?-t/0:0).atan()},asec:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new l(0,1/0);var r=e*e+t*t;return 0!==r?new l(e/r,-t/r).acos():new l(0!==e?e/0:0,0!==t?-t/0:0).acos()},acsc:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new l(Math.PI/2,1/0);var r=e*e+t*t;return 0!==r?new l(e/r,-t/r).asin():new l(0!==e?e/0:0,0!==t?-t/0:0).asin()},sinh:function(){var e=this.re,t=this.im;return new l(s(e)*Math.cos(t),i(e)*Math.sin(t))},cosh:function(){var e=this.re,t=this.im;return new l(i(e)*Math.cos(t),s(e)*Math.sin(t))},tanh:function(){var e=2*this.re,t=2*this.im,r=i(e)+Math.cos(t);return new l(s(e)/r,Math.sin(t)/r)},coth:function(){var e=2*this.re,t=2*this.im,r=i(e)-Math.cos(t);return new l(s(e)/r,-Math.sin(t)/r)},csch:function(){var e=this.re,t=this.im,r=Math.cos(2*t)-i(2*e);return new l(-2*s(e)*Math.cos(t)/r,2*i(e)*Math.sin(t)/r)},sech:function(){var e=this.re,t=this.im,r=Math.cos(2*t)+i(2*e);return new l(2*i(e)*Math.cos(t)/r,-2*s(e)*Math.sin(t)/r)},asinh:function(){var e=this.im;this.im=-this.re,this.re=e;var t=this.asin();return this.re=-this.im,this.im=e,e=t.re,t.re=-t.im,t.im=e,t},acosh:function(){var e=this.acos();if(e.im<=0){var t=e.re;e.re=-e.im,e.im=t}else{t=e.im;e.im=-e.re,e.re=t}return e},atanh:function(){var e=this.re,t=this.im,r=e>1&&0===t,n=1-e,i=1+e,s=n*n+t*t,a=0!==s?new l((i*n-t*t)/s,(t*n+i*t)/s):new l(-1!==e?e/0:0,0!==t?t/0:0),u=a.re;return a.re=o(a.re,a.im)/2,a.im=Math.atan2(a.im,u)/2,r&&(a.im=-a.im),a},acoth:function(){var e=this.re,t=this.im;if(0===e&&0===t)return new l(0,Math.PI/2);var r=e*e+t*t;return 0!==r?new l(e/r,-t/r).atanh():new l(0!==e?e/0:0,0!==t?-t/0:0).atanh()},acsch:function(){var e=this.re,t=this.im;if(0===t)return new l(0!==e?Math.log(e+Math.sqrt(e*e+1)):1/0,0);var r=e*e+t*t;return 0!==r?new l(e/r,-t/r).asinh():new l(0!==e?e/0:0,0!==t?-t/0:0).asinh()},asech:function(){var e=this.re,t=this.im;if(this.isZero())return l.INFINITY;var r=e*e+t*t;return 0!==r?new l(e/r,-t/r).acosh():new l(0!==e?e/0:0,0!==t?-t/0:0).acosh()},inverse:function(){if(this.isZero())return l.INFINITY;if(this.isInfinite())return l.ZERO;var e=this.re,t=this.im,r=e*e+t*t;return new l(e/r,-t/r)},conjugate:function(){return new l(this.re,-this.im)},neg:function(){return new l(-this.re,-this.im)},ceil:function(e){return e=Math.pow(10,e||0),new l(Math.ceil(this.re*e)/e,Math.ceil(this.im*e)/e)},floor:function(e){return e=Math.pow(10,e||0),new l(Math.floor(this.re*e)/e,Math.floor(this.im*e)/e)},round:function(e){return e=Math.pow(10,e||0),new l(Math.round(this.re*e)/e,Math.round(this.im*e)/e)},equals:function(e,t){var r=new l(e,t);return Math.abs(r.re-this.re)<=l.EPSILON&&Math.abs(r.im-this.im)<=l.EPSILON},clone:function(){return new l(this.re,this.im)},toString:function(){var e=this.re,t=this.im,r="";return this.isNaN()?"NaN":this.isInfinite()?"Infinity":(Math.abs(e)<l.EPSILON&&(e=0),Math.abs(t)<l.EPSILON&&(t=0),0===t?r+e:(0!==e?(r+=e,r+=" ",t<0?(t=-t,r+="-"):r+="+",r+=" "):t<0&&(t=-t,r+="-"),1!==t&&(r+=t),r+"i"))},toVector:function(){return[this.re,this.im]},valueOf:function(){return 0===this.im?this.re:null},isNaN:function(){return isNaN(this.re)||isNaN(this.im)},isZero:function(){return 0===this.im&&0===this.re},isFinite:function(){return isFinite(this.re)&&isFinite(this.im)},isInfinite:function(){return!(this.isNaN()||this.isFinite())}},l.ZERO=new l(0,0),l.ONE=new l(1,0),l.I=new l(0,1),l.PI=new l(Math.PI,0),l.E=new l(Math.E,0),l.INFINITY=new l(1/0,1/0),l.NAN=new l(NaN,NaN),l.EPSILON=1e-15,void 0===(r=function(){return l}.apply(t,[]))||(e.exports=r)}()},7928:e=>{"use strict";var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},n={"–":"\\--","—":"\\---"," ":"~","\t":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},i=function(e,r){return t({},e,r)};e.exports=function(e){for(var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=s.preserveFormatting,o=void 0!==a&&a,l=s.escapeMapFn,u=void 0===l?i:l,c=String(e),d="",h=u(t({},r),o?t({},n):{}),f=Object.keys(h),p=function(){var e=!1;f.forEach((function(t,r){e||c.length>=t.length&&c.slice(0,t.length)===t&&(d+=h[f[r]],c=c.slice(t.length,c.length),e=!0)})),e||(d+=c.slice(0,1),c=c.slice(1,c.length))};c;)p();return d}},5628:function(e,t){var r;!function(n){"use strict";var i={s:1,n:0,d:1};function s(e,t){if(isNaN(e=parseInt(e,10)))throw c.InvalidParameter;return e*t}function a(e,t){if(0===t)throw c.DivisionByZero;var r=Object.create(c.prototype);r.s=e<0?-1:1;var n=u(e=e<0?-e:e,t);return r.n=e/n,r.d=t/n,r}function o(e){for(var t={},r=e,n=2,i=4;i<=r;){for(;r%n==0;)r/=n,t[n]=(t[n]||0)+1;i+=1+2*n++}return r!==e?r>1&&(t[r]=(t[r]||0)+1):t[e]=(t[e]||0)+1,t}var l=function(e,t){var r,n=0,a=1,o=1,l=0,u=0,d=0,h=1,f=1,p=0,m=1,g=1,y=1,v=1e7;if(null==e);else if(void 0!==t){if(o=(n=e)*(a=t),n%1!=0||a%1!=0)throw c.NonIntegerParameter}else switch(typeof e){case"object":if("d"in e&&"n"in e)n=e.n,a=e.d,"s"in e&&(n*=e.s);else{if(!(0 in e))throw c.InvalidParameter;n=e[0],1 in e&&(a=e[1])}o=n*a;break;case"number":if(e<0&&(o=e,e=-e),e%1==0)n=e;else if(e>0){for(e>=1&&(e/=f=Math.pow(10,Math.floor(1+Math.log(e)/Math.LN10)));m<=v&&y<=v;){if(e===(r=(p+g)/(m+y))){m+y<=v?(n=p+g,a=m+y):y>m?(n=g,a=y):(n=p,a=m);break}e>r?(p+=g,m+=y):(g+=p,y+=m),m>v?(n=g,a=y):(n=p,a=m)}n*=f}else(isNaN(e)||isNaN(t))&&(a=n=NaN);break;case"string":if(null===(m=e.match(/\d+|./g)))throw c.InvalidParameter;if("-"===m[p]?(o=-1,p++):"+"===m[p]&&p++,m.length===p+1?u=s(m[p++],o):"."===m[p+1]||"."===m[p]?("."!==m[p]&&(l=s(m[p++],o)),(++p+1===m.length||"("===m[p+1]&&")"===m[p+3]||"'"===m[p+1]&&"'"===m[p+3])&&(u=s(m[p],o),h=Math.pow(10,m[p].length),p++),("("===m[p]&&")"===m[p+2]||"'"===m[p]&&"'"===m[p+2])&&(d=s(m[p+1],o),f=Math.pow(10,m[p+1].length)-1,p+=3)):"/"===m[p+1]||":"===m[p+1]?(u=s(m[p],o),h=s(m[p+2],1),p+=3):"/"===m[p+3]&&" "===m[p+1]&&(l=s(m[p],o),u=s(m[p+2],o),h=s(m[p+4],1),p+=5),m.length<=p){o=n=d+(a=h*f)*l+f*u;break}default:throw c.InvalidParameter}if(0===a)throw c.DivisionByZero;i.s=o<0?-1:1,i.n=Math.abs(n),i.d=Math.abs(a)};function u(e,t){if(!e)return t;if(!t)return e;for(;;){if(!(e%=t))return t;if(!(t%=e))return e}}function c(e,t){if(l(e,t),!(this instanceof c))return a(i.s*i.n,i.d);e=u(i.d,i.n),this.s=i.s,this.n=i.n/e,this.d=i.d/e}c.DivisionByZero=new Error("Division by Zero"),c.InvalidParameter=new Error("Invalid argument"),c.NonIntegerParameter=new Error("Parameters must be integer"),c.prototype={s:1,n:0,d:1,abs:function(){return a(this.n,this.d)},neg:function(){return a(-this.s*this.n,this.d)},add:function(e,t){return l(e,t),a(this.s*this.n*i.d+i.s*this.d*i.n,this.d*i.d)},sub:function(e,t){return l(e,t),a(this.s*this.n*i.d-i.s*this.d*i.n,this.d*i.d)},mul:function(e,t){return l(e,t),a(this.s*i.s*this.n*i.n,this.d*i.d)},div:function(e,t){return l(e,t),a(this.s*i.s*this.n*i.d,this.d*i.n)},clone:function(){return a(this.s*this.n,this.d)},mod:function(e,t){if(isNaN(this.n)||isNaN(this.d))return new c(NaN);if(void 0===e)return a(this.s*this.n%this.d,1);if(l(e,t),0===i.n&&0===this.d)throw c.DivisionByZero;return a(this.s*(i.d*this.n)%(i.n*this.d),i.d*this.d)},gcd:function(e,t){return l(e,t),a(u(i.n,this.n)*u(i.d,this.d),i.d*this.d)},lcm:function(e,t){return l(e,t),0===i.n&&0===this.n?a(0,1):a(i.n*this.n,u(i.n,this.n)*u(i.d,this.d))},ceil:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):a(Math.ceil(e*this.s*this.n/this.d),e)},floor:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):a(Math.floor(e*this.s*this.n/this.d),e)},round:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new c(NaN):a(Math.round(e*this.s*this.n/this.d),e)},inverse:function(){return a(this.s*this.d,this.n)},pow:function(e,t){if(l(e,t),1===i.d)return i.s<0?a(Math.pow(this.s*this.d,i.n),Math.pow(this.n,i.n)):a(Math.pow(this.s*this.n,i.n),Math.pow(this.d,i.n));if(this.s<0)return null;var r=o(this.n),n=o(this.d),s=1,u=1;for(var c in r)if("1"!==c){if("0"===c){s=0;break}if(r[c]*=i.n,r[c]%i.d!=0)return null;r[c]/=i.d,s*=Math.pow(c,r[c])}for(var c in n)if("1"!==c){if(n[c]*=i.n,n[c]%i.d!=0)return null;n[c]/=i.d,u*=Math.pow(c,n[c])}return i.s<0?a(u,s):a(s,u)},equals:function(e,t){return l(e,t),this.s*this.n*i.d==i.s*i.n*this.d},compare:function(e,t){l(e,t);var r=this.s*this.n*i.d-i.s*i.n*this.d;return(0<r)-(r<0)},simplify:function(e){if(isNaN(this.n)||isNaN(this.d))return this;e=e||.001;for(var t=this.abs(),r=t.toContinued(),n=1;n<r.length;n++){for(var i=a(r[n-1],1),s=n-2;s>=0;s--)i=i.inverse().add(r[s]);if(i.sub(t).abs().valueOf()<e)return i.mul(this.s)}return this},divisible:function(e,t){return l(e,t),!(!(i.n*this.d)||this.n*i.d%(i.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(e){var t,r="",n=this.n,i=this.d;return this.s<0&&(r+="-"),1===i?r+=n:(e&&(t=Math.floor(n/i))>0&&(r+=t,r+=" ",n%=i),r+=n,r+="/",r+=i),r},toLatex:function(e){var t,r="",n=this.n,i=this.d;return this.s<0&&(r+="-"),1===i?r+=n:(e&&(t=Math.floor(n/i))>0&&(r+=t,n%=i),r+="\\frac{",r+=n,r+="}{",r+=i,r+="}"),r},toContinued:function(){var e,t=this.n,r=this.d,n=[];if(isNaN(t)||isNaN(r))return n;do{n.push(Math.floor(t/r)),e=t%r,t=r,r=e}while(1!==t);return n},toString:function(e){var t=this.n,r=this.d;if(isNaN(t)||isNaN(r))return"NaN";e=e||15;var n=function(e,t){for(;t%2==0;t/=2);for(;t%5==0;t/=5);if(1===t)return 0;for(var r=10%t,n=1;1!==r;n++)if(r=10*r%t,n>2e3)return 0;return n}(0,r),i=function(e,t,r){for(var n=1,i=function(e,t,r){for(var n=1;t>0;e=e*e%r,t>>=1)1&t&&(n=n*e%r);return n}(10,r,t),s=0;s<300;s++){if(n===i)return s;n=10*n%t,i=10*i%t}return 0}(0,r,n),s=this.s<0?"-":"";if(s+=t/r|0,t%=r,(t*=10)&&(s+="."),n){for(var a=i;a--;)s+=t/r|0,t%=r,t*=10;s+="(";for(a=n;a--;)s+=t/r|0,t%=r,t*=10;s+=")"}else for(a=e;t&&a--;)s+=t/r|0,t%=r,t*=10;return s}},void 0===(r=function(){return c}.apply(t,[]))||(e.exports=r)}()},3228:e=>{e.exports=function e(t,r){"use strict";var n,i,s=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,a=/(^[ ]*|[ ]*$)/g,o=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,l=/^0x[0-9a-f]+$/i,u=/^0/,c=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},d=c(t).replace(a,"")||"",h=c(r).replace(a,"")||"",f=d.replace(s,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=h.replace(s,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(d.match(l),16)||1!==f.length&&d.match(o)&&Date.parse(d),g=parseInt(h.match(l),16)||m&&h.match(o)&&Date.parse(h)||null;if(g){if(m<g)return-1;if(m>g)return 1}for(var y=0,v=Math.max(f.length,p.length);y<v;y++){if(n=!(f[y]||"").match(u)&&parseFloat(f[y])||f[y]||0,i=!(p[y]||"").match(u)&&parseFloat(p[y])||p[y]||0,isNaN(n)!==isNaN(i))return isNaN(n)?1:-1;if(typeof n!=typeof i&&(n+="",i+=""),n<i)return-1;if(n>i)return 1}return 0}},1443:function(e,t,r){"object"==typeof navigator&&(e.exports=function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var a={addCSS:!0,thumbWidth:15,watch:!0},o=function(e){return null!=e?e.constructor:null},l=function(e,t){return!!(e&&t&&e instanceof t)},u=function(e){return null==e},c=function(e){return o(e)===Object},d=function(e){return o(e)===String},h=function(e){return Array.isArray(e)},f=function(e){return l(e,NodeList)},p={nullOrUndefined:u,object:c,number:function(e){return o(e)===Number&&!Number.isNaN(e)},string:d,boolean:function(e){return o(e)===Boolean},function:function(e){return o(e)===Function},array:h,nodeList:f,element:function(e){return l(e,Element)},event:function(e){return l(e,Event)},empty:function(e){return u(e)||(d(e)||h(e)||f(e))&&!e.length||c(e)&&!Object.keys(e).length}};function m(e,t){if(1>t){var r=function(e){var t="".concat(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}(t);return parseFloat(e.toFixed(r))}return Math.round(e/t)*t}var g=function(){function e(t,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),p.element(t)?this.element=t:p.string(t)&&(this.element=document.querySelector(t)),p.element(this.element)&&p.empty(this.element.rangeTouch)&&(this.config=s({},a,{},r),this.init())}return function(e,r,n){r&&t(e.prototype,r),n&&t(e,n)}(e,[{key:"init",value:function(){e.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){e.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(e){var t=this,r=e?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach((function(e){t.element[r](e,(function(e){return t.set(e)}),!1)}))}},{key:"get",value:function(t){if(!e.enabled||!p.event(t))return null;var r,n=t.target,i=t.changedTouches[0],s=parseFloat(n.getAttribute("min"))||0,a=parseFloat(n.getAttribute("max"))||100,o=parseFloat(n.getAttribute("step"))||1,l=n.getBoundingClientRect(),u=100/l.width*(this.config.thumbWidth/2)/100;return 0>(r=100/l.width*(i.clientX-l.left))?r=0:100<r&&(r=100),50>r?r-=(100-2*r)*u:50<r&&(r+=2*(r-50)*u),s+m(r/100*(a-s),o)}},{key:"set",value:function(t){e.enabled&&p.event(t)&&!t.target.disabled&&(t.preventDefault(),t.target.value=this.get(t),function(e,t){if(e&&t){var r=new Event(t,{bubbles:!0});e.dispatchEvent(r)}}(t.target,"touchend"===t.type?"change":"input"))}}],[{key:"setup",value:function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=null;if(p.empty(t)||p.string(t)?n=Array.from(document.querySelectorAll(p.string(t)?t:'input[type="range"]')):p.element(t)?n=[t]:p.nodeList(t)?n=Array.from(t):p.array(t)&&(n=t.filter(p.element)),p.empty(n))return null;var i=s({},a,{},r);if(p.string(t)&&i.watch){var o=new MutationObserver((function(r){Array.from(r).forEach((function(r){Array.from(r.addedNodes).forEach((function(r){p.element(r)&&function(e,t){return function(){return Array.from(document.querySelectorAll(t)).includes(this)}.call(e,t)}(r,t)&&new e(r,i)}))}))}));o.observe(document.body,{childList:!0,subtree:!0})}return n.map((function(t){return new e(t,r)}))}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),e}();const y=e=>null!=e?e.constructor:null,v=(e,t)=>Boolean(e&&t&&e instanceof t),b=e=>null==e,w=e=>y(e)===Object,x=e=>y(e)===String,E=e=>"function"==typeof e,D=e=>Array.isArray(e),S=e=>v(e,NodeList),A=e=>b(e)||(x(e)||D(e)||S(e))&&!e.length||w(e)&&!Object.keys(e).length;var T={nullOrUndefined:b,object:w,number:e=>y(e)===Number&&!Number.isNaN(e),string:x,boolean:e=>y(e)===Boolean,function:E,array:D,weakMap:e=>v(e,WeakMap),nodeList:S,element:e=>null!==e&&"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument,textNode:e=>y(e)===Text,event:e=>v(e,Event),keyboardEvent:e=>v(e,KeyboardEvent),cue:e=>v(e,window.TextTrackCue)||v(e,window.VTTCue),track:e=>v(e,TextTrack)||!b(e)&&x(e.kind),promise:e=>v(e,Promise)&&E(e.then),url:e=>{if(v(e,window.URL))return!0;if(!x(e))return!1;let t=e;e.startsWith("http://")&&e.startsWith("https://")||(t=`http://${e}`);try{return!A(new URL(t).hostname)}catch(e){return!1}},empty:A};const C=(()=>{const e=document.createElement("span"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},r=Object.keys(t).find((t=>void 0!==e.style[t]));return!!T.string(r)&&t[r]})();function N(e,t){setTimeout((()=>{try{e.hidden=!0,e.offsetHeight,e.hidden=!1}catch(e){}}),t)}var k={isIE:Boolean(window.document.documentMode),isEdge:/Edge/g.test(navigator.userAgent),isWebKit:"WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent),isIPhone:/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1,isIPadOS:"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,isIos:/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1};function M(e,t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function O(e={},...t){if(!t.length)return e;const r=t.shift();return T.object(r)?(Object.keys(r).forEach((t=>{T.object(r[t])?(Object.keys(e).includes(t)||Object.assign(e,{[t]:{}}),O(e[t],r[t])):Object.assign(e,{[t]:r[t]})})),O(e,...t)):e}function F(e,t){const r=e.length?e:[e];Array.from(r).reverse().forEach(((e,r)=>{const n=r>0?t.cloneNode(!0):t,i=e.parentNode,s=e.nextSibling;n.appendChild(e),s?i.insertBefore(n,s):i.appendChild(n)}))}function L(e,t){T.element(e)&&!T.empty(t)&&Object.entries(t).filter((([,e])=>!T.nullOrUndefined(e))).forEach((([t,r])=>e.setAttribute(t,r)))}function _(e,t,r){const n=document.createElement(e);return T.object(t)&&L(n,t),T.string(r)&&(n.innerText=r),n}function R(e,t,r,n){T.element(t)&&t.appendChild(_(e,r,n))}function I(e){T.nodeList(e)||T.array(e)?Array.from(e).forEach(I):T.element(e)&&T.element(e.parentNode)&&e.parentNode.removeChild(e)}function P(e){if(!T.element(e))return;let{length:t}=e.childNodes;for(;t>0;)e.removeChild(e.lastChild),t-=1}function B(e,t){return T.element(t)&&T.element(t.parentNode)&&T.element(e)?(t.parentNode.replaceChild(e,t),e):null}function U(e,t){if(!T.string(e)||T.empty(e))return{};const r={},n=O({},t);return e.split(",").forEach((e=>{const t=e.trim(),i=t.replace(".",""),s=t.replace(/[[\]]/g,"").split("="),[a]=s,o=s.length>1?s[1].replace(/["']/g,""):"";switch(t.charAt(0)){case".":T.string(n.class)?r.class=`${n.class} ${i}`:r.class=i;break;case"#":r.id=t.replace("#","");break;case"[":r[a]=o}})),O(n,r)}function $(e,t){if(!T.element(e))return;let r=t;T.boolean(r)||(r=!e.hidden),e.hidden=r}function z(e,t,r){if(T.nodeList(e))return Array.from(e).map((e=>z(e,t,r)));if(T.element(e)){let n="toggle";return void 0!==r&&(n=r?"add":"remove"),e.classList[n](t),e.classList.contains(t)}return!1}function j(e,t){return T.element(e)&&e.classList.contains(t)}function q(e,t){const{prototype:r}=Element;return(r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(e,t)}function H(e){return this.elements.container.querySelectorAll(e)}function V(e){return this.elements.container.querySelector(e)}function G(e=null,t=!1){T.element(e)&&e.focus({preventScroll:!0,focusVisible:t})}const K={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},W={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(e,t){const r=W[e]||"html5"!==t;return{api:r,ui:r&&W.rangeInput}},pip:!(k.isIPhone||!T.function(_("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||_("video").disablePictureInPicture)),airplay:T.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(e){if(T.empty(e))return!1;const[t]=e.split("/");let r=e;if(!this.isHTML5||t!==this.type)return!1;Object.keys(K).includes(r)&&(r+=`; codecs="${K[e]}"`);try{return Boolean(r&&this.media.canPlayType(r).replace(/no/,""))}catch(e){return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const e=document.createElement("input");return e.type="range","range"===e.type})(),touch:"ontouchstart"in document.documentElement,transitions:!1!==C,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},Y=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>(e=!0,null)});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e})();function J(e,t,r,n=!1,i=!0,s=!1){if(!e||!("addEventListener"in e)||T.empty(t)||!T.function(r))return;const a=t.split(" ");let o=s;Y&&(o={passive:i,capture:s}),a.forEach((t=>{this&&this.eventListeners&&n&&this.eventListeners.push({element:e,type:t,callback:r,options:o}),e[n?"addEventListener":"removeEventListener"](t,r,o)}))}function Z(e,t="",r,n=!0,i=!1){J.call(this,e,t,r,!0,n,i)}function X(e,t="",r,n=!0,i=!1){J.call(this,e,t,r,!1,n,i)}function Q(e,t="",r,n=!0,i=!1){const s=(...a)=>{X(e,t,s,n,i),r.apply(this,a)};J.call(this,e,t,s,!0,n,i)}function ee(e,t="",r=!1,n={}){if(!T.element(e)||T.empty(t))return;const i=new CustomEvent(t,{bubbles:r,detail:{...n,plyr:this}});e.dispatchEvent(i)}function te(){this&&this.eventListeners&&(this.eventListeners.forEach((e=>{const{element:t,type:r,callback:n,options:i}=e;t.removeEventListener(r,n,i)})),this.eventListeners=[])}function re(){return new Promise((e=>this.ready?setTimeout(e,0):Z.call(this,this.elements.container,"ready",e))).then((()=>{}))}function ne(e){T.promise(e)&&e.then(null,(()=>{}))}function ie(e){return T.array(e)?e.filter(((t,r)=>e.indexOf(t)===r)):e}function se(e,t){return T.array(e)&&e.length?e.reduce(((e,r)=>Math.abs(r-t)<Math.abs(e-t)?r:e)):null}function ae(e){return!(!window||!window.CSS)&&window.CSS.supports(e)}const oe=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce(((e,[t,r])=>({...e,[t/r]:[t,r]})),{});function le(e){return!!(T.array(e)||T.string(e)&&e.includes(":"))&&(T.array(e)?e:e.split(":")).map(Number).every(T.number)}function ue(e){if(!T.array(e)||!e.every(T.number))return null;const[t,r]=e,n=(e,t)=>0===t?e:n(t,e%t),i=n(t,r);return[t/i,r/i]}function ce(e){const t=e=>le(e)?e.split(":").map(Number):null;let r=t(e);if(null===r&&(r=t(this.config.ratio)),null===r&&!T.empty(this.embed)&&T.array(this.embed.ratio)&&({ratio:r}=this.embed),null===r&&this.isHTML5){const{videoWidth:e,videoHeight:t}=this.media;r=[e,t]}return ue(r)}function de(e){if(!this.isVideo)return{};const{wrapper:t}=this.elements,r=ce.call(this,e);if(!T.array(r))return{};const[n,i]=ue(r),s=100/n*i;if(ae(`aspect-ratio: ${n}/${i}`)?t.style.aspectRatio=`${n}/${i}`:t.style.paddingBottom=`${s}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const e=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),r=(e-s)/(e/50);this.fullscreen.active?t.style.paddingBottom=null:this.media.style.transform=`translateY(-${r}%)`}else this.isHTML5&&t.classList.add(this.config.classNames.videoFixedRatio);return{padding:s,ratio:r}}function he(e,t,r=.05){const n=e/t,i=se(Object.keys(oe),n);return Math.abs(i-n)<=r?oe[i]:[e,t]}const fe={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter((e=>{const t=e.getAttribute("type");return!!T.empty(t)||W.mime.call(this,t)})):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:fe.getSources.call(this).map((e=>Number(e.getAttribute("size")))).filter(Boolean)},setup(){if(!this.isHTML5)return;const e=this;e.options.speed=e.config.speed.options,T.empty(this.config.ratio)||de.call(e),Object.defineProperty(e.media,"quality",{get(){const t=fe.getSources.call(e).find((t=>t.getAttribute("src")===e.source));return t&&Number(t.getAttribute("size"))},set(t){if(e.quality!==t){if(e.config.quality.forced&&T.function(e.config.quality.onChange))e.config.quality.onChange(t);else{const r=fe.getSources.call(e).find((e=>Number(e.getAttribute("size"))===t));if(!r)return;const{currentTime:n,paused:i,preload:s,readyState:a,playbackRate:o}=e.media;e.media.src=r.getAttribute("src"),("none"!==s||a)&&(e.once("loadedmetadata",(()=>{e.speed=o,e.currentTime=n,i||ne(e.play())})),e.media.load())}ee.call(e,e.media,"qualitychange",!1,{quality:t})}}})},cancelRequests(){this.isHTML5&&(I(fe.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function pe(e,...t){return T.empty(e)?e:e.toString().replace(/{(\d+)}/g,((e,r)=>t[r].toString()))}const me=(e="",t="",r="")=>e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),r.toString()),ge=(e="")=>e.toString().replace(/\w\S*/g,(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()));function ye(e=""){let t=e.toString();return t=function(e=""){let t=e.toString();return t=me(t,"-"," "),t=me(t,"_"," "),t=ge(t),me(t," ","")}(t),t.charAt(0).toLowerCase()+t.slice(1)}function ve(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML}const be={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},we={get(e="",t={}){if(T.empty(e)||T.empty(t))return"";let r=M(t.i18n,e);if(T.empty(r))return Object.keys(be).includes(e)?be[e]:"";const n={"{seektime}":t.seekTime,"{title}":t.title};return Object.entries(n).forEach((([e,t])=>{r=me(r,e,t)})),r}};class xe{constructor(t){e(this,"get",(e=>{if(!xe.supported||!this.enabled)return null;const t=window.localStorage.getItem(this.key);if(T.empty(t))return null;const r=JSON.parse(t);return T.string(e)&&e.length?r[e]:r})),e(this,"set",(e=>{if(!xe.supported||!this.enabled)return;if(!T.object(e))return;let t=this.get();T.empty(t)&&(t={}),O(t,e);try{window.localStorage.setItem(this.key,JSON.stringify(t))}catch(e){}})),this.enabled=t.config.storage.enabled,this.key=t.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const e="___test";return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}}}function Ee(e,t="text"){return new Promise(((r,n)=>{try{const n=new XMLHttpRequest;if(!("withCredentials"in n))return;n.addEventListener("load",(()=>{if("text"===t)try{r(JSON.parse(n.responseText))}catch(e){r(n.responseText)}else r(n.response)})),n.addEventListener("error",(()=>{throw new Error(n.status)})),n.open("GET",e,!0),n.responseType=t,n.send()}catch(e){n(e)}}))}function De(e,t){if(!T.string(e))return;const r="cache",n=T.string(t);let i=!1;const s=()=>null!==document.getElementById(t),a=(e,t)=>{e.innerHTML=t,n&&s()||document.body.insertAdjacentElement("afterbegin",e)};if(!n||!s()){const s=xe.supported,o=document.createElement("div");if(o.setAttribute("hidden",""),n&&o.setAttribute("id",t),s){const e=window.localStorage.getItem(`${r}-${t}`);if(i=null!==e,i){const t=JSON.parse(e);a(o,t.content)}}Ee(e).then((e=>{if(!T.empty(e)){if(s)try{window.localStorage.setItem(`${r}-${t}`,JSON.stringify({content:e}))}catch(e){}a(o,e)}})).catch((()=>{}))}}const Se=e=>Math.trunc(e/60/60%60,10),Ae=e=>Math.trunc(e/60%60,10),Te=e=>Math.trunc(e%60,10);function Ce(e=0,t=!1,r=!1){if(!T.number(e))return Ce(void 0,t,r);const n=e=>`0${e}`.slice(-2);let i=Se(e);const s=Ae(e),a=Te(e);return i=t||i>0?`${i}:`:"",`${r&&e>0?"-":""}${i}${n(s)}:${n(a)}`}const Ne={getIconUrl(){const e=new URL(this.config.iconUrl,window.location),t=window.location.host?window.location.host:window.top.location.host,r=e.host!==t||k.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:r}},findElements(){try{return this.elements.controls=V.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:H.call(this,this.config.selectors.buttons.play),pause:V.call(this,this.config.selectors.buttons.pause),restart:V.call(this,this.config.selectors.buttons.restart),rewind:V.call(this,this.config.selectors.buttons.rewind),fastForward:V.call(this,this.config.selectors.buttons.fastForward),mute:V.call(this,this.config.selectors.buttons.mute),pip:V.call(this,this.config.selectors.buttons.pip),airplay:V.call(this,this.config.selectors.buttons.airplay),settings:V.call(this,this.config.selectors.buttons.settings),captions:V.call(this,this.config.selectors.buttons.captions),fullscreen:V.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=V.call(this,this.config.selectors.progress),this.elements.inputs={seek:V.call(this,this.config.selectors.inputs.seek),volume:V.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:V.call(this,this.config.selectors.display.buffer),currentTime:V.call(this,this.config.selectors.display.currentTime),duration:V.call(this,this.config.selectors.display.duration)},T.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),this.toggleNativeControls(!0),!1}},createIcon(e,t){const r="http://www.w3.org/2000/svg",n=Ne.getIconUrl.call(this),i=`${n.cors?"":n.url}#${this.config.iconPrefix}`,s=document.createElementNS(r,"svg");L(s,O(t,{"aria-hidden":"true",focusable:"false"}));const a=document.createElementNS(r,"use"),o=`${i}-${e}`;return"href"in a&&a.setAttributeNS("http://www.w3.org/1999/xlink","href",o),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o),s.appendChild(a),s},createLabel(e,t={}){const r=we.get(e,this.config);return _("span",{...t,class:[t.class,this.config.classNames.hidden].filter(Boolean).join(" ")},r)},createBadge(e){if(T.empty(e))return null;const t=_("span",{class:this.config.classNames.menu.value});return t.appendChild(_("span",{class:this.config.classNames.menu.badge},e)),t},createButton(e,t){const r=O({},t);let n=ye(e);const i={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach((e=>{Object.keys(r).includes(e)&&(i[e]=r[e],delete r[e])})),"button"!==i.element||Object.keys(r).includes("type")||(r.type="button"),Object.keys(r).includes("class")?r.class.split(" ").some((e=>e===this.config.classNames.control))||O(r,{class:`${r.class} ${this.config.classNames.control}`}):r.class=this.config.classNames.control,e){case"play":i.toggle=!0,i.label="play",i.labelPressed="pause",i.icon="play",i.iconPressed="pause";break;case"mute":i.toggle=!0,i.label="mute",i.labelPressed="unmute",i.icon="volume",i.iconPressed="muted";break;case"captions":i.toggle=!0,i.label="enableCaptions",i.labelPressed="disableCaptions",i.icon="captions-off",i.iconPressed="captions-on";break;case"fullscreen":i.toggle=!0,i.label="enterFullscreen",i.labelPressed="exitFullscreen",i.icon="enter-fullscreen",i.iconPressed="exit-fullscreen";break;case"play-large":r.class+=` ${this.config.classNames.control}--overlaid`,n="play",i.label="play",i.icon="play";break;default:T.empty(i.label)&&(i.label=n),T.empty(i.icon)&&(i.icon=e)}const s=_(i.element);return i.toggle?(s.appendChild(Ne.createIcon.call(this,i.iconPressed,{class:"icon--pressed"})),s.appendChild(Ne.createIcon.call(this,i.icon,{class:"icon--not-pressed"})),s.appendChild(Ne.createLabel.call(this,i.labelPressed,{class:"label--pressed"})),s.appendChild(Ne.createLabel.call(this,i.label,{class:"label--not-pressed"}))):(s.appendChild(Ne.createIcon.call(this,i.icon)),s.appendChild(Ne.createLabel.call(this,i.label))),O(r,U(this.config.selectors.buttons[n],r)),L(s,r),"play"===n?(T.array(this.elements.buttons[n])||(this.elements.buttons[n]=[]),this.elements.buttons[n].push(s)):this.elements.buttons[n]=s,s},createRange(e,t){const r=_("input",O(U(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":we.get(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));return this.elements.inputs[e]=r,Ne.updateRangeFill.call(this,r),g.setup(r),r},createProgress(e,t){const r=_("progress",O(U(this.config.selectors.display[e]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},t));if("volume"!==e){r.appendChild(_("span",null,"0"));const t={played:"played",buffer:"buffered"}[e],n=t?we.get(t,this.config):"";r.innerText=`% ${n.toLowerCase()}`}return this.elements.display[e]=r,r},createTime(e,t){const r=U(this.config.selectors.display[e],t),n=_("div",O(r,{class:`${r.class?r.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":we.get(e,this.config),role:"timer"}),"00:00");return this.elements.display[e]=n,n},bindMenuItemShortcuts(e,t){Z.call(this,e,"keydown keyup",(r=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(r.key))return;if(r.preventDefault(),r.stopPropagation(),"keydown"===r.type)return;const n=q(e,'[role="menuitemradio"]');if(!n&&[" ","ArrowRight"].includes(r.key))Ne.showMenuPanel.call(this,t,!0);else{let t;" "!==r.key&&("ArrowDown"===r.key||n&&"ArrowRight"===r.key?(t=e.nextElementSibling,T.element(t)||(t=e.parentNode.firstElementChild)):(t=e.previousElementSibling,T.element(t)||(t=e.parentNode.lastElementChild)),G.call(this,t,!0))}}),!1),Z.call(this,e,"keyup",(e=>{"Return"===e.key&&Ne.focusFirstMenuItem.call(this,null,!0)}))},createMenuItem({value:e,list:t,type:r,title:n,badge:i=null,checked:s=!1}){const a=U(this.config.selectors.inputs[r]),o=_("button",O(a,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${a.class?a.class:""}`.trim(),"aria-checked":s,value:e})),l=_("span");l.innerHTML=n,T.element(i)&&l.appendChild(i),o.appendChild(l),Object.defineProperty(o,"checked",{enumerable:!0,get:()=>"true"===o.getAttribute("aria-checked"),set(e){e&&Array.from(o.parentNode.children).filter((e=>q(e,'[role="menuitemradio"]'))).forEach((e=>e.setAttribute("aria-checked","false"))),o.setAttribute("aria-checked",e?"true":"false")}}),this.listeners.bind(o,"click keyup",(t=>{if(!T.keyboardEvent(t)||" "===t.key){switch(t.preventDefault(),t.stopPropagation(),o.checked=!0,r){case"language":this.currentTrack=Number(e);break;case"quality":this.quality=e;break;case"speed":this.speed=parseFloat(e)}Ne.showMenuPanel.call(this,"home",T.keyboardEvent(t))}}),r,!1),Ne.bindMenuItemShortcuts.call(this,o,r),t.appendChild(o)},formatTime(e=0,t=!1){return T.number(e)?Ce(e,Se(this.duration)>0,t):e},updateTimeDisplay(e=null,t=0,r=!1){T.element(e)&&T.number(t)&&(e.innerText=Ne.formatTime(t,r))},updateVolume(){this.supported.ui&&(T.element(this.elements.inputs.volume)&&Ne.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),T.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume))},setRange(e,t=0){T.element(e)&&(e.value=t,Ne.updateRangeFill.call(this,e))},updateProgress(e){if(!this.supported.ui||!T.event(e))return;let t=0;const r=(e,t)=>{const r=T.number(t)?t:0,n=T.element(e)?e:this.elements.display.buffer;if(T.element(n)){n.value=r;const e=n.getElementsByTagName("span")[0];T.element(e)&&(e.childNodes[0].nodeValue=r)}};if(e)switch(e.type){case"timeupdate":case"seeking":case"seeked":n=this.currentTime,i=this.duration,t=0===n||0===i||Number.isNaN(n)||Number.isNaN(i)?0:(n/i*100).toFixed(2),"timeupdate"===e.type&&Ne.setRange.call(this,this.elements.inputs.seek,t);break;case"playing":case"progress":r(this.elements.display.buffer,100*this.buffered)}var n,i},updateRangeFill(e){const t=T.event(e)?e.target:e;if(T.element(t)&&"range"===t.getAttribute("type")){if(q(t,this.config.selectors.inputs.seek)){t.setAttribute("aria-valuenow",this.currentTime);const e=Ne.formatTime(this.currentTime),r=Ne.formatTime(this.duration),n=we.get("seekLabel",this.config);t.setAttribute("aria-valuetext",n.replace("{currentTime}",e).replace("{duration}",r))}else if(q(t,this.config.selectors.inputs.volume)){const e=100*t.value;t.setAttribute("aria-valuenow",e),t.setAttribute("aria-valuetext",`${e.toFixed(1)}%`)}else t.setAttribute("aria-valuenow",t.value);(k.isWebKit||k.isIPadOS)&&t.style.setProperty("--value",t.value/t.max*100+"%")}},updateSeekTooltip(e){var t,r;if(!this.config.tooltips.seek||!T.element(this.elements.inputs.seek)||!T.element(this.elements.display.seekTooltip)||0===this.duration)return;const n=this.elements.display.seekTooltip,i=`${this.config.classNames.tooltip}--visible`,s=e=>z(n,i,e);if(this.touch)return void s(!1);let a=0;const o=this.elements.progress.getBoundingClientRect();if(T.event(e))a=100/o.width*(e.pageX-o.left);else{if(!j(n,i))return;a=parseFloat(n.style.left,10)}a<0?a=0:a>100&&(a=100);const l=this.duration/100*a;n.innerText=Ne.formatTime(l);const u=null===(t=this.config.markers)||void 0===t||null===(r=t.points)||void 0===r?void 0:r.find((({time:e})=>e===Math.round(l)));u&&n.insertAdjacentHTML("afterbegin",`${u.label}<br>`),n.style.left=`${a}%`,T.event(e)&&["mouseenter","mouseleave"].includes(e.type)&&s("mouseenter"===e.type)},timeUpdate(e){const t=!T.element(this.elements.display.duration)&&this.config.invertTime;Ne.updateTimeDisplay.call(this,this.elements.display.currentTime,t?this.duration-this.currentTime:this.currentTime,t),e&&"timeupdate"===e.type&&this.media.seeking||Ne.updateProgress.call(this,e)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return $(this.elements.display.currentTime,!0),void $(this.elements.progress,!0);T.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const e=T.element(this.elements.display.duration);!e&&this.config.displayDuration&&this.paused&&Ne.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),e&&Ne.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&Ne.setMarkers.call(this),Ne.updateSeekTooltip.call(this)},toggleMenuButton(e,t){$(this.elements.settings.buttons[e],!t)},updateSetting(e,t,r){const n=this.elements.settings.panels[e];let i=null,s=t;if("captions"===e)i=this.currentTrack;else{if(i=T.empty(r)?this[e]:r,T.empty(i)&&(i=this.config[e].default),!T.empty(this.options[e])&&!this.options[e].includes(i))return void this.debug.warn(`Unsupported value of '${i}' for ${e}`);if(!this.config[e].options.includes(i))return void this.debug.warn(`Disabled value of '${i}' for ${e}`)}if(T.element(s)||(s=n&&n.querySelector('[role="menu"]')),!T.element(s))return;this.elements.settings.buttons[e].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=Ne.getLabel.call(this,e,i);const a=s&&s.querySelector(`[value="${i}"]`);T.element(a)&&(a.checked=!0)},getLabel(e,t){switch(e){case"speed":return 1===t?we.get("normal",this.config):`${t}&times;`;case"quality":if(T.number(t)){const e=we.get(`qualityLabel.${t}`,this.config);return e.length?e:`${t}p`}return ge(t);case"captions":return Oe.getLabel.call(this);default:return null}},setQualityMenu(e){if(!T.element(this.elements.settings.panels.quality))return;const t="quality",r=this.elements.settings.panels.quality.querySelector('[role="menu"]');T.array(e)&&(this.options.quality=ie(e).filter((e=>this.config.quality.options.includes(e))));const n=!T.empty(this.options.quality)&&this.options.quality.length>1;if(Ne.toggleMenuButton.call(this,t,n),P(r),Ne.checkMenu.call(this),!n)return;const i=e=>{const t=we.get(`qualityBadge.${e}`,this.config);return t.length?Ne.createBadge.call(this,t):null};this.options.quality.sort(((e,t)=>{const r=this.config.quality.options;return r.indexOf(e)>r.indexOf(t)?1:-1})).forEach((e=>{Ne.createMenuItem.call(this,{value:e,list:r,type:t,title:Ne.getLabel.call(this,"quality",e),badge:i(e)})})),Ne.updateSetting.call(this,t,r)},setCaptionsMenu(){if(!T.element(this.elements.settings.panels.captions))return;const e="captions",t=this.elements.settings.panels.captions.querySelector('[role="menu"]'),r=Oe.getTracks.call(this),n=Boolean(r.length);if(Ne.toggleMenuButton.call(this,e,n),P(t),Ne.checkMenu.call(this),!n)return;const i=r.map(((e,r)=>({value:r,checked:this.captions.toggled&&this.currentTrack===r,title:Oe.getLabel.call(this,e),badge:e.language&&Ne.createBadge.call(this,e.language.toUpperCase()),list:t,type:"language"})));i.unshift({value:-1,checked:!this.captions.toggled,title:we.get("disabled",this.config),list:t,type:"language"}),i.forEach(Ne.createMenuItem.bind(this)),Ne.updateSetting.call(this,e,t)},setSpeedMenu(){if(!T.element(this.elements.settings.panels.speed))return;const e="speed",t=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter((e=>e>=this.minimumSpeed&&e<=this.maximumSpeed));const r=!T.empty(this.options.speed)&&this.options.speed.length>1;Ne.toggleMenuButton.call(this,e,r),P(t),Ne.checkMenu.call(this),r&&(this.options.speed.forEach((r=>{Ne.createMenuItem.call(this,{value:r,list:t,type:e,title:Ne.getLabel.call(this,"speed",r)})})),Ne.updateSetting.call(this,e,t))},checkMenu(){const{buttons:e}=this.elements.settings,t=!T.empty(e)&&Object.values(e).some((e=>!e.hidden));$(this.elements.settings.menu,!t)},focusFirstMenuItem(e,t=!1){if(this.elements.settings.popup.hidden)return;let r=e;T.element(r)||(r=Object.values(this.elements.settings.panels).find((e=>!e.hidden)));const n=r.querySelector('[role^="menuitem"]');G.call(this,n,t)},toggleMenu(e){const{popup:t}=this.elements.settings,r=this.elements.buttons.settings;if(!T.element(t)||!T.element(r))return;const{hidden:n}=t;let i=n;if(T.boolean(e))i=e;else if(T.keyboardEvent(e)&&"Escape"===e.key)i=!1;else if(T.event(e)){const n=T.function(e.composedPath)?e.composedPath()[0]:e.target,s=t.contains(n);if(s||!s&&e.target!==r&&i)return}r.setAttribute("aria-expanded",i),$(t,!i),z(this.elements.container,this.config.classNames.menu.open,i),i&&T.keyboardEvent(e)?Ne.focusFirstMenuItem.call(this,null,!0):i||n||G.call(this,r,T.keyboardEvent(e))},getMenuSize(e){const t=e.cloneNode(!0);t.style.position="absolute",t.style.opacity=0,t.removeAttribute("hidden"),e.parentNode.appendChild(t);const r=t.scrollWidth,n=t.scrollHeight;return I(t),{width:r,height:n}},showMenuPanel(e="",t=!1){const r=this.elements.container.querySelector(`#plyr-settings-${this.id}-${e}`);if(!T.element(r))return;const n=r.parentNode,i=Array.from(n.children).find((e=>!e.hidden));if(W.transitions&&!W.reducedMotion){n.style.width=`${i.scrollWidth}px`,n.style.height=`${i.scrollHeight}px`;const e=Ne.getMenuSize.call(this,r),t=e=>{e.target===n&&["width","height"].includes(e.propertyName)&&(n.style.width="",n.style.height="",X.call(this,n,C,t))};Z.call(this,n,C,t),n.style.width=`${e.width}px`,n.style.height=`${e.height}px`}$(i,!0),$(r,!1),Ne.focusFirstMenuItem.call(this,r,t)},setDownloadUrl(){const e=this.elements.buttons.download;T.element(e)&&e.setAttribute("href",this.download)},create(e){const{bindMenuItemShortcuts:t,createButton:r,createProgress:n,createRange:i,createTime:s,setQualityMenu:a,setSpeedMenu:o,showMenuPanel:l}=Ne;this.elements.controls=null,T.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(r.call(this,"play-large"));const u=_("div",U(this.config.selectors.controls.wrapper));this.elements.controls=u;const c={class:"plyr__controls__item"};return ie(T.array(this.config.controls)?this.config.controls:[]).forEach((a=>{if("restart"===a&&u.appendChild(r.call(this,"restart",c)),"rewind"===a&&u.appendChild(r.call(this,"rewind",c)),"play"===a&&u.appendChild(r.call(this,"play",c)),"fast-forward"===a&&u.appendChild(r.call(this,"fast-forward",c)),"progress"===a){const t=_("div",{class:`${c.class} plyr__progress__container`}),r=_("div",U(this.config.selectors.progress));if(r.appendChild(i.call(this,"seek",{id:`plyr-seek-${e.id}`})),r.appendChild(n.call(this,"buffer")),this.config.tooltips.seek){const e=_("span",{class:this.config.classNames.tooltip},"00:00");r.appendChild(e),this.elements.display.seekTooltip=e}this.elements.progress=r,t.appendChild(this.elements.progress),u.appendChild(t)}if("current-time"===a&&u.appendChild(s.call(this,"currentTime",c)),"duration"===a&&u.appendChild(s.call(this,"duration",c)),"mute"===a||"volume"===a){let{volume:t}=this.elements;if(T.element(t)&&u.contains(t)||(t=_("div",O({},c,{class:`${c.class} plyr__volume`.trim()})),this.elements.volume=t,u.appendChild(t)),"mute"===a&&t.appendChild(r.call(this,"mute")),"volume"===a&&!k.isIos&&!k.isIPadOS){const r={max:1,step:.05,value:this.config.volume};t.appendChild(i.call(this,"volume",O(r,{id:`plyr-volume-${e.id}`})))}}if("captions"===a&&u.appendChild(r.call(this,"captions",c)),"settings"===a&&!T.empty(this.config.settings)){const n=_("div",O({},c,{class:`${c.class} plyr__menu`.trim(),hidden:""}));n.appendChild(r.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${e.id}`,"aria-expanded":!1}));const i=_("div",{class:"plyr__menu__container",id:`plyr-settings-${e.id}`,hidden:""}),s=_("div"),a=_("div",{id:`plyr-settings-${e.id}-home`}),o=_("div",{role:"menu"});a.appendChild(o),s.appendChild(a),this.elements.settings.panels.home=a,this.config.settings.forEach((r=>{const n=_("button",O(U(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));t.call(this,n,r),Z.call(this,n,"click",(()=>{l.call(this,r,!1)}));const i=_("span",null,we.get(r,this.config)),a=_("span",{class:this.config.classNames.menu.value});a.innerHTML=e[r],i.appendChild(a),n.appendChild(i),o.appendChild(n);const u=_("div",{id:`plyr-settings-${e.id}-${r}`,hidden:""}),c=_("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});c.appendChild(_("span",{"aria-hidden":!0},we.get(r,this.config))),c.appendChild(_("span",{class:this.config.classNames.hidden},we.get("menuBack",this.config))),Z.call(this,u,"keydown",(e=>{"ArrowLeft"===e.key&&(e.preventDefault(),e.stopPropagation(),l.call(this,"home",!0))}),!1),Z.call(this,c,"click",(()=>{l.call(this,"home",!1)})),u.appendChild(c),u.appendChild(_("div",{role:"menu"})),s.appendChild(u),this.elements.settings.buttons[r]=n,this.elements.settings.panels[r]=u})),i.appendChild(s),n.appendChild(i),u.appendChild(n),this.elements.settings.popup=i,this.elements.settings.menu=n}if("pip"===a&&W.pip&&u.appendChild(r.call(this,"pip",c)),"airplay"===a&&W.airplay&&u.appendChild(r.call(this,"airplay",c)),"download"===a){const e=O({},c,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(e.download="");const{download:t}=this.config.urls;!T.url(t)&&this.isEmbed&&O(e,{icon:`logo-${this.provider}`,label:this.provider}),u.appendChild(r.call(this,"download",e))}"fullscreen"===a&&u.appendChild(r.call(this,"fullscreen",c))})),this.isHTML5&&a.call(this,fe.getQualityOptions.call(this)),o.call(this),u},inject(){if(this.config.loadSprite){const e=Ne.getIconUrl.call(this);e.cors&&De(e.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let e=null;this.elements.controls=null;const t={id:this.id,seektime:this.config.seekTime,title:this.config.title};let r,n=!0;if(T.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,t)),this.config.controls||(this.config.controls=[]),T.element(this.config.controls)||T.string(this.config.controls)?e=this.config.controls:(e=Ne.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:Oe.getLabel.call(this)}),n=!1),n&&T.string(this.config.controls)&&(e=(e=>{let r=e;return Object.entries(t).forEach((([e,t])=>{r=me(r,`{${e}}`,t)})),r})(e)),T.string(this.config.selectors.controls.container)&&(r=document.querySelector(this.config.selectors.controls.container)),T.element(r)||(r=this.elements.container),r[T.element(e)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",e),T.element(this.elements.controls)||Ne.findElements.call(this),!T.empty(this.elements.buttons)){const e=e=>{const t=this.config.classNames.controlPressed;e.setAttribute("aria-pressed","false"),Object.defineProperty(e,"pressed",{configurable:!0,enumerable:!0,get:()=>j(e,t),set(r=!1){z(e,t,r),e.setAttribute("aria-pressed",r?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach((t=>{T.array(t)||T.nodeList(t)?Array.from(t).filter(Boolean).forEach(e):e(t)}))}if(k.isEdge&&N(r),this.config.tooltips.controls){const{classNames:e,selectors:t}=this.config,r=`${t.controls.wrapper} ${t.labels} .${e.hidden}`,n=H.call(this,r);Array.from(n).forEach((e=>{z(e,this.config.classNames.hidden,!1),z(e,this.config.classNames.tooltip,!0)}))}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch(e){}},setMarkers(){var e,t;if(!this.duration||this.elements.markers)return;const r=null===(e=this.config.markers)||void 0===e||null===(t=e.points)||void 0===t?void 0:t.filter((({time:e})=>e>0&&e<this.duration));if(null==r||!r.length)return;const n=document.createDocumentFragment(),i=document.createDocumentFragment();let s=null;const a=`${this.config.classNames.tooltip}--visible`,o=e=>z(s,a,e);r.forEach((e=>{const t=_("span",{class:this.config.classNames.marker},""),r=e.time/this.duration*100+"%";s&&(t.addEventListener("mouseenter",(()=>{e.label||(s.style.left=r,s.innerHTML=e.label,o(!0))})),t.addEventListener("mouseleave",(()=>{o(!1)}))),t.addEventListener("click",(()=>{this.currentTime=e.time})),t.style.left=r,i.appendChild(t)})),n.appendChild(i),this.config.tooltips.seek||(s=_("span",{class:this.config.classNames.tooltip},""),n.appendChild(s)),this.elements.markers={points:i,tip:s},this.elements.progress.appendChild(n)}};function ke(e,t=!0){let r=e;if(t){const e=document.createElement("a");e.href=r,r=e.href}try{return new URL(r)}catch(e){return null}}function Me(e){const t=new URLSearchParams;return T.object(e)&&Object.entries(e).forEach((([e,r])=>{t.set(e,r)})),t}const Oe={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!W.textTracks)return void(T.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Ne.setCaptionsMenu.call(this));var e,t;if(T.element(this.elements.captions)||(this.elements.captions=_("div",U(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),e=this.elements.captions,t=this.elements.wrapper,T.element(e)&&T.element(t)&&t.parentNode.insertBefore(e,t.nextSibling)),k.isIE&&window.URL){const e=this.media.querySelectorAll("track");Array.from(e).forEach((e=>{const t=e.getAttribute("src"),r=ke(t);null!==r&&r.hostname!==window.location.href.hostname&&["http:","https:"].includes(r.protocol)&&Ee(t,"blob").then((t=>{e.setAttribute("src",window.URL.createObjectURL(t))})).catch((()=>{I(e)}))}))}const r=ie((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map((e=>e.split("-")[0])));let n=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();"auto"===n&&([n]=r);let i=this.storage.get("captions");if(T.boolean(i)||({active:i}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:i,language:n,languages:r}),this.isHTML5){const e=this.config.captions.update?"addtrack removetrack":"removetrack";Z.call(this,this.media.textTracks,e,Oe.update.bind(this))}setTimeout(Oe.update.bind(this),0)},update(){const e=Oe.getTracks.call(this,!0),{active:t,language:r,meta:n,currentTrackNode:i}=this.captions,s=Boolean(e.find((e=>e.language===r)));this.isHTML5&&this.isVideo&&e.filter((e=>!n.get(e))).forEach((e=>{this.debug.log("Track added",e),n.set(e,{default:"showing"===e.mode}),"showing"===e.mode&&(e.mode="hidden"),Z.call(this,e,"cuechange",(()=>Oe.updateCues.call(this)))})),(s&&this.language!==r||!e.includes(i))&&(Oe.setLanguage.call(this,r),Oe.toggle.call(this,t&&s)),this.elements&&z(this.elements.container,this.config.classNames.captions.enabled,!T.empty(e)),T.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Ne.setCaptionsMenu.call(this)},toggle(e,t=!0){if(!this.supported.ui)return;const{toggled:r}=this.captions,n=this.config.classNames.captions.active,i=T.nullOrUndefined(e)?!r:e;if(i!==r){if(t||(this.captions.active=i,this.storage.set({captions:i})),!this.language&&i&&!t){const e=Oe.getTracks.call(this),t=Oe.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=t.language,void Oe.set.call(this,e.indexOf(t))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=i),z(this.elements.container,n,i),this.captions.toggled=i,Ne.updateSetting.call(this,"captions"),ee.call(this,this.media,i?"captionsenabled":"captionsdisabled")}setTimeout((()=>{i&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")}))},set(e,t=!0){const r=Oe.getTracks.call(this);if(-1!==e)if(T.number(e))if(e in r){if(this.captions.currentTrack!==e){this.captions.currentTrack=e;const n=r[e],{language:i}=n||{};this.captions.currentTrackNode=n,Ne.updateSetting.call(this,"captions"),t||(this.captions.language=i,this.storage.set({language:i})),this.isVimeo&&this.embed.enableTextTrack(i),ee.call(this,this.media,"languagechange")}Oe.toggle.call(this,!0,t),this.isHTML5&&this.isVideo&&Oe.updateCues.call(this)}else this.debug.warn("Track not found",e);else this.debug.warn("Invalid caption argument",e);else Oe.toggle.call(this,!1,t)},setLanguage(e,t=!0){if(!T.string(e))return void this.debug.warn("Invalid language argument",e);const r=e.toLowerCase();this.captions.language=r;const n=Oe.getTracks.call(this),i=Oe.findTrack.call(this,[r]);Oe.set.call(this,n.indexOf(i),t)},getTracks(e=!1){return Array.from((this.media||{}).textTracks||[]).filter((t=>!this.isHTML5||e||this.captions.meta.has(t))).filter((e=>["captions","subtitles"].includes(e.kind)))},findTrack(e,t=!1){const r=Oe.getTracks.call(this),n=e=>Number((this.captions.meta.get(e)||{}).default),i=Array.from(r).sort(((e,t)=>n(t)-n(e)));let s;return e.every((e=>(s=i.find((t=>t.language===e)),!s))),s||(t?i[0]:void 0)},getCurrentTrack(){return Oe.getTracks.call(this)[this.currentTrack]},getLabel(e){let t=e;return!T.track(t)&&W.textTracks&&this.captions.toggled&&(t=Oe.getCurrentTrack.call(this)),T.track(t)?T.empty(t.label)?T.empty(t.language)?we.get("enabled",this.config):e.language.toUpperCase():t.label:we.get("disabled",this.config)},updateCues(e){if(!this.supported.ui)return;if(!T.element(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!T.nullOrUndefined(e)&&!Array.isArray(e))return void this.debug.warn("updateCues: Invalid input",e);let t=e;if(!t){const e=Oe.getCurrentTrack.call(this);t=Array.from((e||{}).activeCues||[]).map((e=>e.getCueAsHTML())).map(ve)}const r=t.map((e=>e.trim())).join("\n");if(r!==this.elements.captions.innerHTML){P(this.elements.captions);const e=_("span",U(this.config.selectors.caption));e.innerHTML=r,this.elements.captions.appendChild(e),ee.call(this,this.media,"cuechange")}}},Fe={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.8/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},Le="picture-in-picture",_e="inline",Re={html5:"html5",youtube:"youtube",vimeo:"vimeo"},Ie="audio",Pe="video",Be=()=>{};class Ue{constructor(e=!1){this.enabled=window.console&&e,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):Be}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):Be}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):Be}}class $e{constructor(t){e(this,"onChange",(()=>{if(!this.supported)return;const e=this.player.elements.buttons.fullscreen;T.element(e)&&(e.pressed=this.active);const t=this.target===this.player.media?this.target:this.player.elements.container;ee.call(this.player,t,this.active?"enterfullscreen":"exitfullscreen",!0)})),e(this,"toggleFallback",((e=!1)=>{if(e?this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?"hidden":"",z(this.target,this.player.config.classNames.fullscreen.fallback,e),k.isIos){let t=document.head.querySelector('meta[name="viewport"]');const r="viewport-fit=cover";t||(t=document.createElement("meta"),t.setAttribute("name","viewport"));const n=T.string(t.content)&&t.content.includes(r);e?(this.cleanupViewport=!n,n||(t.content+=`,${r}`)):this.cleanupViewport&&(t.content=t.content.split(",").filter((e=>e.trim()!==r)).join(","))}this.onChange()})),e(this,"trapFocus",(e=>{if(k.isIos||k.isIPadOS||!this.active||"Tab"!==e.key)return;const t=document.activeElement,r=H.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[n]=r,i=r[r.length-1];t!==i||e.shiftKey?t===n&&e.shiftKey&&(i.focus(),e.preventDefault()):(n.focus(),e.preventDefault())})),e(this,"update",(()=>{if(this.supported){let e;e=this.forceFallback?"Fallback (forced)":$e.nativeSupported?"Native":"Fallback",this.player.debug.log(`${e} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");z(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)})),e(this,"enter",(()=>{this.supported&&(k.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!$e.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?T.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))})),e(this,"exit",(()=>{if(this.supported)if(k.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),ne(this.player.play());else if(!$e.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!T.empty(this.prefix)){const e="moz"===this.prefix?"Cancel":"Exit";document[`${this.prefix}${e}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)})),e(this,"toggle",(()=>{this.active?this.exit():this.enter()})),this.player=t,this.prefix=$e.prefix,this.property=$e.property,this.scrollPosition={x:0,y:0},this.forceFallback="force"===t.config.fullscreen.fallback,this.player.elements.fullscreen=t.config.fullscreen.container&&function(e,t){const{prototype:r}=Element;return(r.closest||function(){let e=this;do{if(q.matches(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}).call(e,t)}(this.player.elements.container,t.config.fullscreen.container),Z.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":`${this.prefix}fullscreenchange`,(()=>{this.onChange()})),Z.call(this.player,this.player.elements.container,"dblclick",(e=>{T.element(this.player.elements.controls)&&this.player.elements.controls.contains(e.target)||this.player.listeners.proxy(e,this.toggle,"fullscreen")})),Z.call(this,this.player.elements.container,"keydown",(e=>this.trapFocus(e))),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return $e.nativeSupported&&!this.forceFallback}static get prefix(){if(T.function(document.exitFullscreen))return"";let e="";return["webkit","moz","ms"].some((t=>!(!T.function(document[`${t}ExitFullscreen`])&&!T.function(document[`${t}CancelFullScreen`])||(e=t,0)))),e}static get property(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,$e.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||$e.nativeSupported||!k.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!$e.nativeSupported||this.forceFallback)return j(this.target,this.player.config.classNames.fullscreen.fallback);const e=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return e&&e.shadowRoot?e===this.target.getRootNode().host:e===this.target}get target(){return k.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}}function ze(e,t=1){return new Promise(((r,n)=>{const i=new Image,s=()=>{delete i.onload,delete i.onerror,(i.naturalWidth>=t?r:n)(i)};Object.assign(i,{onload:s,onerror:s,src:e})}))}const je={addStyleHook(){z(this.elements.container,this.config.selectors.container.replace(".",""),!0),z(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(e=!1){e&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void je.toggleNativeControls.call(this,!0);T.element(this.elements.controls)||(Ne.inject.call(this),this.listeners.controls()),je.toggleNativeControls.call(this),this.isHTML5&&Oe.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,Ne.updateVolume.call(this),Ne.timeUpdate.call(this),Ne.durationUpdate.call(this),je.checkPlaying.call(this),z(this.elements.container,this.config.classNames.pip.supported,W.pip&&this.isHTML5&&this.isVideo),z(this.elements.container,this.config.classNames.airplay.supported,W.airplay&&this.isHTML5),z(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout((()=>{ee.call(this,this.media,"ready")}),0),je.setTitle.call(this),this.poster&&je.setPoster.call(this,this.poster,!1).catch((()=>{})),this.config.duration&&Ne.durationUpdate.call(this),this.config.mediaMetadata&&Ne.setMediaMetadata.call(this)},setTitle(){let e=we.get("play",this.config);if(T.string(this.config.title)&&!T.empty(this.config.title)&&(e+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach((t=>{t.setAttribute("aria-label",e)})),this.isEmbed){const e=V.call(this,"iframe");if(!T.element(e))return;const t=T.empty(this.config.title)?"video":this.config.title,r=we.get("frameTitle",this.config);e.setAttribute("title",r.replace("{title}",t))}},togglePoster(e){z(this.elements.container,this.config.classNames.posterEnabled,e)},setPoster(e,t=!0){return t&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",e),this.elements.poster.removeAttribute("hidden"),re.call(this).then((()=>ze(e))).catch((t=>{throw e===this.poster&&je.togglePoster.call(this,!1),t})).then((()=>{if(e!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")})).then((()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${e}')`,backgroundSize:""}),je.togglePoster.call(this,!0),e))))},checkPlaying(e){z(this.elements.container,this.config.classNames.playing,this.playing),z(this.elements.container,this.config.classNames.paused,this.paused),z(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach((e=>{Object.assign(e,{pressed:this.playing}),e.setAttribute("aria-label",we.get(this.playing?"pause":"play",this.config))})),T.event(e)&&"timeupdate"===e.type||je.toggleControls.call(this)},checkLoading(e){this.loading=["stalled","waiting"].includes(e.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout((()=>{z(this.elements.container,this.config.classNames.loading,this.loading),je.toggleControls.call(this)}),this.loading?250:0)},toggleControls(e){const{controls:t}=this.elements;if(t&&this.config.hideControls){const r=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(Boolean(e||this.loading||this.paused||t.pressed||t.hover||r))}},migrateStyles(){Object.values({...this.media.style}).filter((e=>!T.empty(e)&&T.string(e)&&e.startsWith("--plyr"))).forEach((e=>{this.elements.container.style.setProperty(e,this.media.style.getPropertyValue(e)),this.media.style.removeProperty(e)})),T.empty(this.media.style)&&this.media.removeAttribute("style")}};class qe{constructor(t){e(this,"firstTouch",(()=>{const{player:e}=this,{elements:t}=e;e.touch=!0,z(t.container,e.config.classNames.isTouch,!0)})),e(this,"global",((e=!0)=>{const{player:t}=this;t.config.keyboard.global&&J.call(t,window,"keydown keyup",this.handleKey,e,!1),J.call(t,document.body,"click",this.toggleMenu,e),Q.call(t,document.body,"touchstart",this.firstTouch)})),e(this,"container",(()=>{const{player:e}=this,{config:t,elements:r,timers:n}=e;!t.keyboard.global&&t.keyboard.focused&&Z.call(e,r.container,"keydown keyup",this.handleKey,!1),Z.call(e,r.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",(t=>{const{controls:i}=r;i&&"enterfullscreen"===t.type&&(i.pressed=!1,i.hover=!1);let s=0;["touchstart","touchmove","mousemove"].includes(t.type)&&(je.toggleControls.call(e,!0),s=e.touch?3e3:2e3),clearTimeout(n.controls),n.controls=setTimeout((()=>je.toggleControls.call(e,!1)),s)}));const i=()=>{if(!e.isVimeo||e.config.vimeo.premium)return;const t=r.wrapper,{active:n}=e.fullscreen,[i,s]=ce.call(e),a=ae(`aspect-ratio: ${i} / ${s}`);if(!n)return void(a?(t.style.width=null,t.style.height=null):(t.style.maxWidth=null,t.style.margin=null));const[o,l]=[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)],u=o/l>i/s;a?(t.style.width=u?"auto":"100%",t.style.height=u?"100%":"auto"):(t.style.maxWidth=u?l/s*i+"px":null,t.style.margin=u?"0 auto":null)},s=()=>{clearTimeout(n.resized),n.resized=setTimeout(i,50)};Z.call(e,r.container,"enterfullscreen exitfullscreen",(t=>{const{target:n}=e.fullscreen;n===r.container&&(!e.isEmbed&&T.empty(e.config.ratio)||(i(),("enterfullscreen"===t.type?Z:X).call(e,window,"resize",s)))}))})),e(this,"media",(()=>{const{player:e}=this,{elements:t}=e;if(Z.call(e,e.media,"timeupdate seeking seeked",(t=>Ne.timeUpdate.call(e,t))),Z.call(e,e.media,"durationchange loadeddata loadedmetadata",(t=>Ne.durationUpdate.call(e,t))),Z.call(e,e.media,"ended",(()=>{e.isHTML5&&e.isVideo&&e.config.resetOnEnd&&(e.restart(),e.pause())})),Z.call(e,e.media,"progress playing seeking seeked",(t=>Ne.updateProgress.call(e,t))),Z.call(e,e.media,"volumechange",(t=>Ne.updateVolume.call(e,t))),Z.call(e,e.media,"playing play pause ended emptied timeupdate",(t=>je.checkPlaying.call(e,t))),Z.call(e,e.media,"waiting canplay seeked playing",(t=>je.checkLoading.call(e,t))),e.supported.ui&&e.config.clickToPlay&&!e.isAudio){const r=V.call(e,`.${e.config.classNames.video}`);if(!T.element(r))return;Z.call(e,t.container,"click",(n=>{([t.container,r].includes(n.target)||r.contains(n.target))&&(e.touch&&e.config.hideControls||(e.ended?(this.proxy(n,e.restart,"restart"),this.proxy(n,(()=>{ne(e.play())}),"play")):this.proxy(n,(()=>{ne(e.togglePlay())}),"play")))}))}e.supported.ui&&e.config.disableContextMenu&&Z.call(e,t.wrapper,"contextmenu",(e=>{e.preventDefault()}),!1),Z.call(e,e.media,"volumechange",(()=>{e.storage.set({volume:e.volume,muted:e.muted})})),Z.call(e,e.media,"ratechange",(()=>{Ne.updateSetting.call(e,"speed"),e.storage.set({speed:e.speed})})),Z.call(e,e.media,"qualitychange",(t=>{Ne.updateSetting.call(e,"quality",null,t.detail.quality)})),Z.call(e,e.media,"ready qualitychange",(()=>{Ne.setDownloadUrl.call(e)}));const r=e.config.events.concat(["keyup","keydown"]).join(" ");Z.call(e,e.media,r,(r=>{let{detail:n={}}=r;"error"===r.type&&(n=e.media.error),ee.call(e,t.container,r.type,!0,n)}))})),e(this,"proxy",((e,t,r)=>{const{player:n}=this,i=n.config.listeners[r];let s=!0;T.function(i)&&(s=i.call(n,e)),!1!==s&&T.function(t)&&t.call(n,e)})),e(this,"bind",((e,t,r,n,i=!0)=>{const{player:s}=this,a=s.config.listeners[n],o=T.function(a);Z.call(s,e,t,(e=>this.proxy(e,r,n)),i&&!o)})),e(this,"controls",(()=>{const{player:e}=this,{elements:t}=e,r=k.isIE?"change":"input";if(t.buttons.play&&Array.from(t.buttons.play).forEach((t=>{this.bind(t,"click",(()=>{ne(e.togglePlay())}),"play")})),this.bind(t.buttons.restart,"click",e.restart,"restart"),this.bind(t.buttons.rewind,"click",(()=>{e.lastSeekTime=Date.now(),e.rewind()}),"rewind"),this.bind(t.buttons.fastForward,"click",(()=>{e.lastSeekTime=Date.now(),e.forward()}),"fastForward"),this.bind(t.buttons.mute,"click",(()=>{e.muted=!e.muted}),"mute"),this.bind(t.buttons.captions,"click",(()=>e.toggleCaptions())),this.bind(t.buttons.download,"click",(()=>{ee.call(e,e.media,"download")}),"download"),this.bind(t.buttons.fullscreen,"click",(()=>{e.fullscreen.toggle()}),"fullscreen"),this.bind(t.buttons.pip,"click",(()=>{e.pip="toggle"}),"pip"),this.bind(t.buttons.airplay,"click",e.airplay,"airplay"),this.bind(t.buttons.settings,"click",(t=>{t.stopPropagation(),t.preventDefault(),Ne.toggleMenu.call(e,t)}),null,!1),this.bind(t.buttons.settings,"keyup",(t=>{[" ","Enter"].includes(t.key)&&("Enter"!==t.key?(t.preventDefault(),t.stopPropagation(),Ne.toggleMenu.call(e,t)):Ne.focusFirstMenuItem.call(e,null,!0))}),null,!1),this.bind(t.settings.menu,"keydown",(t=>{"Escape"===t.key&&Ne.toggleMenu.call(e,t)})),this.bind(t.inputs.seek,"mousedown mousemove",(e=>{const r=t.progress.getBoundingClientRect(),n=100/r.width*(e.pageX-r.left);e.currentTarget.setAttribute("seek-value",n)})),this.bind(t.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",(t=>{const r=t.currentTarget,n="play-on-seeked";if(T.keyboardEvent(t)&&!["ArrowLeft","ArrowRight"].includes(t.key))return;e.lastSeekTime=Date.now();const i=r.hasAttribute(n),s=["mouseup","touchend","keyup"].includes(t.type);i&&s?(r.removeAttribute(n),ne(e.play())):!s&&e.playing&&(r.setAttribute(n,""),e.pause())})),k.isIos){const t=H.call(e,'input[type="range"]');Array.from(t).forEach((e=>this.bind(e,r,(e=>N(e.target)))))}this.bind(t.inputs.seek,r,(t=>{const r=t.currentTarget;let n=r.getAttribute("seek-value");T.empty(n)&&(n=r.value),r.removeAttribute("seek-value"),e.currentTime=n/r.max*e.duration}),"seek"),this.bind(t.progress,"mouseenter mouseleave mousemove",(t=>Ne.updateSeekTooltip.call(e,t))),this.bind(t.progress,"mousemove touchmove",(t=>{const{previewThumbnails:r}=e;r&&r.loaded&&r.startMove(t)})),this.bind(t.progress,"mouseleave touchend click",(()=>{const{previewThumbnails:t}=e;t&&t.loaded&&t.endMove(!1,!0)})),this.bind(t.progress,"mousedown touchstart",(t=>{const{previewThumbnails:r}=e;r&&r.loaded&&r.startScrubbing(t)})),this.bind(t.progress,"mouseup touchend",(t=>{const{previewThumbnails:r}=e;r&&r.loaded&&r.endScrubbing(t)})),k.isWebKit&&Array.from(H.call(e,'input[type="range"]')).forEach((t=>{this.bind(t,"input",(t=>Ne.updateRangeFill.call(e,t.target)))})),e.config.toggleInvert&&!T.element(t.display.duration)&&this.bind(t.display.currentTime,"click",(()=>{0!==e.currentTime&&(e.config.invertTime=!e.config.invertTime,Ne.timeUpdate.call(e))})),this.bind(t.inputs.volume,r,(t=>{e.volume=t.target.value}),"volume"),this.bind(t.controls,"mouseenter mouseleave",(r=>{t.controls.hover=!e.touch&&"mouseenter"===r.type})),t.fullscreen&&Array.from(t.fullscreen.children).filter((e=>!e.contains(t.container))).forEach((r=>{this.bind(r,"mouseenter mouseleave",(r=>{t.controls&&(t.controls.hover=!e.touch&&"mouseenter"===r.type)}))})),this.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",(e=>{t.controls.pressed=["mousedown","touchstart"].includes(e.type)})),this.bind(t.controls,"focusin",(()=>{const{config:r,timers:n}=e;z(t.controls,r.classNames.noTransition,!0),je.toggleControls.call(e,!0),setTimeout((()=>{z(t.controls,r.classNames.noTransition,!1)}),0);const i=this.touch?3e3:4e3;clearTimeout(n.controls),n.controls=setTimeout((()=>je.toggleControls.call(e,!1)),i)})),this.bind(t.inputs.volume,"wheel",(t=>{const r=t.webkitDirectionInvertedFromDevice,[n,i]=[t.deltaX,-t.deltaY].map((e=>r?-e:e)),s=Math.sign(Math.abs(n)>Math.abs(i)?n:i);e.increaseVolume(s/50);const{volume:a}=e.media;(1===s&&a<1||-1===s&&a>0)&&t.preventDefault()}),"volume",!1)})),this.player=t,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(e){const{player:t}=this,{elements:r}=t,{key:n,type:i,altKey:s,ctrlKey:a,metaKey:o,shiftKey:l}=e,u="keydown"===i,c=u&&n===this.lastKey;var d;if(!(s||a||o||l)&&n)if(u){const i=document.activeElement;if(T.element(i)){const{editable:n}=t.config.selectors,{seek:s}=r.inputs;if(i!==s&&q(i,n))return;if(" "===e.key&&q(i,'button, [role^="menuitem"]'))return}switch([" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(n)&&(e.preventDefault(),e.stopPropagation()),n){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c||(d=parseInt(n,10),t.currentTime=t.duration/10*d);break;case" ":case"k":c||ne(t.togglePlay());break;case"ArrowUp":t.increaseVolume(.1);break;case"ArrowDown":t.decreaseVolume(.1);break;case"m":c||(t.muted=!t.muted);break;case"ArrowRight":t.forward();break;case"ArrowLeft":t.rewind();break;case"f":t.fullscreen.toggle();break;case"c":c||t.toggleCaptions();break;case"l":t.loop=!t.loop}"Escape"===n&&!t.fullscreen.usingNative&&t.fullscreen.active&&t.fullscreen.toggle(),this.lastKey=n}else this.lastKey=null}toggleMenu(e){Ne.toggleMenu.call(this.player,e)}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self&&self;var He=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function(){var e=function(){},t={},r={},n={};function i(e,t){e=e.push?e:[e];var i,s,a,o=[],l=e.length,u=l;for(i=function(e,r){r.length&&o.push(e),--u||t(o)};l--;)s=e[l],(a=r[s])?i(s,a):(n[s]=n[s]||[]).push(i)}function s(e,t){if(e){var i=n[e];if(r[e]=t,i)for(;i.length;)i[0](e,t),i.splice(0,1)}}function a(t,r){t.call&&(t={success:t}),r.length?(t.error||e)(r):(t.success||e)(t)}function o(t,r,n,i){var s,a,l=document,u=n.async,c=(n.numRetries||0)+1,d=n.before||e,h=t.replace(/[\?|#].*$/,""),f=t.replace(/^(css|img)!/,"");i=i||0,/(^css!|\.css$)/.test(h)?((a=l.createElement("link")).rel="stylesheet",a.href=f,(s="hideFocus"in a)&&a.relList&&(s=0,a.rel="preload",a.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(h)?(a=l.createElement("img")).src=f:((a=l.createElement("script")).src=t,a.async=void 0===u||u),a.onload=a.onerror=a.onbeforeload=function(e){var l=e.type[0];if(s)try{a.sheet.cssText.length||(l="e")}catch(e){18!=e.code&&(l="e")}if("e"==l){if((i+=1)<c)return o(t,r,n,i)}else if("preload"==a.rel&&"style"==a.as)return a.rel="stylesheet";r(t,l,e.defaultPrevented)},!1!==d(t,a)&&l.head.appendChild(a)}function l(e,t,r){var n,i,s=(e=e.push?e:[e]).length,a=s,l=[];for(n=function(e,r,n){if("e"==r&&l.push(e),"b"==r){if(!n)return;l.push(e)}--s||t(l)},i=0;i<a;i++)o(e[i],n,r)}function u(e,r,n){var i,o;if(r&&r.trim&&(i=r),o=(i?n:r)||{},i){if(i in t)throw"LoadJS";t[i]=!0}function u(t,r){l(e,(function(e){a(o,e),t&&a({success:t,error:r},e),s(i,e)}),o)}if(o.returnPromise)return new Promise(u);u()}return u.ready=function(e,t){return i(e,(function(e){a(t,e)})),u},u.done=function(e){s(e,[])},u.reset=function(){t={},r={},n={}},u.isDefined=function(e){return e in t},u}()}));function Ve(e){return new Promise(((t,r)=>{He(e,{success:t,error:r})}))}function Ge(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,ee.call(this,this.media,e?"play":"pause"))}const Ke={setup(){const e=this;z(e.elements.wrapper,e.config.classNames.embed,!0),e.options.speed=e.config.speed.options,de.call(e),T.object(window.Vimeo)?Ke.ready.call(e):Ve(e.config.urls.vimeo.sdk).then((()=>{Ke.ready.call(e)})).catch((t=>{e.debug.warn("Vimeo SDK (player.js) failed to load",t)}))},ready(){const e=this,t=e.config.vimeo,{premium:r,referrerPolicy:n,...i}=t;let s=e.media.getAttribute("src"),a="";T.empty(s)?(s=e.media.getAttribute(e.config.attributes.embed.id),a=e.media.getAttribute(e.config.attributes.embed.hash)):a=function(e){const t=e.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/);return t&&5===t.length?t[4]:null}(s);const o=a?{h:a}:{};r&&Object.assign(i,{controls:!1,sidedock:!1});const l=Me({loop:e.config.loop.active,autoplay:e.autoplay,muted:e.muted,gesture:"media",playsinline:e.config.playsinline,...o,...i}),u=(c=s,T.empty(c)?null:T.number(Number(c))?c:c.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:c);var c;const d=_("iframe"),h=pe(e.config.urls.vimeo.iframe,u,l);if(d.setAttribute("src",h),d.setAttribute("allowfullscreen",""),d.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),T.empty(n)||d.setAttribute("referrerPolicy",n),r||!t.customControls)d.setAttribute("data-poster",e.poster),e.media=B(d,e.media);else{const t=_("div",{class:e.config.classNames.embedContainer,"data-poster":e.poster});t.appendChild(d),e.media=B(t,e.media)}t.customControls||Ee(pe(e.config.urls.vimeo.api,h)).then((t=>{!T.empty(t)&&t.thumbnail_url&&je.setPoster.call(e,t.thumbnail_url).catch((()=>{}))})),e.embed=new window.Vimeo.Player(d,{autopause:e.config.autopause,muted:e.muted}),e.media.paused=!0,e.media.currentTime=0,e.supported.ui&&e.embed.disableTextTrack(),e.media.play=()=>(Ge.call(e,!0),e.embed.play()),e.media.pause=()=>(Ge.call(e,!1),e.embed.pause()),e.media.stop=()=>{e.pause(),e.currentTime=0};let{currentTime:f}=e.media;Object.defineProperty(e.media,"currentTime",{get:()=>f,set(t){const{embed:r,media:n,paused:i,volume:s}=e,a=i&&!r.hasPlayed;n.seeking=!0,ee.call(e,n,"seeking"),Promise.resolve(a&&r.setVolume(0)).then((()=>r.setCurrentTime(t))).then((()=>a&&r.pause())).then((()=>a&&r.setVolume(s))).catch((()=>{}))}});let p=e.config.speed.selected;Object.defineProperty(e.media,"playbackRate",{get:()=>p,set(t){e.embed.setPlaybackRate(t).then((()=>{p=t,ee.call(e,e.media,"ratechange")})).catch((()=>{e.options.speed=[1]}))}});let{volume:m}=e.config;Object.defineProperty(e.media,"volume",{get:()=>m,set(t){e.embed.setVolume(t).then((()=>{m=t,ee.call(e,e.media,"volumechange")}))}});let{muted:g}=e.config;Object.defineProperty(e.media,"muted",{get:()=>g,set(t){const r=!!T.boolean(t)&&t;e.embed.setMuted(!!r||e.config.muted).then((()=>{g=r,ee.call(e,e.media,"volumechange")}))}});let y,{loop:v}=e.config;Object.defineProperty(e.media,"loop",{get:()=>v,set(t){const r=T.boolean(t)?t:e.config.loop.active;e.embed.setLoop(r).then((()=>{v=r}))}}),e.embed.getVideoUrl().then((t=>{y=t,Ne.setDownloadUrl.call(e)})).catch((e=>{this.debug.warn(e)})),Object.defineProperty(e.media,"currentSrc",{get:()=>y}),Object.defineProperty(e.media,"ended",{get:()=>e.currentTime===e.duration}),Promise.all([e.embed.getVideoWidth(),e.embed.getVideoHeight()]).then((t=>{const[r,n]=t;e.embed.ratio=he(r,n),de.call(this)})),e.embed.setAutopause(e.config.autopause).then((t=>{e.config.autopause=t})),e.embed.getVideoTitle().then((t=>{e.config.title=t,je.setTitle.call(this)})),e.embed.getCurrentTime().then((t=>{f=t,ee.call(e,e.media,"timeupdate")})),e.embed.getDuration().then((t=>{e.media.duration=t,ee.call(e,e.media,"durationchange")})),e.embed.getTextTracks().then((t=>{e.media.textTracks=t,Oe.setup.call(e)})),e.embed.on("cuechange",(({cues:t=[]})=>{const r=t.map((e=>function(e){const t=document.createDocumentFragment(),r=document.createElement("div");return t.appendChild(r),r.innerHTML=e,t.firstChild.innerText}(e.text)));Oe.updateCues.call(e,r)})),e.embed.on("loaded",(()=>{e.embed.getPaused().then((t=>{Ge.call(e,!t),t||ee.call(e,e.media,"playing")})),T.element(e.embed.element)&&e.supported.ui&&e.embed.element.setAttribute("tabindex",-1)})),e.embed.on("bufferstart",(()=>{ee.call(e,e.media,"waiting")})),e.embed.on("bufferend",(()=>{ee.call(e,e.media,"playing")})),e.embed.on("play",(()=>{Ge.call(e,!0),ee.call(e,e.media,"playing")})),e.embed.on("pause",(()=>{Ge.call(e,!1)})),e.embed.on("timeupdate",(t=>{e.media.seeking=!1,f=t.seconds,ee.call(e,e.media,"timeupdate")})),e.embed.on("progress",(t=>{e.media.buffered=t.percent,ee.call(e,e.media,"progress"),1===parseInt(t.percent,10)&&ee.call(e,e.media,"canplaythrough"),e.embed.getDuration().then((t=>{t!==e.media.duration&&(e.media.duration=t,ee.call(e,e.media,"durationchange"))}))})),e.embed.on("seeked",(()=>{e.media.seeking=!1,ee.call(e,e.media,"seeked")})),e.embed.on("ended",(()=>{e.media.paused=!0,ee.call(e,e.media,"ended")})),e.embed.on("error",(t=>{e.media.error=t,ee.call(e,e.media,"error")})),t.customControls&&setTimeout((()=>je.build.call(e)),0)}};function We(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,ee.call(this,this.media,e?"play":"pause"))}function Ye(e){return e.noCookie?"https://www.youtube-nocookie.com":"http:"===window.location.protocol?"http://www.youtube.com":void 0}const Je={setup(){if(z(this.elements.wrapper,this.config.classNames.embed,!0),T.object(window.YT)&&T.function(window.YT.Player))Je.ready.call(this);else{const e=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{T.function(e)&&e(),Je.ready.call(this)},Ve(this.config.urls.youtube.sdk).catch((e=>{this.debug.warn("YouTube API failed to load",e)}))}},getTitle(e){Ee(pe(this.config.urls.youtube.api,e)).then((e=>{if(T.object(e)){const{title:t,height:r,width:n}=e;this.config.title=t,je.setTitle.call(this),this.embed.ratio=he(n,r)}de.call(this)})).catch((()=>{de.call(this)}))},ready(){const e=this,t=e.config.youtube,r=e.media&&e.media.getAttribute("id");if(!T.empty(r)&&r.startsWith("youtube-"))return;let n=e.media.getAttribute("src");T.empty(n)&&(n=e.media.getAttribute(this.config.attributes.embed.id));const i=(s=n,T.empty(s)?null:s.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:s);var s;const a=_("div",{id:`${e.provider}-${Math.floor(1e4*Math.random())}`,"data-poster":t.customControls?e.poster:void 0});if(e.media=B(a,e.media),t.customControls){const t=e=>`https://i.ytimg.com/vi/${i}/${e}default.jpg`;ze(t("maxres"),121).catch((()=>ze(t("sd"),121))).catch((()=>ze(t("hq")))).then((t=>je.setPoster.call(e,t.src))).then((t=>{t.includes("maxres")||(e.elements.poster.style.backgroundSize="cover")})).catch((()=>{}))}e.embed=new window.YT.Player(e.media,{videoId:i,host:Ye(t),playerVars:O({},{autoplay:e.config.autoplay?1:0,hl:e.config.hl,controls:e.supported.ui&&t.customControls?0:1,disablekb:1,playsinline:e.config.playsinline&&!e.config.fullscreen.iosNative?1:0,cc_load_policy:e.captions.active?1:0,cc_lang_pref:e.config.captions.language,widget_referrer:window?window.location.href:null},t),events:{onError(t){if(!e.media.error){const r=t.data,n={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[r]||"An unknown error occurred";e.media.error={code:r,message:n},ee.call(e,e.media,"error")}},onPlaybackRateChange(t){const r=t.target;e.media.playbackRate=r.getPlaybackRate(),ee.call(e,e.media,"ratechange")},onReady(r){if(T.function(e.media.play))return;const n=r.target;Je.getTitle.call(e,i),e.media.play=()=>{We.call(e,!0),n.playVideo()},e.media.pause=()=>{We.call(e,!1),n.pauseVideo()},e.media.stop=()=>{n.stopVideo()},e.media.duration=n.getDuration(),e.media.paused=!0,e.media.currentTime=0,Object.defineProperty(e.media,"currentTime",{get:()=>Number(n.getCurrentTime()),set(t){e.paused&&!e.embed.hasPlayed&&e.embed.mute(),e.media.seeking=!0,ee.call(e,e.media,"seeking"),n.seekTo(t)}}),Object.defineProperty(e.media,"playbackRate",{get:()=>n.getPlaybackRate(),set(e){n.setPlaybackRate(e)}});let{volume:s}=e.config;Object.defineProperty(e.media,"volume",{get:()=>s,set(t){s=t,n.setVolume(100*s),ee.call(e,e.media,"volumechange")}});let{muted:a}=e.config;Object.defineProperty(e.media,"muted",{get:()=>a,set(t){const r=T.boolean(t)?t:a;a=r,n[r?"mute":"unMute"](),n.setVolume(100*s),ee.call(e,e.media,"volumechange")}}),Object.defineProperty(e.media,"currentSrc",{get:()=>n.getVideoUrl()}),Object.defineProperty(e.media,"ended",{get:()=>e.currentTime===e.duration});const o=n.getAvailablePlaybackRates();e.options.speed=o.filter((t=>e.config.speed.options.includes(t))),e.supported.ui&&t.customControls&&e.media.setAttribute("tabindex",-1),ee.call(e,e.media,"timeupdate"),ee.call(e,e.media,"durationchange"),clearInterval(e.timers.buffering),e.timers.buffering=setInterval((()=>{e.media.buffered=n.getVideoLoadedFraction(),(null===e.media.lastBuffered||e.media.lastBuffered<e.media.buffered)&&ee.call(e,e.media,"progress"),e.media.lastBuffered=e.media.buffered,1===e.media.buffered&&(clearInterval(e.timers.buffering),ee.call(e,e.media,"canplaythrough"))}),200),t.customControls&&setTimeout((()=>je.build.call(e)),50)},onStateChange(r){const n=r.target;switch(clearInterval(e.timers.playing),e.media.seeking&&[1,2].includes(r.data)&&(e.media.seeking=!1,ee.call(e,e.media,"seeked")),r.data){case-1:ee.call(e,e.media,"timeupdate"),e.media.buffered=n.getVideoLoadedFraction(),ee.call(e,e.media,"progress");break;case 0:We.call(e,!1),e.media.loop?(n.stopVideo(),n.playVideo()):ee.call(e,e.media,"ended");break;case 1:t.customControls&&!e.config.autoplay&&e.media.paused&&!e.embed.hasPlayed?e.media.pause():(We.call(e,!0),ee.call(e,e.media,"playing"),e.timers.playing=setInterval((()=>{ee.call(e,e.media,"timeupdate")}),50),e.media.duration!==n.getDuration()&&(e.media.duration=n.getDuration(),ee.call(e,e.media,"durationchange")));break;case 2:e.muted||e.embed.unMute(),We.call(e,!1);break;case 3:ee.call(e,e.media,"waiting")}ee.call(e,e.elements.container,"statechange",!1,{code:r.data})}}})}},Ze={setup(){this.media?(z(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),z(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&z(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=_("div",{class:this.config.classNames.video}),F(this.media,this.elements.wrapper),this.elements.poster=_("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?fe.setup.call(this):this.isYouTube?Je.setup.call(this):this.isVimeo&&Ke.setup.call(this)):this.debug.warn("No media element found!")}};class Xe{constructor(t){e(this,"load",(()=>{this.enabled&&(T.object(window.google)&&T.object(window.google.ima)?this.ready():Ve(this.player.config.urls.googleIMA.sdk).then((()=>{this.ready()})).catch((()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))})))})),e(this,"ready",(()=>{var e;this.enabled||((e=this).manager&&e.manager.destroy(),e.elements.displayContainer&&e.elements.displayContainer.destroy(),e.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then((()=>{this.clearSafetyTimer("onAdsManagerLoaded()")})),this.listeners(),this.setupIMA()})),e(this,"setupIMA",(()=>{this.elements.container=_("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(e=>this.onAdsManagerLoaded(e)),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,(e=>this.onAdError(e)),!1),this.requestAds()})),e(this,"requestAds",(()=>{const{container:e}=this.player.elements;try{const t=new google.ima.AdsRequest;t.adTagUrl=this.tagUrl,t.linearAdSlotWidth=e.offsetWidth,t.linearAdSlotHeight=e.offsetHeight,t.nonLinearAdSlotWidth=e.offsetWidth,t.nonLinearAdSlotHeight=e.offsetHeight,t.forceNonLinearFullSlot=!1,t.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(t)}catch(e){this.onAdError(e)}})),e(this,"pollCountdown",((e=!1)=>{if(!e)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval((()=>{const e=Ce(Math.max(this.manager.getRemainingTime(),0)),t=`${we.get("advertisement",this.player.config)} - ${e}`;this.elements.container.setAttribute("data-badge-text",t)}),100)})),e(this,"onAdsManagerLoaded",(e=>{if(!this.enabled)return;const t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.enablePreloading=!0,this.manager=e.getAdsManager(this.player,t),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,(e=>this.onAdError(e))),Object.keys(google.ima.AdEvent.Type).forEach((e=>{this.manager.addEventListener(google.ima.AdEvent.Type[e],(e=>this.onAdEvent(e)))})),this.trigger("loaded")})),e(this,"addCuePoints",(()=>{T.empty(this.cuePoints)||this.cuePoints.forEach((e=>{if(0!==e&&-1!==e&&e<this.player.duration){const t=this.player.elements.progress;if(T.element(t)){const r=100/this.player.duration*e,n=_("span",{class:this.player.config.classNames.cues});n.style.left=`${r.toString()}%`,t.appendChild(n)}}}))})),e(this,"onAdEvent",(e=>{const{container:t}=this.player.elements,r=e.getAd(),n=e.getAdData();switch((e=>{ee.call(this.player,this.player.media,`ads${e.replace(/_/g,"").toLowerCase()}`)})(e.type),e.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),r.isLinear()||(r.width=t.offsetWidth,r.height=t.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:n.adError&&this.player.debug.warn(`Non-fatal ad error: ${n.adError.getMessage()}`)}})),e(this,"onAdError",(e=>{this.cancel(),this.player.debug.warn("Ads error",e)})),e(this,"listeners",(()=>{const{container:e}=this.player.elements;let t;this.player.on("canplay",(()=>{this.addCuePoints()})),this.player.on("ended",(()=>{this.loader.contentComplete()})),this.player.on("timeupdate",(()=>{t=this.player.currentTime})),this.player.on("seeked",(()=>{const e=this.player.currentTime;T.empty(this.cuePoints)||this.cuePoints.forEach(((r,n)=>{t<r&&r<e&&(this.manager.discardAdBreak(),this.cuePoints.splice(n,1))}))})),window.addEventListener("resize",(()=>{this.manager&&this.manager.resize(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL)}))})),e(this,"play",(()=>{const{container:e}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then((()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(e){this.onAdError(e)}})).catch((()=>{}))})),e(this,"resumeContent",(()=>{this.elements.container.style.zIndex="",this.playing=!1,ne(this.player.media.play())})),e(this,"pauseContent",(()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()})),e(this,"cancel",(()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()})),e(this,"loadAds",(()=>{this.managerPromise.then((()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise((e=>{this.on("loaded",e),this.player.debug.log(this.manager)})),this.initialized=!1,this.requestAds()})).catch((()=>{}))})),e(this,"trigger",((e,...t)=>{const r=this.events[e];T.array(r)&&r.forEach((e=>{T.function(e)&&e.apply(this,t)}))})),e(this,"on",((e,t)=>(T.array(this.events[e])||(this.events[e]=[]),this.events[e].push(t),this))),e(this,"startSafetyTimer",((e,t)=>{this.player.debug.log(`Safety timer invoked from: ${t}`),this.safetyTimer=setTimeout((()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")}),e)})),e(this,"clearSafetyTimer",(e=>{T.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${e}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)})),this.player=t,this.config=t.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise(((e,t)=>{this.on("loaded",e),this.on("error",t)})),this.load()}get enabled(){const{config:e}=this;return this.player.isHTML5&&this.player.isVideo&&e.enabled&&(!T.empty(e.publisherId)||T.url(e.tagUrl))}get tagUrl(){const{config:e}=this;return T.url(e.tagUrl)?e.tagUrl:`https://go.aniview.com/api/adserver6/vast/?${Me({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:e.publisherId})}`}}function Qe(e=0,t=0,r=255){return Math.min(Math.max(e,t),r)}const et=e=>{const t=[];return e.split(/\r\n\r\n|\n\n|\r\r/).forEach((e=>{const r={};e.split(/\r\n|\n|\r/).forEach((e=>{if(T.number(r.startTime)){if(!T.empty(e.trim())&&T.empty(r.text)){const t=e.trim().split("#xywh=");[r.text]=t,t[1]&&([r.x,r.y,r.w,r.h]=t[1].split(","))}}else{const t=e.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);t&&(r.startTime=60*Number(t[1]||0)*60+60*Number(t[2])+Number(t[3])+Number(`0.${t[4]}`),r.endTime=60*Number(t[6]||0)*60+60*Number(t[7])+Number(t[8])+Number(`0.${t[9]}`))}})),r.text&&t.push(r)})),t},tt=(e,t)=>{const r={};return e>t.width/t.height?(r.width=t.width,r.height=1/e*t.width):(r.height=t.height,r.width=e*t.height),r};class rt{constructor(t){e(this,"load",(()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then((()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)}))})),e(this,"getThumbnails",(()=>new Promise((e=>{const{src:t}=this.player.config.previewThumbnails;if(T.empty(t))throw new Error("Missing previewThumbnails.src config attribute");const r=()=>{this.thumbnails.sort(((e,t)=>e.height-t.height)),this.player.debug.log("Preview thumbnails",this.thumbnails),e()};if(T.function(t))t((e=>{this.thumbnails=e,r()}));else{const e=(T.string(t)?[t]:t).map((e=>this.getThumbnail(e)));Promise.all(e).then(r)}})))),e(this,"getThumbnail",(e=>new Promise((t=>{Ee(e).then((r=>{const n={frames:et(r),height:null,urlPrefix:""};n.frames[0].text.startsWith("/")||n.frames[0].text.startsWith("http://")||n.frames[0].text.startsWith("https://")||(n.urlPrefix=e.substring(0,e.lastIndexOf("/")+1));const i=new Image;i.onload=()=>{n.height=i.naturalHeight,n.width=i.naturalWidth,this.thumbnails.push(n),t()},i.src=n.urlPrefix+n.frames[0].text}))})))),e(this,"startMove",(e=>{if(this.loaded&&T.event(e)&&["touchmove","mousemove"].includes(e.type)&&this.player.media.duration){if("touchmove"===e.type)this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{var t,r;const n=this.player.elements.progress.getBoundingClientRect(),i=100/n.width*(e.pageX-n.left);this.seekTime=this.player.media.duration*(i/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=e.pageX,this.elements.thumb.time.innerText=Ce(this.seekTime);const s=null===(t=this.player.config.markers)||void 0===t||null===(r=t.points)||void 0===r?void 0:r.find((({time:e})=>e===Math.round(this.seekTime)));s&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${s.label}<br>`)}this.showImageAtCurrentTime()}})),e(this,"endMove",(()=>{this.toggleThumbContainer(!1,!0)})),e(this,"startScrubbing",(e=>{(T.nullOrUndefined(e.button)||!1===e.button||0===e.button)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))})),e(this,"endScrubbing",(()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):Q.call(this.player,this.player.media,"timeupdate",(()=>{this.mouseDown||this.toggleScrubbingContainer(!1)}))})),e(this,"listeners",(()=>{this.player.on("play",(()=>{this.toggleThumbContainer(!1,!0)})),this.player.on("seeked",(()=>{this.toggleThumbContainer(!1)})),this.player.on("timeupdate",(()=>{this.lastTime=this.player.media.currentTime}))})),e(this,"render",(()=>{this.elements.thumb.container=_("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=_("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const e=_("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=_("span",{},"00:00"),e.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(e),T.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=_("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)})),e(this,"destroy",(()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()})),e(this,"showImageAtCurrentTime",(()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const e=this.thumbnails[0].frames.findIndex((e=>this.seekTime>=e.startTime&&this.seekTime<=e.endTime)),t=e>=0;let r=0;this.mouseDown||this.toggleThumbContainer(t),t&&(this.thumbnails.forEach(((t,n)=>{this.loadedImages.includes(t.frames[e].text)&&(r=n)})),e!==this.showingThumb&&(this.showingThumb=e,this.loadImage(r)))})),e(this,"loadImage",((e=0)=>{const t=this.showingThumb,r=this.thumbnails[e],{urlPrefix:n}=r,i=r.frames[t],s=r.frames[t].text,a=n+s;if(this.currentImageElement&&this.currentImageElement.dataset.filename===s)this.showImage(this.currentImageElement,i,e,t,s,!1),this.currentImageElement.dataset.index=t,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const r=new Image;r.src=a,r.dataset.index=t,r.dataset.filename=s,this.showingThumbFilename=s,this.player.debug.log(`Loading image: ${a}`),r.onload=()=>this.showImage(r,i,e,t,s,!0),this.loadingImage=r,this.removeOldImages(r)}})),e(this,"showImage",((e,t,r,n,i,s=!0)=>{this.player.debug.log(`Showing thumb: ${i}. num: ${n}. qual: ${r}. newimg: ${s}`),this.setImageSizeAndOffset(e,t),s&&(this.currentImageContainer.appendChild(e),this.currentImageElement=e,this.loadedImages.includes(i)||this.loadedImages.push(i)),this.preloadNearby(n,!0).then(this.preloadNearby(n,!1)).then(this.getHigherQuality(r,e,t,i))})),e(this,"removeOldImages",(e=>{Array.from(this.currentImageContainer.children).forEach((t=>{if("img"!==t.tagName.toLowerCase())return;const r=this.usingSprites?500:1e3;if(t.dataset.index!==e.dataset.index&&!t.dataset.deleting){t.dataset.deleting=!0;const{currentImageContainer:e}=this;setTimeout((()=>{e.removeChild(t),this.player.debug.log(`Removing thumb: ${t.dataset.filename}`)}),r)}}))})),e(this,"preloadNearby",((e,t=!0)=>new Promise((r=>{setTimeout((()=>{const n=this.thumbnails[0].frames[e].text;if(this.showingThumbFilename===n){let i;i=t?this.thumbnails[0].frames.slice(e):this.thumbnails[0].frames.slice(0,e).reverse();let s=!1;i.forEach((e=>{const t=e.text;if(t!==n&&!this.loadedImages.includes(t)){s=!0,this.player.debug.log(`Preloading thumb filename: ${t}`);const{urlPrefix:e}=this.thumbnails[0],n=e+t,i=new Image;i.src=n,i.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${t}`),this.loadedImages.includes(t)||this.loadedImages.push(t),r()}}})),s||r()}}),300)})))),e(this,"getHigherQuality",((e,t,r,n)=>{if(e<this.thumbnails.length-1){let i=t.naturalHeight;this.usingSprites&&(i=r.h),i<this.thumbContainerHeight&&setTimeout((()=>{this.showingThumbFilename===n&&(this.player.debug.log(`Showing higher quality thumb for: ${n}`),this.loadImage(e+1))}),300)}})),e(this,"toggleThumbContainer",((e=!1,t=!1)=>{const r=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(r,e),!e&&t&&(this.showingThumb=null,this.showingThumbFilename=null)})),e(this,"toggleScrubbingContainer",((e=!1)=>{const t=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(t,e),e||(this.showingThumb=null,this.showingThumbFilename=null)})),e(this,"determineContainerAutoSizing",(()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)})),e(this,"setThumbContainerSizeAndPos",(()=>{const{imageContainer:e}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(e.clientHeight>20&&e.clientWidth<20){const t=Math.floor(e.clientHeight*this.thumbAspectRatio);e.style.width=`${t}px`}else if(e.clientHeight<20&&e.clientWidth>20){const t=Math.floor(e.clientWidth/this.thumbAspectRatio);e.style.height=`${t}px`}}else{const t=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);e.style.height=`${this.thumbContainerHeight}px`,e.style.width=`${t}px`}this.setThumbContainerPos()})),e(this,"setThumbContainerPos",(()=>{const e=this.player.elements.progress.getBoundingClientRect(),t=this.player.elements.container.getBoundingClientRect(),{container:r}=this.elements.thumb,n=t.left-e.left+10,i=t.right-e.left-r.clientWidth-10,s=this.mousePosX-e.left-r.clientWidth/2,a=Qe(s,n,i);r.style.left=`${a}px`,r.style.setProperty("--preview-arrow-offset",s-a+"px")})),e(this,"setScrubbingContainerSize",(()=>{const{width:e,height:t}=tt(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${e}px`,this.elements.scrubbing.container.style.height=`${t}px`})),e(this,"setImageSizeAndOffset",((e,t)=>{if(!this.usingSprites)return;const r=this.thumbContainerHeight/t.h;e.style.height=e.naturalHeight*r+"px",e.style.width=e.naturalWidth*r+"px",e.style.left=`-${t.x*r}px`,e.style.top=`-${t.y*r}px`})),this.player=t,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:e}=tt(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return e}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(e){this.mouseDown?this.currentScrubbingImageElement=e:this.currentThumbnailImageElement=e}}const nt={insertElements(e,t){T.string(t)?R(e,this.media,{src:t}):T.array(t)&&t.forEach((t=>{R(e,this.media,t)}))},change(e){M(e,"sources.length")?(fe.cancelRequests.call(this),this.destroy.call(this,(()=>{this.options.quality=[],I(this.media),this.media=null,T.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:t,type:r}=e,[{provider:n=Re.html5,src:i}]=t,s="html5"===n?r:"div",a="html5"===n?{}:{src:i};Object.assign(this,{provider:n,type:r,supported:W.check(r,n,this.config.playsinline),media:_(s,a)}),this.elements.container.appendChild(this.media),T.boolean(e.autoplay)&&(this.config.autoplay=e.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),T.empty(e.poster)||(this.poster=e.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),je.addStyleHook.call(this),this.isHTML5&&nt.insertElements.call(this,"source",t),this.config.title=e.title,Ze.setup.call(this),this.isHTML5&&Object.keys(e).includes("tracks")&&nt.insertElements.call(this,"track",e.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&je.build.call(this),this.isHTML5&&this.media.load(),T.empty(e.previewThumbnails)||(Object.assign(this.config.previewThumbnails,e.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new rt(this))),this.fullscreen.update()}),!0)):this.debug.warn("Invalid source format")}};class it{constructor(t,r){if(e(this,"play",(()=>T.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then((()=>this.ads.play())).catch((()=>ne(this.media.play()))),this.media.play()):null)),e(this,"pause",(()=>this.playing&&T.function(this.media.pause)?this.media.pause():null)),e(this,"togglePlay",(e=>(T.boolean(e)?e:!this.playing)?this.play():this.pause())),e(this,"stop",(()=>{this.isHTML5?(this.pause(),this.restart()):T.function(this.media.stop)&&this.media.stop()})),e(this,"restart",(()=>{this.currentTime=0})),e(this,"rewind",(e=>{this.currentTime-=T.number(e)?e:this.config.seekTime})),e(this,"forward",(e=>{this.currentTime+=T.number(e)?e:this.config.seekTime})),e(this,"increaseVolume",(e=>{const t=this.media.muted?0:this.volume;this.volume=t+(T.number(e)?e:0)})),e(this,"decreaseVolume",(e=>{this.increaseVolume(-e)})),e(this,"airplay",(()=>{W.airplay&&this.media.webkitShowPlaybackTargetPicker()})),e(this,"toggleControls",(e=>{if(this.supported.ui&&!this.isAudio){const t=j(this.elements.container,this.config.classNames.hideControls),r=void 0===e?void 0:!e,n=z(this.elements.container,this.config.classNames.hideControls,r);if(n&&T.array(this.config.controls)&&this.config.controls.includes("settings")&&!T.empty(this.config.settings)&&Ne.toggleMenu.call(this,!1),n!==t){const e=n?"controlshidden":"controlsshown";ee.call(this,this.media,e)}return!n}return!1})),e(this,"on",((e,t)=>{Z.call(this,this.elements.container,e,t)})),e(this,"once",((e,t)=>{Q.call(this,this.elements.container,e,t)})),e(this,"off",((e,t)=>{X(this.elements.container,e,t)})),e(this,"destroy",((e,t=!1)=>{if(!this.ready)return;const r=()=>{document.body.style.overflow="",this.embed=null,t?(Object.keys(this.elements).length&&(I(this.elements.buttons.play),I(this.elements.captions),I(this.elements.controls),I(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),T.function(e)&&e()):(te.call(this),fe.cancelRequests.call(this),B(this.elements.original,this.elements.container),ee.call(this,this.elements.original,"destroyed",!0),T.function(e)&&e.call(this.elements.original),this.ready=!1,setTimeout((()=>{this.elements=null,this.media=null}),200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(je.toggleNativeControls.call(this,!0),r()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),null!==this.embed&&T.function(this.embed.destroy)&&this.embed.destroy(),r()):this.isVimeo&&(null!==this.embed&&this.embed.unload().then(r),setTimeout(r,200))})),e(this,"supports",(e=>W.mime.call(this,e))),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=W.touch,this.media=t,T.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||T.nodeList(this.media)||T.array(this.media))&&(this.media=this.media[0]),this.config=O({},Fe,it.defaults,r||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch(e){return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new Ue(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",W),T.nullOrUndefined(this.media)||!T.element(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!W.check().api)return void this.debug.error("Setup failed: no support");const n=this.media.cloneNode(!0);n.autoplay=!1,this.elements.original=n;const i=this.media.tagName.toLowerCase();let s=null,a=null;switch(i){case"div":if(s=this.media.querySelector("iframe"),T.element(s)){if(a=ke(s.getAttribute("src")),this.provider=function(e){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(e)?Re.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(e)?Re.vimeo:null}(a.toString()),this.elements.container=this.media,this.media=s,this.elements.container.className="",a.search.length){const e=["1","true"];e.includes(a.searchParams.get("autoplay"))&&(this.config.autoplay=!0),e.includes(a.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=e.includes(a.searchParams.get("playsinline")),this.config.youtube.hl=a.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(T.empty(this.provider)||!Object.values(Re).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=Pe;break;case"video":case"audio":this.type=i,this.provider=Re.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=W.check(this.type,this.provider),this.supported.api?(this.eventListeners=[],this.listeners=new qe(this),this.storage=new xe(this),this.media.plyr=this,T.element(this.elements.container)||(this.elements.container=_("div"),F(this.media,this.elements.container)),je.migrateStyles.call(this),je.addStyleHook.call(this),Ze.setup.call(this),this.config.debug&&Z.call(this,this.elements.container,this.config.events.join(" "),(e=>{this.debug.log(`event: ${e.type}`)})),this.fullscreen=new $e(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&je.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new Xe(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",(()=>ne(this.play()))),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new rt(this))):this.debug.error("Setup failed: no support")}get isHTML5(){return this.provider===Re.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===Re.youtube}get isVimeo(){return this.provider===Re.vimeo}get isVideo(){return this.type===Pe}get isAudio(){return this.type===Ie}get playing(){return Boolean(this.ready&&!this.paused&&!this.ended)}get paused(){return Boolean(this.media.paused)}get stopped(){return Boolean(this.paused&&0===this.currentTime)}get ended(){return Boolean(this.media.ended)}set currentTime(e){if(!this.duration)return;const t=T.number(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:e}=this.media;return T.number(e)?e:e&&e.length&&this.duration>0?e.end(0)/this.duration:0}get seeking(){return Boolean(this.media.seeking)}get duration(){const e=parseFloat(this.config.duration),t=(this.media||{}).duration,r=T.number(t)&&t!==1/0?t:0;return e||r}set volume(e){let t=e;T.string(t)&&(t=Number(t)),T.number(t)||(t=this.storage.get("volume")),T.number(t)||({volume:t}=this.config),t>1&&(t=1),t<0&&(t=0),this.config.volume=t,this.media.volume=t,!T.empty(e)&&this.muted&&t>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(e){let t=e;T.boolean(t)||(t=this.storage.get("muted")),T.boolean(t)||(t=this.config.muted),this.config.muted=t,this.media.muted=t}get muted(){return Boolean(this.media.muted)}get hasAudio(){return!this.isHTML5||!!this.isAudio||Boolean(this.media.mozHasAudio)||Boolean(this.media.webkitAudioDecodedByteCount)||Boolean(this.media.audioTracks&&this.media.audioTracks.length)}set speed(e){let t=null;T.number(e)&&(t=e),T.number(t)||(t=this.storage.get("speed")),T.number(t)||(t=this.config.speed.selected);const{minimumSpeed:r,maximumSpeed:n}=this;t=Qe(t,r,n),this.config.speed.selected=t,setTimeout((()=>{this.media&&(this.media.playbackRate=t)}),0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(e){const t=this.config.quality,r=this.options.quality;if(!r.length)return;let n=[!T.empty(e)&&Number(e),this.storage.get("quality"),t.selected,t.default].find(T.number),i=!0;if(!r.includes(n)){const e=se(r,n);this.debug.warn(`Unsupported quality option: ${n}, using ${e} instead`),n=e,i=!1}t.selected=n,this.media.quality=n,i&&this.storage.set({quality:n})}get quality(){return this.media.quality}set loop(e){const t=T.boolean(e)?e:this.config.loop.active;this.config.loop.active=t,this.media.loop=t}get loop(){return Boolean(this.media.loop)}set source(e){nt.change.call(this,e)}get source(){return this.media.currentSrc}get download(){const{download:e}=this.config.urls;return T.url(e)?e:this.source}set download(e){T.url(e)&&(this.config.urls.download=e,Ne.setDownloadUrl.call(this))}set poster(e){this.isVideo?je.setPoster.call(this,e,!1).catch((()=>{})):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const e=ue(ce.call(this));return T.array(e)?e.join(":"):e}set ratio(e){this.isVideo?T.string(e)&&le(e)?(this.config.ratio=ue(e),de.call(this)):this.debug.error(`Invalid aspect ratio specified (${e})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(e){this.config.autoplay=T.boolean(e)?e:this.config.autoplay}get autoplay(){return Boolean(this.config.autoplay)}toggleCaptions(e){Oe.toggle.call(this,e,!1)}set currentTrack(e){Oe.set.call(this,e,!1),Oe.setup.call(this)}get currentTrack(){const{toggled:e,currentTrack:t}=this.captions;return e?t:-1}set language(e){Oe.setLanguage.call(this,e,!1)}get language(){return(Oe.getCurrentTrack.call(this)||{}).language}set pip(e){if(!W.pip)return;const t=T.boolean(e)?e:!this.pip;T.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(t?Le:_e),T.function(this.media.requestPictureInPicture)&&(!this.pip&&t?this.media.requestPictureInPicture():this.pip&&!t&&document.exitPictureInPicture())}get pip(){return W.pip?T.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===Le:null}setPreviewThumbnails(e){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,e),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new rt(this))}static supported(e,t){return W.check(e,t)}static loadSprite(e,t){return De(e,t)}static setup(e,t={}){let r=null;return T.string(e)?r=Array.from(document.querySelectorAll(e)):T.nodeList(e)?r=Array.from(e):T.array(e)&&(r=e.filter(T.element)),T.empty(r)?null:r.map((e=>new it(e,t)))}}var st;return it.defaults=(st=Fe,JSON.parse(JSON.stringify(st))),it}())},6377:(e,t,r)=>{var n=r(4832),i=r(8652),s=r(801),a=r(2030),o=r(3618),l=r(9049),u=r(1971);u.alea=n,u.xor128=i,u.xorwow=s,u.xorshift7=a,u.xor4096=o,u.tychei=l,e.exports=u},4832:function(e,t,r){var n;!function(e,i,s){function a(e){var t=this,r=function(){var e=4022871197,t=function(t){t=String(t);for(var r=0;r<t.length;r++){var n=.02519603282416938*(e+=t.charCodeAt(r));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=r(" "),t.s1=r(" "),t.s2=r(" "),t.s0-=r(e),t.s0<0&&(t.s0+=1),t.s1-=r(e),t.s1<0&&(t.s1+=1),t.s2-=r(e),t.s2<0&&(t.s2+=1),r=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var r=new a(e),n=t&&t.state,i=r.next;return i.int32=function(){return 4294967296*r.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,n&&("object"==typeof n&&o(n,r),i.state=function(){return o(r,{})}),i}i&&i.exports?i.exports=l:r.amdD&&r.amdO?void 0===(n=function(){return l}.call(t,r,t,i))||(i.exports=n):this.alea=l}(0,e=r.nmd(e),r.amdD)},9049:function(e,t,r){var n;!function(e,i,s){function a(e){var t=this,r="";t.next=function(){var e=t.b,r=t.c,n=t.d,i=t.a;return e=e<<25^e>>>7^r,r=r-n|0,n=n<<24^n>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^r,t.c=r=r-n|0,t.d=n<<16^r>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):r+=e;for(var n=0;n<r.length+20;n++)t.b^=0|r.charCodeAt(n),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var r=new a(e),n=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=r.next,i.quick=i,n&&("object"==typeof n&&o(n,r),i.state=function(){return o(r,{})}),i}i&&i.exports?i.exports=l:r.amdD&&r.amdO?void 0===(n=function(){return l}.call(t,r,t,i))||(i.exports=n):this.tychei=l}(0,e=r.nmd(e),r.amdD)},8652:function(e,t,r){var n;!function(e,i,s){function a(e){var t=this,r="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:r+=e;for(var n=0;n<r.length+64;n++)t.x^=0|r.charCodeAt(n),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var r=new a(e),n=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=r.next,i.quick=i,n&&("object"==typeof n&&o(n,r),i.state=function(){return o(r,{})}),i}i&&i.exports?i.exports=l:r.amdD&&r.amdO?void 0===(n=function(){return l}.call(t,r,t,i))||(i.exports=n):this.xor128=l}(0,e=r.nmd(e),r.amdD)},3618:function(e,t,r){var n;!function(e,i,s){function a(e){var t=this;t.next=function(){var e,r,n=t.w,i=t.X,s=t.i;return t.w=n=n+1640531527|0,r=i[s+34&127],e=i[s=s+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,r=i[s]=r^e,t.i=s,r+(n^n>>>16)|0},function(e,t){var r,n,i,s,a,o=[],l=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,l=Math.max(l,t.length)),i=0,s=-32;s<l;++s)t&&(n^=t.charCodeAt((s+32)%t.length)),0===s&&(a=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,s>=0&&(a=a+1640531527|0,i=0==(r=o[127&s]^=n+a)?i+1:0);for(i>=128&&(o[127&(t&&t.length||0)]=-1),i=127,s=512;s>0;--s)n=o[i+34&127],r=o[i=i+1&127],n^=n<<13,r^=r<<17,n^=n>>>15,r^=r>>>12,o[i]=n^r;e.w=a,e.X=o,e.i=i}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var r=new a(e),n=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=r.next,i.quick=i,n&&(n.X&&o(n,r),i.state=function(){return o(r,{})}),i}i&&i.exports?i.exports=l:r.amdD&&r.amdO?void 0===(n=function(){return l}.call(t,r,t,i))||(i.exports=n):this.xor4096=l}(0,e=r.nmd(e),r.amdD)},2030:function(e,t,r){var n;!function(e,i,s){function a(e){var t=this;t.next=function(){var e,r,n=t.x,i=t.i;return e=n[i],r=(e^=e>>>7)^e<<24,r^=(e=n[i+1&7])^e>>>10,r^=(e=n[i+3&7])^e>>>3,r^=(e=n[i+4&7])^e<<7,e=n[i+7&7],r^=(e^=e<<13)^e<<9,n[i]=r,t.i=i+1&7,r},function(e,t){var r,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,r=0;r<t.length;++r)n[7&r]=n[7&r]<<15^t.charCodeAt(r)+n[r+1&7]<<13;for(;n.length<8;)n.push(0);for(r=0;r<8&&0===n[r];++r);for(8==r?n[7]=-1:n[r],e.x=n,e.i=0,r=256;r>0;--r)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var r=new a(e),n=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=r.next,i.quick=i,n&&(n.x&&o(n,r),i.state=function(){return o(r,{})}),i}i&&i.exports?i.exports=l:r.amdD&&r.amdO?void 0===(n=function(){return l}.call(t,r,t,i))||(i.exports=n):this.xorshift7=l}(0,e=r.nmd(e),r.amdD)},801:function(e,t,r){var n;!function(e,i,s){function a(e){var t=this,r="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:r+=e;for(var n=0;n<r.length+64;n++)t.x^=0|r.charCodeAt(n),n==r.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var r=new a(e),n=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do{var e=((r.next()>>>11)+(r.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=r.next,i.quick=i,n&&("object"==typeof n&&o(n,r),i.state=function(){return o(r,{})}),i}i&&i.exports?i.exports=l:r.amdD&&r.amdO?void 0===(n=function(){return l}.call(t,r,t,i))||(i.exports=n):this.xorwow=l}(0,e=r.nmd(e),r.amdD)},1971:function(e,t,r){var n;!function(i,s,a){var o,l=256,u=a.pow(l,6),c=a.pow(2,52),d=2*c,h=l-1;function f(e,t,r){var n=[],h=y(g((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(s)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(l):(e=new Uint8Array(l),(i.crypto||i.msCrypto).getRandomValues(e)),v(e)}catch(e){var t=i.navigator,r=t&&t.plugins;return[+new Date,i,r,i.screen,v(s)]}}():e,3),n),f=new p(n),b=function(){for(var e=f.g(6),t=u,r=0;e<c;)e=(e+r)*l,t*=l,r=f.g(1);for(;e>=d;)e/=2,t/=2,r>>>=1;return(e+r)/t};return b.int32=function(){return 0|f.g(4)},b.quick=function(){return f.g(4)/4294967296},b.double=b,y(v(f.S),s),(t.pass||r||function(e,t,r,n){return n&&(n.S&&m(n,f),e.state=function(){return m(f,{})}),r?(a.random=e,t):e})(b,h,"global"in t?t.global:this==a,t.state)}function p(e){var t,r=e.length,n=this,i=0,s=n.i=n.j=0,a=n.S=[];for(r||(e=[r++]);i<l;)a[i]=i++;for(i=0;i<l;i++)a[i]=a[s=h&s+e[i%r]+(t=a[i])],a[s]=t;(n.g=function(e){for(var t,r=0,i=n.i,s=n.j,a=n.S;e--;)t=a[i=h&i+1],r=r*l+a[h&(a[i]=a[s=h&s+t])+(a[s]=t)];return n.i=i,n.j=s,r})(l)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var r,n=[],i=typeof e;if(t&&"object"==i)for(r in e)try{n.push(g(e[r],t-1))}catch(e){}return n.length?n:"string"==i?e:e+"\0"}function y(e,t){for(var r,n=e+"",i=0;i<n.length;)t[h&i]=h&(r^=19*t[h&i])+n.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(y(a.random(),s),e.exports){e.exports=f;try{o=r(5042)}catch(e){}}else void 0===(n=function(){return f}.call(t,r,t,e))||(e.exports=n)}("undefined"!=typeof self?self:this,[],Math)},5042:()=>{},4814:function(e){e.exports=function(){"use strict";function e(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=t(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var i=0,s=function(){};return{s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function t(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){return!0}function s(){return!1}function a(){}var o="Argument is not a typed-function.";function l(){function t(e){return"object"===n(e)&&null!==e&&e.constructor===Object}var r,u,c=[{name:"number",test:function(e){return"number"==typeof e}},{name:"string",test:function(e){return"string"==typeof e}},{name:"boolean",test:function(e){return"boolean"==typeof e}},{name:"Function",test:function(e){return"function"==typeof e}},{name:"Array",test:Array.isArray},{name:"Date",test:function(e){return e instanceof Date}},{name:"RegExp",test:function(e){return e instanceof RegExp}},{name:"Object",test:t},{name:"null",test:function(e){return null===e}},{name:"undefined",test:function(e){return void 0===e}}],d={name:"any",test:i,isAny:!0},h=0,f={createCount:0};function p(t){var n=r.get(t);if(n)return n;var i,s,a='Unknown type "'+t+'"',o=t.toLowerCase(),l=e(u);try{for(l.s();!(s=l.n()).done;)if((i=s.value).toLowerCase()===o){a+='. Did you mean "'+i+'" ?';break}}catch(e){l.e(e)}finally{l.f()}throw new TypeError(a)}function m(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"any",n=t?p(t).index:u.length,i=[],s=0;s<e.length;++s){if(!e[s]||"string"!=typeof e[s].name||"function"!=typeof e[s].test)throw new TypeError("Object with properties {name: string, test: function} expected");var a=e[s].name;if(r.has(a))throw new TypeError('Duplicate type name "'+a+'"');i.push(a),r.set(a,{name:a,test:e[s].test,isAny:e[s].isAny,index:n+s,conversionsTo:[]})}var o=u.slice(n);u=u.slice(0,n).concat(i).concat(o);for(var l=n+i.length;l<u.length;++l)r.get(u[l]).index=l}function g(){r=new Map,u=[],h=0,m([d],!1)}function y(){var t,n,i=e(u);try{for(i.s();!(n=i.n()).done;)t=n.value,r.get(t).conversionsTo=[]}catch(e){i.e(e)}finally{i.f()}h=0}function v(e){var t=u.filter((function(t){var n=r.get(t);return!n.isAny&&n.test(e)}));return t.length?t:["any"]}function b(e){return e&&"function"==typeof e&&"_typedFunctionData"in e}function w(t,r,n){if(!b(t))throw new TypeError(o);var i=n&&n.exact,s=C(Array.isArray(r)?r.join(","):r),a=D(s);if(!i||a in t.signatures){var l=t._typedFunctionData.signatureMap.get(a);if(l)return l}var u,c,d,h=s.length;if(i)for(c in u=[],t.signatures)u.push(t._typedFunctionData.signatureMap.get(c));else u=t._typedFunctionData.signatures;for(var f=0;f<h;++f){var p,m=s[f],g=[],y=void 0,v=e(u);try{for(v.s();!(p=v.n()).done;){var w=O((y=p.value).params,f);if(w&&(!m.restParam||w.restParam)){if(!w.hasAny&&"continue"===function(){var e=T(w);if(m.types.some((function(t){return!e.has(t.name)})))return"continue"}())continue;g.push(y)}}}catch(e){v.e(e)}finally{v.f()}if(0===(u=g).length)break}var x,E=e(u);try{for(E.s();!(x=E.n()).done;)if((d=x.value).params.length<=h)return d}catch(e){E.e(e)}finally{E.f()}throw new TypeError("Signature not found (signature: "+(t.name||"unnamed")+"("+D(s,", ")+"))")}function x(e,t,r){return w(e,t,r).implementation}function E(e,t){var r=p(t);if(r.test(e))return e;var n=r.conversionsTo;if(0===n.length)throw new Error("There are no conversions to "+t+" defined.");for(var i=0;i<n.length;i++)if(p(n[i].from).test(e))return n[i].convert(e);throw new Error("Cannot convert "+e+" to "+t)}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return e.map((function(e){return e.name})).join(t)}function S(e){var t=0===e.indexOf("..."),r=(t?e.length>3?e.slice(3):"any":e).split("|").map((function(e){return p(e.trim())})),n=!1,i=t?"...":"";return{types:r.map((function(e){return n=e.isAny||n,i+=e.name+"|",{name:e.name,typeIndex:e.index,test:e.test,isAny:e.isAny,conversion:null,conversionIndex:-1}})),name:i.slice(0,-1),hasAny:n,hasConversion:!1,restParam:t}}function A(e){var t=$(e.types.map((function(e){return e.name}))),r=e.hasAny,n=e.name,i=t.map((function(e){var t=p(e.from);return r=t.isAny||r,n+="|"+e.from,{name:e.from,typeIndex:t.index,test:t.test,isAny:t.isAny,conversion:e,conversionIndex:e.index}}));return{types:e.types.concat(i),name:n,hasAny:r,hasConversion:i.length>0,restParam:e.restParam}}function T(e){return e.typeSet||(e.typeSet=new Set,e.types.forEach((function(t){return e.typeSet.add(t.name)}))),e.typeSet}function C(e){var t=[];if("string"!=typeof e)throw new TypeError("Signatures must be strings");var r=e.trim();if(""===r)return t;for(var n=r.split(","),i=0;i<n.length;++i){var s=S(n[i].trim());if(s.restParam&&i!==n.length-1)throw new SyntaxError('Unexpected rest parameter "'+n[i]+'": only allowed for the last parameter');if(0===s.types.length)return null;t.push(s)}return t}function N(e){var t=X(e);return!!t&&t.restParam}function k(e){if(e&&0!==e.types.length){if(1===e.types.length)return p(e.types[0].name).test;if(2===e.types.length){var t=p(e.types[0].name).test,r=p(e.types[1].name).test;return function(e){return t(e)||r(e)}}var n=e.types.map((function(e){return p(e.name).test}));return function(e){for(var t=0;t<n.length;t++)if(n[t](e))return!0;return!1}}return i}function M(e){var t,r,n;if(N(e)){var i=(t=Z(e).map(k)).length,s=k(X(e)),a=function(e){for(var t=i;t<e.length;t++)if(!s(e[t]))return!1;return!0};return function(e){for(var r=0;r<t.length;r++)if(!t[r](e[r]))return!1;return a(e)&&e.length>=i+1}}return 0===e.length?function(e){return 0===e.length}:1===e.length?(r=k(e[0]),function(e){return r(e[0])&&1===e.length}):2===e.length?(r=k(e[0]),n=k(e[1]),function(e){return r(e[0])&&n(e[1])&&2===e.length}):(t=e.map(k),function(e){for(var r=0;r<t.length;r++)if(!t[r](e[r]))return!1;return e.length===t.length})}function O(e,t){return t<e.length?e[t]:N(e)?X(e):null}function F(e,t){var r=O(e,t);return r?T(r):new Set}function L(e){return null===e.conversion||void 0===e.conversion}function _(t,r){var n=new Set;return t.forEach((function(t){var i,s,a=e(F(t.params,r));try{for(a.s();!(s=a.n()).done;)i=s.value,n.add(i)}catch(e){a.e(e)}finally{a.f()}})),n.has("any")?["any"]:Array.from(n)}function R(e,t,r){var i,s,a,o=e||"unnamed",l=r,u=function(){var e=[];if(l.forEach((function(r){var n=k(O(r.params,a));(a<r.params.length||N(r.params))&&n(t[a])&&e.push(r)})),0===e.length){if((s=_(l,a)).length>0){var r=v(t[a]);return(i=new TypeError("Unexpected type of argument in function "+o+" (expected: "+s.join(" or ")+", actual: "+r.join(" | ")+", index: "+a+")")).data={category:"wrongType",fn:o,index:a,actual:r,expected:s},{v:i}}}else l=e};for(a=0;a<t.length;a++){var c=u();if("object"===n(c))return c.v}var d=l.map((function(e){return N(e.params)?1/0:e.params.length}));if(t.length<Math.min.apply(null,d))return s=_(l,a),(i=new TypeError("Too few arguments in function "+o+" (expected: "+s.join(" or ")+", index: "+t.length+")")).data={category:"tooFewArgs",fn:o,index:t.length,expected:s},i;var h=Math.max.apply(null,d);if(t.length>h)return(i=new TypeError("Too many arguments in function "+o+" (expected: "+h+", actual: "+t.length+")")).data={category:"tooManyArgs",fn:o,index:t.length,expectedLength:h},i;for(var f=[],p=0;p<t.length;++p)f.push(v(t[p]).join("|"));return(i=new TypeError('Arguments of type "'+f.join(", ")+'" do not match any of the defined signatures of function '+o+".")).data={category:"mismatch",actual:f},i}function I(e){for(var t=u.length+1,r=0;r<e.types.length;r++)L(e.types[r])&&(t=Math.min(t,e.types[r].typeIndex));return t}function P(e){for(var t=h+1,r=0;r<e.types.length;r++)L(e.types[r])||(t=Math.min(t,e.types[r].conversionIndex));return t}function B(e,t){if(e.hasAny){if(!t.hasAny)return 1}else if(t.hasAny)return-1;if(e.restParam){if(!t.restParam)return 1}else if(t.restParam)return-1;if(e.hasConversion){if(!t.hasConversion)return 1}else if(t.hasConversion)return-1;var r=I(e)-I(t);if(r<0)return-1;if(r>0)return 1;var n=P(e)-P(t);return n<0?-1:n>0?1:0}function U(t,r){var n=t.params,i=r.params,s=X(n),a=X(i),o=N(n),l=N(i);if(o&&s.hasAny){if(!l||!a.hasAny)return 1}else if(l&&a.hasAny)return-1;var u,c,d=0,h=0,f=e(n);try{for(f.s();!(c=f.n()).done;)(u=c.value).hasAny&&++d,u.hasConversion&&++h}catch(e){f.e(e)}finally{f.f()}var p,m=0,g=0,y=e(i);try{for(y.s();!(p=y.n()).done;)(u=p.value).hasAny&&++m,u.hasConversion&&++g}catch(e){y.e(e)}finally{y.f()}if(d!==m)return d-m;if(o&&s.hasConversion){if(!l||!a.hasConversion)return 1}else if(l&&a.hasConversion)return-1;if(h!==g)return h-g;if(o){if(!l)return 1}else if(l)return-1;var v=(n.length-i.length)*(o?-1:1);if(0!==v)return v;for(var b,w=[],x=0,E=0;E<n.length;++E){var D=B(n[E],i[E]);w.push(D),x+=D}if(0!==x)return x;for(var S=0,A=w;S<A.length;S++)if(0!==(b=A[S]))return b;return 0}function $(t){if(0===t.length)return[];var r=t.map(p);t.length>1&&r.sort((function(e,t){return e.index-t.index}));var n=r[0].conversionsTo;if(1===t.length)return n;n=n.concat([]);for(var i=new Set(t),s=1;s<r.length;++s){var a,o=void 0,l=e(r[s].conversionsTo);try{for(l.s();!(a=l.n()).done;)o=a.value,i.has(o.from)||(n.push(o),i.add(o.from))}catch(e){l.e(e)}finally{l.f()}}return n}function z(e,t){var r=t;if(e.some((function(e){return e.hasConversion}))){var n=N(e),i=e.map(j);r=function(){for(var e=[],r=n?arguments.length-1:arguments.length,s=0;s<r;s++)e[s]=i[s](arguments[s]);return n&&(e[r]=arguments[r].map(i[r])),t.apply(this,e)}}var s=r;if(N(e)){var a=e.length-1;s=function(){return r.apply(this,Q(arguments,0,a).concat([Q(arguments,a)]))}}return s}function j(e){var t,r,n,i,s=[],a=[];switch(e.types.forEach((function(e){e.conversion&&(s.push(p(e.conversion.from).test),a.push(e.conversion.convert))})),a.length){case 0:return function(e){return e};case 1:return t=s[0],n=a[0],function(e){return t(e)?n(e):e};case 2:return t=s[0],r=s[1],n=a[0],i=a[1],function(e){return t(e)?n(e):r(e)?i(e):e};default:return function(e){for(var t=0;t<a.length;t++)if(s[t](e))return a[t](e);return e}}}function q(e){function t(e,r,n){if(r<e.length){var i=e[r],s=[];if(i.restParam){var a=i.types.filter(L);a.length<i.types.length&&s.push({types:a,name:"..."+a.map((function(e){return e.name})).join("|"),hasAny:a.some((function(e){return e.isAny})),hasConversion:!1,restParam:!0}),s.push(i)}else s=i.types.map((function(e){return{types:[e],name:e.name,hasAny:e.isAny,hasConversion:e.conversion,restParam:!1}}));return te(s,(function(i){return t(e,r+1,n.concat([i]))}))}return[n]}return t(e,0,[])}function H(t,r){for(var n=Math.max(t.length,r.length),i=0;i<n;i++){var s,a=F(t,i),o=!1,l=void 0,u=e(F(r,i));try{for(u.s();!(s=u.n()).done;)if(l=s.value,a.has(l)){o=!0;break}}catch(e){u.e(e)}finally{u.f()}if(!o)return!1}var c=t.length,d=r.length,h=N(t),f=N(r);return h?f?c===d:d>=c:f?c>=d:c===d}function V(e){return e.map((function(e){return ae(e)?ie(e.referToSelf.callback):se(e)?ne(e.referTo.references,e.referTo.callback):e}))}function G(t,r,n){var i,s,a=[],o=e(t);try{for(o.s();!(s=o.n()).done;){var l=n[i=s.value];if("number"!=typeof l)throw new TypeError('No definition for referenced signature "'+i+'"');if("function"!=typeof(l=r[l]))return!1;a.push(l)}}catch(e){o.e(e)}finally{o.f()}return a}function K(e,t,r){for(var n=V(e),i=new Array(n.length).fill(!1),s=!0;s;){s=!1;for(var a=!0,o=0;o<n.length;++o)if(!i[o]){var l=n[o];if(ae(l))n[o]=l.referToSelf.callback(r),n[o].referToSelf=l.referToSelf,i[o]=!0,a=!1;else if(se(l)){var u=G(l.referTo.references,n,t);u?(n[o]=l.referTo.callback.apply(this,u),n[o].referTo=l.referTo,i[o]=!0,a=!1):s=!0}}if(a&&s)throw new SyntaxError("Circular reference detected in resolving typed.referTo")}return n}function W(e){var t=/\bthis(\(|\.signatures\b)/;Object.keys(e).forEach((function(r){var n=e[r];if(t.test(n.toString()))throw new SyntaxError("Using `this` to self-reference a function is deprecated since typed-function@3. Use typed.referTo and typed.referToSelf instead.")}))}function Y(t,r){if(f.createCount++,0===Object.keys(r).length)throw new SyntaxError("No signatures provided");f.warnAgainstDeprecatedThis&&W(r);var n,i=[],o=[],l={},u=[],c=function(){if(!Object.prototype.hasOwnProperty.call(r,n))return"continue";var t=C(n);if(!t)return"continue";i.forEach((function(e){if(H(e,t))throw new TypeError('Conflicting signatures "'+D(e)+'" and "'+D(t)+'".')})),i.push(t);var s=o.length;o.push(r[n]);var a,c=void 0,d=e(q(t.map(A)));try{for(d.s();!(a=d.n()).done;){var h=D(c=a.value);u.push({params:c,name:h,fn:s}),c.every((function(e){return!e.hasConversion}))&&(l[h]=s)}}catch(e){d.e(e)}finally{d.f()}};for(n in r)c();u.sort(U);var d,h=K(o,l,pe);for(d in l)Object.prototype.hasOwnProperty.call(l,d)&&(l[d]=h[l[d]]);for(var p=[],m=new Map,g=0,y=u;g<y.length;g++)d=y[g],m.has(d.name)||(d.fn=h[d.fn],p.push(d),m.set(d.name,d));for(var v=p[0]&&p[0].params.length<=2&&!N(p[0].params),b=p[1]&&p[1].params.length<=2&&!N(p[1].params),w=p[2]&&p[2].params.length<=2&&!N(p[2].params),x=p[3]&&p[3].params.length<=2&&!N(p[3].params),E=p[4]&&p[4].params.length<=2&&!N(p[4].params),S=p[5]&&p[5].params.length<=2&&!N(p[5].params),T=v&&b&&w&&x&&E&&S,O=0;O<p.length;++O)p[O].test=M(p[O].params);for(var F=v?k(p[0].params[0]):s,L=b?k(p[1].params[0]):s,_=w?k(p[2].params[0]):s,R=x?k(p[3].params[0]):s,I=E?k(p[4].params[0]):s,P=S?k(p[5].params[0]):s,B=v?k(p[0].params[1]):s,$=b?k(p[1].params[1]):s,j=w?k(p[2].params[1]):s,V=x?k(p[3].params[1]):s,G=E?k(p[4].params[1]):s,Y=S?k(p[5].params[1]):s,J=0;J<p.length;++J)p[J].implementation=z(p[J].params,p[J].fn);var Z=v?p[0].implementation:a,X=b?p[1].implementation:a,Q=w?p[2].implementation:a,ee=x?p[3].implementation:a,te=E?p[4].implementation:a,re=S?p[5].implementation:a,ne=v?p[0].params.length:-1,ie=b?p[1].params.length:-1,se=w?p[2].params.length:-1,ae=x?p[3].params.length:-1,oe=E?p[4].params.length:-1,le=S?p[5].params.length:-1,ue=T?6:0,ce=p.length,de=p.map((function(e){return e.test})),he=p.map((function(e){return e.implementation})),fe=function(){for(var e=ue;e<ce;e++)if(de[e](arguments))return he[e].apply(this,arguments);return f.onMismatch(t,arguments,p)};function pe(e,t){return arguments.length===ne&&F(e)&&B(t)?Z.apply(this,arguments):arguments.length===ie&&L(e)&&$(t)?X.apply(this,arguments):arguments.length===se&&_(e)&&j(t)?Q.apply(this,arguments):arguments.length===ae&&R(e)&&V(t)?ee.apply(this,arguments):arguments.length===oe&&I(e)&&G(t)?te.apply(this,arguments):arguments.length===le&&P(e)&&Y(t)?re.apply(this,arguments):fe.apply(this,arguments)}try{Object.defineProperty(pe,"name",{value:t})}catch(e){}return pe.signatures=l,pe._typedFunctionData={signatures:p,signatureMap:m},pe}function J(e,t,r){throw R(e,t,r)}function Z(e){return Q(e,0,e.length-1)}function X(e){return e[e.length-1]}function Q(e,t,r){return Array.prototype.slice.call(e,t,r)}function ee(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return e[r]}function te(e,t){return Array.prototype.concat.apply([],e.map(t))}function re(){var e=Z(arguments).map((function(e){return D(C(e))})),t=X(arguments);if("function"!=typeof t)throw new TypeError("Callback function expected as last argument");return ne(e,t)}function ne(e,t){return{referTo:{references:e,callback:t}}}function ie(e){if("function"!=typeof e)throw new TypeError("Callback function expected as first argument");return{referToSelf:{callback:e}}}function se(e){return e&&"object"===n(e.referTo)&&Array.isArray(e.referTo.references)&&"function"==typeof e.referTo.callback}function ae(e){return e&&"object"===n(e.referToSelf)&&"function"==typeof e.referToSelf.callback}function oe(e,t){if(!e)return t;if(t&&t!==e){var r=new Error("Function names do not match (expected: "+e+", actual: "+t+")");throw r.data={actual:t,expected:e},r}return e}function le(e){var t;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(b(e[r])||"string"==typeof e[r].signature)&&(t=oe(t,e[r].name));return t}function ue(e,t){var r;for(r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(r in e&&t[r]!==e[r]){var n=new Error('Signature "'+r+'" is defined twice');throw n.data={signature:r,sourceFunction:t[r],destFunction:e[r]},n}e[r]=t[r]}}g(),m(c);var ce=f;function de(e){if(!e||"string"!=typeof e.from||"string"!=typeof e.to||"function"!=typeof e.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");if(e.to===e.from)throw new SyntaxError('Illegal to define conversion from "'+e.from+'" to itself.')}return f=function(e){for(var r="string"==typeof e,n=r?e:"",i={},s=r?1:0;s<arguments.length;++s){var a=arguments[s],o={},l=void 0;if("function"==typeof a?(l=a.name,"string"==typeof a.signature?o[a.signature]=a:b(a)&&(o=a.signatures)):t(a)&&(o=a,r||(l=le(a))),0===Object.keys(o).length){var u=new TypeError("Argument to 'typed' at index "+s+" is not a (typed) function, nor an object with signatures as keys and functions as values.");throw u.data={index:s,argument:a},u}r||(n=oe(n,l)),ue(i,o)}return Y(n||"",i)},f.create=l,f.createCount=ce.createCount,f.onMismatch=J,f.throwMismatchError=J,f.createError=R,f.clear=g,f.clearConversions=y,f.addTypes=m,f._findType=p,f.referTo=re,f.referToSelf=ie,f.convert=E,f.findSignature=w,f.find=x,f.isTypedFunction=b,f.warnAgainstDeprecatedThis=!0,f.addType=function(e,t){var n="any";!1!==t&&r.has("Object")&&(n="Object"),f.addTypes([e],n)},f.addConversion=function(e){de(e);var t=p(e.to);if(!t.conversionsTo.every((function(t){return t.from!==e.from})))throw new Error('There is already a conversion from "'+e.from+'" to "'+t.name+'"');t.conversionsTo.push({from:e.from,convert:e.convert,index:h++})},f.addConversions=function(e){e.forEach(f.addConversion)},f.removeConversion=function(e){de(e);var t=p(e.to),r=ee(t.conversionsTo,(function(t){return t.from===e.from}));if(!r)throw new Error("Attempt to remove nonexistent conversion from "+e.from+" to "+e.to);if(r.convert!==e.convert)throw new Error("Conversion to remove does not match existing conversion");var n=t.conversionsTo.indexOf(r);t.conversionsTo.splice(n,1)},f.resolve=function(e,t){if(!b(e))throw new TypeError(o);for(var r=e._typedFunctionData.signatures,n=0;n<r.length;++n)if(r[n].test(t))return r[n];return null},f}return l()}()}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.amdD=function(){throw new Error("define cannot be used indirect")},r.amdO={},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";function e(e,t){return function(){return e.apply(t,arguments)}}const{toString:t}=Object.prototype,{getPrototypeOf:n}=Object,i=(s=Object.create(null),e=>{const r=t.call(e);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())});var s;const a=e=>(e=e.toLowerCase(),t=>i(t)===e),o=e=>t=>typeof t===e,{isArray:l}=Array,u=o("undefined");const c=a("ArrayBuffer");const d=o("string"),h=o("function"),f=o("number"),p=e=>null!==e&&"object"==typeof e,m=e=>{if("object"!==i(e))return!1;const t=n(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},g=a("Date"),y=a("File"),v=a("Blob"),b=a("FileList"),w=a("URLSearchParams");function x(e,t,{allOwnKeys:r=!1}={}){if(null==e)return;let n,i;if("object"!=typeof e&&(e=[e]),l(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let a;for(n=0;n<s;n++)a=i[n],t.call(null,e[a],a,e)}}function E(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,S=e=>!u(e)&&e!==D;const A=(T="undefined"!=typeof Uint8Array&&n(Uint8Array),e=>T&&e instanceof T);var T;const C=a("HTMLFormElement"),N=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),k=a("RegExp"),M=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};x(r,((r,i)=>{!1!==t(r,i,e)&&(n[i]=r)})),Object.defineProperties(e,n)},O="abcdefghijklmnopqrstuvwxyz",F="0123456789",L={DIGIT:F,ALPHA:O,ALPHA_DIGIT:O+O.toUpperCase()+F};const _=a("AsyncFunction"),R={isArray:l,isArrayBuffer:c,isBuffer:function(e){return null!==e&&!u(e)&&null!==e.constructor&&!u(e.constructor)&&h(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||h(e.append)&&("formdata"===(t=i(e))||"object"===t&&h(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&c(e.buffer),t},isString:d,isNumber:f,isBoolean:e=>!0===e||!1===e,isObject:p,isPlainObject:m,isUndefined:u,isDate:g,isFile:y,isBlob:v,isRegExp:k,isFunction:h,isStream:e=>p(e)&&h(e.pipe),isURLSearchParams:w,isTypedArray:A,isFileList:b,forEach:x,merge:function e(){const{caseless:t}=S(this)&&this||{},r={},n=(n,i)=>{const s=t&&E(r,i)||i;m(r[s])&&m(n)?r[s]=e(r[s],n):m(n)?r[s]=e({},n):l(n)?r[s]=n.slice():r[s]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&x(arguments[e],n);return r},extend:(t,r,n,{allOwnKeys:i}={})=>(x(r,((r,i)=>{n&&h(r)?t[i]=e(r,n):t[i]=r}),{allOwnKeys:i}),t),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,i)=>{let s,a,o;const l={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),a=s.length;a-- >0;)o=s[a],i&&!i(o,e,t)||l[o]||(t[o]=e[o],l[o]=!0);e=!1!==r&&n(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:i,kindOfTest:a,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(l(e))return e;let t=e.length;if(!f(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:C,hasOwnProperty:N,hasOwnProp:N,reduceDescriptors:M,freezeMethods:e=>{M(e,((t,r)=>{if(h(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];h(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach((e=>{r[e]=!0}))};return l(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:E,global:D,isContextDefined:S,ALPHABET:L,generateString:(e=16,t=L.ALPHA_DIGIT)=>{let r="";const{length:n}=t;for(;e--;)r+=t[Math.random()*n|0];return r},isSpecCompliantForm:function(e){return!!(e&&h(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(p(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const i=l(e)?[]:{};return x(e,((e,t)=>{const s=r(e,n+1);!u(s)&&(i[t]=s)})),t[n]=void 0,i}}return e};return r(e,0)},isAsyncFn:_,isThenable:e=>e&&(p(e)||h(e))&&h(e.then)&&h(e.catch)};function I(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}R.inherits(I,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:R.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const P=I.prototype,B={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{B[e]={value:e}})),Object.defineProperties(I,B),Object.defineProperty(P,"isAxiosError",{value:!0}),I.from=(e,t,r,n,i,s)=>{const a=Object.create(P);return R.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),I.call(a,e.message,t,r,n,i),a.cause=e,a.name=e.name,s&&Object.assign(a,s),a};const U=I;function $(e){return R.isPlainObject(e)||R.isArray(e)}function z(e){return R.endsWith(e,"[]")?e.slice(0,-2):e}function j(e,t,r){return e?e.concat(t).map((function(e,t){return e=z(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}const q=R.toFlatObject(R,{},null,(function(e){return/^is[A-Z]/.test(e)}));const H=function(e,t,r){if(!R.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=R.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!R.isUndefined(t[e])}))).metaTokens,i=r.visitor||u,s=r.dots,a=r.indexes,o=(r.Blob||"undefined"!=typeof Blob&&Blob)&&R.isSpecCompliantForm(t);if(!R.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(R.isDate(e))return e.toISOString();if(!o&&R.isBlob(e))throw new U("Blob is not supported. Use a Buffer instead.");return R.isArrayBuffer(e)||R.isTypedArray(e)?o&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,r,i){let o=e;if(e&&!i&&"object"==typeof e)if(R.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(R.isArray(e)&&function(e){return R.isArray(e)&&!e.some($)}(e)||(R.isFileList(e)||R.endsWith(r,"[]"))&&(o=R.toArray(e)))return r=z(r),o.forEach((function(e,n){!R.isUndefined(e)&&null!==e&&t.append(!0===a?j([r],n,s):null===a?r:r+"[]",l(e))})),!1;return!!$(e)||(t.append(j(i,r,s),l(e)),!1)}const c=[],d=Object.assign(q,{defaultVisitor:u,convertValue:l,isVisitable:$});if(!R.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!R.isUndefined(r)){if(-1!==c.indexOf(r))throw Error("Circular reference detected in "+n.join("."));c.push(r),R.forEach(r,(function(r,s){!0===(!(R.isUndefined(r)||null===r)&&i.call(t,r,R.isString(s)?s.trim():s,n,d))&&e(r,n?n.concat(s):[s])})),c.pop()}}(e),t};function V(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function G(e,t){this._pairs=[],e&&H(e,this,t)}const K=G.prototype;K.append=function(e,t){this._pairs.push([e,t])},K.toString=function(e){const t=e?function(t){return e.call(this,t,V)}:V;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const W=G;function Y(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function J(e,t,r){if(!t)return e;const n=r&&r.encode||Y,i=r&&r.serialize;let s;if(s=i?i(t,r):R.isURLSearchParams(t)?t.toString():new W(t,r).toString(n),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}const Z=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){R.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},X={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q="undefined"!=typeof URLSearchParams?URLSearchParams:W,ee="undefined"!=typeof FormData?FormData:null,te="undefined"!=typeof Blob?Blob:null,re=(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),ne={isBrowser:!0,classes:{URLSearchParams:Q,FormData:ee,Blob:te},isStandardBrowserEnv:re,isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};const ie=function(e){function t(e,r,n,i){let s=e[i++];const a=Number.isFinite(+s),o=i>=e.length;if(s=!s&&R.isArray(n)?n.length:s,o)return R.hasOwnProp(n,s)?n[s]=[n[s],r]:n[s]=r,!a;n[s]&&R.isObject(n[s])||(n[s]=[]);return t(e,r,n[s],i)&&R.isArray(n[s])&&(n[s]=function(e){const t={},r=Object.keys(e);let n;const i=r.length;let s;for(n=0;n<i;n++)s=r[n],t[s]=e[s];return t}(n[s])),!a}if(R.isFormData(e)&&R.isFunction(e.entries)){const r={};return R.forEachEntry(e,((e,n)=>{t(function(e){return R.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,r,0)})),r}return null},se={"Content-Type":void 0};const ae={transitional:X,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=R.isObject(e);i&&R.isHTMLForm(e)&&(e=new FormData(e));if(R.isFormData(e))return n&&n?JSON.stringify(ie(e)):e;if(R.isArrayBuffer(e)||R.isBuffer(e)||R.isStream(e)||R.isFile(e)||R.isBlob(e))return e;if(R.isArrayBufferView(e))return e.buffer;if(R.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return H(e,new ne.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return ne.isNode&&R.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=R.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return H(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,r){if(R.isString(e))try{return(t||JSON.parse)(e),R.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||ae.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(e&&R.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw U.from(e,U.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ne.classes.FormData,Blob:ne.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};R.forEach(["delete","get","head"],(function(e){ae.headers[e]={}})),R.forEach(["post","put","patch"],(function(e){ae.headers[e]=R.merge(se)}));const oe=ae,le=R.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ue=Symbol("internals");function ce(e){return e&&String(e).trim().toLowerCase()}function de(e){return!1===e||null==e?e:R.isArray(e)?e.map(de):String(e)}function he(e,t,r,n,i){return R.isFunction(n)?n.call(this,t,r):(i&&(t=r),R.isString(t)?R.isString(n)?-1!==t.indexOf(n):R.isRegExp(n)?n.test(t):void 0:void 0)}class fe{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(e,t,r){const i=ce(t);if(!i)throw new Error("header name must be a non-empty string");const s=R.findKey(n,i);(!s||void 0===n[s]||!0===r||void 0===r&&!1!==n[s])&&(n[s||t]=de(e))}const s=(e,t)=>R.forEach(e,((e,r)=>i(e,r,t)));return R.isPlainObject(e)||e instanceof this.constructor?s(e,t):R.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?s((e=>{const t={};let r,n,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),r=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!r||t[r]&&le[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)})),t})(e),t):null!=e&&i(t,e,r),this}get(e,t){if(e=ce(e)){const r=R.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(R.isFunction(t))return t.call(this,e,r);if(R.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ce(e)){const r=R.findKey(this,e);return!(!r||void 0===this[r]||t&&!he(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function i(e){if(e=ce(e)){const i=R.findKey(r,e);!i||t&&!he(0,r[i],i,t)||(delete r[i],n=!0)}}return R.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];e&&!he(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return R.forEach(this,((n,i)=>{const s=R.findKey(r,i);if(s)return t[s]=de(n),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,r)=>t.toUpperCase()+r))}(i):String(i).trim();a!==i&&delete t[i],t[a]=de(n),r[a]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return R.forEach(this,((r,n)=>{null!=r&&!1!==r&&(t[n]=e&&R.isArray(r)?r.join(", "):r)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach((e=>r.set(e))),r}static accessor(e){const t=(this[ue]=this[ue]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=ce(e);t[n]||(!function(e,t){const r=R.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})}))}(r,e),t[n]=!0)}return R.isArray(e)?e.forEach(n):n(e),this}}fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),R.freezeMethods(fe.prototype),R.freezeMethods(fe);const pe=fe;function me(e,t){const r=this||oe,n=t||r,i=pe.from(n.headers);let s=n.data;return R.forEach(e,(function(e){s=e.call(r,s,i.normalize(),t?t.status:void 0)})),i.normalize(),s}function ge(e){return!(!e||!e.__CANCEL__)}function ye(e,t,r){U.call(this,null==e?"canceled":e,U.ERR_CANCELED,t,r),this.name="CanceledError"}R.inherits(ye,U,{__CANCEL__:!0});const ve=ye;const be=ne.isStandardBrowserEnv?{write:function(e,t,r,n,i,s){const a=[];a.push(e+"="+encodeURIComponent(t)),R.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),R.isString(n)&&a.push("path="+n),R.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function we(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const xe=ne.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function n(r){let n=r;return e&&(t.setAttribute("href",n),n=t.href),t.setAttribute("href",n),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return r=n(window.location.href),function(e){const t=R.isString(e)?n(e):e;return t.protocol===r.protocol&&t.host===r.host}}():function(){return!0};const Ee=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const l=Date.now(),u=n[a];i||(i=l),r[s]=o,n[s]=l;let c=a,d=0;for(;c!==s;)d+=r[c++],c%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),l-i<t)return;const h=u&&l-u;return h?Math.round(1e3*d/h):void 0}};function De(e,t){let r=0;const n=Ee(50,250);return i=>{const s=i.loaded,a=i.lengthComputable?i.total:void 0,o=s-r,l=n(o);r=s;const u={loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:l||void 0,estimated:l&&a&&s<=a?(a-s)/l:void 0,event:i};u[t?"download":"upload"]=!0,e(u)}}const Se="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,r){let n=e.data;const i=pe.from(e.headers).normalize(),s=e.responseType;let a;function o(){e.cancelToken&&e.cancelToken.unsubscribe(a),e.signal&&e.signal.removeEventListener("abort",a)}R.isFormData(n)&&(ne.isStandardBrowserEnv||ne.isStandardBrowserWebWorkerEnv?i.setContentType(!1):i.setContentType("multipart/form-data;",!1));let l=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",r=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+r))}const u=we(e.baseURL,e.url);function c(){if(!l)return;const n=pe.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());!function(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new U("Request failed with status code "+r.status,[U.ERR_BAD_REQUEST,U.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}((function(e){t(e),o()}),(function(e){r(e),o()}),{data:s&&"text"!==s&&"json"!==s?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:n,config:e,request:l}),l=null}if(l.open(e.method.toUpperCase(),J(u,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,"onloadend"in l?l.onloadend=c:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(c)},l.onabort=function(){l&&(r(new U("Request aborted",U.ECONNABORTED,e,l)),l=null)},l.onerror=function(){r(new U("Network Error",U.ERR_NETWORK,e,l)),l=null},l.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const n=e.transitional||X;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new U(t,n.clarifyTimeoutError?U.ETIMEDOUT:U.ECONNABORTED,e,l)),l=null},ne.isStandardBrowserEnv){const t=(e.withCredentials||xe(u))&&e.xsrfCookieName&&be.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===n&&i.setContentType(null),"setRequestHeader"in l&&R.forEach(i.toJSON(),(function(e,t){l.setRequestHeader(t,e)})),R.isUndefined(e.withCredentials)||(l.withCredentials=!!e.withCredentials),s&&"json"!==s&&(l.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",De(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",De(e.onUploadProgress)),(e.cancelToken||e.signal)&&(a=t=>{l&&(r(!t||t.type?new ve(null,e,l):t),l.abort(),l=null)},e.cancelToken&&e.cancelToken.subscribe(a),e.signal&&(e.signal.aborted?a():e.signal.addEventListener("abort",a)));const d=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(u);d&&-1===ne.protocols.indexOf(d)?r(new U("Unsupported protocol "+d+":",U.ERR_BAD_REQUEST,e)):l.send(n||null)}))},Ae={http:null,xhr:Se};R.forEach(Ae,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const Te=e=>{e=R.isArray(e)?e:[e];const{length:t}=e;let r,n;for(let i=0;i<t&&(r=e[i],!(n=R.isString(r)?Ae[r.toLowerCase()]:r));i++);if(!n){if(!1===n)throw new U(`Adapter ${r} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(R.hasOwnProp(Ae,r)?`Adapter '${r}' is not available in the build`:`Unknown adapter '${r}'`)}if(!R.isFunction(n))throw new TypeError("adapter is not a function");return n};function Ce(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ve(null,e)}function Ne(e){Ce(e),e.headers=pe.from(e.headers),e.data=me.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Te(e.adapter||oe.adapter)(e).then((function(t){return Ce(e),t.data=me.call(e,e.transformResponse,t),t.headers=pe.from(t.headers),t}),(function(t){return ge(t)||(Ce(e),t&&t.response&&(t.response.data=me.call(e,e.transformResponse,t.response),t.response.headers=pe.from(t.response.headers))),Promise.reject(t)}))}const ke=e=>e instanceof pe?e.toJSON():e;function Me(e,t){t=t||{};const r={};function n(e,t,r){return R.isPlainObject(e)&&R.isPlainObject(t)?R.merge.call({caseless:r},e,t):R.isPlainObject(t)?R.merge({},t):R.isArray(t)?t.slice():t}function i(e,t,r){return R.isUndefined(t)?R.isUndefined(e)?void 0:n(void 0,e,r):n(e,t,r)}function s(e,t){if(!R.isUndefined(t))return n(void 0,t)}function a(e,t){return R.isUndefined(t)?R.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function o(r,i,s){return s in t?n(r,i):s in e?n(void 0,r):void 0}const l={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(e,t)=>i(ke(e),ke(t),!0)};return R.forEach(Object.keys(Object.assign({},e,t)),(function(n){const s=l[n]||i,a=s(e[n],t[n],n);R.isUndefined(a)&&s!==o||(r[n]=a)})),r}const Oe="1.4.0",Fe={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Fe[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const Le={};Fe.transitional=function(e,t,r){function n(e,t){return"[Axios v1.4.0] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,s)=>{if(!1===e)throw new U(n(i," has been removed"+(t?" in "+t:"")),U.ERR_DEPRECATED);return t&&!Le[i]&&(Le[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,s)}};const _e={assertOptions:function(e,t,r){if("object"!=typeof e)throw new U("options must be an object",U.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const s=n[i],a=t[s];if(a){const t=e[s],r=void 0===t||a(t,s,e);if(!0!==r)throw new U("option "+s+" must be "+r,U.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new U("Unknown option "+s,U.ERR_BAD_OPTION)}},validators:Fe},Re=_e.validators;class Ie{constructor(e){this.defaults=e,this.interceptors={request:new Z,response:new Z}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Me(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;let s;void 0!==r&&_e.assertOptions(r,{silentJSONParsing:Re.transitional(Re.boolean),forcedJSONParsing:Re.transitional(Re.boolean),clarifyTimeoutError:Re.transitional(Re.boolean)},!1),null!=n&&(R.isFunction(n)?t.paramsSerializer={serialize:n}:_e.assertOptions(n,{encode:Re.function,serialize:Re.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase(),s=i&&R.merge(i.common,i[t.method]),s&&R.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=pe.concat(s,i);const a=[];let o=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(o=o&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const l=[];let u;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let c,d=0;if(!o){const e=[Ne.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,l),c=e.length,u=Promise.resolve(t);d<c;)u=u.then(e[d++],e[d++]);return u}c=a.length;let h=t;for(d=0;d<c;){const e=a[d++],t=a[d++];try{h=e(h)}catch(e){t.call(this,e);break}}try{u=Ne.call(this,h)}catch(e){return Promise.reject(e)}for(d=0,c=l.length;d<c;)u=u.then(l[d++],l[d++]);return u}getUri(e){return J(we((e=Me(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}R.forEach(["delete","get","head","options"],(function(e){Ie.prototype[e]=function(t,r){return this.request(Me(r||{},{method:e,url:t,data:(r||{}).data}))}})),R.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(Me(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}Ie.prototype[e]=t(),Ie.prototype[e+"Form"]=t(!0)}));const Pe=Ie;class Be{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const r=this;this.promise.then((e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e,n,i){r.reason||(r.reason=new ve(e,n,i),t(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new Be((function(t){e=t})),cancel:e}}}const Ue=Be;const $e={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($e).forEach((([e,t])=>{$e[t]=e}));const ze=$e;const je=function t(r){const n=new Pe(r),i=e(Pe.prototype.request,n);return R.extend(i,Pe.prototype,n,{allOwnKeys:!0}),R.extend(i,n,null,{allOwnKeys:!0}),i.create=function(e){return t(Me(r,e))},i}(oe);je.Axios=Pe,je.CanceledError=ve,je.CancelToken=Ue,je.isCancel=ge,je.VERSION=Oe,je.toFormData=H,je.AxiosError=U,je.Cancel=je.CanceledError,je.all=function(e){return Promise.all(e)},je.spread=function(e){return function(t){return e.apply(null,t)}},je.isAxiosError=function(e){return R.isObject(e)&&!0===e.isAxiosError},je.mergeConfig=Me,je.AxiosHeaders=pe,je.formToJSON=e=>ie(R.isHTMLForm(e)?new FormData(e):e),je.HttpStatusCode=ze,je.default=je;const qe=je;class He extends Error{}class Ve extends He{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Ge extends He{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Ke extends He{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class We extends He{}class Ye extends He{constructor(e){super(`Invalid unit ${e}`)}}class Je extends He{}class Ze extends He{constructor(){super("Zone is an abstract class")}}const Xe="numeric",Qe="short",et="long",tt={year:Xe,month:Xe,day:Xe},rt={year:Xe,month:Qe,day:Xe},nt={year:Xe,month:Qe,day:Xe,weekday:Qe},it={year:Xe,month:et,day:Xe},st={year:Xe,month:et,day:Xe,weekday:et},at={hour:Xe,minute:Xe},ot={hour:Xe,minute:Xe,second:Xe},lt={hour:Xe,minute:Xe,second:Xe,timeZoneName:Qe},ut={hour:Xe,minute:Xe,second:Xe,timeZoneName:et},ct={hour:Xe,minute:Xe,hourCycle:"h23"},dt={hour:Xe,minute:Xe,second:Xe,hourCycle:"h23"},ht={hour:Xe,minute:Xe,second:Xe,hourCycle:"h23",timeZoneName:Qe},ft={hour:Xe,minute:Xe,second:Xe,hourCycle:"h23",timeZoneName:et},pt={year:Xe,month:Xe,day:Xe,hour:Xe,minute:Xe},mt={year:Xe,month:Xe,day:Xe,hour:Xe,minute:Xe,second:Xe},gt={year:Xe,month:Qe,day:Xe,hour:Xe,minute:Xe},yt={year:Xe,month:Qe,day:Xe,hour:Xe,minute:Xe,second:Xe},vt={year:Xe,month:Qe,day:Xe,weekday:Qe,hour:Xe,minute:Xe},bt={year:Xe,month:et,day:Xe,hour:Xe,minute:Xe,timeZoneName:Qe},wt={year:Xe,month:et,day:Xe,hour:Xe,minute:Xe,second:Xe,timeZoneName:Qe},xt={year:Xe,month:et,day:Xe,weekday:et,hour:Xe,minute:Xe,timeZoneName:et},Et={year:Xe,month:et,day:Xe,weekday:et,hour:Xe,minute:Xe,second:Xe,timeZoneName:et};class Dt{get type(){throw new Ze}get name(){throw new Ze}get ianaName(){return this.name}get isUniversal(){throw new Ze}offsetName(e,t){throw new Ze}formatOffset(e,t){throw new Ze}offset(e){throw new Ze}equals(e){throw new Ze}get isValid(){throw new Ze}}let St=null;class At extends Dt{static get instance(){return null===St&&(St=new At),St}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return yr(e,t,r)}formatOffset(e,t){return xr(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}let Tt={};const Ct={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Nt={};class kt extends Dt{static create(e){return Nt[e]||(Nt[e]=new kt(e)),Nt[e]}static resetCache(){Nt={},Tt={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}}constructor(e){super(),this.zoneName=e,this.valid=kt.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:r}){return yr(e,t,r,this.name)}formatOffset(e,t){return xr(this.offset(e),t)}offset(e){const t=new Date(e);if(isNaN(t))return NaN;const r=(n=this.name,Tt[n]||(Tt[n]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Tt[n]);var n;let[i,s,a,o,l,u,c]=r.formatToParts?function(e,t){const r=e.formatToParts(t),n=[];for(let e=0;e<r.length;e++){const{type:t,value:i}=r[e],s=Ct[t];"era"===t?n[s]=i:Qt(s)||(n[s]=parseInt(i,10))}return n}(r,t):function(e,t){const r=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,i,s,a,o,l,u,c]=n;return[a,i,s,o,l,u,c]}(r,t);"BC"===o&&(i=1-Math.abs(i));let d=+t;const h=d%1e3;return d-=h>=0?h:1e3+h,(pr({year:i,month:s,day:a,hour:24===l?0:l,minute:u,second:c,millisecond:0})-d)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let Mt={};let Ot={};function Ft(e,t={}){const r=JSON.stringify([e,t]);let n=Ot[r];return n||(n=new Intl.DateTimeFormat(e,t),Ot[r]=n),n}let Lt={};let _t={};let Rt=null;function It(e,t,r,n){const i=e.listingMode();return"error"===i?null:"en"===i?r(t):n(t)}class Pt{constructor(e,t,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:n,floor:i,...s}=r;if(!t||Object.keys(s).length>0){const t={useGrouping:!1,...r};r.padTo>0&&(t.minimumIntegerDigits=r.padTo),this.inf=function(e,t={}){const r=JSON.stringify([e,t]);let n=Lt[r];return n||(n=new Intl.NumberFormat(e,t),Lt[r]=n),n}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return ar(this.floor?Math.floor(e):cr(e,3),this.padTo)}}class Bt{constructor(e,t,r){let n;if(this.opts=r,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,r=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&kt.create(r).valid?(n=r,this.dt=e):(n="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const i={...this.opts};i.timeZone=i.timeZone||n,this.dtf=Ft(t,i)}format(){return this.originalZone?this.formatToParts().map((({value:e})=>e)).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map((e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e})):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Ut{constructor(e,t,r){this.opts={style:"long",...r},!t&&rr()&&(this.rtf=function(e,t={}){const{base:r,...n}=t,i=JSON.stringify([e,n]);let s=_t[i];return s||(s=new Intl.RelativeTimeFormat(e,t),_t[i]=s),s}(e,r))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,r="always",n=!1){const i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===r&&s){const r="days"===e;switch(t){case 1:return r?"tomorrow":`next ${i[e][0]}`;case-1:return r?"yesterday":`last ${i[e][0]}`;case 0:return r?"today":`this ${i[e][0]}`}}const a=Object.is(t,-0)||t<0,o=Math.abs(t),l=1===o,u=i[e],c=n?l?u[1]:u[2]||u[1]:l?i[e][0]:e;return a?`${o} ${c} ago`:`in ${o} ${c}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}class $t{static fromOpts(e){return $t.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,t,r,n=!1){const i=e||Xt.defaultLocale,s=i||(n?"en-US":Rt||(Rt=(new Intl.DateTimeFormat).resolvedOptions().locale,Rt)),a=t||Xt.defaultNumberingSystem,o=r||Xt.defaultOutputCalendar;return new $t(s,a,o,i)}static resetCache(){Rt=null,Ot={},Lt={},_t={}}static fromObject({locale:e,numberingSystem:t,outputCalendar:r}={}){return $t.create(e,t,r)}constructor(e,t,r,n){const[i,s,a]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const r=e.indexOf("-u-");if(-1===r)return[e];{let t,n;try{t=Ft(e).resolvedOptions(),n=e}catch(i){const s=e.substring(0,r);t=Ft(s).resolvedOptions(),n=s}const{numberingSystem:i,calendar:s}=t;return[n,i,s]}}(e);this.locale=i,this.numberingSystem=t||s||null,this.outputCalendar=r||a||null,this.intl=function(e,t,r){return r||t?(e.includes("-u-")||(e+="-u"),r&&(e+=`-ca-${r}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?$t.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return It(this,e,Tr,(()=>{const r=t?{month:e,day:"numeric"}:{month:e},n=t?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=function(e){const t=[];for(let r=1;r<=12;r++){const n=qi.utc(2009,r,1);t.push(e(n))}return t}((e=>this.extract(e,r,"month")))),this.monthsCache[n][e]}))}weekdays(e,t=!1){return It(this,e,Mr,(()=>{const r=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=t?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=function(e){const t=[];for(let r=1;r<=7;r++){const n=qi.utc(2016,11,13+r);t.push(e(n))}return t}((e=>this.extract(e,r,"weekday")))),this.weekdaysCache[n][e]}))}meridiems(){return It(this,void 0,(()=>Or),(()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[qi.utc(2016,11,13,9),qi.utc(2016,11,13,19)].map((t=>this.extract(t,e,"dayperiod")))}return this.meridiemCache}))}eras(e){return It(this,e,Rr,(()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[qi.utc(-40,1,1),qi.utc(2017,1,1)].map((e=>this.extract(e,t,"era")))),this.eraCache[e]}))}extract(e,t,r){const n=this.dtFormatter(e,t).formatToParts().find((e=>e.type.toLowerCase()===r));return n?n.value:null}numberFormatter(e={}){return new Pt(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new Bt(e,this.intl,t)}relFormatter(e={}){return new Ut(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function(e,t={}){const r=JSON.stringify([e,t]);let n=Mt[r];return n||(n=new Intl.ListFormat(e,t),Mt[r]=n),n}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let zt=null;class jt extends Dt{static get utcInstance(){return null===zt&&(zt=new jt(0)),zt}static instance(e){return 0===e?jt.utcInstance:new jt(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new jt(vr(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${xr(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${xr(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return xr(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class qt extends Dt{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Ht(e,t){if(Qt(e)||null===e)return t;if(e instanceof Dt)return e;if("string"==typeof e){const r=e.toLowerCase();return"default"===r?t:"local"===r||"system"===r?At.instance:"utc"===r||"gmt"===r?jt.utcInstance:jt.parseSpecifier(r)||kt.create(e)}return er(e)?jt.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new qt(e)}let Vt,Gt=()=>Date.now(),Kt="system",Wt=null,Yt=null,Jt=null,Zt=60;class Xt{static get now(){return Gt}static set now(e){Gt=e}static set defaultZone(e){Kt=e}static get defaultZone(){return Ht(Kt,At.instance)}static get defaultLocale(){return Wt}static set defaultLocale(e){Wt=e}static get defaultNumberingSystem(){return Yt}static set defaultNumberingSystem(e){Yt=e}static get defaultOutputCalendar(){return Jt}static set defaultOutputCalendar(e){Jt=e}static get twoDigitCutoffYear(){return Zt}static set twoDigitCutoffYear(e){Zt=e%100}static get throwOnInvalid(){return Vt}static set throwOnInvalid(e){Vt=e}static resetCaches(){$t.resetCache(),kt.resetCache()}}function Qt(e){return void 0===e}function er(e){return"number"==typeof e}function tr(e){return"number"==typeof e&&e%1==0}function rr(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function nr(e,t,r){if(0!==e.length)return e.reduce(((e,n)=>{const i=[t(n),n];return e&&r(e[0],i[0])===e[0]?e:i}),null)[1]}function ir(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function sr(e,t,r){return tr(e)&&e>=t&&e<=r}function ar(e,t=2){let r;return r=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),r}function or(e){return Qt(e)||null===e||""===e?void 0:parseInt(e,10)}function lr(e){return Qt(e)||null===e||""===e?void 0:parseFloat(e)}function ur(e){if(!Qt(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function cr(e,t,r=!1){const n=10**t;return(r?Math.trunc:Math.round)(e*n)/n}function dr(e){return e%4==0&&(e%100!=0||e%400==0)}function hr(e){return dr(e)?366:365}function fr(e,t){const r=function(e,t){return e-t*Math.floor(e/t)}(t-1,12)+1;return 2===r?dr(e+(t-r)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function pr(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function mr(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,r=e-1,n=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return 4===t||3===n?53:52}function gr(e){return e>99?e:e>Xt.twoDigitCutoffYear?1900+e:2e3+e}function yr(e,t,r,n=null){const i=new Date(e),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};n&&(s.timeZone=n);const a={timeZoneName:t,...s},o=new Intl.DateTimeFormat(r,a).formatToParts(i).find((e=>"timezonename"===e.type.toLowerCase()));return o?o.value:null}function vr(e,t){let r=parseInt(e,10);Number.isNaN(r)&&(r=0);const n=parseInt(t,10)||0;return 60*r+(r<0||Object.is(r,-0)?-n:n)}function br(e){const t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new Je(`Invalid unit value ${e}`);return t}function wr(e,t){const r={};for(const n in e)if(ir(e,n)){const i=e[n];if(null==i)continue;r[t(n)]=br(i)}return r}function xr(e,t){const r=Math.trunc(Math.abs(e/60)),n=Math.trunc(Math.abs(e%60)),i=e>=0?"+":"-";switch(t){case"short":return`${i}${ar(r,2)}:${ar(n,2)}`;case"narrow":return`${i}${r}${n>0?`:${n}`:""}`;case"techie":return`${i}${ar(r,2)}${ar(n,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function Er(e){return function(e,t){return t.reduce(((t,r)=>(t[r]=e[r],t)),{})}(e,["hour","minute","second","millisecond"])}const Dr=["January","February","March","April","May","June","July","August","September","October","November","December"],Sr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ar=["J","F","M","A","M","J","J","A","S","O","N","D"];function Tr(e){switch(e){case"narrow":return[...Ar];case"short":return[...Sr];case"long":return[...Dr];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Cr=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Nr=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],kr=["M","T","W","T","F","S","S"];function Mr(e){switch(e){case"narrow":return[...kr];case"short":return[...Nr];case"long":return[...Cr];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Or=["AM","PM"],Fr=["Before Christ","Anno Domini"],Lr=["BC","AD"],_r=["B","A"];function Rr(e){switch(e){case"narrow":return[..._r];case"short":return[...Lr];case"long":return[...Fr];default:return null}}function Ir(e,t){let r="";for(const n of e)n.literal?r+=n.val:r+=t(n.val);return r}const Pr={D:tt,DD:rt,DDD:it,DDDD:st,t:at,tt:ot,ttt:lt,tttt:ut,T:ct,TT:dt,TTT:ht,TTTT:ft,f:pt,ff:gt,fff:bt,ffff:xt,F:mt,FF:yt,FFF:wt,FFFF:Et};class Br{static create(e,t={}){return new Br(e,t)}static parseFormat(e){let t=null,r="",n=!1;const i=[];for(let s=0;s<e.length;s++){const a=e.charAt(s);"'"===a?(r.length>0&&i.push({literal:n||/^\s+$/.test(r),val:r}),t=null,r="",n=!n):n||a===t?r+=a:(r.length>0&&i.push({literal:/^\s+$/.test(r),val:r}),r=a,t=a)}return r.length>0&&i.push({literal:n||/^\s+$/.test(r),val:r}),i}static macroTokenToFormatOpts(e){return Pr[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return ar(e,t);const r={...this.opts};return t>0&&(r.padTo=t),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){const r="en"===this.loc.listingMode(),n=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,i=(t,r)=>this.loc.extract(e,t,r),s=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",a=()=>r?function(e){return Or[e.hour<12?0:1]}(e):i({hour:"numeric",hourCycle:"h12"},"dayperiod"),o=(t,n)=>r?function(e,t){return Tr(t)[e.month-1]}(e,t):i(n?{month:t}:{month:t,day:"numeric"},"month"),l=(t,n)=>r?function(e,t){return Mr(t)[e.weekday-1]}(e,t):i(n?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),u=t=>{const r=Br.macroTokenToFormatOpts(t);return r?this.formatWithSystemDefault(e,r):t},c=t=>r?function(e,t){return Rr(t)[e.year<0?0:1]}(e,t):i({era:t},"era");return Ir(Br.parseFormat(t),(t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?i({day:"numeric"},"day"):this.num(e.day);case"dd":return n?i({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return n?i({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?i({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return o("short",!0);case"LLLL":return o("long",!0);case"LLLLL":return o("narrow",!0);case"M":return n?i({month:"numeric"},"month"):this.num(e.month);case"MM":return n?i({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return o("short",!1);case"MMMM":return o("long",!1);case"MMMMM":return o("narrow",!1);case"y":return n?i({year:"numeric"},"year"):this.num(e.year);case"yy":return n?i({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?i({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?i({year:"numeric"},"year"):this.num(e.year,6);case"G":return c("short");case"GG":return c("long");case"GGGGG":return c("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(t)}}))}formatDurationFromString(e,t){const r=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=Br.parseFormat(t),i=n.reduce(((e,{literal:t,val:r})=>t?e:e.concat(r)),[]);return Ir(n,(e=>t=>{const n=r(t);return n?this.num(e.get(n),t.length):t})(e.shiftTo(...i.map(r).filter((e=>e)))))}}class Ur{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const $r=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function zr(...e){const t=e.reduce(((e,t)=>e+t.source),"");return RegExp(`^${t}$`)}function jr(...e){return t=>e.reduce((([e,r,n],i)=>{const[s,a,o]=i(t,n);return[{...e,...s},a||r,o]}),[{},null,1]).slice(0,2)}function qr(e,...t){if(null==e)return[null,null];for(const[r,n]of t){const t=r.exec(e);if(t)return n(t)}return[null,null]}function Hr(...e){return(t,r)=>{const n={};let i;for(i=0;i<e.length;i++)n[e[i]]=or(t[r+i]);return[n,null,r+i]}}const Vr=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Gr=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Kr=RegExp(`${Gr.source}${`(?:${Vr.source}?(?:\\[(${$r.source})\\])?)?`}`),Wr=RegExp(`(?:T${Kr.source})?`),Yr=Hr("weekYear","weekNumber","weekDay"),Jr=Hr("year","ordinal"),Zr=RegExp(`${Gr.source} ?(?:${Vr.source}|(${$r.source}))?`),Xr=RegExp(`(?: ${Zr.source})?`);function Qr(e,t,r){const n=e[t];return Qt(n)?r:or(n)}function en(e,t){return[{hours:Qr(e,t,0),minutes:Qr(e,t+1,0),seconds:Qr(e,t+2,0),milliseconds:ur(e[t+3])},null,t+4]}function tn(e,t){const r=!e[t]&&!e[t+1],n=vr(e[t+1],e[t+2]);return[{},r?null:jt.instance(n),t+3]}function rn(e,t){return[{},e[t]?kt.create(e[t]):null,t+1]}const nn=RegExp(`^T?${Gr.source}$`),sn=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function an(e){const[t,r,n,i,s,a,o,l,u]=e,c="-"===t[0],d=l&&"-"===l[0],h=(e,t=!1)=>void 0!==e&&(t||e&&c)?-e:e;return[{years:h(lr(r)),months:h(lr(n)),weeks:h(lr(i)),days:h(lr(s)),hours:h(lr(a)),minutes:h(lr(o)),seconds:h(lr(l),"-0"===l),milliseconds:h(ur(u),d)}]}const on={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function ln(e,t,r,n,i,s,a){const o={year:2===t.length?gr(or(t)):or(t),month:Sr.indexOf(r)+1,day:or(n),hour:or(i),minute:or(s)};return a&&(o.second=or(a)),e&&(o.weekday=e.length>3?Cr.indexOf(e)+1:Nr.indexOf(e)+1),o}const un=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function cn(e){const[,t,r,n,i,s,a,o,l,u,c,d]=e,h=ln(t,i,n,r,s,a,o);let f;return f=l?on[l]:u?0:vr(c,d),[h,new jt(f)]}const dn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,hn=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,fn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function pn(e){const[,t,r,n,i,s,a,o]=e;return[ln(t,i,n,r,s,a,o),jt.utcInstance]}function mn(e){const[,t,r,n,i,s,a,o]=e;return[ln(t,o,r,n,i,s,a),jt.utcInstance]}const gn=zr(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Wr),yn=zr(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Wr),vn=zr(/(\d{4})-?(\d{3})/,Wr),bn=zr(Kr),wn=jr((function(e,t){return[{year:Qr(e,t),month:Qr(e,t+1,1),day:Qr(e,t+2,1)},null,t+3]}),en,tn,rn),xn=jr(Yr,en,tn,rn),En=jr(Jr,en,tn,rn),Dn=jr(en,tn,rn);const Sn=jr(en);const An=zr(/(\d{4})-(\d\d)-(\d\d)/,Xr),Tn=zr(Zr),Cn=jr(en,tn,rn);const Nn={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},kn={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...Nn},Mn=365.2425,On=30.436875,Fn={years:{quarters:4,months:12,weeks:52.1775,days:Mn,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:On,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...Nn},Ln=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],_n=Ln.slice(0).reverse();function Rn(e,t,r=!1){const n={values:r?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new Bn(n)}function In(e){return Math.trunc(1e3*e)/1e3}function Pn(e,t,r,n,i){const s=e[i][r],a=t[r]/s,o=Math.floor(a);n[i]=In(n[i]+o),t[r]=In(t[r]-o*s)}class Bn{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let r=t?Fn:kn;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||$t.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,t){return Bn.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new Je("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new Bn({values:wr(e,Bn.normalizeUnit),loc:$t.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(er(e))return Bn.fromMillis(e);if(Bn.isDuration(e))return e;if("object"==typeof e)return Bn.fromObject(e);throw new Je(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[r]=function(e){return qr(e,[sn,an])}(e);return r?Bn.fromObject(r,t):Bn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[r]=function(e){return qr(e,[nn,Sn])}(e);return r?Bn.fromObject(r,t):Bn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new Je("need to specify a reason the Duration is invalid");const r=e instanceof Ur?e:new Ur(e,t);if(Xt.throwOnInvalid)throw new Ke(r);return new Bn({invalid:r})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new Ye(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const r={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?Br.create(this.loc,r).formatDurationFromString(this,e):"Invalid Duration"}toHuman(e={}){const t=Ln.map((t=>{const r=this.values[t];return Qt(r)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(r)})).filter((e=>e));return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=cr(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1};return qi.fromMillis(t,{zone:"UTC"}).toISOTime(e)}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){let e=this.values.milliseconds??0;for(let t of _n.slice(1))this.values?.[t]&&(e+=this.values[t]*this.matrix[t].milliseconds);return e}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=Bn.fromDurationLike(e),r={};for(const e of Ln)(ir(t.values,e)||ir(this.values,e))&&(r[e]=t.get(e)+this.get(e));return Rn(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const t=Bn.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=br(e(this.values[r],r));return Rn(this,{values:t},!0)}get(e){return this[Bn.normalizeUnit(e)]}set(e){if(!this.isValid)return this;return Rn(this,{values:{...this.values,...wr(e,Bn.normalizeUnit)}})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:r,matrix:n}={}){return Rn(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:n,conversionAccuracy:r})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return this.valueOf()>=0?(function(e,t){_n.reduce(((r,n)=>Qt(t[n])?r:(r&&Pn(e,t,r,t,n),n)),null)}(this.matrix,e),Rn(this,{values:e},!0)):this.negate().normalize().negate()}rescale(){if(!this.isValid)return this;return Rn(this,{values:function(e){const t={};for(const[r,n]of Object.entries(e))0!==n&&(t[r]=n);return t}(this.normalize().shiftToAll().toObject())},!0)}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map((e=>Bn.normalizeUnit(e)));const t={},r={},n=this.toObject();let i;for(const s of Ln)if(e.indexOf(s)>=0){i=s;let e=0;for(const t in r)e+=this.matrix[t][s]*r[t],r[t]=0;er(n[s])&&(e+=n[s]);const a=Math.trunc(e);t[s]=a,r[s]=(1e3*e-1e3*a)/1e3;for(const e in n)Ln.indexOf(e)>Ln.indexOf(s)&&Pn(this.matrix,n,e,t,s)}else er(n[s])&&(r[s]=n[s]);for(const e in r)0!==r[e]&&(t[i]+=e===i?r[e]:r[e]/this.matrix[i][e]);return Rn(this,{values:t},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return Rn(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(const n of Ln)if(t=this.values[n],r=e.values[n],!(void 0===t||0===t?void 0===r||0===r:t===r))return!1;var t,r;return!0}}const Un="Invalid Interval";class $n{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new Je("need to specify a reason the Interval is invalid");const r=e instanceof Ur?e:new Ur(e,t);if(Xt.throwOnInvalid)throw new Ge(r);return new $n({invalid:r})}static fromDateTimes(e,t){const r=Hi(e),n=Hi(t),i=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?$n.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:$n.invalid("missing or invalid end"):$n.invalid("missing or invalid start")}(r,n);return null==i?new $n({start:r,end:n}):i}static after(e,t){const r=Bn.fromDurationLike(t),n=Hi(e);return $n.fromDateTimes(n,n.plus(r))}static before(e,t){const r=Bn.fromDurationLike(t),n=Hi(e);return $n.fromDateTimes(n.minus(r),n)}static fromISO(e,t){const[r,n]=(e||"").split("/",2);if(r&&n){let e,i,s,a;try{e=qi.fromISO(r,t),i=e.isValid}catch(n){i=!1}try{s=qi.fromISO(n,t),a=s.isValid}catch(n){a=!1}if(i&&a)return $n.fromDateTimes(e,s);if(i){const r=Bn.fromISO(n,t);if(r.isValid)return $n.after(e,r)}else if(a){const e=Bn.fromISO(r,t);if(e.isValid)return $n.before(s,e)}}return $n.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const t=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(t,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&(this.s<=e&&this.e>e)}set({start:e,end:t}={}){return this.isValid?$n.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(Hi).filter((e=>this.contains(e))).sort(),r=[];let{s:n}=this,i=0;for(;n<this.e;){const e=t[i]||this.e,s=+e>+this.e?this.e:e;r.push($n.fromDateTimes(n,s)),n=s,i+=1}return r}splitBy(e){const t=Bn.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let r,{s:n}=this,i=1;const s=[];for(;n<this.e;){const e=this.start.plus(t.mapUnits((e=>e*i)));r=+e>+this.e?this.e:e,s.push($n.fromDateTimes(n,r)),n=r,i+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e==+e.s}abutsEnd(e){return!!this.isValid&&+e.e==+this.s}engulfs(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)}equals(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return t>=r?null:$n.fromDateTimes(t,r)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return $n.fromDateTimes(t,r)}static merge(e){const[t,r]=e.sort(((e,t)=>e.s-t.s)).reduce((([e,t],r)=>t?t.overlaps(r)||t.abutsStart(r)?[e,t.union(r)]:[e.concat([t]),r]:[e,r]),[[],null]);return r&&t.push(r),t}static xor(e){let t=null,r=0;const n=[],i=e.map((e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}])),s=Array.prototype.concat(...i).sort(((e,t)=>e.time-t.time));for(const e of s)r+="s"===e.type?1:-1,1===r?t=e.time:(t&&+t!=+e.time&&n.push($n.fromDateTimes(t,e.time)),t=null);return $n.merge(n)}difference(...e){return $n.xor([this].concat(e)).map((e=>this.intersection(e))).filter((e=>e&&!e.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Un}toLocaleString(e=tt,t={}){return this.isValid?Br.create(this.s.loc.clone(t),e).formatInterval(this):Un}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Un}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Un}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Un}toFormat(e,{separator:t=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Un}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Bn.invalid(this.invalidReason)}mapEndpoints(e){return $n.fromDateTimes(e(this.s),e(this.e))}}class zn{static hasDST(e=Xt.defaultZone){const t=qi.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return kt.isValidZone(e)}static normalizeZone(e){return Ht(e,Xt.defaultZone)}static months(e="long",{locale:t=null,numberingSystem:r=null,locObj:n=null,outputCalendar:i="gregory"}={}){return(n||$t.create(t,r,i)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:n=null,outputCalendar:i="gregory"}={}){return(n||$t.create(t,r,i)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:r=null,locObj:n=null}={}){return(n||$t.create(t,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:r=null,locObj:n=null}={}){return(n||$t.create(t,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return $t.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return $t.create(t,null,"gregory").eras(e)}static features(){return{relative:rr()}}}function jn(e,t){const r=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),n=r(t)-r(e);return Math.floor(Bn.fromMillis(n).as("days"))}function qn(e,t,r,n){let[i,s,a,o]=function(e,t,r){const n=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const r=jn(e,t);return(r-r%7)/7}],["days",jn]],i={},s=e;let a,o;for(const[l,u]of n)r.indexOf(l)>=0&&(a=l,i[l]=u(e,t),o=s.plus(i),o>t?(i[l]--,(e=s.plus(i))>t&&(o=e,i[l]--,e=s.plus(i))):e=o);return[e,i,o,a]}(e,t,r);const l=t-i,u=r.filter((e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0));0===u.length&&(a<t&&(a=i.plus({[o]:1})),a!==i&&(s[o]=(s[o]||0)+l/(a-i)));const c=Bn.fromObject(s,n);return u.length>0?Bn.fromMillis(l,n).shiftTo(...u).plus(c):c}const Hn={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Vn={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Gn=Hn.hanidec.replace(/[\[|\]]/g,"").split("");function Kn({numberingSystem:e},t=""){return new RegExp(`${Hn[e||"latn"]}${t}`)}const Wn="missing Intl.DateTimeFormat.formatToParts support";function Yn(e,t=(e=>e)){return{regex:e,deser:([e])=>t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);if(-1!==e[r].search(Hn.hanidec))t+=Gn.indexOf(e[r]);else for(const e in Vn){const[r,i]=Vn[e];n>=r&&n<=i&&(t+=n-r)}}return parseInt(t,10)}return t}(e))}}const Jn=`[ ${String.fromCharCode(160)}]`,Zn=new RegExp(Jn,"g");function Xn(e){return e.replace(/\./g,"\\.?").replace(Zn,Jn)}function Qn(e){return e.replace(/\./g,"").replace(Zn," ").toLowerCase()}function ei(e,t){return null===e?null:{regex:RegExp(e.map(Xn).join("|")),deser:([r])=>e.findIndex((e=>Qn(r)===Qn(e)))+t}}function ti(e,t){return{regex:e,deser:([,e,t])=>vr(e,t),groups:t}}function ri(e){return{regex:e,deser:([e])=>e}}const ni={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let ii=null;function si(e,t){return Array.prototype.concat(...e.map((e=>function(e,t){if(e.literal)return e;const r=oi(Br.macroTokenToFormatOpts(e.val),t);return null==r||r.includes(void 0)?e:r}(e,t))))}function ai(e,t,r){const n=si(Br.parseFormat(r),e),i=n.map((t=>function(e,t){const r=Kn(t),n=Kn(t,"{2}"),i=Kn(t,"{3}"),s=Kn(t,"{4}"),a=Kn(t,"{6}"),o=Kn(t,"{1,2}"),l=Kn(t,"{1,3}"),u=Kn(t,"{1,6}"),c=Kn(t,"{1,9}"),d=Kn(t,"{2,4}"),h=Kn(t,"{4,6}"),f=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var t},p=(p=>{if(e.literal)return f(p);switch(p.val){case"G":return ei(t.eras("short"),0);case"GG":return ei(t.eras("long"),0);case"y":return Yn(u);case"yy":case"kk":return Yn(d,gr);case"yyyy":case"kkkk":return Yn(s);case"yyyyy":return Yn(h);case"yyyyyy":return Yn(a);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return Yn(o);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return Yn(n);case"MMM":return ei(t.months("short",!0),1);case"MMMM":return ei(t.months("long",!0),1);case"LLL":return ei(t.months("short",!1),1);case"LLLL":return ei(t.months("long",!1),1);case"o":case"S":return Yn(l);case"ooo":case"SSS":return Yn(i);case"u":return ri(c);case"uu":return ri(o);case"uuu":case"E":case"c":return Yn(r);case"a":return ei(t.meridiems(),0);case"EEE":return ei(t.weekdays("short",!1),1);case"EEEE":return ei(t.weekdays("long",!1),1);case"ccc":return ei(t.weekdays("short",!0),1);case"cccc":return ei(t.weekdays("long",!0),1);case"Z":case"ZZ":return ti(new RegExp(`([+-]${o.source})(?::(${n.source}))?`),2);case"ZZZ":return ti(new RegExp(`([+-]${o.source})(${n.source})?`),2);case"z":return ri(/[a-z_+-/]{1,256}?/i);case" ":return ri(/[^\S\n\r]/);default:return f(p)}})(e)||{invalidReason:Wn};return p.token=e,p}(t,e))),s=i.find((e=>e.invalidReason));if(s)return{input:t,tokens:n,invalidReason:s.invalidReason};{const[e,r]=function(e){return[`^${e.map((e=>e.regex)).reduce(((e,t)=>`${e}(${t.source})`),"")}$`,e]}(i),s=RegExp(e,"i"),[a,o]=function(e,t,r){const n=e.match(t);if(n){const e={};let t=1;for(const i in r)if(ir(r,i)){const s=r[i],a=s.groups?s.groups+1:1;!s.literal&&s.token&&(e[s.token.val[0]]=s.deser(n.slice(t,t+a))),t+=a}return[n,e]}return[n,{}]}(t,s,r),[l,u,c]=o?function(e){let t,r=null;return Qt(e.z)||(r=kt.create(e.z)),Qt(e.Z)||(r||(r=new jt(e.Z)),t=e.Z),Qt(e.q)||(e.M=3*(e.q-1)+1),Qt(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),Qt(e.u)||(e.S=ur(e.u)),[Object.keys(e).reduce(((t,r)=>{const n=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(r);return n&&(t[n]=e[r]),t}),{}),r,t]}(o):[null,null,void 0];if(ir(o,"a")&&ir(o,"H"))throw new We("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:n,regex:s,rawMatches:a,matches:o,result:l,zone:u,specificOffset:c}}}function oi(e,t){if(!e)return null;const r=Br.create(t,e).dtFormatter((ii||(ii=qi.fromMillis(1555555555555)),ii)),n=r.formatToParts(),i=r.resolvedOptions();return n.map((t=>function(e,t,r){const{type:n,value:i}=e;if("literal"===n){const e=/^\s+$/.test(i);return{literal:!e,val:e?" ":i}}const s=t[n];let a=n;"hour"===n&&(a=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":r.hour12?"hour12":"hour24");let o=ni[a];if("object"==typeof o&&(o=o[s]),o)return{literal:!1,val:o}}(t,e,i)))}const li=[0,31,59,90,120,151,181,212,243,273,304,334],ui=[0,31,60,91,121,152,182,213,244,274,305,335];function ci(e,t){return new Ur("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function di(e,t,r){const n=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&n.setUTCFullYear(n.getUTCFullYear()-1900);const i=n.getUTCDay();return 0===i?7:i}function hi(e,t,r){return r+(dr(e)?ui:li)[t-1]}function fi(e,t){const r=dr(e)?ui:li,n=r.findIndex((e=>e<t));return{month:n+1,day:t-r[n]}}function pi(e){const{year:t,month:r,day:n}=e,i=hi(t,r,n),s=di(t,r,n);let a,o=Math.floor((i-s+10)/7);return o<1?(a=t-1,o=mr(a)):o>mr(t)?(a=t+1,o=1):a=t,{weekYear:a,weekNumber:o,weekday:s,...Er(e)}}function mi(e){const{weekYear:t,weekNumber:r,weekday:n}=e,i=di(t,1,4),s=hr(t);let a,o=7*r+n-i-3;o<1?(a=t-1,o+=hr(a)):o>s?(a=t+1,o-=hr(t)):a=t;const{month:l,day:u}=fi(a,o);return{year:a,month:l,day:u,...Er(e)}}function gi(e){const{year:t,month:r,day:n}=e;return{year:t,ordinal:hi(t,r,n),...Er(e)}}function yi(e){const{year:t,ordinal:r}=e,{month:n,day:i}=fi(t,r);return{year:t,month:n,day:i,...Er(e)}}function vi(e){const t=tr(e.year),r=sr(e.month,1,12),n=sr(e.day,1,fr(e.year,e.month));return t?r?!n&&ci("day",e.day):ci("month",e.month):ci("year",e.year)}function bi(e){const{hour:t,minute:r,second:n,millisecond:i}=e,s=sr(t,0,23)||24===t&&0===r&&0===n&&0===i,a=sr(r,0,59),o=sr(n,0,59),l=sr(i,0,999);return s?a?o?!l&&ci("millisecond",i):ci("second",n):ci("minute",r):ci("hour",t)}const wi="Invalid DateTime",xi=864e13;function Ei(e){return new Ur("unsupported zone",`the zone "${e.name}" is not supported`)}function Di(e){return null===e.weekData&&(e.weekData=pi(e.c)),e.weekData}function Si(e,t){const r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new qi({...r,...t,old:r})}function Ai(e,t,r){let n=e-60*t*1e3;const i=r.offset(n);if(t===i)return[n,t];n-=60*(i-t)*1e3;const s=r.offset(n);return i===s?[n,i]:[e-60*Math.min(i,s)*1e3,Math.max(i,s)]}function Ti(e,t){const r=new Date(e+=60*t*1e3);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function Ci(e,t,r){return Ai(pr(e),t,r)}function Ni(e,t){const r=e.o,n=e.c.year+Math.trunc(t.years),i=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),s={...e.c,year:n,month:i,day:Math.min(e.c.day,fr(n,i))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},a=Bn.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),o=pr(s);let[l,u]=Ai(o,r,e.zone);return 0!==a&&(l+=a,u=e.zone.offset(l)),{ts:l,o:u}}function ki(e,t,r,n,i,s){const{setZone:a,zone:o}=r;if(e&&0!==Object.keys(e).length||t){const n=t||o,i=qi.fromObject(e,{...r,zone:n,specificOffset:s});return a?i:i.setZone(o)}return qi.invalid(new Ur("unparsable",`the input "${i}" can't be parsed as ${n}`))}function Mi(e,t,r=!0){return e.isValid?Br.create($t.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Oi(e,t){const r=e.c.year>9999||e.c.year<0;let n="";return r&&e.c.year>=0&&(n+="+"),n+=ar(e.c.year,r?6:4),t?(n+="-",n+=ar(e.c.month),n+="-",n+=ar(e.c.day)):(n+=ar(e.c.month),n+=ar(e.c.day)),n}function Fi(e,t,r,n,i,s){let a=ar(e.c.hour);return t?(a+=":",a+=ar(e.c.minute),0===e.c.millisecond&&0===e.c.second&&r||(a+=":")):a+=ar(e.c.minute),0===e.c.millisecond&&0===e.c.second&&r||(a+=ar(e.c.second),0===e.c.millisecond&&n||(a+=".",a+=ar(e.c.millisecond,3))),i&&(e.isOffsetFixed&&0===e.offset&&!s?a+="Z":e.o<0?(a+="-",a+=ar(Math.trunc(-e.o/60)),a+=":",a+=ar(Math.trunc(-e.o%60))):(a+="+",a+=ar(Math.trunc(e.o/60)),a+=":",a+=ar(Math.trunc(e.o%60)))),s&&(a+="["+e.zone.ianaName+"]"),a}const Li={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},_i={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Ri={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Ii=["year","month","day","hour","minute","second","millisecond"],Pi=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Bi=["year","ordinal","hour","minute","second","millisecond"];function Ui(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new Ye(e);return t}function $i(e,t){const r=Ht(t.zone,Xt.defaultZone),n=$t.fromObject(t),i=Xt.now();let s,a;if(Qt(e.year))s=i;else{for(const t of Ii)Qt(e[t])&&(e[t]=Li[t]);const t=vi(e)||bi(e);if(t)return qi.invalid(t);const n=r.offset(i);[s,a]=Ci(e,n,r)}return new qi({ts:s,zone:r,loc:n,o:a})}function zi(e,t,r){const n=!!Qt(r.round)||r.round,i=(e,i)=>{e=cr(e,n||r.calendary?0:2,!0);return t.loc.clone(r).relFormatter(r).format(e,i)},s=n=>r.calendary?t.hasSame(e,n)?0:t.startOf(n).diff(e.startOf(n),n).get(n):t.diff(e,n).get(n);if(r.unit)return i(s(r.unit),r.unit);for(const e of r.units){const t=s(e);if(Math.abs(t)>=1)return i(t,e)}return i(e>t?-0:0,r.units[r.units.length-1])}function ji(e){let t,r={};return e.length>0&&"object"==typeof e[e.length-1]?(r=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[r,t]}class qi{constructor(e){const t=e.zone||Xt.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Ur("invalid input"):null)||(t.isValid?null:Ei(t));this.ts=Qt(e.ts)?Xt.now():e.ts;let n=null,i=null;if(!r){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[n,i]=[e.old.c,e.old.o];else{const e=t.offset(this.ts);n=Ti(this.ts,e),r=Number.isNaN(n.year)?new Ur("invalid input"):null,n=r?null:n,i=r?null:e}}this._zone=t,this.loc=e.loc||$t.create(),this.invalid=r,this.weekData=null,this.c=n,this.o=i,this.isLuxonDateTime=!0}static now(){return new qi({})}static local(){const[e,t]=ji(arguments),[r,n,i,s,a,o,l]=t;return $i({year:r,month:n,day:i,hour:s,minute:a,second:o,millisecond:l},e)}static utc(){const[e,t]=ji(arguments),[r,n,i,s,a,o,l]=t;return e.zone=jt.utcInstance,$i({year:r,month:n,day:i,hour:s,minute:a,second:o,millisecond:l},e)}static fromJSDate(e,t={}){const r=(n=e,"[object Date]"===Object.prototype.toString.call(n)?e.valueOf():NaN);var n;if(Number.isNaN(r))return qi.invalid("invalid input");const i=Ht(t.zone,Xt.defaultZone);return i.isValid?new qi({ts:r,zone:i,loc:$t.fromObject(t)}):qi.invalid(Ei(i))}static fromMillis(e,t={}){if(er(e))return e<-xi||e>xi?qi.invalid("Timestamp out of range"):new qi({ts:e,zone:Ht(t.zone,Xt.defaultZone),loc:$t.fromObject(t)});throw new Je(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(er(e))return new qi({ts:1e3*e,zone:Ht(t.zone,Xt.defaultZone),loc:$t.fromObject(t)});throw new Je("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const r=Ht(t.zone,Xt.defaultZone);if(!r.isValid)return qi.invalid(Ei(r));const n=Xt.now(),i=Qt(t.specificOffset)?r.offset(n):t.specificOffset,s=wr(e,Ui),a=!Qt(s.ordinal),o=!Qt(s.year),l=!Qt(s.month)||!Qt(s.day),u=o||l,c=s.weekYear||s.weekNumber,d=$t.fromObject(t);if((u||a)&&c)throw new We("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&a)throw new We("Can't mix ordinal dates with month/day");const h=c||s.weekday&&!u;let f,p,m=Ti(n,i);h?(f=Pi,p=_i,m=pi(m)):a?(f=Bi,p=Ri,m=gi(m)):(f=Ii,p=Li);let g=!1;for(const e of f){Qt(s[e])?s[e]=g?p[e]:m[e]:g=!0}const y=h?function(e){const t=tr(e.weekYear),r=sr(e.weekNumber,1,mr(e.weekYear)),n=sr(e.weekday,1,7);return t?r?!n&&ci("weekday",e.weekday):ci("week",e.week):ci("weekYear",e.weekYear)}(s):a?function(e){const t=tr(e.year),r=sr(e.ordinal,1,hr(e.year));return t?!r&&ci("ordinal",e.ordinal):ci("year",e.year)}(s):vi(s),v=y||bi(s);if(v)return qi.invalid(v);const b=h?mi(s):a?yi(s):s,[w,x]=Ci(b,i,r),E=new qi({ts:w,zone:r,o:x,loc:d});return s.weekday&&u&&e.weekday!==E.weekday?qi.invalid("mismatched weekday",`you can't specify both a weekday of ${s.weekday} and a date of ${E.toISO()}`):E}static fromISO(e,t={}){const[r,n]=function(e){return qr(e,[gn,wn],[yn,xn],[vn,En],[bn,Dn])}(e);return ki(r,n,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[r,n]=function(e){return qr(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[un,cn])}(e);return ki(r,n,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[r,n]=function(e){return qr(e,[dn,pn],[hn,pn],[fn,mn])}(e);return ki(r,n,t,"HTTP",t)}static fromFormat(e,t,r={}){if(Qt(e)||Qt(t))throw new Je("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:i=null}=r,s=$t.fromOpts({locale:n,numberingSystem:i,defaultToEN:!0}),[a,o,l,u]=function(e,t,r){const{result:n,zone:i,specificOffset:s,invalidReason:a}=ai(e,t,r);return[n,i,s,a]}(s,e,t);return u?qi.invalid(u):ki(a,o,r,`format ${t}`,e,l)}static fromString(e,t,r={}){return qi.fromFormat(e,t,r)}static fromSQL(e,t={}){const[r,n]=function(e){return qr(e,[An,wn],[Tn,Cn])}(e);return ki(r,n,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new Je("need to specify a reason the DateTime is invalid");const r=e instanceof Ur?e:new Ur(e,t);if(Xt.throwOnInvalid)throw new Ve(r);return new qi({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const r=oi(e,$t.fromObject(t));return r?r.map((e=>e?e.val:null)).join(""):null}static expandFormat(e,t={}){return si(Br.parseFormat(e),$t.fromObject(t)).map((e=>e.val)).join("")}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Di(this).weekYear:NaN}get weekNumber(){return this.isValid?Di(this).weekNumber:NaN}get weekday(){return this.isValid?Di(this).weekday:NaN}get ordinal(){return this.isValid?gi(this.c).ordinal:NaN}get monthShort(){return this.isValid?zn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?zn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?zn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?zn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,r=pr(this.c),n=this.zone.offset(r-e),i=this.zone.offset(r+e),s=this.zone.offset(r-n*t),a=this.zone.offset(r-i*t);if(s===a)return[this];const o=r-s*t,l=r-a*t,u=Ti(o,s),c=Ti(l,a);return u.hour===c.hour&&u.minute===c.minute&&u.second===c.second&&u.millisecond===c.millisecond?[Si(this,{ts:o}),Si(this,{ts:l})]:[this]}get isInLeapYear(){return dr(this.year)}get daysInMonth(){return fr(this.year,this.month)}get daysInYear(){return this.isValid?hr(this.year):NaN}get weeksInWeekYear(){return this.isValid?mr(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:r,calendar:n}=Br.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:r,outputCalendar:n}}toUTC(e=0,t={}){return this.setZone(jt.instance(e),t)}toLocal(){return this.setZone(Xt.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:r=!1}={}){if((e=Ht(e,Xt.defaultZone)).equals(this.zone))return this;if(e.isValid){let n=this.ts;if(t||r){const t=e.offset(this.ts),r=this.toObject();[n]=Ci(r,t,e)}return Si(this,{ts:n,zone:e})}return qi.invalid(Ei(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:r}={}){return Si(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:r})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=wr(e,Ui),r=!Qt(t.weekYear)||!Qt(t.weekNumber)||!Qt(t.weekday),n=!Qt(t.ordinal),i=!Qt(t.year),s=!Qt(t.month)||!Qt(t.day),a=i||s,o=t.weekYear||t.weekNumber;if((a||n)&&o)throw new We("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(s&&n)throw new We("Can't mix ordinal dates with month/day");let l;r?l=mi({...pi(this.c),...t}):Qt(t.ordinal)?(l={...this.toObject(),...t},Qt(t.day)&&(l.day=Math.min(fr(l.year,l.month),l.day))):l=yi({...gi(this.c),...t});const[u,c]=Ci(l,this.o,this.zone);return Si(this,{ts:u,o:c})}plus(e){if(!this.isValid)return this;return Si(this,Ni(this,Bn.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return Si(this,Ni(this,Bn.fromDurationLike(e).negate()))}startOf(e){if(!this.isValid)return this;const t={},r=Bn.normalizeUnit(e);switch(r){case"years":t.month=1;case"quarters":case"months":t.day=1;case"weeks":case"days":t.hour=0;case"hours":t.minute=0;case"minutes":t.second=0;case"seconds":t.millisecond=0}if("weeks"===r&&(t.weekday=1),"quarters"===r){const e=Math.ceil(this.month/3);t.month=3*(e-1)+1}return this.set(t)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,t={}){return this.isValid?Br.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):wi}toLocaleString(e=tt,t={}){return this.isValid?Br.create(this.loc.clone(t),e).formatDateTime(this):wi}toLocaleParts(e={}){return this.isValid?Br.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:r=!1,includeOffset:n=!0,extendedZone:i=!1}={}){if(!this.isValid)return null;const s="extended"===e;let a=Oi(this,s);return a+="T",a+=Fi(this,s,t,r,n,i),a}toISODate({format:e="extended"}={}){return this.isValid?Oi(this,"extended"===e):null}toISOWeekDate(){return Mi(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:r=!0,includePrefix:n=!1,extendedZone:i=!1,format:s="extended"}={}){if(!this.isValid)return null;return(n?"T":"")+Fi(this,"extended"===s,t,e,r,i)}toRFC2822(){return Mi(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Mi(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Oi(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:r=!0}={}){let n="HH:mm:ss.SSS";return(t||e)&&(r&&(n+=" "),t?n+="z":e&&(n+="ZZ")),Mi(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():wi}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",r={}){if(!this.isValid||!e.isValid)return Bn.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...r},i=(o=t,Array.isArray(o)?o:[o]).map(Bn.normalizeUnit),s=e.valueOf()>this.valueOf(),a=qn(s?this:e,s?e:this,i,n);var o;return s?a.negate():a}diffNow(e="milliseconds",t={}){return this.diff(qi.now(),e,t)}until(e){return this.isValid?$n.fromDateTimes(this,e):this}hasSame(e,t){if(!this.isValid)return!1;const r=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(t)<=r&&r<=n.endOf(t)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||qi.fromObject({},{zone:this.zone}),r=e.padding?this<t?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],i=e.unit;return Array.isArray(e.unit)&&(n=e.unit,i=void 0),zi(t,this.plus(r),{...e,numeric:"always",units:n,unit:i})}toRelativeCalendar(e={}){return this.isValid?zi(e.base||qi.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(qi.isDateTime))throw new Je("min requires all arguments be DateTimes");return nr(e,(e=>e.valueOf()),Math.min)}static max(...e){if(!e.every(qi.isDateTime))throw new Je("max requires all arguments be DateTimes");return nr(e,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t,r={}){const{locale:n=null,numberingSystem:i=null}=r;return ai($t.fromOpts({locale:n,numberingSystem:i,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,r={}){return qi.fromFormatExplain(e,t,r)}static get DATE_SHORT(){return tt}static get DATE_MED(){return rt}static get DATE_MED_WITH_WEEKDAY(){return nt}static get DATE_FULL(){return it}static get DATE_HUGE(){return st}static get TIME_SIMPLE(){return at}static get TIME_WITH_SECONDS(){return ot}static get TIME_WITH_SHORT_OFFSET(){return lt}static get TIME_WITH_LONG_OFFSET(){return ut}static get TIME_24_SIMPLE(){return ct}static get TIME_24_WITH_SECONDS(){return dt}static get TIME_24_WITH_SHORT_OFFSET(){return ht}static get TIME_24_WITH_LONG_OFFSET(){return ft}static get DATETIME_SHORT(){return pt}static get DATETIME_SHORT_WITH_SECONDS(){return mt}static get DATETIME_MED(){return gt}static get DATETIME_MED_WITH_SECONDS(){return yt}static get DATETIME_MED_WITH_WEEKDAY(){return vt}static get DATETIME_FULL(){return bt}static get DATETIME_FULL_WITH_SECONDS(){return wt}static get DATETIME_HUGE(){return xt}static get DATETIME_HUGE_WITH_SECONDS(){return Et}}function Hi(e){if(qi.isDateTime(e))return e;if(e&&e.valueOf&&er(e.valueOf()))return qi.fromJSDate(e);if(e&&"object"==typeof e)return qi.fromObject(e);throw new Je(`Unknown datetime argument: ${e}, of type ${typeof e}`)}function Vi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var Gi=function e(t,r){function n(e,n,i){if("undefined"!=typeof document){"number"==typeof(i=Vi({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,!0!==i[a]&&(s+="="+i[a].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+s}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},i=0;i<r.length;i++){var s=r[i].split("="),a=s.slice(1).join("=");try{var o=decodeURIComponent(s[0]);if(n[o]=t.read(a,o),e===o)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",Vi({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,Vi({},this.attributes,t))},withConverter:function(t){return e(Vi({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});function Ki(e){this.content=e}Ki.prototype={constructor:Ki,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,r){var n=r&&r!=e?this.remove(r):this,i=n.find(e),s=n.content.slice();return-1==i?s.push(r||e,t):(s[i+1]=t,r&&(s[i]=r)),new Ki(s)},remove:function(e){var t=this.find(e);if(-1==t)return this;var r=this.content.slice();return r.splice(t,2),new Ki(r)},addToStart:function(e,t){return new Ki([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var r=this.remove(e).content.slice();return r.push(e,t),new Ki(r)},addBefore:function(e,t,r){var n=this.remove(t),i=n.content.slice(),s=n.find(e);return i.splice(-1==s?i.length:s,0,t,r),new Ki(i)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=Ki.from(e)).size?new Ki(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=Ki.from(e)).size?new Ki(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=Ki.from(e);for(var r=0;r<e.content.length;r+=2)t=t.remove(e.content[r]);return t},toObject:function(){var e={};return this.forEach((function(t,r){e[t]=r})),e},get size(){return this.content.length>>1}},Ki.from=function(e){if(e instanceof Ki)return e;var t=[];if(e)for(var r in e)t.push(r,e[r]);return new Ki(t)};const Wi=Ki;function Yi(e,t,r){for(let n=0;;n++){if(n==e.childCount||n==t.childCount)return e.childCount==t.childCount?null:r;let i=e.child(n),s=t.child(n);if(i!=s){if(!i.sameMarkup(s))return r;if(i.isText&&i.text!=s.text){for(let e=0;i.text[e]==s.text[e];e++)r++;return r}if(i.content.size||s.content.size){let e=Yi(i.content,s.content,r+1);if(null!=e)return e}r+=i.nodeSize}else r+=i.nodeSize}}function Ji(e,t,r,n){for(let i=e.childCount,s=t.childCount;;){if(0==i||0==s)return i==s?null:{a:r,b:n};let a=e.child(--i),o=t.child(--s),l=a.nodeSize;if(a!=o){if(!a.sameMarkup(o))return{a:r,b:n};if(a.isText&&a.text!=o.text){let e=0,t=Math.min(a.text.length,o.text.length);for(;e<t&&a.text[a.text.length-e-1]==o.text[o.text.length-e-1];)e++,r--,n--;return{a:r,b:n}}if(a.content.size||o.content.size){let e=Ji(a.content,o.content,r-1,n-1);if(e)return e}r-=l,n-=l}else r-=l,n-=l}}class Zi{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let t=0;t<e.length;t++)this.size+=e[t].nodeSize}nodesBetween(e,t,r,n=0,i){for(let s=0,a=0;a<t;s++){let o=this.content[s],l=a+o.nodeSize;if(l>e&&!1!==r(o,n+a,i||null,s)&&o.content.size){let i=a+1;o.nodesBetween(Math.max(0,e-i),Math.min(o.content.size,t-i),r,n+i)}a=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,n){let i="",s=!0;return this.nodesBetween(e,t,((a,o)=>{a.isText?(i+=a.text.slice(Math.max(e,o)-o,t-o),s=!r):a.isLeaf?(n?i+="function"==typeof n?n(a):n:a.type.spec.leafText&&(i+=a.type.spec.leafText(a)),s=!r):!s&&a.isBlock&&(i+=r,s=!0)}),0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,n=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(r)&&(n[n.length-1]=t.withText(t.text+r.text),i=1);i<e.content.length;i++)n.push(e.content[i]);return new Zi(n,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let r=[],n=0;if(t>e)for(let i=0,s=0;s<t;i++){let a=this.content[i],o=s+a.nodeSize;o>e&&((s<e||o>t)&&(a=a.isText?a.cut(Math.max(0,e-s),Math.min(a.text.length,t-s)):a.cut(Math.max(0,e-s-1),Math.min(a.content.size,t-s-1))),r.push(a),n+=a.nodeSize),s=o}return new Zi(r,n)}cutByIndex(e,t){return e==t?Zi.empty:0==e&&t==this.content.length?this:new Zi(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let n=this.content.slice(),i=this.size+t.nodeSize-r.nodeSize;return n[e]=t,new Zi(n,i)}addToStart(e){return new Zi([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Zi(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let n=this.content[t];e(n,r,t),r+=n.nodeSize}}findDiffStart(e,t=0){return Yi(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return Ji(this,e,t,r)}findIndex(e,t=-1){if(0==e)return Qi(0,e);if(e==this.size)return Qi(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,n=0;;r++){let i=n+this.child(r).nodeSize;if(i>=e)return i==e||t>0?Qi(r+1,i):Qi(r,n);n=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return Zi.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new Zi(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Zi.empty;let t,r=0;for(let n=0;n<e.length;n++){let i=e[n];r+=i.nodeSize,n&&i.isText&&e[n-1].sameMarkup(i)?(t||(t=e.slice(0,n)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new Zi(t||e,r)}static from(e){if(!e)return Zi.empty;if(e instanceof Zi)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Zi([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Zi.empty=new Zi([],0);const Xi={index:0,offset:0};function Qi(e,t){return Xi.index=e,Xi.offset=t,Xi}function es(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let r=Array.isArray(e);if(Array.isArray(t)!=r)return!1;if(r){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!es(e[r],t[r]))return!1}else{for(let r in e)if(!(r in t)||!es(e[r],t[r]))return!1;for(let r in t)if(!(r in e))return!1}return!0}class ts{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let n=0;n<e.length;n++){let i=e[n];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,n));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,n)),t.push(this),r=!0),t&&t.push(i)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&es(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);return r.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return ts.none;if(e instanceof ts)return[e];let t=e.slice();return t.sort(((e,t)=>e.type.rank-t.type.rank)),t}}ts.none=[];class rs extends Error{}class ns{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=ss(this.content,e+this.openStart,t);return r&&new ns(r,this.openStart,this.openEnd)}removeBetween(e,t){return new ns(is(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return ns.empty;let r=t.openStart||0,n=t.openEnd||0;if("number"!=typeof r||"number"!=typeof n)throw new RangeError("Invalid input for Slice.fromJSON");return new ns(Zi.fromJSON(e,t.content),r,n)}static maxOpen(e,t=!0){let r=0,n=0;for(let n=e.firstChild;n&&!n.isLeaf&&(t||!n.type.spec.isolating);n=n.firstChild)r++;for(let r=e.lastChild;r&&!r.isLeaf&&(t||!r.type.spec.isolating);r=r.lastChild)n++;return new ns(e,r,n)}}function is(e,t,r){let{index:n,offset:i}=e.findIndex(t),s=e.maybeChild(n),{index:a,offset:o}=e.findIndex(r);if(i==t||s.isText){if(o!=r&&!e.child(a).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(r))}if(n!=a)throw new RangeError("Removing non-flat range");return e.replaceChild(n,s.copy(is(s.content,t-i-1,r-i-1)))}function ss(e,t,r,n){let{index:i,offset:s}=e.findIndex(t),a=e.maybeChild(i);if(s==t||a.isText)return n&&!n.canReplace(i,i,r)?null:e.cut(0,t).append(r).append(e.cut(t));let o=ss(a.content,t-s-1,r);return o&&e.replaceChild(i,a.copy(o))}function as(e,t,r){if(r.openStart>e.depth)throw new rs("Inserted content deeper than insertion position");if(e.depth-r.openStart!=t.depth-r.openEnd)throw new rs("Inconsistent open depths");return ls(e,t,r,0)}function ls(e,t,r,n){let i=e.index(n),s=e.node(n);if(i==t.index(n)&&n<e.depth-r.openStart){let a=ls(e,t,r,n+1);return s.copy(s.content.replaceChild(i,a))}if(r.content.size){if(r.openStart||r.openEnd||e.depth!=n||t.depth!=n){let{start:i,end:a}=function(e,t){let r=t.depth-e.openStart,n=t.node(r).copy(e.content);for(let e=r-1;e>=0;e--)n=t.node(e).copy(Zi.from(n));return{start:n.resolveNoCache(e.openStart+r),end:n.resolveNoCache(n.content.size-e.openEnd-r)}}(r,e);return fs(s,ps(e,i,a,t,n))}{let n=e.parent,i=n.content;return fs(n,i.cut(0,e.parentOffset).append(r.content).append(i.cut(t.parentOffset)))}}return fs(s,ms(e,t,n))}function us(e,t){if(!t.type.compatibleContent(e.type))throw new rs("Cannot join "+t.type.name+" onto "+e.type.name)}function cs(e,t,r){let n=e.node(r);return us(n,t.node(r)),n}function ds(e,t){let r=t.length-1;r>=0&&e.isText&&e.sameMarkup(t[r])?t[r]=e.withText(t[r].text+e.text):t.push(e)}function hs(e,t,r,n){let i=(t||e).node(r),s=0,a=t?t.index(r):i.childCount;e&&(s=e.index(r),e.depth>r?s++:e.textOffset&&(ds(e.nodeAfter,n),s++));for(let e=s;e<a;e++)ds(i.child(e),n);t&&t.depth==r&&t.textOffset&&ds(t.nodeBefore,n)}function fs(e,t){return e.type.checkContent(t),e.copy(t)}function ps(e,t,r,n,i){let s=e.depth>i&&cs(e,t,i+1),a=n.depth>i&&cs(r,n,i+1),o=[];return hs(null,e,i,o),s&&a&&t.index(i)==r.index(i)?(us(s,a),ds(fs(s,ps(e,t,r,n,i+1)),o)):(s&&ds(fs(s,ms(e,t,i+1)),o),hs(t,r,i,o),a&&ds(fs(a,ms(r,n,i+1)),o)),hs(n,null,i,o),new Zi(o)}function ms(e,t,r){let n=[];if(hs(null,e,r,n),e.depth>r){ds(fs(cs(e,t,r+1),ms(e,t,r+1)),n)}return hs(t,null,r,n),new Zi(n)}ns.empty=new ns(Zi.empty,0,0);class gs{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],n=e.child(t);return r?e.child(t).cut(r):n}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[3*t],n=0==t?0:this.path[3*t-1]+1;for(let t=0;t<e;t++)n+=r.child(t).nodeSize;return n}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return ts.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),n=e.maybeChild(t);if(!r){let e=r;r=n,n=e}let i=r.marks;for(var s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||n&&i[s].isInSet(n.marks)||(i=i[s--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,n=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)!1!==r[i].type.spec.inclusive||n&&r[i].isInSet(n.marks)||(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new ws(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],n=0,i=t;for(let t=e;;){let{index:e,offset:s}=t.content.findIndex(i),a=i-s;if(r.push(t,e,n+s),!a)break;if(t=t.child(e),t.isText)break;i=a-1,n+=s+1}return new gs(t,r,i)}static resolveCached(e,t){for(let r=0;r<ys.length;r++){let n=ys[r];if(n.pos==t&&n.doc==e)return n}let r=ys[vs]=gs.resolve(e,t);return vs=(vs+1)%bs,r}}let ys=[],vs=0,bs=12;class ws{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const xs=Object.create(null);class Es{constructor(e,t,r,n=ts.none){this.type=e,this.attrs=t,this.marks=n,this.content=r||Zi.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,n=0){this.content.nodesBetween(e,t,r,n,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,n){return this.content.textBetween(e,t,r,n)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&es(this.attrs,t||e.defaultAttrs||xs)&&ts.sameSet(this.marks,r||ts.none)}copy(e=null){return e==this.content?this:new Es(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Es(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return ns.empty;let n=this.resolve(e),i=this.resolve(t),s=r?0:n.sharedDepth(t),a=n.start(s),o=n.node(s).content.cut(n.pos-a,i.pos-a);return new ns(o,n.depth-s,i.depth-s)}replace(e,t,r){return as(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:n}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(n==e||t.isText)return t;e-=n+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let n=this.content.child(t-1);return{node:n,index:t-1,offset:r-n.nodeSize}}resolve(e){return gs.resolveCached(this,e)}resolveNoCache(e){return gs.resolve(this,e)}rangeHasMark(e,t,r){let n=!1;return t>e&&this.nodesBetween(e,t,(e=>(r.isInSet(e.marks)&&(n=!0),!n))),n}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Ss(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=Zi.empty,n=0,i=r.childCount){let s=this.contentMatchAt(e).matchFragment(r,n,i),a=s&&s.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let e=n;e<i;e++)if(!this.type.allowsMarks(r.child(e).marks))return!1;return!0}canReplaceWith(e,t,r,n){if(n&&!this.type.allowsMarks(n))return!1;let i=this.contentMatchAt(e).matchType(r),s=i&&i.matchFragment(this.content,t);return!!s&&s.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=ts.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!ts.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((e=>e.type.name))}`);this.content.forEach((e=>e.check()))}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map((e=>e.toJSON()))),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let n=Zi.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,n,r)}}Es.prototype.text=void 0;class Ds extends Es{constructor(e,t,r,n){if(super(e,t,null,n),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Ss(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ds(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ds(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Ss(e,t){for(let r=e.length-1;r>=0;r--)t=e[r].type.name+"("+t+")";return t}class As{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new Ts(e,t);if(null==r.next)return As.empty;let n=Cs(r);r.next&&r.err("Unexpected trailing text");let i=function(e){let t=Object.create(null);return r(Ls(e,0));function r(n){let i=[];n.forEach((t=>{e[t].forEach((({term:t,to:r})=>{if(!t)return;let n;for(let e=0;e<i.length;e++)i[e][0]==t&&(n=i[e][1]);Ls(e,r).forEach((e=>{n||i.push([t,n=[]]),-1==n.indexOf(e)&&n.push(e)}))}))}));let s=t[n.join(",")]=new As(n.indexOf(e.length-1)>-1);for(let e=0;e<i.length;e++){let n=i[e][1].sort(Fs);s.next.push({type:i[e][0],next:t[n.join(",")]||r(n)})}return s}}(function(e){let t=[[]];return i(s(e,0),r()),t;function r(){return t.push([])-1}function n(e,r,n){let i={term:n,to:r};return t[e].push(i),i}function i(e,t){e.forEach((e=>e.to=t))}function s(e,t){if("choice"==e.type)return e.exprs.reduce(((e,r)=>e.concat(s(r,t))),[]);if("seq"!=e.type){if("star"==e.type){let a=r();return n(t,a),i(s(e.expr,a),a),[n(a)]}if("plus"==e.type){let a=r();return i(s(e.expr,t),a),i(s(e.expr,a),a),[n(a)]}if("opt"==e.type)return[n(t)].concat(s(e.expr,t));if("range"==e.type){let a=t;for(let t=0;t<e.min;t++){let t=r();i(s(e.expr,a),t),a=t}if(-1==e.max)i(s(e.expr,a),a);else for(let t=e.min;t<e.max;t++){let t=r();n(a,t),i(s(e.expr,a),t),a=t}return[n(a)]}if("name"==e.type)return[n(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let n=0;;n++){let a=s(e.exprs[n],t);if(n==e.exprs.length-1)return a;i(a,t=r())}}}(n));return function(e,t){for(let r=0,n=[e];r<n.length;r++){let e=n[r],i=!e.validEnd,s=[];for(let t=0;t<e.next.length;t++){let{type:r,next:a}=e.next[t];s.push(r.name),!i||r.isText||r.hasRequiredAttrs()||(i=!1),-1==n.indexOf(a)&&n.push(a)}i&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(i,r),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let n=this;for(let i=t;n&&i<r;i++)n=n.matchType(e.child(i).type);return n}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let n=[this];return function i(s,a){let o=s.matchFragment(e,r);if(o&&(!t||o.validEnd))return Zi.from(a.map((e=>e.createAndFill())));for(let e=0;e<s.next.length;e++){let{type:t,next:r}=s.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==n.indexOf(r)){n.push(r);let e=i(r,a.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let n=r.shift(),i=n.match;if(i.matchType(e)){let e=[];for(let t=n;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<i.next.length;e++){let{type:s,next:a}=i.next[e];s.isLeaf||s.hasRequiredAttrs()||s.name in t||n.type&&!a.validEnd||(r.push({match:s.contentMatch,type:s,via:n}),t[s.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(r){e.push(r);for(let n=0;n<r.next.length;n++)-1==e.indexOf(r.next[n].next)&&t(r.next[n].next)}(this),e.map(((t,r)=>{let n=r+(t.validEnd?"*":" ")+" ";for(let r=0;r<t.next.length;r++)n+=(r?", ":"")+t.next[r].type.name+"->"+e.indexOf(t.next[r].next);return n})).join("\n")}}As.empty=new As(!0);class Ts{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Cs(e){let t=[];do{t.push(Ns(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function Ns(e){let t=[];do{t.push(ks(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function ks(e){let t=function(e){if(e.eat("(")){let t=Cs(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let r=e.nodeTypes,n=r[t];if(n)return[n];let i=[];for(let e in r){let n=r[e];n.groups.indexOf(t)>-1&&i.push(n)}0==i.length&&e.err("No node type or group '"+t+"' found");return i}(e,e.next).map((t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t})));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=Os(e,t)}return t}function Ms(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function Os(e,t){let r=Ms(e),n=r;return e.eat(",")&&(n="}"!=e.next?Ms(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:r,max:n,expr:t}}function Fs(e,t){return t-e}function Ls(e,t){let r=[];return function t(n){let i=e[n];if(1==i.length&&!i[0].term)return t(i[0].to);r.push(n);for(let e=0;e<i.length;e++){let{term:n,to:s}=i[e];n||-1!=r.indexOf(s)||t(s)}}(t),r.sort(Fs)}function _s(e){let t=Object.create(null);for(let r in e){let n=e[r];if(!n.hasDefault)return null;t[r]=n.default}return t}function Rs(e,t){let r=Object.create(null);for(let n in e){let i=t&&t[n];if(void 0===i){let t=e[n];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+n);i=t.default}r[n]=i}return r}function Is(e){let t=Object.create(null);if(e)for(let r in e)t[r]=new Bs(e[r]);return t}class Ps{constructor(e,t,r){this.name=e,this.schema=t,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Is(r.attrs),this.defaultAttrs=_s(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==As.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Rs(this.attrs,e)}create(e=null,t,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Es(this,this.computeAttrs(e),Zi.from(t),ts.setFrom(r))}createChecked(e=null,t,r){return t=Zi.from(t),this.checkContent(t),new Es(this,this.computeAttrs(e),t,ts.setFrom(r))}createAndFill(e=null,t,r){if(e=this.computeAttrs(e),(t=Zi.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let n=this.contentMatch.matchFragment(t),i=n&&n.fillBefore(Zi.empty,!0);return i?new Es(this,e,t.append(i),ts.setFrom(r)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let t=0;t<e.childCount;t++)if(!this.allowsMarks(e.child(t).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:ts.none:e}static compile(e,t){let r=Object.create(null);e.forEach(((e,n)=>r[e]=new Ps(e,t,n)));let n=t.spec.topNode||"doc";if(!r[n])throw new RangeError("Schema is missing its top node type ('"+n+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let e in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}}class Bs{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class Us{constructor(e,t,r,n){this.name=e,this.rank=t,this.schema=r,this.spec=n,this.attrs=Is(n.attrs),this.excluded=null;let i=_s(this.attrs);this.instance=i?new ts(this,i):null}create(e=null){return!e&&this.instance?this.instance:new ts(this,Rs(this.attrs,e))}static compile(e,t){let r=Object.create(null),n=0;return e.forEach(((e,i)=>r[e]=new Us(e,n++,t,i))),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}}class $s{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let r in e)t[r]=e[r];t.nodes=Wi.from(e.nodes),t.marks=Wi.from(e.marks||{}),this.nodes=Ps.compile(this.spec.nodes,this),this.marks=Us.compile(this.spec.marks,this);let r=Object.create(null);for(let e in this.nodes){if(e in this.marks)throw new RangeError(e+" can not be both a node and a mark");let t=this.nodes[e],n=t.spec.content||"",i=t.spec.marks;t.contentMatch=r[n]||(r[n]=As.parse(n,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.markSet="_"==i?null:i?zs(this,i.split(" ")):""!=i&&t.inlineContent?null:[]}for(let e in this.marks){let t=this.marks[e],r=t.spec.excludes;t.excluded=null==r?[t]:""==r?[]:zs(this,r.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,r,n){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof Ps))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,r,n)}text(e,t){let r=this.nodes.text;return new Ds(r,r.defaultAttrs,e,ts.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Es.fromJSON(this,e)}markFromJSON(e){return ts.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function zs(e,t){let r=[];for(let n=0;n<t.length;n++){let i=t[n],s=e.marks[i],a=s;if(s)r.push(s);else for(let t in e.marks){let n=e.marks[t];("_"==i||n.spec.group&&n.spec.group.split(" ").indexOf(i)>-1)&&r.push(a=n)}if(!a)throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}return r}class js{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach((e=>{e.tag?this.tags.push(e):e.style&&this.styles.push(e)})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let r=e.nodes[t.node];return r.contentMatch.matchType(r)}))}parse(e,t={}){let r=new Ws(this,t,!1);return r.addAll(e,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new Ws(this,t,!0);return r.addAll(e,t.from,t.to),ns.maxOpen(r.finish())}matchTag(e,t,r){for(let n=r?this.tags.indexOf(r)+1:0;n<this.tags.length;n++){let r=this.tags[n];if(Ys(e,r.tag)&&(void 0===r.namespace||e.namespaceURI==r.namespace)&&(!r.context||t.matchesContext(r.context))){if(r.getAttrs){let t=r.getAttrs(e);if(!1===t)continue;r.attrs=t||void 0}return r}}}matchStyle(e,t,r,n){for(let i=n?this.styles.indexOf(n)+1:0;i<this.styles.length;i++){let n=this.styles[i],s=n.style;if(!(0!=s.indexOf(e)||n.context&&!r.matchesContext(n.context)||s.length>e.length&&(61!=s.charCodeAt(e.length)||s.slice(e.length+1)!=t))){if(n.getAttrs){let e=n.getAttrs(t);if(!1===e)continue;n.attrs=e||void 0}return n}}}static schemaRules(e){let t=[];function r(e){let r=null==e.priority?50:e.priority,n=0;for(;n<t.length;n++){let e=t[n];if((null==e.priority?50:e.priority)<r)break}t.splice(n,0,e)}for(let t in e.marks){let n=e.marks[t].spec.parseDOM;n&&n.forEach((e=>{r(e=Js(e)),e.mark||e.ignore||e.clearMark||(e.mark=t)}))}for(let t in e.nodes){let n=e.nodes[t].spec.parseDOM;n&&n.forEach((e=>{r(e=Js(e)),e.node||e.ignore||e.mark||(e.node=t)}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new js(e,js.schemaRules(e)))}}const qs={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Hs={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Vs={ol:!0,ul:!0};function Gs(e,t,r){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&r}class Ks{constructor(e,t,r,n,i,s,a){this.type=e,this.attrs=t,this.marks=r,this.pendingMarks=n,this.solid=i,this.options=a,this.content=[],this.activeMarks=ts.none,this.stashMarks=[],this.match=s||(4&a?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(Zi.from(e));if(!t){let t,r=this.type.contentMatch;return(t=r.findWrapping(e.type))?(this.match=r,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let r=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-e[0].length))}}let t=Zi.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(Zi.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,r=this.pendingMarks;t<r.length;t++){let n=r[t];(this.type?this.type.allowsMarkType(n.type):Zs(n.type,e))&&!n.isInSet(this.activeMarks)&&(this.activeMarks=n.addToSet(this.activeMarks),this.pendingMarks=n.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!qs.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Ws{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0;let n,i=t.topNode,s=Gs(null,t.preserveWhitespace,0)|(r?4:0);n=i?new Ks(i.type,i.attrs,ts.none,ts.none,!0,t.topMatch||i.type.contentMatch,s):new Ks(r?null:e.schema.topNodeType,null,ts.none,ts.none,!0,null,s),this.nodes=[n],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(3==e.nodeType)this.addTextNode(e);else if(1==e.nodeType){let t=e.getAttribute("style");if(t){let r=this.readStyles(function(e){let t,r=/\s*([\w-]+)\s*:\s*([^;]+)/g,n=[];for(;t=r.exec(e);)n.push(t[1],t[2].trim());return n}(t));if(!r)return;let[n,i]=r,s=this.top;for(let e=0;e<i.length;e++)this.removePendingMark(i[e],s);for(let e=0;e<n.length;e++)this.addPendingMark(n[e]);this.addElement(e);for(let e=0;e<n.length;e++)this.removePendingMark(n[e],s);for(let e=0;e<i.length;e++)this.addPendingMark(i[e])}else this.addElement(e)}}addTextNode(e){let t=e.nodeValue,r=this.top;if(2&r.options||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(1&r.options)t=2&r.options?t.replace(/\r\n?/g,"\n"):t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let n=r.content[r.content.length-1],i=e.previousSibling;(!n||i&&"BR"==i.nodeName||n.isText&&/[ \t\r\n\u000c]$/.test(n.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let r,n=e.nodeName.toLowerCase();Vs.hasOwnProperty(n)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,r=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&Vs.hasOwnProperty(e)&&r?(r.appendChild(t),t=r):"li"==e?r=t:e&&(r=null)}}(e);let i=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(r=this.parser.matchTag(e,this,t));if(i?i.ignore:Hs.hasOwnProperty(n))this.findInside(e),this.ignoreFallback(e);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(e=i.skip);let t,r=this.top,s=this.needsBlock;if(qs.hasOwnProperty(n))r.content.length&&r.content[0].isInline&&this.open&&(this.open--,r=this.top),t=!0,r.type||(this.needsBlock=!0);else if(!e.firstChild)return void this.leafFallback(e);this.addAll(e),t&&this.sync(r),this.needsBlock=s}else this.addElementByRule(e,i,!1===i.consuming?r:void 0)}leafFallback(e){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"))}ignoreFallback(e){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=ts.none,r=ts.none;e:for(let n=0;n<e.length;n+=2)for(let i;;){let s=this.parser.matchStyle(e[n],e[n+1],this,i);if(!s)continue e;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.forEach((e=>{s.clearMark(e)&&(r=e.addToSet(r))})):t=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(t),!1!==s.consuming)break;i=s}return[t,r]}addElementByRule(e,t,r){let n,i,s;if(t.node)i=this.parser.schema.nodes[t.node],i.isLeaf?this.insertNode(i.create(t.attrs))||this.leafFallback(e):n=this.enter(i,t.attrs||null,t.preserveWhitespace);else{s=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(s)}let a=this.top;if(i&&i.isLeaf)this.findInside(e);else if(r)this.addElement(e,r);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e)));else{let r=e;"string"==typeof t.contentElement?r=e.querySelector(t.contentElement):"function"==typeof t.contentElement?r=t.contentElement(e):t.contentElement&&(r=t.contentElement),this.findAround(e,r,!0),this.addAll(r)}n&&this.sync(a)&&this.open--,s&&this.removePendingMark(s,a)}addAll(e,t,r){let n=t||0;for(let i=t?e.childNodes[t]:e.firstChild,s=null==r?null:e.childNodes[r];i!=s;i=i.nextSibling,++n)this.findAtPoint(e,n),this.addDOM(i);this.findAtPoint(e,n)}findPlace(e){let t,r;for(let n=this.open;n>=0;n--){let i=this.nodes[n],s=i.findWrapping(e);if(s&&(!t||t.length>s.length)&&(t=s,r=i,!s.length))break;if(i.solid)break}if(!t)return!1;this.sync(r);for(let e=0;e<t.length;e++)this.enterInner(t[e],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let r=t.activeMarks;for(let n=0;n<e.marks.length;n++)t.type&&!t.type.allowsMarkType(e.marks[n].type)||(r=e.marks[n].addToSet(r));return t.content.push(e.mark(r)),!0}return!1}enter(e,t,r){let n=this.findPlace(e.create(t));return n&&this.enterInner(e,t,!0,r),n}enterInner(e,t=null,r=!1,n){this.closeExtra();let i=this.top;i.applyPending(e),i.match=i.match&&i.match.matchType(e);let s=Gs(e,n,i.options);4&i.options&&0==i.content.length&&(s|=4),this.nodes.push(new Ks(e,t,i.activeMarks,i.pendingMarks,r,null,s)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let t=r.length-1;t>=0;t--)e+=r[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let n=0;n<this.find.length;n++)if(null==this.find[n].pos&&1==e.nodeType&&e.contains(this.find[n].node)){t.compareDocumentPosition(this.find[n].node)&(r?2:4)&&(this.find[n].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,n=!(this.isOpen||r&&r.parent.type!=this.nodes[0].type),i=-(r?r.depth+1:0)+(n?0:1),s=(e,a)=>{for(;e>=0;e--){let o=t[e];if(""==o){if(e==t.length-1||0==e)continue;for(;a>=i;a--)if(s(e-1,a))return!0;return!1}{let e=a>0||0==a&&n?this.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!e||e.name!=o&&-1==e.groups.indexOf(o))return!1;a--}}return!0};return s(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}addPendingMark(e){let t=function(e,t){for(let r=0;r<t.length;r++)if(e.eq(t[r]))return t[r]}(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let r=this.open;r>=0;r--){let n=this.nodes[r];if(n.pendingMarks.lastIndexOf(e)>-1)n.pendingMarks=e.removeFromSet(n.pendingMarks);else{n.activeMarks=e.removeFromSet(n.activeMarks);let t=n.popFromStashMark(e);t&&n.type&&n.type.allowsMarkType(t.type)&&(n.activeMarks=t.addToSet(n.activeMarks))}if(n==t)break}}}function Ys(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function Js(e){let t={};for(let r in e)t[r]=e[r];return t}function Zs(e,t){let r=t.schema.nodes;for(let n in r){let i=r[n];if(!i.allowsMarkType(e))continue;let s=[],a=e=>{s.push(e);for(let r=0;r<e.edgeCount;r++){let{type:n,next:i}=e.edge(r);if(n==t)return!0;if(s.indexOf(i)<0&&a(i))return!0}};if(a(i.contentMatch))return!0}}class Xs{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=ea(t).createDocumentFragment());let n=r,i=[];return e.forEach((e=>{if(i.length||e.marks.length){let r=0,s=0;for(;r<i.length&&s<e.marks.length;){let t=e.marks[s];if(this.marks[t.type.name]){if(!t.eq(i[r][0])||!1===t.type.spec.spanning)break;r++,s++}else s++}for(;r<i.length;)n=i.pop()[1];for(;s<e.marks.length;){let r=e.marks[s++],a=this.serializeMark(r,e.isInline,t);a&&(i.push([r,n]),n.appendChild(a.dom),n=a.contentDOM||a.dom)}}n.appendChild(this.serializeNodeInner(e,t))})),r}serializeNodeInner(e,t){let{dom:r,contentDOM:n}=Xs.renderSpec(ea(t),this.nodes[e.type.name](e));if(n){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,n)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let n=e.marks.length-1;n>=0;n--){let i=this.serializeMark(e.marks[n],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,t,r={}){let n=this.marks[e.type.name];return n&&Xs.renderSpec(ea(r),n(e,t))}static renderSpec(e,t,r=null){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let n,i=t[0],s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let a=r?e.createElementNS(r,i):e.createElement(i),o=t[1],l=1;if(o&&"object"==typeof o&&null==o.nodeType&&!Array.isArray(o)){l=2;for(let e in o)if(null!=o[e]){let t=e.indexOf(" ");t>0?a.setAttributeNS(e.slice(0,t),e.slice(t+1),o[e]):a.setAttribute(e,o[e])}}for(let i=l;i<t.length;i++){let s=t[i];if(0===s){if(i<t.length-1||i>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}{let{dom:t,contentDOM:i}=Xs.renderSpec(e,s,r);if(a.appendChild(t),i){if(n)throw new RangeError("Multiple content holes");n=i}}}return{dom:a,contentDOM:n}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Xs(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Qs(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return Qs(e.marks)}}function Qs(e){let t={};for(let r in e){let n=e[r].spec.toDOM;n&&(t[r]=n)}return t}function ea(e){return e.document||window.document}const ta=Math.pow(2,16);function ra(e,t){return e+t*ta}function na(e){return 65535&e}class ia{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class sa{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&sa.empty)return sa.empty}recover(e){let t=0,r=na(e);if(!this.inverted)for(let e=0;e<r;e++)t+=this.ranges[3*e+2]-this.ranges[3*e+1];return this.ranges[3*r]+t+function(e){return(e-(65535&e))/ta}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let n=0,i=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let o=this.ranges[a]-(this.inverted?n:0);if(o>e)break;let l=this.ranges[a+i],u=this.ranges[a+s],c=o+l;if(e<=c){let i=o+n+((l?e==o?-1:e==c?1:t:t)<0?0:u);if(r)return i;let s=e==(t<0?o:c)?null:ra(a/3,e-o),d=e==o?2:e==c?1:4;return(t<0?e!=o:e!=c)&&(d|=8),new ia(i,d,s)}n+=u-l}return r?e+n:new ia(e+n,0,null)}touches(e,t){let r=0,n=na(t),i=this.inverted?2:1,s=this.inverted?1:2;for(let t=0;t<this.ranges.length;t+=3){let a=this.ranges[t]-(this.inverted?r:0);if(a>e)break;let o=this.ranges[t+i];if(e<=a+o&&t==3*n)return!0;r+=this.ranges[t+s]-o}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let n=0,i=0;n<this.ranges.length;n+=3){let s=this.ranges[n],a=s-(this.inverted?i:0),o=s+(this.inverted?0:i),l=this.ranges[n+t],u=this.ranges[n+r];e(a,a+l,o,o+u),i+=u-l}}invert(){return new sa(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?sa.empty:new sa(e<0?[0,-e,0]:[0,0,e])}}sa.empty=new sa([]);class aa{constructor(e=[],t,r=0,n=e.length){this.maps=e,this.mirror=t,this.from=r,this.to=n}slice(e=0,t=this.maps.length){return new aa(this.maps,this.mirror,e,t)}copy(){return new aa(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,r=this.maps.length;t<e.maps.length;t++){let n=e.getMirror(t);this.appendMap(e.maps[t],null!=n&&n<t?r+n:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this.maps.length+e.maps.length;t>=0;t--){let n=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=n&&n>t?r-n-1:void 0)}}invert(){let e=new aa;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let n=0;for(let r=this.from;r<this.to;r++){let i=this.maps[r].mapResult(e,t);if(null!=i.recover){let t=this.getMirror(r);if(null!=t&&t>r&&t<this.to){r=t,e=this.maps[t].recover(i.recover);continue}}n|=i.delInfo,e=i.pos}return r?e:new ia(e,n,null)}}const oa=Object.create(null);class la{getMap(){return sa.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=oa[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in oa)throw new RangeError("Duplicate use of step JSON ID "+e);return oa[e]=t,t.prototype.jsonID=e,t}}class ua{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new ua(e,null)}static fail(e){return new ua(null,e)}static fromReplace(e,t,r,n){try{return ua.ok(e.replace(t,r,n))}catch(e){if(e instanceof rs)return ua.fail(e.message);throw e}}}function ca(e,t,r){let n=[];for(let i=0;i<e.childCount;i++){let s=e.child(i);s.content.size&&(s=s.copy(ca(s.content,t,s))),s.isInline&&(s=t(s,r,i)),n.push(s)}return Zi.fromArray(n)}class da extends la{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),n=r.node(r.sharedDepth(this.to)),i=new ns(ca(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),n),t.openStart,t.openEnd);return ua.fromReplace(e,this.from,this.to,i)}invert(){return new ha(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new da(t.pos,r.pos,this.mark)}merge(e){return e instanceof da&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new da(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new da(t.from,t.to,e.markFromJSON(t.mark))}}la.jsonID("addMark",da);class ha extends la{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new ns(ca(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return ua.fromReplace(e,this.from,this.to,r)}invert(){return new da(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new ha(t.pos,r.pos,this.mark)}merge(e){return e instanceof ha&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ha(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ha(t.from,t.to,e.markFromJSON(t.mark))}}la.jsonID("removeMark",ha);class fa extends la{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return ua.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return ua.fromReplace(e,this.pos,this.pos+1,new ns(Zi.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let r=0;r<t.marks.length;r++)if(!t.marks[r].isInSet(e))return new fa(this.pos,t.marks[r]);return new fa(this.pos,this.mark)}}return new pa(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new fa(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new fa(t.pos,e.markFromJSON(t.mark))}}la.jsonID("addNodeMark",fa);class pa extends la{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return ua.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return ua.fromReplace(e,this.pos,this.pos+1,new ns(Zi.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new fa(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new pa(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new pa(t.pos,e.markFromJSON(t.mark))}}la.jsonID("removeNodeMark",pa);class ma extends la{constructor(e,t,r,n=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=n}apply(e){return this.structure&&ya(e,this.from,this.to)?ua.fail("Structure replace would overwrite content"):ua.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new sa([this.from,this.to-this.from,this.slice.size])}invert(e){return new ma(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new ma(t.pos,Math.max(t.pos,r.pos),this.slice)}merge(e){if(!(e instanceof ma)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?ns.empty:new ns(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ma(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?ns.empty:new ns(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ma(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ma(t.from,t.to,ns.fromJSON(e,t.slice),!!t.structure)}}la.jsonID("replace",ma);class ga extends la{constructor(e,t,r,n,i,s,a=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=n,this.slice=i,this.insert=s,this.structure=a}apply(e){if(this.structure&&(ya(e,this.from,this.gapFrom)||ya(e,this.gapTo,this.to)))return ua.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return ua.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?ua.fromReplace(e,this.from,this.to,r):ua.fail("Content does not fit in gap")}getMap(){return new sa([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new ga(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),n=e.map(this.gapFrom,-1),i=e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||n<t.pos||i>r.pos?null:new ga(t.pos,r.pos,n,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ga(t.from,t.to,t.gapFrom,t.gapTo,ns.fromJSON(e,t.slice),t.insert,!!t.structure)}}function ya(e,t,r){let n=e.resolve(t),i=r-t,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let e=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,i--}}return!1}function va(e,t,r){return(0==t||e.canReplace(t,e.childCount))&&(r==e.childCount||e.canReplace(0,r))}function ba(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let r=e.depth;;--r){let n=e.$from.node(r),i=e.$from.index(r),s=e.$to.indexAfter(r);if(r<e.depth&&n.canReplace(i,s,t))return r;if(0==r||n.type.spec.isolating||!va(n,i,s))break}return null}function wa(e,t,r=null,n=e){let i=function(e,t){let{parent:r,startIndex:n,endIndex:i}=e,s=r.contentMatchAt(n).findWrapping(t);if(!s)return null;let a=s.length?s[0]:t;return r.canReplaceWith(n,i,a)?s:null}(e,t),s=i&&function(e,t){let{parent:r,startIndex:n,endIndex:i}=e,s=r.child(n),a=t.contentMatch.findWrapping(s.type);if(!a)return null;let o=(a.length?a[a.length-1]:t).contentMatch;for(let e=n;o&&e<i;e++)o=o.matchType(r.child(e).type);return o&&o.validEnd?a:null}(n,t);return s?i.map(xa).concat({type:t,attrs:r}).concat(s.map(xa)):null}function xa(e){return{type:e,attrs:null}}function Ea(e,t,r=1,n){let i=e.resolve(t),s=i.depth-r,a=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!a.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let e=i.depth-1,t=r-2;e>s;e--,t--){let r=i.node(e),s=i.index(e);if(r.type.spec.isolating)return!1;let a=r.content.cutByIndex(s,r.childCount),o=n&&n[t]||r;if(o!=r&&(a=a.replaceChild(0,o.type.create(o.attrs))),!r.canReplace(s+1,r.childCount)||!o.type.validContent(a))return!1}let o=i.indexAfter(s),l=n&&n[0];return i.node(s).canReplaceWith(o,o,l?l.type:i.node(s+1).type)}function Da(e,t){let r=e.resolve(t),n=r.index();return Sa(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function Sa(e,t){return!(!e||!t||e.isLeaf||!e.canAppend(t))}function Aa(e,t,r=-1){let n=e.resolve(t);for(let e=n.depth;;e--){let i,s,a=n.index(e);if(e==n.depth?(i=n.nodeBefore,s=n.nodeAfter):r>0?(i=n.node(e+1),a++,s=n.node(e).maybeChild(a)):(i=n.node(e).maybeChild(a-1),s=n.node(e+1)),i&&!i.isTextblock&&Sa(i,s)&&n.node(e).canReplace(a,a+1))return t;if(0==e)break;t=r<0?n.before(e):n.after(e)}}function Ta(e,t,r){let n=e.resolve(t);if(!r.content.size)return t;let i=r.content;for(let e=0;e<r.openStart;e++)i=i.firstChild.content;for(let e=1;e<=(0==r.openStart&&r.size?2:1);e++)for(let t=n.depth;t>=0;t--){let r=t==n.depth?0:n.pos<=(n.start(t+1)+n.end(t+1))/2?-1:1,s=n.index(t)+(r>0?1:0),a=n.node(t),o=!1;if(1==e)o=a.canReplace(s,s,i);else{let e=a.contentMatchAt(s).findWrapping(i.firstChild.type);o=e&&a.canReplaceWith(s,s,e[0])}if(o)return 0==r?n.pos:r<0?n.before(t+1):n.after(t+1)}return null}function Ca(e,t,r=t,n=ns.empty){if(t==r&&!n.size)return null;let i=e.resolve(t),s=e.resolve(r);return Na(i,s,n)?new ma(t,r,n):new ka(i,s,n).fit()}function Na(e,t,r){return!r.openStart&&!r.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),r.content)}la.jsonID("replaceAround",ga);class ka{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=Zi.empty;for(let t=0;t<=e.depth;t++){let r=e.node(t);this.frontier.push({type:r.type,match:r.contentMatchAt(e.indexAfter(t))})}for(let t=e.depth;t>0;t--)this.placed=Zi.from(e.node(t).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,n=this.close(e<0?this.$to:r.doc.resolve(e));if(!n)return null;let i=this.placed,s=r.depth,a=n.depth;for(;s&&a&&1==i.childCount;)i=i.firstChild.content,s--,a--;let o=new ns(i,s,a);return e>-1?new ga(r.pos,e,this.$to.pos,this.$to.end(),o,t):o.size||r.pos!=this.$to.pos?new ma(r.pos,n.pos,o):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,n=this.unplaced.openEnd;r<e;r++){let i=t.firstChild;if(t.childCount>1&&(n=0),i.type.spec.isolating&&n<=r){e=r;break}t=i.content}for(let t=1;t<=2;t++)for(let r=1==t?e:this.unplaced.openStart;r>=0;r--){let e,n=null;r?(n=Fa(this.unplaced.content,r-1).firstChild,e=n.content):e=this.unplaced.content;let i=e.firstChild;for(let e=this.depth;e>=0;e--){let s,{type:a,match:o}=this.frontier[e],l=null;if(1==t&&(i?o.matchType(i.type)||(l=o.fillBefore(Zi.from(i),!1)):n&&a.compatibleContent(n.type)))return{sliceDepth:r,frontierDepth:e,parent:n,inject:l};if(2==t&&i&&(s=o.findWrapping(i.type)))return{sliceDepth:r,frontierDepth:e,parent:n,wrap:s};if(n&&o.matchType(n.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,n=Fa(e,t);return!(!n.childCount||n.firstChild.isLeaf)&&(this.unplaced=new ns(e,t+1,Math.max(r,n.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,n=Fa(e,t);if(n.childCount<=1&&t>0){let i=e.size-t<=t+n.size;this.unplaced=new ns(Ma(e,t-1,1),t-1,i?t-1:r)}else this.unplaced=new ns(Ma(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:n,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let e=0;e<i.length;e++)this.openFrontierNode(i[e]);let s=this.unplaced,a=r?r.content:s.content,o=s.openStart-e,l=0,u=[],{match:c,type:d}=this.frontier[t];if(n){for(let e=0;e<n.childCount;e++)u.push(n.child(e));c=c.matchFragment(n)}let h=a.size+e-(s.content.size-s.openEnd);for(;l<a.childCount;){let e=a.child(l),t=c.matchType(e.type);if(!t)break;l++,(l>1||0==o||e.content.size)&&(c=t,u.push(La(e.mark(d.allowedMarks(e.marks)),1==l?o:0,l==a.childCount?h:-1)))}let f=l==a.childCount;f||(h=-1),this.placed=Oa(this.placed,t,Zi.from(u)),this.frontier[t].match=c,f&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let e=0,t=a;e<h;e++){let e=t.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),t=e.content}this.unplaced=f?0==e?ns.empty:new ns(Ma(s.content,e-1,1),e-1,h<0?s.openEnd:e-1):new ns(Ma(s.content,e,l),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!_a(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:r}=this.$to,n=this.$to.after(r);for(;r>1&&n==this.$to.end(--r);)++n;return n}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:n}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),s=_a(e,t,n,r,i);if(s){for(let r=t-1;r>=0;r--){let{match:t,type:n}=this.frontier[r],i=_a(e,r,n,t,!0);if(!i||i.childCount)continue e}return{depth:t,fit:s,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Oa(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let t=e.node(r),n=t.type.contentMatch.fillBefore(t.content,!0,e.index(r));this.openFrontierNode(t.type,t.attrs,n)}return e}openFrontierNode(e,t=null,r){let n=this.frontier[this.depth];n.match=n.match.matchType(e),this.placed=Oa(this.placed,this.depth,Zi.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(Zi.empty,!0);e.childCount&&(this.placed=Oa(this.placed,this.frontier.length,e))}}function Ma(e,t,r){return 0==t?e.cutByIndex(r,e.childCount):e.replaceChild(0,e.firstChild.copy(Ma(e.firstChild.content,t-1,r)))}function Oa(e,t,r){return 0==t?e.append(r):e.replaceChild(e.childCount-1,e.lastChild.copy(Oa(e.lastChild.content,t-1,r)))}function Fa(e,t){for(let r=0;r<t;r++)e=e.firstChild.content;return e}function La(e,t,r){if(t<=0)return e;let n=e.content;return t>1&&(n=n.replaceChild(0,La(n.firstChild,t-1,1==n.childCount?r-1:0))),t>0&&(n=e.type.contentMatch.fillBefore(n).append(n),r<=0&&(n=n.append(e.type.contentMatch.matchFragment(n).fillBefore(Zi.empty,!0)))),e.copy(n)}function _a(e,t,r,n,i){let s=e.node(t),a=i?e.indexAfter(t):e.index(t);if(a==s.childCount&&!r.compatibleContent(s.type))return null;let o=n.fillBefore(s.content,!0,a);return o&&!function(e,t,r){for(let n=r;n<t.childCount;n++)if(!e.allowsMarks(t.child(n).marks))return!0;return!1}(r,s.content,a)?o:null}function Ra(e){return e.spec.defining||e.spec.definingForContent}function Ia(e,t,r,n,i){if(t<r){let i=e.firstChild;e=e.replaceChild(0,i.copy(Ia(i.content,t+1,r,n,i)))}if(t>n){let t=i.contentMatchAt(0),r=t.fillBefore(e).append(e);e=r.append(t.matchFragment(r).fillBefore(Zi.empty,!0))}return e}function Pa(e,t){let r=[];for(let n=Math.min(e.depth,t.depth);n>=0;n--){let i=e.start(n);if(i<e.pos-(e.depth-n)||t.end(n)>t.pos+(t.depth-n)||e.node(n).type.spec.isolating||t.node(n).type.spec.isolating)break;(i==t.start(n)||n==e.depth&&n==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&n&&t.start(n-1)==i-1)&&r.push(n)}return r}class Ba extends la{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return ua.fail("No node at attribute step's position");let r=Object.create(null);for(let e in t.attrs)r[e]=t.attrs[e];r[this.attr]=this.value;let n=t.type.create(r,null,t.marks);return ua.fromReplace(e,this.pos,this.pos+1,new ns(Zi.from(n),0,t.isLeaf?0:1))}getMap(){return sa.empty}invert(e){return new Ba(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ba(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new Ba(t.pos,t.attr,t.value)}}la.jsonID("attr",Ba);let Ua=class extends Error{};Ua=function e(t){let r=Error.call(this,t);return r.__proto__=e.prototype,r},(Ua.prototype=Object.create(Error.prototype)).constructor=Ua,Ua.prototype.name="TransformError";class $a{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new aa}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new Ua(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=ns.empty){let n=Ca(this.doc,e,t,r);return n&&this.step(n),this}replaceWith(e,t,r){return this.replace(e,t,new ns(Zi.from(r),0,0))}delete(e,t){return this.replace(e,t,ns.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return function(e,t,r,n){if(!n.size)return e.deleteRange(t,r);let i=e.doc.resolve(t),s=e.doc.resolve(r);if(Na(i,s,n))return e.step(new ma(t,r,n));let a=Pa(i,e.doc.resolve(r));0==a[a.length-1]&&a.pop();let o=-(i.depth+1);a.unshift(o);for(let e=i.depth,t=i.pos-1;e>0;e--,t--){let r=i.node(e).type.spec;if(r.defining||r.definingAsContext||r.isolating)break;a.indexOf(e)>-1?o=e:i.before(e)==t&&a.splice(1,0,-e)}let l=a.indexOf(o),u=[],c=n.openStart;for(let e=n.content,t=0;;t++){let r=e.firstChild;if(u.push(r),t==n.openStart)break;e=r.content}for(let e=c-1;e>=0;e--){let t=u[e].type,r=Ra(t);if(r&&i.node(l).type!=t)c=e;else if(r||!t.isTextblock)break}for(let t=n.openStart;t>=0;t--){let o=(t+c+1)%(n.openStart+1),d=u[o];if(d)for(let t=0;t<a.length;t++){let u=a[(t+l)%a.length],c=!0;u<0&&(c=!1,u=-u);let h=i.node(u-1),f=i.index(u-1);if(h.canReplaceWith(f,f,d.type,d.marks))return e.replace(i.before(u),c?s.after(u):r,new ns(Ia(n.content,0,n.openStart,o),o,n.openEnd))}}let d=e.steps.length;for(let o=a.length-1;o>=0&&(e.replace(t,r,n),!(e.steps.length>d));o--){let e=a[o];e<0||(t=i.before(e),r=s.after(e))}}(this,e,t,r),this}replaceRangeWith(e,t,r){return function(e,t,r,n){if(!n.isInline&&t==r&&e.doc.resolve(t).parent.content.size){let i=function(e,t,r){let n=e.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),r))return t;if(0==n.parentOffset)for(let e=n.depth-1;e>=0;e--){let t=n.index(e);if(n.node(e).canReplaceWith(t,t,r))return n.before(e+1);if(t>0)return null}if(n.parentOffset==n.parent.content.size)for(let e=n.depth-1;e>=0;e--){let t=n.indexAfter(e);if(n.node(e).canReplaceWith(t,t,r))return n.after(e+1);if(t<n.node(e).childCount)return null}return null}(e.doc,t,n.type);null!=i&&(t=r=i)}e.replaceRange(t,r,new ns(Zi.from(n),0,0))}(this,e,t,r),this}deleteRange(e,t){return function(e,t,r){let n=e.doc.resolve(t),i=e.doc.resolve(r),s=Pa(n,i);for(let t=0;t<s.length;t++){let r=s[t],a=t==s.length-1;if(a&&0==r||n.node(r).type.contentMatch.validEnd)return e.delete(n.start(r),i.end(r));if(r>0&&(a||n.node(r-1).canReplace(n.index(r-1),i.indexAfter(r-1))))return e.delete(n.before(r),i.after(r))}for(let s=1;s<=n.depth&&s<=i.depth;s++)if(t-n.start(s)==n.depth-s&&r>n.end(s)&&i.end(s)-r!=i.depth-s)return e.delete(n.before(s),r);e.delete(t,r)}(this,e,t),this}lift(e,t){return function(e,t,r){let{$from:n,$to:i,depth:s}=t,a=n.before(s+1),o=i.after(s+1),l=a,u=o,c=Zi.empty,d=0;for(let e=s,t=!1;e>r;e--)t||n.index(e)>0?(t=!0,c=Zi.from(n.node(e).copy(c)),d++):l--;let h=Zi.empty,f=0;for(let e=s,t=!1;e>r;e--)t||i.after(e+1)<i.end(e)?(t=!0,h=Zi.from(i.node(e).copy(h)),f++):u++;e.step(new ga(l,u,a,o,new ns(c.append(h),d,f),c.size-d,!0))}(this,e,t),this}join(e,t=1){return function(e,t,r){let n=new ma(t-r,t+r,ns.empty,!0);e.step(n)}(this,e,t),this}wrap(e,t){return function(e,t,r){let n=Zi.empty;for(let e=r.length-1;e>=0;e--){if(n.size){let t=r[e].type.contentMatch.matchFragment(n);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=Zi.from(r[e].type.create(r[e].attrs,n))}let i=t.start,s=t.end;e.step(new ga(i,s,i,s,new ns(n,0,0),r.length,!0))}(this,e,t),this}setBlockType(e,t=e,r,n=null){return function(e,t,r,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=e.steps.length;e.doc.nodesBetween(t,r,((t,r)=>{if(t.isTextblock&&!t.hasMarkup(n,i)&&function(e,t,r){let n=e.resolve(t),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}(e.doc,e.mapping.slice(s).map(r),n)){e.clearIncompatible(e.mapping.slice(s).map(r,1),n);let a=e.mapping.slice(s),o=a.map(r,1),l=a.map(r+t.nodeSize,1);return e.step(new ga(o,l,o+1,l-1,new ns(Zi.from(n.create(i,null,t.marks)),0,0),1,!0)),!1}}))}(this,e,t,r,n),this}setNodeMarkup(e,t,r=null,n){return function(e,t,r,n,i){let s=e.doc.nodeAt(t);if(!s)throw new RangeError("No node at given position");r||(r=s.type);let a=r.create(n,null,i||s.marks);if(s.isLeaf)return e.replaceWith(t,t+s.nodeSize,a);if(!r.validContent(s.content))throw new RangeError("Invalid content for node type "+r.name);e.step(new ga(t,t+s.nodeSize,t+1,t+s.nodeSize-1,new ns(Zi.from(a),0,0),1,!0))}(this,e,t,r,n),this}setNodeAttribute(e,t,r){return this.step(new Ba(e,t,r)),this}addNodeMark(e,t){return this.step(new fa(e,t)),this}removeNodeMark(e,t){if(!(t instanceof ts)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(!(t=t.isInSet(r.marks)))return this}return this.step(new pa(e,t)),this}split(e,t=1,r){return function(e,t,r=1,n){let i=e.doc.resolve(t),s=Zi.empty,a=Zi.empty;for(let e=i.depth,t=i.depth-r,o=r-1;e>t;e--,o--){s=Zi.from(i.node(e).copy(s));let t=n&&n[o];a=Zi.from(t?t.type.create(t.attrs,a):i.node(e).copy(a))}e.step(new ma(t,t,new ns(s.append(a),r,r),!0))}(this,e,t,r),this}addMark(e,t,r){return function(e,t,r,n){let i,s,a=[],o=[];e.doc.nodesBetween(t,r,((e,l,u)=>{if(!e.isInline)return;let c=e.marks;if(!n.isInSet(c)&&u.type.allowsMarkType(n.type)){let u=Math.max(l,t),d=Math.min(l+e.nodeSize,r),h=n.addToSet(c);for(let e=0;e<c.length;e++)c[e].isInSet(h)||(i&&i.to==u&&i.mark.eq(c[e])?i.to=d:a.push(i=new ha(u,d,c[e])));s&&s.to==u?s.to=d:o.push(s=new da(u,d,n))}})),a.forEach((t=>e.step(t))),o.forEach((t=>e.step(t)))}(this,e,t,r),this}removeMark(e,t,r){return function(e,t,r,n){let i=[],s=0;e.doc.nodesBetween(t,r,((e,a)=>{if(!e.isInline)return;s++;let o=null;if(n instanceof Us){let t,r=e.marks;for(;t=n.isInSet(r);)(o||(o=[])).push(t),r=t.removeFromSet(r)}else n?n.isInSet(e.marks)&&(o=[n]):o=e.marks;if(o&&o.length){let n=Math.min(a+e.nodeSize,r);for(let e=0;e<o.length;e++){let r,l=o[e];for(let e=0;e<i.length;e++){let t=i[e];t.step==s-1&&l.eq(i[e].style)&&(r=t)}r?(r.to=n,r.step=s):i.push({style:l,from:Math.max(a,t),to:n,step:s})}}})),i.forEach((t=>e.step(new ha(t.from,t.to,t.style))))}(this,e,t,r),this}clearIncompatible(e,t,r){return function(e,t,r,n=r.contentMatch){let i=e.doc.nodeAt(t),s=[],a=t+1;for(let t=0;t<i.childCount;t++){let o=i.child(t),l=a+o.nodeSize,u=n.matchType(o.type);if(u){n=u;for(let t=0;t<o.marks.length;t++)r.allowsMarkType(o.marks[t].type)||e.step(new ha(a,l,o.marks[t]))}else s.push(new ma(a,l,ns.empty));a=l}if(!n.validEnd){let t=n.fillBefore(Zi.empty,!0);e.replace(a,a,new ns(t,0,0))}for(let t=s.length-1;t>=0;t--)e.step(s[t])}(this,e,t,r),this}}const za=Object.create(null);class ja{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new qa(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=ns.empty){let r=t.content.lastChild,n=null;for(let e=0;e<t.openEnd;e++)n=r,r=r.lastChild;let i=e.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:o,$to:l}=s[a],u=e.mapping.slice(i);e.replaceRange(u.map(o.pos),u.map(l.pos),a?ns.empty:t),0==a&&Qa(e,i,(r?r.isInline:n&&n.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,n=this.ranges;for(let i=0;i<n.length;i++){let{$from:s,$to:a}=n[i],o=e.mapping.slice(r),l=o.map(s.pos),u=o.map(a.pos);i?e.deleteRange(l,u):(e.replaceRangeWith(l,u,t),Qa(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let n=e.parent.inlineContent?new Ga(e):Xa(e.node(0),e.parent,e.pos,e.index(),t,r);if(n)return n;for(let n=e.depth-1;n>=0;n--){let i=t<0?Xa(e.node(0),e.node(n),e.before(n+1),e.index(n),t,r):Xa(e.node(0),e.node(n),e.after(n+1),e.index(n)+1,t,r);if(i)return i}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Ja(e.node(0))}static atStart(e){return Xa(e,e,0,0,1)||new Ja(e)}static atEnd(e){return Xa(e,e,e.content.size,e.childCount,-1)||new Ja(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=za[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in za)throw new RangeError("Duplicate use of selection JSON ID "+e);return za[e]=t,t.prototype.jsonID=e,t}getBookmark(){return Ga.between(this.$anchor,this.$head).getBookmark()}}ja.prototype.visible=!0;class qa{constructor(e,t){this.$from=e,this.$to=t}}let Ha=!1;function Va(e){Ha||e.parent.inlineContent||(Ha=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class Ga extends ja{constructor(e,t=e){Va(e),Va(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return ja.near(r);let n=e.resolve(t.map(this.anchor));return new Ga(n.parent.inlineContent?n:r,r)}replace(e,t=ns.empty){if(super.replace(e,t),t==ns.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof Ga&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Ka(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new Ga(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let n=e.resolve(t);return new this(n,r==t?n:e.resolve(r))}static between(e,t,r){let n=e.pos-t.pos;if(r&&!n||(r=n>=0?1:-1),!t.parent.inlineContent){let e=ja.findFrom(t,r,!0)||ja.findFrom(t,-r,!0);if(!e)return ja.near(t,r);t=e.$head}return e.parent.inlineContent||(0==n||(e=(ja.findFrom(e,-r,!0)||ja.findFrom(e,r,!0)).$anchor).pos<t.pos!=n<0)&&(e=t),new Ga(e,t)}}ja.jsonID("text",Ga);class Ka{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Ka(e.map(this.anchor),e.map(this.head))}resolve(e){return Ga.between(e.resolve(this.anchor),e.resolve(this.head))}}class Wa extends ja{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:n}=t.mapResult(this.anchor),i=e.resolve(n);return r?ja.near(i):new Wa(i)}content(){return new ns(Zi.from(this.node),0,0)}eq(e){return e instanceof Wa&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Ya(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Wa(e.resolve(t.anchor))}static create(e,t){return new Wa(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}Wa.prototype.visible=!1,ja.jsonID("node",Wa);class Ya{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new Ka(r,r):new Ya(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&Wa.isSelectable(r)?new Wa(t):ja.near(t)}}class Ja extends ja{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=ns.empty){if(t==ns.empty){e.delete(0,e.doc.content.size);let t=ja.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ja(e)}map(e){return new Ja(e)}eq(e){return e instanceof Ja}getBookmark(){return Za}}ja.jsonID("all",Ja);const Za={map(){return this},resolve:e=>new Ja(e)};function Xa(e,t,r,n,i,s=!1){if(t.inlineContent)return Ga.create(e,r);for(let a=n-(i>0?0:1);i>0?a<t.childCount:a>=0;a+=i){let n=t.child(a);if(n.isAtom){if(!s&&Wa.isSelectable(n))return Wa.create(e,r-(i<0?n.nodeSize:0))}else{let t=Xa(e,n,r+i,i<0?n.childCount:0,i,s);if(t)return t}r+=n.nodeSize*i}return null}function Qa(e,t,r){let n=e.steps.length-1;if(n<t)return;let i,s=e.steps[n];(s instanceof ma||s instanceof ga)&&(e.mapping.maps[n].forEach(((e,t,r,n)=>{null==i&&(i=n)})),e.setSelection(ja.near(e.doc.resolve(i),r)))}class eo extends $a{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return ts.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let r=this.selection;return t&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||ts.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,r){let n=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(n.text(e),!0):this.deleteSelection();{if(null==r&&(r=t),r=null==r?t:r,!e)return this.deleteRange(t,r);let i=this.storedMarks;if(!i){let e=this.doc.resolve(t);i=r==t?e.marks():e.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(t,r,n.text(e,i)),this.selection.empty||this.setSelection(ja.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function to(e,t){return t&&e?e.bind(t):e}class ro{constructor(e,t,r){this.name=e,this.init=to(t.init,r),this.apply=to(t.apply,r)}}const no=[new ro("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new ro("selection",{init:(e,t)=>e.selection||ja.atStart(t.doc),apply:e=>e.selection}),new ro("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,r,n)=>n.selection.$cursor?e.storedMarks:null}),new ro("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class io{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=no.slice(),t&&t.forEach((e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new ro(e.key,e.spec.state,e))}))}}class so{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=t){let t=this.config.plugins[r];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],r=this.applyInner(e),n=null;for(;;){let i=!1;for(let s=0;s<this.config.plugins.length;s++){let a=this.config.plugins[s];if(a.spec.appendTransaction){let o=n?n[s].n:0,l=n?n[s].state:this,u=o<t.length&&a.spec.appendTransaction.call(a,o?t.slice(o):t,l,r);if(u&&r.filterTransaction(u,s)){if(u.setMeta("appendedTransaction",e),!n){n=[];for(let e=0;e<this.config.plugins.length;e++)n.push(e<s?{state:r,n:t.length}:{state:this,n:0})}t.push(u),r=r.applyInner(u),i=!0}n&&(n[s]={state:r,n:t.length})}}if(!i)return{state:r,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new so(this.config),r=this.config.fields;for(let n=0;n<r.length;n++){let i=r[n];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new eo(this)}static create(e){let t=new io(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new so(t);for(let n=0;n<t.fields.length;n++)r[t.fields[n].name]=t.fields[n].init(e,r);return r}reconfigure(e){let t=new io(this.schema,e.plugins),r=t.fields,n=new so(t);for(let t=0;t<r.length;t++){let i=r[t].name;n[i]=this.hasOwnProperty(i)?this[i]:r[t].init(e,n)}return n}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map((e=>e.toJSON()))),e&&"object"==typeof e)for(let r in e){if("doc"==r||"selection"==r)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let n=e[r],i=n.spec.state;i&&i.toJSON&&(t[r]=i.toJSON.call(n,this[n.key]))}return t}static fromJSON(e,t,r){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let n=new io(e.schema,e.plugins),i=new so(n);return n.fields.forEach((n=>{if("doc"==n.name)i.doc=Es.fromJSON(e.schema,t.doc);else if("selection"==n.name)i.selection=ja.fromJSON(i.doc,t.selection);else if("storedMarks"==n.name)t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let s in r){let a=r[s],o=a.spec.state;if(a.key==n.name&&o&&o.fromJSON&&Object.prototype.hasOwnProperty.call(t,s))return void(i[n.name]=o.fromJSON.call(a,e,t[s],i))}i[n.name]=n.init(e,i)}})),i}}function ao(e,t,r){for(let n in e){let i=e[n];i instanceof Function?i=i.bind(t):"handleDOMEvents"==n&&(i=ao(i,t,{})),r[n]=i}return r}class oo{constructor(e){this.spec=e,this.props={},e.props&&ao(e.props,this,this.props),this.key=e.key?e.key.key:uo("plugin")}getState(e){return e[this.key]}}const lo=Object.create(null);function uo(e){return e in lo?e+"$"+ ++lo[e]:(lo[e]=0,e+"$")}class co{constructor(e="key"){this.key=uo(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const ho=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},fo=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let po=null;const mo=function(e,t,r){let n=po||(po=document.createRange());return n.setEnd(e,null==r?e.nodeValue.length:r),n.setStart(e,t||0),n},go=function(e,t,r,n){return r&&(vo(e,t,r,n,-1)||vo(e,t,r,n,1))},yo=/^(img|br|input|textarea|hr)$/i;function vo(e,t,r,n,i){for(;;){if(e==r&&t==n)return!0;if(t==(i<0?0:bo(e))){let r=e.parentNode;if(!r||1!=r.nodeType||wo(e)||yo.test(e.nodeName)||"false"==e.contentEditable)return!1;t=ho(e)+(i<0?0:1),e=r}else{if(1!=e.nodeType)return!1;if("false"==(e=e.childNodes[t+(i<0?-1:0)]).contentEditable)return!1;t=i<0?bo(e):0}}}function bo(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function wo(e){let t;for(let r=e;r&&!(t=r.pmViewDesc);r=r.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const xo=function(e){return e.focusNode&&go(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function Eo(e,t){let r=document.createEvent("Event");return r.initEvent("keydown",!0,!0),r.keyCode=e,r.key=r.code=t,r}const Do="undefined"!=typeof navigator?navigator:null,So="undefined"!=typeof document?document:null,Ao=Do&&Do.userAgent||"",To=/Edge\/(\d+)/.exec(Ao),Co=/MSIE \d/.exec(Ao),No=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ao),ko=!!(Co||No||To),Mo=Co?document.documentMode:No?+No[1]:To?+To[1]:0,Oo=!ko&&/gecko\/(\d+)/i.test(Ao);Oo&&(/Firefox\/(\d+)/.exec(Ao)||[0,0])[1];const Fo=!ko&&/Chrome\/(\d+)/.exec(Ao),Lo=!!Fo,_o=Fo?+Fo[1]:0,Ro=!ko&&!!Do&&/Apple Computer/.test(Do.vendor),Io=Ro&&(/Mobile\/\w+/.test(Ao)||!!Do&&Do.maxTouchPoints>2),Po=Io||!!Do&&/Mac/.test(Do.platform),Bo=/Android \d/.test(Ao),Uo=!!So&&"webkitFontSmoothing"in So.documentElement.style,$o=Uo?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function zo(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function jo(e,t){return"number"==typeof e?e:e[t]}function qo(e){let t=e.getBoundingClientRect(),r=t.width/e.offsetWidth||1,n=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*r,top:t.top,bottom:t.top+e.clientHeight*n}}function Ho(e,t,r){let n=e.someProp("scrollThreshold")||0,i=e.someProp("scrollMargin")||5,s=e.dom.ownerDocument;for(let a=r||e.dom;a;a=fo(a)){if(1!=a.nodeType)continue;let e=a,r=e==s.body,o=r?zo(s):qo(e),l=0,u=0;if(t.top<o.top+jo(n,"top")?u=-(o.top-t.top+jo(i,"top")):t.bottom>o.bottom-jo(n,"bottom")&&(u=t.bottom-o.bottom+jo(i,"bottom")),t.left<o.left+jo(n,"left")?l=-(o.left-t.left+jo(i,"left")):t.right>o.right-jo(n,"right")&&(l=t.right-o.right+jo(i,"right")),l||u)if(r)s.defaultView.scrollBy(l,u);else{let r=e.scrollLeft,n=e.scrollTop;u&&(e.scrollTop+=u),l&&(e.scrollLeft+=l);let i=e.scrollLeft-r,s=e.scrollTop-n;t={left:t.left-i,top:t.top-s,right:t.right-i,bottom:t.bottom-s}}if(r)break}}function Vo(e){let t=[],r=e.ownerDocument;for(let n=e;n&&(t.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),e!=r);n=fo(n));return t}function Go(e,t){for(let r=0;r<e.length;r++){let{dom:n,top:i,left:s}=e[r];n.scrollTop!=i+t&&(n.scrollTop=i+t),n.scrollLeft!=s&&(n.scrollLeft=s)}}let Ko=null;function Wo(e,t){let r,n,i=2e8,s=0,a=t.top,o=t.top;for(let l=e.firstChild,u=0;l;l=l.nextSibling,u++){let e;if(1==l.nodeType)e=l.getClientRects();else{if(3!=l.nodeType)continue;e=mo(l).getClientRects()}for(let c=0;c<e.length;c++){let d=e[c];if(d.top<=a&&d.bottom>=o){a=Math.max(d.bottom,a),o=Math.min(d.top,o);let e=d.left>t.left?d.left-t.left:d.right<t.left?t.left-d.right:0;if(e<i){r=l,i=e,n=e&&3==r.nodeType?{left:d.right<t.left?d.right:d.left,top:t.top}:t,1==l.nodeType&&e&&(s=u+(t.left>=(d.left+d.right)/2?1:0));continue}}!r&&(t.left>=d.right&&t.top>=d.top||t.left>=d.left&&t.top>=d.bottom)&&(s=u+1)}}return r&&3==r.nodeType?function(e,t){let r=e.nodeValue.length,n=document.createRange();for(let i=0;i<r;i++){n.setEnd(e,i+1),n.setStart(e,i);let r=Xo(n,1);if(r.top!=r.bottom&&Yo(t,r))return{node:e,offset:i+(t.left>=(r.left+r.right)/2?1:0)}}return{node:e,offset:0}}(r,n):!r||i&&1==r.nodeType?{node:e,offset:s}:Wo(r,n)}function Yo(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function Jo(e,t,r){let n=e.childNodes.length;if(n&&r.top<r.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(t.top-r.top)/(r.bottom-r.top))-2)),s=i;;){let r=e.childNodes[s];if(1==r.nodeType){let e=r.getClientRects();for(let n=0;n<e.length;n++){let i=e[n];if(Yo(t,i))return Jo(r,t,i)}}if((s=(s+1)%n)==i)break}return e}function Zo(e,t){let r,n=e.dom.ownerDocument,i=0;if(n.caretPositionFromPoint)try{let e=n.caretPositionFromPoint(t.left,t.top);e&&({offsetNode:r,offset:i}=e)}catch(e){}if(!r&&n.caretRangeFromPoint){let e=n.caretRangeFromPoint(t.left,t.top);e&&({startContainer:r,startOffset:i}=e)}let s,a=(e.root.elementFromPoint?e.root:n).elementFromPoint(t.left,t.top);if(!a||!e.dom.contains(1!=a.nodeType?a.parentNode:a)){let r=e.dom.getBoundingClientRect();if(!Yo(t,r))return null;if(a=Jo(e.dom,t,r),!a)return null}if(Ro)for(let e=a;r&&e;e=fo(e))e.draggable&&(r=void 0);if(a=function(e,t){let r=e.parentNode;return r&&/^li$/i.test(r.nodeName)&&t.left<e.getBoundingClientRect().left?r:e}(a,t),r){if(Oo&&1==r.nodeType&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let e,n=r.childNodes[i];"IMG"==n.nodeName&&(e=n.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&i++}r==e.dom&&i==r.childNodes.length-1&&1==r.lastChild.nodeType&&t.top>r.lastChild.getBoundingClientRect().bottom?s=e.state.doc.content.size:0!=i&&1==r.nodeType&&"BR"==r.childNodes[i-1].nodeName||(s=function(e,t,r,n){let i=-1;for(let r=t;r!=e.dom;){let t=e.docView.nearestDesc(r,!0);if(!t)return null;if(1==t.dom.nodeType&&(t.node.isBlock&&t.parent||!t.contentDOM)){let e=t.dom.getBoundingClientRect();if(t.node.isBlock&&t.parent&&(e.left>n.left||e.top>n.top?i=t.posBefore:(e.right<n.left||e.bottom<n.top)&&(i=t.posAfter)),!t.contentDOM&&i<0)return(t.node.isBlock?n.top<(e.top+e.bottom)/2:n.left<(e.left+e.right)/2)?t.posBefore:t.posAfter}r=t.dom.parentNode}return i>-1?i:e.docView.posFromDOM(t,r,-1)}(e,r,i,t))}null==s&&(s=function(e,t,r){let{node:n,offset:i}=Wo(t,r),s=-1;if(1==n.nodeType&&!n.firstChild){let e=n.getBoundingClientRect();s=e.left!=e.right&&r.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(n,i,s)}(e,a,t));let o=e.docView.nearestDesc(a,!0);return{pos:s,inside:o?o.posAtStart-o.border:-1}}function Xo(e,t){let r=e.getClientRects();return r.length?r[t<0?0:r.length-1]:e.getBoundingClientRect()}const Qo=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function el(e,t,r){let{node:n,offset:i,atom:s}=e.docView.domFromPos(t,r<0?-1:1),a=Uo||Oo;if(3==n.nodeType){if(!a||!Qo.test(n.nodeValue)&&(r<0?i:i!=n.nodeValue.length)){let e=i,t=i,s=r<0?1:-1;return r<0&&!i?(t++,s=-1):r>=0&&i==n.nodeValue.length?(e--,s=1):r<0?e--:t++,tl(Xo(mo(n,e,t),1),s<0)}{let e=Xo(mo(n,i,i),r);if(Oo&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let t=Xo(mo(n,i-1,i-1),-1);if(t.top==e.top){let r=Xo(mo(n,i,i+1),-1);if(r.top!=e.top)return tl(r,r.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(s||0)).parent.inlineContent){if(null==s&&i&&(r<0||i==bo(n))){let e=n.childNodes[i-1];if(1==e.nodeType)return rl(e.getBoundingClientRect(),!1)}if(null==s&&i<bo(n)){let e=n.childNodes[i];if(1==e.nodeType)return rl(e.getBoundingClientRect(),!0)}return rl(n.getBoundingClientRect(),r>=0)}if(null==s&&i&&(r<0||i==bo(n))){let e=n.childNodes[i-1],t=3==e.nodeType?mo(e,bo(e)-(a?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return tl(Xo(t,1),!1)}if(null==s&&i<bo(n)){let e=n.childNodes[i];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?mo(e,0,a?0:1):1==e.nodeType?e:null:null;if(t)return tl(Xo(t,-1),!0)}return tl(Xo(3==n.nodeType?mo(n):n,-r),r>=0)}function tl(e,t){if(0==e.width)return e;let r=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:r,right:r}}function rl(e,t){if(0==e.height)return e;let r=t?e.top:e.bottom;return{top:r,bottom:r,left:e.left,right:e.right}}function nl(e,t,r){let n=e.state,i=e.root.activeElement;n!=t&&e.updateState(t),i!=e.dom&&e.focus();try{return r()}finally{n!=t&&e.updateState(n),i!=e.dom&&i&&i.focus()}}const il=/[\u0590-\u08ac]/;let sl=null,al=null,ol=!1;function ll(e,t,r){return sl==t&&al==r?ol:(sl=t,al=r,ol="up"==r||"down"==r?function(e,t,r){let n=t.selection,i="up"==r?n.$from:n.$to;return nl(e,t,(()=>{let{node:t}=e.docView.domFromPos(i.pos,"up"==r?-1:1);for(;;){let r=e.docView.nearestDesc(t,!0);if(!r)break;if(r.node.isBlock){t=r.contentDOM||r.dom;break}t=r.dom.parentNode}let n=el(e,i.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=mo(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let i=t[e];if(i.bottom>i.top+1&&("up"==r?n.top-i.top>2*(i.bottom-n.top):i.bottom-n.bottom>2*(n.bottom-i.top)))return!1}}return!0}))}(e,t,r):function(e,t,r){let{$head:n}=t.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,s=!i,a=i==n.parent.content.size,o=e.domSelection();return il.test(n.parent.textContent)&&o.modify?nl(e,t,(()=>{let{focusNode:t,focusOffset:i,anchorNode:s,anchorOffset:a}=e.domSelectionRange(),l=o.caretBidiLevel;o.modify("move",r,"character");let u=n.depth?e.docView.domAfterPos(n.before()):e.dom,{focusNode:c,focusOffset:d}=e.domSelectionRange(),h=c&&!u.contains(1==c.nodeType?c:c.parentNode)||t==c&&i==d;try{o.collapse(s,a),t&&(t!=s||i!=a)&&o.extend&&o.extend(t,i)}catch(e){}return null!=l&&(o.caretBidiLevel=l),h})):"left"==r||"backward"==r?s:a}(e,t,r))}class ul{constructor(e,t,r,n){this.parent=e,this.children=t,this.dom=r,this.contentDOM=n,this.dirty=0,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,r=this.posAtStart;;t++){let n=this.children[t];if(n==e)return r;r+=n.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,r){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(r<0){let r,n;if(e==this.contentDOM)r=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.previousSibling}for(;r&&(!(n=r.pmViewDesc)||n.parent!=this);)r=r.previousSibling;return r?this.posBeforeChild(n)+n.size:this.posAtStart}{let r,n;if(e==this.contentDOM)r=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.nextSibling}for(;r&&(!(n=r.pmViewDesc)||n.parent!=this);)r=r.nextSibling;return r?this.posBeforeChild(n):this.posAtEnd}}let n;if(e==this.dom&&this.contentDOM)n=t>ho(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))n=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){n=!1;break}if(t.previousSibling)break}if(null==n&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){n=!0;break}if(t.nextSibling)break}}return(null==n?r>0:n)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let r=!0,n=e;n;n=n.parentNode){let i,s=this.getDesc(n);if(s&&(!t||s.node)){if(!r||!(i=s.nodeDOM)||(1==i.nodeType?i.contains(1==e.nodeType?e:e.parentNode):i==e))return s;r=!1}}}getDesc(e){let t=e.pmViewDesc;for(let e=t;e;e=e.parent)if(e==this)return t}posFromDOM(e,t,r){for(let n=e;n;n=n.parentNode){let i=this.getDesc(n);if(i)return i.localPosFromDOM(e,t,r)}return-1}descAt(e){for(let t=0,r=0;t<this.children.length;t++){let n=this.children[t],i=r+n.size;if(r==e&&i!=r){for(;!n.border&&n.children.length;)n=n.children[0];return n}if(e<i)return n.descAt(e-r-n.border);r=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,n=0;for(let t=0;r<this.children.length;r++){let i=this.children[r],s=t+i.size;if(s>e||i instanceof gl){n=e-t;break}t=s}if(n)return this.children[r].domFromPos(n-this.children[r].border,t);for(let e;r&&!(e=this.children[r-1]).size&&e instanceof cl&&e.side>=0;r--);if(t<=0){let e,n=!0;for(;e=r?this.children[r-1]:null,e&&e.dom.parentNode!=this.contentDOM;r--,n=!1);return e&&t&&n&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?ho(e.dom)+1:0}}{let e,n=!0;for(;e=r<this.children.length?this.children[r]:null,e&&e.dom.parentNode!=this.contentDOM;r++,n=!1);return e&&n&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?ho(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,r=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let n=-1,i=-1;for(let s=r,a=0;;a++){let r=this.children[a],o=s+r.size;if(-1==n&&e<=o){let i=s+r.border;if(e>=i&&t<=o-r.border&&r.node&&r.contentDOM&&this.contentDOM.contains(r.contentDOM))return r.parseRange(e,t,i);e=s;for(let t=a;t>0;t--){let r=this.children[t-1];if(r.size&&r.dom.parentNode==this.contentDOM&&!r.emptyChildAt(1)){n=ho(r.dom)+1;break}e-=r.size}-1==n&&(n=0)}if(n>-1&&(o>t||a==this.children.length-1)){t=o;for(let e=a+1;e<this.children.length;e++){let r=this.children[e];if(r.size&&r.dom.parentNode==this.contentDOM&&!r.emptyChildAt(-1)){i=ho(r.dom);break}t+=r.size}-1==i&&(i=this.contentDOM.childNodes.length);break}s=o}return{node:this.contentDOM,from:e,to:t,fromOffset:n,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:r}=this.domFromPos(e,0);if(1!=t.nodeType||r==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[r]}setSelection(e,t,r,n=!1){let i=Math.min(e,t),s=Math.max(e,t);for(let a=0,o=0;a<this.children.length;a++){let l=this.children[a],u=o+l.size;if(i>o&&s<u)return l.setSelection(e-o-l.border,t-o-l.border,r,n);o=u}let a=this.domFromPos(e,e?-1:1),o=t==e?a:this.domFromPos(t,t?-1:1),l=r.getSelection(),u=!1;if((Oo||Ro)&&e==t){let{node:e,offset:t}=a;if(3==e.nodeType){if(u=!(!t||"\n"!=e.nodeValue[t-1]),u&&t==e.nodeValue.length)for(let t,r=e;r;r=r.parentNode){if(t=r.nextSibling){"BR"==t.nodeName&&(a=o={node:t.parentNode,offset:ho(t)+1});break}let e=r.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let r=e.childNodes[t-1];u=r&&("BR"==r.nodeName||"false"==r.contentEditable)}}if(Oo&&l.focusNode&&l.focusNode!=o.node&&1==l.focusNode.nodeType){let e=l.focusNode.childNodes[l.focusOffset];e&&"false"==e.contentEditable&&(n=!0)}if(!(n||u&&Ro)&&go(a.node,a.offset,l.anchorNode,l.anchorOffset)&&go(o.node,o.offset,l.focusNode,l.focusOffset))return;let c=!1;if((l.extend||e==t)&&!u){l.collapse(a.node,a.offset);try{e!=t&&l.extend(o.node,o.offset),c=!0}catch(e){}}if(!c){if(e>t){let e=a;a=o,o=e}let r=document.createRange();r.setEnd(o.node,o.offset),r.setStart(a.node,a.offset),l.removeAllRanges(),l.addRange(r)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let r=0,n=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==s?e<=s&&t>=r:e<s&&t>r){let n=r+i.border,a=s-i.border;if(e>=n&&t<=a)return this.dirty=e==r||t==s?2:1,void(e!=n||t!=a||!i.contentLost&&i.dom.parentNode==this.contentDOM?i.markDirty(e-n,t-n):i.dirty=3);i.dirty=i.dom!=i.contentDOM||i.dom.parentNode!=this.contentDOM||i.children.length?3:2}r=s}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let r=1==e?2:1;t.dirty<r&&(t.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class cl extends ul{constructor(e,t,r,n){let i,s=t.type.toDOM;if("function"==typeof s&&(s=s(r,(()=>i?i.parent?i.parent.posBeforeChild(i):void 0:n))),!t.type.spec.raw){if(1!=s.nodeType){let e=document.createElement("span");e.appendChild(s),s=e}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class dl extends ul{constructor(e,t,r,n){super(e,[],t,null),this.textDOM=r,this.text=n}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class hl extends ul{constructor(e,t,r,n){super(e,[],r,n),this.mark=t}static create(e,t,r,n){let i=n.nodeViews[t.type.name],s=i&&i(t,n,r);return s&&s.dom||(s=Xs.renderSpec(document,t.type.spec.toDOM(t,r))),new hl(e,t,s.dom,s.contentDOM||s.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,r){let n=hl.create(this.parent,this.mark,!0,r),i=this.children,s=this.size;t<s&&(i=kl(i,t,s,r)),e>0&&(i=kl(i,0,e,r));for(let e=0;e<i.length;e++)i[e].parent=n;return n.children=i,n}}class fl extends ul{constructor(e,t,r,n,i,s,a,o,l){super(e,[],i,s),this.node=t,this.outerDeco=r,this.innerDeco=n,this.nodeDOM=a,s&&this.updateChildren(o,l)}static create(e,t,r,n,i,s){let a,o=i.nodeViews[t.type.name],l=o&&o(t,i,(()=>a?a.parent?a.parent.posBeforeChild(a):void 0:s),r,n),u=l&&l.dom,c=l&&l.contentDOM;if(t.isText)if(u){if(3!=u.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else u=document.createTextNode(t.text);else u||({dom:u,contentDOM:c}=Xs.renderSpec(document,t.type.spec.toDOM(t)));c||t.isText||"BR"==u.nodeName||(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let d=u;return u=Sl(u,r,t),l?a=new yl(e,t,r,n,u,c||null,d,l,i,s+1):t.isText?new ml(e,t,r,n,u,d,i):new fl(e,t,r,n,u,c||null,d,i,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Zi.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,r){return 0==this.dirty&&e.eq(this.node)&&Al(t,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let r=this.node.inlineContent,n=t,i=e.composing?this.localCompositionInfo(e,t):null,s=i&&i.pos>-1?i:null,a=i&&i.pos<0,o=new Cl(this,s&&s.node,e);!function(e,t,r,n){let i=t.locals(e),s=0;if(0==i.length){for(let r=0;r<e.childCount;r++){let a=e.child(r);n(a,i,t.forChild(s,a),r),s+=a.nodeSize}return}let a=0,o=[],l=null;for(let u=0;;){if(a<i.length&&i[a].to==s){let e,t=i[a++];for(;a<i.length&&i[a].to==s;)(e||(e=[t])).push(i[a++]);if(e){e.sort(Nl);for(let t=0;t<e.length;t++)r(e[t],u,!!l)}else r(t,u,!!l)}let c,d;if(l)d=-1,c=l,l=null;else{if(!(u<e.childCount))break;d=u,c=e.child(u++)}for(let e=0;e<o.length;e++)o[e].to<=s&&o.splice(e--,1);for(;a<i.length&&i[a].from<=s&&i[a].to>s;)o.push(i[a++]);let h=s+c.nodeSize;if(c.isText){let e=h;a<i.length&&i[a].from<e&&(e=i[a].from);for(let t=0;t<o.length;t++)o[t].to<e&&(e=o[t].to);e<h&&(l=c.cut(e-s),c=c.cut(0,e-s),h=e,d=-1)}n(c,c.isInline&&!c.isLeaf?o.filter((e=>!e.inline)):o.slice(),t.forChild(s,c),d),s=h}}(this.node,this.innerDeco,((t,i,s)=>{t.spec.marks?o.syncToMarks(t.spec.marks,r,e):t.type.side>=0&&!s&&o.syncToMarks(i==this.node.childCount?ts.none:this.node.child(i).marks,r,e),o.placeWidget(t,e,n)}),((t,s,l,u)=>{let c;o.syncToMarks(t.marks,r,e),o.findNodeMatch(t,s,l,u)||a&&e.state.selection.from>n&&e.state.selection.to<n+t.nodeSize&&(c=o.findIndexWithChild(i.node))>-1&&o.updateNodeAt(t,s,l,c,e)||o.updateNextNode(t,s,l,e,u)||o.addNode(t,s,l,e,n),n+=t.nodeSize})),o.syncToMarks([],r,e),this.node.isTextblock&&o.addTextblockHacks(),o.destroyRest(),(o.changed||2==this.dirty)&&(s&&this.protectLocalComposition(e,s),vl(this.contentDOM,this.children,e),Io&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:r,to:n}=e.state.selection;if(!(e.state.selection instanceof Ga)||r<t||n>t+this.node.content.size)return null;let i=e.domSelectionRange(),s=function(e,t){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0){if(e.childNodes.length>t&&3==e.childNodes[t].nodeType)return e.childNodes[t];t=bo(e=e.childNodes[t-1])}else{if(!(1==e.nodeType&&t<e.childNodes.length))return null;e=e.childNodes[t],t=0}}}(i.focusNode,i.focusOffset);if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let e=s.nodeValue,i=function(e,t,r,n){for(let i=0,s=0;i<e.childCount&&s<=n;){let a=e.child(i++),o=s;if(s+=a.nodeSize,!a.isText)continue;let l=a.text;for(;i<e.childCount;){let t=e.child(i++);if(s+=t.nodeSize,!t.isText)break;l+=t.text}if(s>=r){let e=o<n?l.lastIndexOf(t,n-o-1):-1;if(e>=0&&e+t.length+o>=r)return o+e;if(r==n&&l.length>=n+t.length-o&&l.slice(n-o,n-o+t.length)==t)return n}}return-1}(this.node.content,e,r-t,n-t);return i<0?null:{node:s,pos:i,text:e}}return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:r,text:n}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let s=new dl(this,i,t,n);e.input.compositionNodes.push(s),this.children=kl(this.children,r,r+n.length,e,s)}update(e,t,r,n){return!(3==this.dirty||!e.sameMarkup(this.node))&&(this.updateInner(e,t,r,n),!0)}updateInner(e,t,r,n){this.updateOuterDeco(t),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(n,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(Al(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,r=this.dom;this.dom=El(this.dom,this.nodeDOM,xl(this.outerDeco,this.node,t),xl(e,this.node,t)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function pl(e,t,r,n,i){return Sl(n,t,e),new fl(void 0,e,t,r,n,n,n,i,0)}class ml extends fl{constructor(e,t,r,n,i,s,a){super(e,t,r,n,i,null,s,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,r,n){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,n.trackWrites==this.nodeDOM&&(n.trackWrites=null)),this.node=e,this.dirty=0,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,r){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,r)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,r){let n=this.node.cut(e,t),i=document.createTextNode(n.text);return new ml(this.parent,n,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}}class gl extends ul{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class yl extends fl{constructor(e,t,r,n,i,s,a,o,l,u){super(e,t,r,n,i,s,a,l,u),this.spec=o}update(e,t,r,n){if(3==this.dirty)return!1;if(this.spec.update){let i=this.spec.update(e,t,r);return i&&this.updateInner(e,t,r,n),i}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,r,n)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,r,n){this.spec.setSelection?this.spec.setSelection(e,t,r):super.setSelection(e,t,r,n)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function vl(e,t,r){let n=e.firstChild,i=!1;for(let s=0;s<t.length;s++){let a=t[s],o=a.dom;if(o.parentNode==e){for(;o!=n;)n=Tl(n),i=!0;n=n.nextSibling}else i=!0,e.insertBefore(o,n);if(a instanceof hl){let t=n?n.previousSibling:e.lastChild;vl(a.contentDOM,a.children,r),n=t?t.nextSibling:e.firstChild}}for(;n;)n=Tl(n),i=!0;i&&r.trackWrites==e&&(r.trackWrites=null)}const bl=function(e){e&&(this.nodeName=e)};bl.prototype=Object.create(null);const wl=[new bl];function xl(e,t,r){if(0==e.length)return wl;let n=r?wl[0]:new bl,i=[n];for(let s=0;s<e.length;s++){let a=e[s].type.attrs;if(a){a.nodeName&&i.push(n=new bl(a.nodeName));for(let e in a){let s=a[e];null!=s&&(r&&1==i.length&&i.push(n=new bl(t.isInline?"span":"div")),"class"==e?n.class=(n.class?n.class+" ":"")+s:"style"==e?n.style=(n.style?n.style+";":"")+s:"nodeName"!=e&&(n[e]=s))}}}return i}function El(e,t,r,n){if(r==wl&&n==wl)return t;let i=t;for(let t=0;t<n.length;t++){let s=n[t],a=r[t];if(t){let t;a&&a.nodeName==s.nodeName&&i!=e&&(t=i.parentNode)&&t.nodeName.toLowerCase()==s.nodeName||(t=document.createElement(s.nodeName),t.pmIsDeco=!0,t.appendChild(i),a=wl[0]),i=t}Dl(i,a||wl[0],s)}return i}function Dl(e,t,r){for(let n in t)"class"==n||"style"==n||"nodeName"==n||n in r||e.removeAttribute(n);for(let n in r)"class"!=n&&"style"!=n&&"nodeName"!=n&&r[n]!=t[n]&&e.setAttribute(n,r[n]);if(t.class!=r.class){let n=t.class?t.class.split(" ").filter(Boolean):[],i=r.class?r.class.split(" ").filter(Boolean):[];for(let t=0;t<n.length;t++)-1==i.indexOf(n[t])&&e.classList.remove(n[t]);for(let t=0;t<i.length;t++)-1==n.indexOf(i[t])&&e.classList.add(i[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=r.style){if(t.style){let r,n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;r=n.exec(t.style);)e.style.removeProperty(r[1])}r.style&&(e.style.cssText+=r.style)}}function Sl(e,t,r){return El(e,e,wl,xl(t,r,1!=e.nodeType))}function Al(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].type.eq(t[r].type))return!1;return!0}function Tl(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class Cl{constructor(e,t,r){this.lock=t,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let r=t,n=r.children.length,i=e.childCount,s=new Map,a=[];e:for(;i>0;){let o;for(;;)if(n){let e=r.children[n-1];if(!(e instanceof hl)){o=e,n--;break}r=e,n=e.children.length}else{if(r==t)break e;n=r.parent.children.indexOf(r),r=r.parent}let l=o.node;if(l){if(l!=e.child(i-1))break;--i,s.set(o,i),a.push(o)}}return{index:i,matched:s,matches:a.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let r=e;r<t;r++)this.top.children[r].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,r){let n=0,i=this.stack.length>>1,s=Math.min(i,e.length);for(;n<s&&(n==i-1?this.top:this.stack[n+1<<1]).matchesMark(e[n])&&!1!==e[n].type.spec.spanning;)n++;for(;n<i;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let n=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let r=this.top.children[t];if(r.matchesMark(e[i])&&!this.isLocked(r.dom)){n=t;break}}if(n>-1)n>this.index&&(this.changed=!0,this.destroyBetween(this.index,n)),this.top=this.top.children[this.index];else{let n=hl.create(this.top,e[i],t,r);this.top.children.splice(this.index,0,n),this.top=n,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,r,n){let i,s=-1;if(n>=this.preMatch.index&&(i=this.preMatch.matches[n-this.preMatch.index]).parent==this.top&&i.matchesNode(e,t,r))s=this.top.children.indexOf(i,this.index);else for(let n=this.index,i=Math.min(this.top.children.length,n+5);n<i;n++){let i=this.top.children[n];if(i.matchesNode(e,t,r)&&!this.preMatch.matched.has(i)){s=n;break}}return!(s<0)&&(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,t,r,n,i){let s=this.top.children[n];return 3==s.dirty&&s.dom==s.contentDOM&&(s.dirty=2),!!s.update(e,t,r,i)&&(this.destroyBetween(this.index,n),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,r,n,i){for(let s=this.index;s<this.top.children.length;s++){let a=this.top.children[s];if(a instanceof fl){let o=this.preMatch.matched.get(a);if(null!=o&&o!=i)return!1;let l=a.dom;if(!(this.isLocked(l)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&3!=a.dirty&&Al(t,a.outerDeco)))&&a.update(e,t,r,n))return this.destroyBetween(this.index,s),a.dom!=l&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,t,r,n,i){this.top.children.splice(this.index++,0,fl.create(this.top,e,t,r,n,i)),this.changed=!0}placeWidget(e,t,r){let n=this.index<this.top.children.length?this.top.children[this.index]:null;if(!n||!n.matchesWidget(e)||e!=n.widget&&n.widget.type.toDOM.parentNode){let n=new cl(this.top,e,t,r);this.top.children.splice(this.index++,0,n),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof hl;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof ml)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ro||Lo)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);"IMG"==e&&(r.className="ProseMirror-separator",r.alt=""),"BR"==e&&(r.className="ProseMirror-trailingBreak");let n=new gl(this.top,[],r,null);t!=this.top?t.children.push(n):t.children.splice(this.index++,0,n),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function Nl(e,t){return e.type.side-t.type.side}function kl(e,t,r,n,i){let s=[];for(let a=0,o=0;a<e.length;a++){let l=e[a],u=o,c=o+=l.size;u>=r||c<=t?s.push(l):(u<t&&s.push(l.slice(0,t-u,n)),i&&(s.push(i),i=void 0),c>r&&s.push(l.slice(r-u,l.size,n)))}return s}function Ml(e,t=null){let r=e.domSelectionRange(),n=e.state.doc;if(!r.focusNode)return null;let i=e.docView.nearestDesc(r.focusNode),s=i&&0==i.size,a=e.docView.posFromDOM(r.focusNode,r.focusOffset,1);if(a<0)return null;let o,l,u=n.resolve(a);if(xo(r)){for(o=u;i&&!i.node;)i=i.parent;let e=i.node;if(i&&e.isAtom&&Wa.isSelectable(e)&&i.parent&&(!e.isInline||!function(e,t,r){for(let n=0==t,i=t==bo(e);n||i;){if(e==r)return!0;let t=ho(e);if(!(e=e.parentNode))return!1;n=n&&0==t,i=i&&t==bo(e)}}(r.focusNode,r.focusOffset,i.dom))){let e=i.posBefore;l=new Wa(a==e?u:n.resolve(e))}}else{let t=e.docView.posFromDOM(r.anchorNode,r.anchorOffset,1);if(t<0)return null;o=n.resolve(t)}if(!l){l=Ul(e,o,u,"pointer"==t||e.state.selection.head<u.pos&&!s?1:-1)}return l}function Ol(e){return e.editable?e.hasFocus():zl(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function Fl(e,t=!1){let r=e.state.selection;if(Pl(e,r),Ol(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&Lo){let t=e.domSelectionRange(),r=e.domObserver.currentSelection;if(t.anchorNode&&r.anchorNode&&go(t.anchorNode,t.anchorOffset,r.anchorNode,r.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection(),r=document.createRange(),n=e.cursorWrapper.dom,i="IMG"==n.nodeName;i?r.setEnd(n.parentNode,ho(n)+1):r.setEnd(n,0);r.collapse(!1),t.removeAllRanges(),t.addRange(r),!i&&!e.state.selection.visible&&ko&&Mo<=11&&(n.disabled=!0,n.disabled=!1)}(e);else{let n,i,{anchor:s,head:a}=r;!Ll||r instanceof Ga||(r.$from.parent.inlineContent||(n=_l(e,r.from)),r.empty||r.$from.parent.inlineContent||(i=_l(e,r.to))),e.docView.setSelection(s,a,e.root,t),Ll&&(n&&Il(n),i&&Il(i)),r.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let r=e.domSelectionRange(),n=r.anchorNode,i=r.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{r.anchorNode==n&&r.anchorOffset==i||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{Ol(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const Ll=Ro||Lo&&_o<63;function _l(e,t){let{node:r,offset:n}=e.docView.domFromPos(t,0),i=n<r.childNodes.length?r.childNodes[n]:null,s=n?r.childNodes[n-1]:null;if(Ro&&i&&"false"==i.contentEditable)return Rl(i);if(!(i&&"false"!=i.contentEditable||s&&"false"!=s.contentEditable)){if(i)return Rl(i);if(s)return Rl(s)}}function Rl(e){return e.contentEditable="true",Ro&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Il(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Pl(e,t){if(t instanceof Wa){let r=e.docView.descAt(t.from);r!=e.lastSelectedViewDesc&&(Bl(e),r&&r.selectNode(),e.lastSelectedViewDesc=r)}else Bl(e)}function Bl(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Ul(e,t,r,n){return e.someProp("createSelectionBetween",(n=>n(e,t,r)))||Ga.between(t,r,n)}function $l(e){return!(e.editable&&!e.hasFocus())&&zl(e)}function zl(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(e){return!1}}function jl(e,t){let{$anchor:r,$head:n}=e.selection,i=t>0?r.max(n):r.min(n),s=i.parent.inlineContent?i.depth?e.doc.resolve(t>0?i.after():i.before()):null:i;return s&&ja.findFrom(s,t)}function ql(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function Hl(e,t,r){let n=e.state.selection;if(!(n instanceof Ga)){if(n instanceof Wa&&n.node.isInline)return ql(e,new Ga(t>0?n.$to:n.$from));{let r=jl(e.state,t);return!!r&&ql(e,r)}}if(!n.empty||r.indexOf("s")>-1)return!1;if(e.endOfTextblock(t>0?"right":"left")){let r=jl(e.state,t);return!!(r&&r instanceof Wa)&&ql(e,r)}if(!(Po&&r.indexOf("m")>-1)){let r,i=n.$head,s=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText)return!1;let a=t<0?i.pos-s.nodeSize:i.pos;return!!(s.isAtom||(r=e.docView.descAt(a))&&!r.contentDOM)&&(Wa.isSelectable(s)?ql(e,new Wa(t<0?e.state.doc.resolve(i.pos-s.nodeSize):i)):!!Uo&&ql(e,new Ga(e.state.doc.resolve(t<0?a:a+s.nodeSize))))}}function Vl(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Gl(e){let t=e.pmViewDesc;return t&&0==t.size&&(e.nextSibling||"BR"!=e.nodeName)}function Kl(e){let t=e.domSelectionRange(),r=t.focusNode,n=t.focusOffset;if(!r)return;let i,s,a=!1;for(Oo&&1==r.nodeType&&n<Vl(r)&&Gl(r.childNodes[n])&&(a=!0);;)if(n>0){if(1!=r.nodeType)break;{let e=r.childNodes[n-1];if(Gl(e))i=r,s=--n;else{if(3!=e.nodeType)break;r=e,n=r.nodeValue.length}}}else{if(Yl(r))break;{let t=r.previousSibling;for(;t&&Gl(t);)i=r.parentNode,s=ho(t),t=t.previousSibling;if(t)r=t,n=Vl(r);else{if(r=r.parentNode,r==e.dom)break;n=0}}}a?Jl(e,r,n):i&&Jl(e,i,s)}function Wl(e){let t=e.domSelectionRange(),r=t.focusNode,n=t.focusOffset;if(!r)return;let i,s,a=Vl(r);for(;;)if(n<a){if(1!=r.nodeType)break;if(!Gl(r.childNodes[n]))break;i=r,s=++n}else{if(Yl(r))break;{let t=r.nextSibling;for(;t&&Gl(t);)i=t.parentNode,s=ho(t)+1,t=t.nextSibling;if(t)r=t,n=0,a=Vl(r);else{if(r=r.parentNode,r==e.dom)break;n=a=0}}}i&&Jl(e,i,s)}function Yl(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function Jl(e,t,r){let n=e.domSelection();if(xo(n)){let e=document.createRange();e.setEnd(t,r),e.setStart(t,r),n.removeAllRanges(),n.addRange(e)}else n.extend&&n.extend(t,r);e.domObserver.setCurSelection();let{state:i}=e;setTimeout((()=>{e.state==i&&Fl(e)}),50)}function Zl(e,t,r){let n=e.state.selection;if(n instanceof Ga&&!n.empty||r.indexOf("s")>-1)return!1;if(Po&&r.indexOf("m")>-1)return!1;let{$from:i,$to:s}=n;if(!i.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let r=jl(e.state,t);if(r&&r instanceof Wa)return ql(e,r)}if(!i.parent.inlineContent){let r=t<0?i:s,a=n instanceof Ja?ja.near(r,t):ja.findFrom(r,t);return!!a&&ql(e,a)}return!1}function Xl(e,t){if(!(e.state.selection instanceof Ga))return!0;let{$head:r,$anchor:n,empty:i}=e.state.selection;if(!r.sameParent(n))return!0;if(!i)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let s=!r.textOffset&&(t<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){let n=e.state.tr;return t<0?n.delete(r.pos-s.nodeSize,r.pos):n.delete(r.pos,r.pos+s.nodeSize),e.dispatch(n),!0}return!1}function Ql(e,t,r){e.domObserver.stop(),t.contentEditable=r,e.domObserver.start()}function eu(e,t){let r=t.keyCode,n=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);return 8==r||Po&&72==r&&"c"==n?Xl(e,-1)||Kl(e):46==r||Po&&68==r&&"c"==n?Xl(e,1)||Wl(e):13==r||27==r||(37==r||Po&&66==r&&"c"==n?Hl(e,-1,n)||Kl(e):39==r||Po&&70==r&&"c"==n?Hl(e,1,n)||Wl(e):38==r||Po&&80==r&&"c"==n?Zl(e,-1,n)||Kl(e):40==r||Po&&78==r&&"c"==n?function(e){if(!Ro||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:r}=e.domSelectionRange();if(t&&1==t.nodeType&&0==r&&t.firstChild&&"false"==t.firstChild.contentEditable){let r=t.firstChild;Ql(e,r,"true"),setTimeout((()=>Ql(e,r,"false")),20)}return!1}(e)||Zl(e,1,n)||Wl(e):n==(Po?"m":"c")&&(66==r||73==r||89==r||90==r))}function tu(e,t){e.someProp("transformCopied",(r=>{t=r(t,e)}));let r=[],{content:n,openStart:i,openEnd:s}=t;for(;i>1&&s>1&&1==n.childCount&&1==n.firstChild.childCount;){i--,s--;let e=n.firstChild;r.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),n=e.content}let a=e.someProp("clipboardSerializer")||Xs.fromSchema(e.state.schema),o=du(),l=o.createElement("div");l.appendChild(a.serializeFragment(n,{document:o}));let u,c=l.firstChild,d=0;for(;c&&1==c.nodeType&&(u=uu[c.nodeName.toLowerCase()]);){for(let e=u.length-1;e>=0;e--){let t=o.createElement(u[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),d++}c=l.firstChild}return c&&1==c.nodeType&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(r)}`),{dom:l,text:e.someProp("clipboardTextSerializer",(r=>r(t,e)))||t.content.textBetween(0,t.content.size,"\n\n")}}function ru(e,t,r,n,i){let s,a,o=i.parent.type.spec.code;if(!r&&!t)return null;let l=t&&(n||o||!r);if(l){if(e.someProp("transformPastedText",(r=>{t=r(t,o||n,e)})),o)return t?new ns(Zi.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):ns.empty;let r=e.someProp("clipboardTextParser",(r=>r(t,i,n,e)));if(r)a=r;else{let r=i.marks(),{schema:n}=e.state,a=Xs.fromSchema(n);s=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=s.appendChild(document.createElement("p"));e&&t.appendChild(a.serializeNode(n.text(e,r)))}))}}else e.someProp("transformPastedHTML",(t=>{r=t(r,e)})),s=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let r,n=du().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(e);(r=i&&uu[i[1].toLowerCase()])&&(e=r.map((e=>"<"+e+">")).join("")+e+r.map((e=>"</"+e+">")).reverse().join(""));if(n.innerHTML=e,r)for(let e=0;e<r.length;e++)n=n.querySelector(r[e])||n;return n}(r),Uo&&function(e){let t=e.querySelectorAll(Lo?"span:not([class]):not([style])":"span.Apple-converted-space");for(let r=0;r<t.length;r++){let n=t[r];1==n.childNodes.length&&" "==n.textContent&&n.parentNode&&n.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),n)}}(s);let u=s&&s.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let e=+c[3];e>0;e--){let e=s.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;s=e}if(!a){let t=e.someProp("clipboardParser")||e.someProp("domParser")||js.fromSchema(e.state.schema);a=t.parseSlice(s,{preserveWhitespace:!(!l&&!c),context:i,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||nu.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(c)a=function(e,t){if(!e.size)return e;let r,n=e.content.firstChild.type.schema;try{r=JSON.parse(t)}catch(t){return e}let{content:i,openStart:s,openEnd:a}=e;for(let e=r.length-2;e>=0;e-=2){let t=n.nodes[r[e]];if(!t||t.hasRequiredAttrs())break;i=Zi.from(t.create(r[e+1],i)),s++,a++}return new ns(i,s,a)}(lu(a,+c[1],+c[2]),c[4]);else if(a=ns.maxOpen(function(e,t){if(e.childCount<2)return e;for(let r=t.depth;r>=0;r--){let n,i=t.node(r).contentMatchAt(t.index(r)),s=[];if(e.forEach((e=>{if(!s)return;let t,r=i.findWrapping(e.type);if(!r)return s=null;if(t=s.length&&n.length&&su(r,n,e,s[s.length-1],0))s[s.length-1]=t;else{s.length&&(s[s.length-1]=au(s[s.length-1],n.length));let t=iu(e,r);s.push(t),i=i.matchType(t.type),n=r}})),s)return Zi.from(s)}return e}(a.content,i),!0),a.openStart||a.openEnd){let e=0,t=0;for(let t=a.content.firstChild;e<a.openStart&&!t.type.spec.isolating;e++,t=t.firstChild);for(let e=a.content.lastChild;t<a.openEnd&&!e.type.spec.isolating;t++,e=e.lastChild);a=lu(a,e,t)}return e.someProp("transformPasted",(t=>{a=t(a,e)})),a}const nu=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function iu(e,t,r=0){for(let n=t.length-1;n>=r;n--)e=t[n].create(null,Zi.from(e));return e}function su(e,t,r,n,i){if(i<e.length&&i<t.length&&e[i]==t[i]){let s=su(e,t,r,n.lastChild,i+1);if(s)return n.copy(n.content.replaceChild(n.childCount-1,s));if(n.contentMatchAt(n.childCount).matchType(i==e.length-1?r.type:e[i+1]))return n.copy(n.content.append(Zi.from(iu(r,e,i+1))))}}function au(e,t){if(0==t)return e;let r=e.content.replaceChild(e.childCount-1,au(e.lastChild,t-1)),n=e.contentMatchAt(e.childCount).fillBefore(Zi.empty,!0);return e.copy(r.append(n))}function ou(e,t,r,n,i,s){let a=t<0?e.firstChild:e.lastChild,o=a.content;return i<n-1&&(o=ou(o,t,r,n,i+1,s)),i>=r&&(o=t<0?a.contentMatchAt(0).fillBefore(o,e.childCount>1||s<=i).append(o):o.append(a.contentMatchAt(a.childCount).fillBefore(Zi.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,a.copy(o))}function lu(e,t,r){return t<e.openStart&&(e=new ns(ou(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),r<e.openEnd&&(e=new ns(ou(e.content,1,r,e.openEnd,0,0),e.openStart,r)),e}const uu={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let cu=null;function du(){return cu||(cu=document.implementation.createHTMLDocument("title"))}const hu={},fu={},pu={touchstart:!0,touchmove:!0};class mu{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function gu(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function yu(e){e.someProp("handleDOMEvents",(t=>{for(let r in t)e.input.eventHandlers[r]||e.dom.addEventListener(r,e.input.eventHandlers[r]=t=>vu(e,t))}))}function vu(e,t){return e.someProp("handleDOMEvents",(r=>{let n=r[t.type];return!!n&&(n(e,t)||t.defaultPrevented)}))}function bu(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let r=t.target;r!=e.dom;r=r.parentNode)if(!r||11==r.nodeType||r.pmViewDesc&&r.pmViewDesc.stopEvent(t))return!1;return!0}function wu(e){return{left:e.clientX,top:e.clientY}}function xu(e,t,r,n,i){if(-1==n)return!1;let s=e.state.doc.resolve(n);for(let n=s.depth+1;n>0;n--)if(e.someProp(t,(t=>n>s.depth?t(e,r,s.nodeAfter,s.before(n),i,!0):t(e,r,s.node(n),s.before(n),i,!1))))return!0;return!1}function Eu(e,t,r){e.focused||e.focus();let n=e.state.tr.setSelection(t);"pointer"==r&&n.setMeta("pointer",!0),e.dispatch(n)}function Du(e,t,r,n,i){return xu(e,"handleClickOn",t,r,n)||e.someProp("handleClick",(r=>r(e,t,n)))||(i?function(e,t){if(-1==t)return!1;let r,n,i=e.state.selection;i instanceof Wa&&(r=i.node);let s=e.state.doc.resolve(t);for(let e=s.depth+1;e>0;e--){let t=e>s.depth?s.nodeAfter:s.node(e);if(Wa.isSelectable(t)){n=r&&i.$from.depth>0&&e>=i.$from.depth&&s.before(i.$from.depth+1)==i.$from.pos?s.before(i.$from.depth):s.before(e);break}}return null!=n&&(Eu(e,Wa.create(e.state.doc,n),"pointer"),!0)}(e,r):function(e,t){if(-1==t)return!1;let r=e.state.doc.resolve(t),n=r.nodeAfter;return!!(n&&n.isAtom&&Wa.isSelectable(n))&&(Eu(e,new Wa(r),"pointer"),!0)}(e,r))}function Su(e,t,r,n){return xu(e,"handleDoubleClickOn",t,r,n)||e.someProp("handleDoubleClick",(r=>r(e,t,n)))}function Au(e,t,r,n){return xu(e,"handleTripleClickOn",t,r,n)||e.someProp("handleTripleClick",(r=>r(e,t,n)))||function(e,t,r){if(0!=r.button)return!1;let n=e.state.doc;if(-1==t)return!!n.inlineContent&&(Eu(e,Ga.create(n,0,n.content.size),"pointer"),!0);let i=n.resolve(t);for(let t=i.depth+1;t>0;t--){let r=t>i.depth?i.nodeAfter:i.node(t),s=i.before(t);if(r.inlineContent)Eu(e,Ga.create(n,s+1,s+1+r.content.size),"pointer");else{if(!Wa.isSelectable(r))continue;Eu(e,Wa.create(n,s),"pointer")}return!0}}(e,r,n)}function Tu(e){return Lu(e)}fu.keydown=(e,t)=>{let r=t;if(e.input.shiftKey=16==r.keyCode||r.shiftKey,!ku(e,r)&&(e.input.lastKeyCode=r.keyCode,e.input.lastKeyCodeTime=Date.now(),!Bo||!Lo||13!=r.keyCode))if(229!=r.keyCode&&e.domObserver.forceFlush(),!Io||13!=r.keyCode||r.ctrlKey||r.altKey||r.metaKey)e.someProp("handleKeyDown",(t=>t(e,r)))||eu(e,r)?r.preventDefault():gu(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,Eo(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},fu.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},fu.keypress=(e,t)=>{let r=t;if(ku(e,r)||!r.charCode||r.ctrlKey&&!r.altKey||Po&&r.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,r))))return void r.preventDefault();let n=e.state.selection;if(!(n instanceof Ga&&n.$from.sameParent(n.$to))){let t=String.fromCharCode(r.charCode);/[\r\n]/.test(t)||e.someProp("handleTextInput",(r=>r(e,n.$from.pos,n.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),r.preventDefault()}};const Cu=Po?"metaKey":"ctrlKey";hu.mousedown=(e,t)=>{let r=t;e.input.shiftKey=r.shiftKey;let n=Tu(e),i=Date.now(),s="singleClick";i-e.input.lastClick.time<500&&function(e,t){let r=t.x-e.clientX,n=t.y-e.clientY;return r*r+n*n<100}(r,e.input.lastClick)&&!r[Cu]&&("singleClick"==e.input.lastClick.type?s="doubleClick":"doubleClick"==e.input.lastClick.type&&(s="tripleClick")),e.input.lastClick={time:i,x:r.clientX,y:r.clientY,type:s};let a=e.posAtCoords(wu(r));a&&("singleClick"==s?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new Nu(e,a,r,!!n)):("doubleClick"==s?Su:Au)(e,a.pos,a.inside,r)?r.preventDefault():gu(e,"pointer"))};class Nu{constructor(e,t,r,n){let i,s;if(this.view=e,this.pos=t,this.event=r,this.flushed=n,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Cu],this.allowDefault=r.shiftKey,t.inside>-1)i=e.state.doc.nodeAt(t.inside),s=t.inside;else{let r=e.state.doc.resolve(t.pos);i=r.parent,s=r.depth?r.before():0}const a=n?null:r.target,o=a?e.docView.nearestDesc(a,!0):null;this.target=o?o.dom:null;let{selection:l}=e.state;(0==r.button&&i.type.spec.draggable&&!1!==i.type.spec.selectable||l instanceof Wa&&l.from<=s&&l.to>s)&&(this.mightDrag={node:i,pos:s,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!Oo||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),gu(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>Fl(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(wu(e))),this.updateAllowDefault(e),this.allowDefault||!t?gu(this.view,"pointer"):Du(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||Ro&&this.mightDrag&&!this.mightDrag.node.isAtom||Lo&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Eu(this.view,ja.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):gu(this.view,"pointer")}move(e){this.updateAllowDefault(e),gu(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function ku(e,t){return!!e.composing||!!(Ro&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}hu.touchstart=e=>{e.input.lastTouch=Date.now(),Tu(e),gu(e,"pointer")},hu.touchmove=e=>{e.input.lastTouch=Date.now(),gu(e,"pointer")},hu.contextmenu=e=>Tu(e);const Mu=Bo?5e3:-1;function Ou(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>Lu(e)),t))}function Fu(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function Lu(e,t=!1){if(!(Bo&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),Fu(e),t||e.docView&&e.docView.dirty){let t=Ml(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}fu.compositionstart=fu.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,r=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!r.textOffset&&r.parentOffset&&r.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||r.marks(),Lu(e,!0),e.markCursor=null;else if(Lu(e),Oo&&t.selection.empty&&r.parentOffset&&!r.textOffset&&r.nodeBefore.marks.length){let t=e.domSelectionRange();for(let r=t.focusNode,n=t.focusOffset;r&&1==r.nodeType&&0!=n;){let t=n<0?r.lastChild:r.childNodes[n-1];if(!t)break;if(3==t.nodeType){e.domSelection().collapse(t,t.nodeValue.length);break}r=t,n=-1}}e.input.composing=!0}Ou(e,Mu)},fu.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,Ou(e,20))};const _u=ko&&Mo<15||Io&&$o<604;function Ru(e,t,r,n,i){let s=ru(e,t,r,n,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,i,s||ns.empty))))return!0;if(!s)return!1;let a=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(s),o=a?e.state.tr.replaceSelectionWith(a,e.input.shiftKey):e.state.tr.replaceSelection(s);return e.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}hu.copy=fu.cut=(e,t)=>{let r=t,n=e.state.selection,i="cut"==r.type;if(n.empty)return;let s=_u?null:r.clipboardData,a=n.content(),{dom:o,text:l}=tu(e,a);s?(r.preventDefault(),s.clearData(),s.setData("text/html",o.innerHTML),s.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let r=e.dom.parentNode.appendChild(document.createElement("div"));r.appendChild(t),r.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(t),e.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout((()=>{r.parentNode&&r.parentNode.removeChild(r),e.focus()}),50)}(e,o),i&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},fu.paste=(e,t)=>{let r=t;if(e.composing&&!Bo)return;let n=_u?null:r.clipboardData;n&&Ru(e,n.getData("text/plain"),n.getData("text/html"),e.input.shiftKey,r)?r.preventDefault():function(e,t){if(!e.dom.parentNode)return;let r=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,n=e.dom.parentNode.appendChild(document.createElement(r?"textarea":"div"));r||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout((()=>{e.focus(),n.parentNode&&n.parentNode.removeChild(n),r?Ru(e,n.value,null,e.input.shiftKey,t):Ru(e,n.textContent,n.innerHTML,e.input.shiftKey,t)}),50)}(e,r)};class Iu{constructor(e,t){this.slice=e,this.move=t}}const Pu=Po?"altKey":"ctrlKey";hu.dragstart=(e,t)=>{let r=t,n=e.input.mouseDown;if(n&&n.done(),!r.dataTransfer)return;let i=e.state.selection,s=i.empty?null:e.posAtCoords(wu(r));if(s&&s.pos>=i.from&&s.pos<=(i instanceof Wa?i.to-1:i.to));else if(n&&n.mightDrag)e.dispatch(e.state.tr.setSelection(Wa.create(e.state.doc,n.mightDrag.pos)));else if(r.target&&1==r.target.nodeType){let t=e.docView.nearestDesc(r.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&e.dispatch(e.state.tr.setSelection(Wa.create(e.state.doc,t.posBefore)))}let a=e.state.selection.content(),{dom:o,text:l}=tu(e,a);r.dataTransfer.clearData(),r.dataTransfer.setData(_u?"Text":"text/html",o.innerHTML),r.dataTransfer.effectAllowed="copyMove",_u||r.dataTransfer.setData("text/plain",l),e.dragging=new Iu(a,!r[Pu])},hu.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},fu.dragover=fu.dragenter=(e,t)=>t.preventDefault(),fu.drop=(e,t)=>{let r=t,n=e.dragging;if(e.dragging=null,!r.dataTransfer)return;let i=e.posAtCoords(wu(r));if(!i)return;let s=e.state.doc.resolve(i.pos),a=n&&n.slice;a?e.someProp("transformPasted",(t=>{a=t(a,e)})):a=ru(e,r.dataTransfer.getData(_u?"Text":"text/plain"),_u?null:r.dataTransfer.getData("text/html"),!1,s);let o=!(!n||r[Pu]);if(e.someProp("handleDrop",(t=>t(e,r,a||ns.empty,o))))return void r.preventDefault();if(!a)return;r.preventDefault();let l=a?Ta(e.state.doc,s.pos,a):s.pos;null==l&&(l=s.pos);let u=e.state.tr;o&&u.deleteSelection();let c=u.mapping.map(l),d=0==a.openStart&&0==a.openEnd&&1==a.content.childCount,h=u.doc;if(d?u.replaceRangeWith(c,c,a.content.firstChild):u.replaceRange(c,c,a),u.doc.eq(h))return;let f=u.doc.resolve(c);if(d&&Wa.isSelectable(a.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(a.content.firstChild))u.setSelection(new Wa(f));else{let t=u.mapping.map(l);u.mapping.maps[u.mapping.maps.length-1].forEach(((e,r,n,i)=>t=i)),u.setSelection(Ul(e,f,u.doc.resolve(t)))}e.focus(),e.dispatch(u.setMeta("uiEvent","drop"))},hu.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&Fl(e)}),20))},hu.blur=(e,t)=>{let r=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),r.relatedTarget&&e.dom.contains(r.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},hu.beforeinput=(e,t)=>{if(Lo&&Bo&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,Eo(8,"Backspace")))))return;let{$cursor:r}=e.state.selection;r&&r.pos>0&&e.dispatch(e.state.tr.delete(r.pos-1,r.pos).scrollIntoView())}),50)}};for(let e in fu)hu[e]=fu[e];function Bu(e,t){if(e==t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0}class Uu{constructor(e,t){this.toDOM=e,this.spec=t||Hu,this.side=this.spec.side||0}map(e,t,r,n){let{pos:i,deleted:s}=e.mapResult(t.from+n,this.side<0?-1:1);return s?null:new ju(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Uu&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Bu(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class $u{constructor(e,t){this.attrs=e,this.spec=t||Hu}map(e,t,r,n){let i=e.map(t.from+n,this.spec.inclusiveStart?-1:1)-r,s=e.map(t.to+n,this.spec.inclusiveEnd?1:-1)-r;return i>=s?null:new ju(i,s,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof $u&&Bu(this.attrs,e.attrs)&&Bu(this.spec,e.spec)}static is(e){return e.type instanceof $u}destroy(){}}class zu{constructor(e,t){this.attrs=e,this.spec=t||Hu}map(e,t,r,n){let i=e.mapResult(t.from+n,1);if(i.deleted)return null;let s=e.mapResult(t.to+n,-1);return s.deleted||s.pos<=i.pos?null:new ju(i.pos-r,s.pos-r,this)}valid(e,t){let r,{index:n,offset:i}=e.content.findIndex(t.from);return i==t.from&&!(r=e.child(n)).isText&&i+r.nodeSize==t.to}eq(e){return this==e||e instanceof zu&&Bu(this.attrs,e.attrs)&&Bu(this.spec,e.spec)}destroy(){}}class ju{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new ju(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new ju(e,e,new Uu(t,r))}static inline(e,t,r,n){return new ju(e,t,new $u(r,n))}static node(e,t,r,n){return new ju(e,t,new zu(r,n))}get spec(){return this.type.spec}get inline(){return this.type instanceof $u}}const qu=[],Hu={};class Vu{constructor(e,t){this.local=e.length?e:qu,this.children=t.length?t:qu}static create(e,t){return t.length?Zu(t,e,0,Hu):Gu}find(e,t,r){let n=[];return this.findInner(null==e?0:e,null==t?1e9:t,n,0,r),n}findInner(e,t,r,n,i){for(let s=0;s<this.local.length;s++){let a=this.local[s];a.from<=t&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+n,a.to+n))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<t&&this.children[s+1]>e){let a=this.children[s]+1;this.children[s+2].findInner(e-a,t-a,r,n+a,i)}}map(e,t,r){return this==Gu||0==e.maps.length?this:this.mapInner(e,t,0,0,r||Hu)}mapInner(e,t,r,n,i){let s;for(let a=0;a<this.local.length;a++){let o=this.local[a].map(e,r,n);o&&o.type.valid(t,o)?(s||(s=[])).push(o):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?function(e,t,r,n,i,s,a){let o=e.slice();for(let e=0,t=s;e<r.maps.length;e++){let n=0;r.maps[e].forEach(((e,r,s,a)=>{let l=a-s-(r-e);for(let a=0;a<o.length;a+=3){let u=o[a+1];if(u<0||e>u+t-n)continue;let c=o[a]+t-n;r>=c?o[a+1]=e<=c?-2:-1:s>=i&&l&&(o[a]+=l,o[a+1]+=l)}n+=l})),t=r.maps[e].map(t,-1)}let l=!1;for(let t=0;t<o.length;t+=3)if(o[t+1]<0){if(-2==o[t+1]){l=!0,o[t+1]=-1;continue}let u=r.map(e[t]+s),c=u-i;if(c<0||c>=n.content.size){l=!0;continue}let d=r.map(e[t+1]+s,-1)-i,{index:h,offset:f}=n.content.findIndex(c),p=n.maybeChild(h);if(p&&f==c&&f+p.nodeSize==d){let n=o[t+2].mapInner(r,p,u+1,e[t]+s+1,a);n!=Gu?(o[t]=c,o[t+1]=d,o[t+2]=n):(o[t+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,r,n,i,s,a){function o(e,t){for(let s=0;s<e.local.length;s++){let o=e.local[s].map(n,i,t);o?r.push(o):a.onRemove&&a.onRemove(e.local[s].spec)}for(let r=0;r<e.children.length;r+=3)o(e.children[r+2],e.children[r]+t+1)}for(let r=0;r<e.length;r+=3)-1==e[r+1]&&o(e[r+2],t[r]+s+1);return r}(o,e,t,r,i,s,a),u=Zu(l,n,0,a);t=u.local;for(let e=0;e<o.length;e+=3)o[e+1]<0&&(o.splice(e,3),e-=3);for(let e=0,t=0;e<u.children.length;e+=3){let r=u.children[e];for(;t<o.length&&o[t]<r;)t+=3;o.splice(t,0,u.children[e],u.children[e+1],u.children[e+2])}}return new Vu(t.sort(Xu),o)}(this.children,s||[],e,t,r,n,i):s?new Vu(s.sort(Xu),qu):Gu}add(e,t){return t.length?this==Gu?Vu.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let n,i=0;e.forEach(((e,s)=>{let a,o=s+r;if(a=Yu(t,e,o)){for(n||(n=this.children.slice());i<n.length&&n[i]<s;)i+=3;n[i]==s?n[i+2]=n[i+2].addInner(e,a,o+1):n.splice(i,0,s,s+e.nodeSize,Zu(a,e,o+1,Hu)),i+=3}}));let s=Wu(i?Ju(t):t,-r);for(let t=0;t<s.length;t++)s[t].type.valid(e,s[t])||s.splice(t--,1);return new Vu(s.length?this.local.concat(s).sort(Xu):this.local,n||this.children)}remove(e){return 0==e.length||this==Gu?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,n=this.local;for(let n=0;n<r.length;n+=3){let i,s=r[n]+t,a=r[n+1]+t;for(let t,r=0;r<e.length;r++)(t=e[r])&&t.from>s&&t.to<a&&(e[r]=null,(i||(i=[])).push(t));if(!i)continue;r==this.children&&(r=this.children.slice());let o=r[n+2].removeInner(i,s+1);o!=Gu?r[n+2]=o:(r.splice(n,3),n-=3)}if(n.length)for(let r,i=0;i<e.length;i++)if(r=e[i])for(let e=0;e<n.length;e++)n[e].eq(r,t)&&(n==this.local&&(n=this.local.slice()),n.splice(e--,1));return r==this.children&&n==this.local?this:n.length||r.length?new Vu(n,r):Gu}forChild(e,t){if(this==Gu)return this;if(t.isLeaf)return Vu.empty;let r,n;for(let t=0;t<this.children.length;t+=3)if(this.children[t]>=e){this.children[t]==e&&(r=this.children[t+2]);break}let i=e+1,s=i+t.content.size;for(let e=0;e<this.local.length;e++){let t=this.local[e];if(t.from<s&&t.to>i&&t.type instanceof $u){let e=Math.max(i,t.from)-i,r=Math.min(s,t.to)-i;e<r&&(n||(n=[])).push(t.copy(e,r))}}if(n){let e=new Vu(n.sort(Xu),qu);return r?new Ku([e,r]):e}return r||Gu}eq(e){if(this==e)return!0;if(!(e instanceof Vu)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Qu(this.localsInner(e))}localsInner(e){if(this==Gu)return qu;if(e.inlineContent||!this.local.some($u.is))return this.local;let t=[];for(let e=0;e<this.local.length;e++)this.local[e].type instanceof $u||t.push(this.local[e]);return t}}Vu.empty=new Vu([],[]),Vu.removeOverlap=Qu;const Gu=Vu.empty;class Ku{constructor(e){this.members=e}map(e,t){const r=this.members.map((r=>r.map(e,t,Hu)));return Ku.from(r)}forChild(e,t){if(t.isLeaf)return Vu.empty;let r=[];for(let n=0;n<this.members.length;n++){let i=this.members[n].forChild(e,t);i!=Gu&&(i instanceof Ku?r=r.concat(i.members):r.push(i))}return Ku.from(r)}eq(e){if(!(e instanceof Ku)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let n=0;n<this.members.length;n++){let i=this.members[n].localsInner(e);if(i.length)if(t){r&&(t=t.slice(),r=!1);for(let e=0;e<i.length;e++)t.push(i[e])}else t=i}return t?Qu(r?t:t.sort(Xu)):qu}static from(e){switch(e.length){case 0:return Gu;case 1:return e[0];default:return new Ku(e.every((e=>e instanceof Vu))?e:e.reduce(((e,t)=>e.concat(t instanceof Vu?t:t.members)),[]))}}}function Wu(e,t){if(!t||!e.length)return e;let r=[];for(let n=0;n<e.length;n++){let i=e[n];r.push(new ju(i.from+t,i.to+t,i.type))}return r}function Yu(e,t,r){if(t.isLeaf)return null;let n=r+t.nodeSize,i=null;for(let t,s=0;s<e.length;s++)(t=e[s])&&t.from>r&&t.to<n&&((i||(i=[])).push(t),e[s]=null);return i}function Ju(e){let t=[];for(let r=0;r<e.length;r++)null!=e[r]&&t.push(e[r]);return t}function Zu(e,t,r,n){let i=[],s=!1;t.forEach(((t,a)=>{let o=Yu(e,t,a+r);if(o){s=!0;let e=Zu(o,t,r+a+1,n);e!=Gu&&i.push(a,a+t.nodeSize,e)}}));let a=Wu(s?Ju(e):e,-r).sort(Xu);for(let e=0;e<a.length;e++)a[e].type.valid(t,a[e])||(n.onRemove&&n.onRemove(a[e].spec),a.splice(e--,1));return a.length||i.length?new Vu(a,i):Gu}function Xu(e,t){return e.from-t.from||e.to-t.to}function Qu(e){let t=e;for(let r=0;r<t.length-1;r++){let n=t[r];if(n.from!=n.to)for(let i=r+1;i<t.length;i++){let s=t[i];if(s.from!=n.from){s.from<n.to&&(t==e&&(t=e.slice()),t[r]=n.copy(n.from,s.from),ec(t,i,n.copy(s.from,n.to)));break}s.to!=n.to&&(t==e&&(t=e.slice()),t[i]=s.copy(s.from,n.to),ec(t,i+1,s.copy(n.to,s.to)))}}return t}function ec(e,t,r){for(;t<e.length&&Xu(r,e[t])>0;)t++;e.splice(t,0,r)}function tc(e){let t=[];return e.someProp("decorations",(r=>{let n=r(e.state);n&&n!=Gu&&t.push(n)})),e.cursorWrapper&&t.push(Vu.create(e.state.doc,[e.cursorWrapper.deco])),Ku.from(t)}const rc={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},nc=ko&&Mo<=11;class ic{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class sc{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new ic,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);ko&&Mo<=11&&e.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),nc&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,rc)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if($l(this.view)){if(this.suppressingSelectionUpdates)return Fl(this.view);if(ko&&Mo<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&go(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,r=new Set;for(let t=e.focusNode;t;t=fo(t))r.add(t);for(let n=e.anchorNode;n;n=fo(n))if(r.has(n)){t=n;break}let n=t&&this.view.docView.nearestDesc(t);return n&&n.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);let r=e.domSelectionRange(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&$l(e)&&!this.ignoreSelectionChange(r),i=-1,s=-1,a=!1,o=[];if(e.editable)for(let e=0;e<t.length;e++){let r=this.registerMutation(t[e],o);r&&(i=i<0?r.from:Math.min(r.from,i),s=s<0?r.to:Math.max(r.to,s),r.typeOver&&(a=!0))}if(Oo&&o.length>1){let e=o.filter((e=>"BR"==e.nodeName));if(2==e.length){let t=e[0],r=e[1];t.parentNode&&t.parentNode.parentNode==r.parentNode?r.remove():t.remove()}}let l=null;i<0&&n&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&xo(r)&&(l=Ml(e))&&l.eq(ja.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Fl(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||n)&&(i>-1&&(e.docView.markDirty(i,s),function(e){if(ac.has(e))return;if(ac.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)){if(e.requiresGeckoHackNode=Oo,oc)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),oc=!0}}(e)),this.handleDOMChange(i,s,a,o),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Fl(e),this.currentSelection.set(r))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(r==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!r||r.ignoreMutation(e))return null;if("childList"==e.type){for(let r=0;r<e.addedNodes.length;r++)t.push(e.addedNodes[r]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let n=e.previousSibling,i=e.nextSibling;if(ko&&Mo<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:r,nextSibling:s}=e.addedNodes[t];(!r||Array.prototype.indexOf.call(e.addedNodes,r)<0)&&(n=r),(!s||Array.prototype.indexOf.call(e.addedNodes,s)<0)&&(i=s)}let s=n&&n.parentNode==e.target?ho(n)+1:0,a=r.localPosFromDOM(e.target,s,-1),o=i&&i.parentNode==e.target?ho(i):e.target.childNodes.length;return{from:a,to:r.localPosFromDOM(e.target,o,1)}}return"attributes"==e.type?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let ac=new WeakMap,oc=!1;function lc(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(Ro&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||Ro&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}function uc(e,t,r,n,i){if(t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,r=Ml(e,t);if(r&&!e.state.selection.eq(r)){if(Lo&&Bo&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",(t=>t(e,Eo(13,"Enter")))))return;let n=e.state.tr.setSelection(r);"pointer"==t?n.setMeta("pointer",!0):"key"==t&&n.scrollIntoView(),e.dispatch(n)}return}let s=e.state.doc.resolve(t),a=s.sharedDepth(r);t=s.before(a+1),r=e.state.doc.resolve(r).after(a+1);let o,l,u=e.state.selection,c=function(e,t,r){let n,{node:i,fromOffset:s,toOffset:a,from:o,to:l}=e.docView.parseRange(t,r),u=e.domSelectionRange(),c=u.anchorNode;if(c&&e.dom.contains(1==c.nodeType?c:c.parentNode)&&(n=[{node:c,offset:u.anchorOffset}],xo(u)||n.push({node:u.focusNode,offset:u.focusOffset})),Lo&&8===e.input.lastKeyCode)for(let e=a;e>s;e--){let t=i.childNodes[e-1],r=t.pmViewDesc;if("BR"==t.nodeName&&!r){a=e;break}if(!r||r.size)break}let d=e.state.doc,h=e.someProp("domParser")||js.fromSchema(e.state.schema),f=d.resolve(o),p=null,m=h.parse(i,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:s,to:a,preserveWhitespace:"pre"!=f.parent.type.whitespace||"full",findPositions:n,ruleFromNode:lc,context:f});if(n&&null!=n[0].pos){let e=n[0].pos,t=n[1]&&n[1].pos;null==t&&(t=e),p={anchor:e+o,head:t+o}}return{doc:m,sel:p,from:o,to:l}}(e,t,r),d=e.state.doc,h=d.slice(c.from,c.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(o=e.state.selection.to,l="end"):(o=e.state.selection.from,l="start"),e.input.lastKeyCode=null;let f=function(e,t,r,n,i){let s=e.findDiffStart(t,r);if(null==s)return null;let{a,b:o}=e.findDiffEnd(t,r+e.size,r+t.size);if("end"==i){n-=a+Math.max(0,s-Math.min(a,o))-s}if(a<s&&e.size<t.size){s-=n<=s&&n>=a?s-n:0,o=s+(o-a),a=s}else if(o<s){s-=n<=s&&n>=o?s-n:0,a=s+(a-o),o=s}return{start:s,endA:a,endB:o}}(h.content,c.doc.content,c.from,o,l);if((Io&&e.input.lastIOSEnter>Date.now()-225||Bo)&&i.some((e=>"DIV"==e.nodeName||"P"==e.nodeName||"LI"==e.nodeName))&&(!f||f.endA>=f.endB)&&e.someProp("handleKeyDown",(t=>t(e,Eo(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(!f){if(!(n&&u instanceof Ga&&!u.empty&&u.$head.sameParent(u.$anchor))||e.composing||c.sel&&c.sel.anchor!=c.sel.head){if(c.sel){let t=cc(e,e.state.doc,c.sel);t&&!t.eq(e.state.selection)&&e.dispatch(e.state.tr.setSelection(t))}return}f={start:u.from,endA:u.to,endB:u.to}}if(Lo&&e.cursorWrapper&&c.sel&&c.sel.anchor==e.cursorWrapper.deco.from&&c.sel.head==c.sel.anchor){let e=f.endB-f.start;c.sel={anchor:c.sel.anchor+e,head:c.sel.anchor+e}}e.input.domChangeCount++,e.state.selection.from<e.state.selection.to&&f.start==f.endB&&e.state.selection instanceof Ga&&(f.start>e.state.selection.from&&f.start<=e.state.selection.from+2&&e.state.selection.from>=c.from?f.start=e.state.selection.from:f.endA<e.state.selection.to&&f.endA>=e.state.selection.to-2&&e.state.selection.to<=c.to&&(f.endB+=e.state.selection.to-f.endA,f.endA=e.state.selection.to)),ko&&Mo<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>c.from&&"  "==c.doc.textBetween(f.start-c.from-1,f.start-c.from+1)&&(f.start--,f.endA--,f.endB--);let p,m=c.doc.resolveNoCache(f.start-c.from),g=c.doc.resolveNoCache(f.endB-c.from),y=d.resolve(f.start),v=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=f.endA;if((Io&&e.input.lastIOSEnter>Date.now()-225&&(!v||i.some((e=>"DIV"==e.nodeName||"P"==e.nodeName)))||!v&&m.pos<c.doc.content.size&&(p=ja.findFrom(c.doc.resolve(m.pos+1),1,!0))&&p.head==g.pos)&&e.someProp("handleKeyDown",(t=>t(e,Eo(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>f.start&&function(e,t,r,n,i){if(!n.parent.isTextblock||r-t<=i.pos-n.pos||dc(n,!0,!1)<i.pos)return!1;let s=e.resolve(t);if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let a=e.resolve(dc(s,!0,!0));return!(!a.parent.isTextblock||a.pos>r||dc(a,!0,!1)<r)&&n.parent.content.cut(n.parentOffset).eq(a.parent.content)}(d,f.start,f.endA,m,g)&&e.someProp("handleKeyDown",(t=>t(e,Eo(8,"Backspace")))))return void(Bo&&Lo&&e.domObserver.suppressSelectionUpdates());Lo&&Bo&&f.endB==f.start&&(e.input.lastAndroidDelete=Date.now()),Bo&&!v&&m.start()!=g.start()&&0==g.parentOffset&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==f.endA&&(f.endB-=2,g=c.doc.resolveNoCache(f.endB-c.from),setTimeout((()=>{e.someProp("handleKeyDown",(function(t){return t(e,Eo(13,"Enter"))}))}),20));let b,w,x,E=f.start,D=f.endA;if(v)if(m.pos==g.pos)ko&&Mo<=11&&0==m.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout((()=>Fl(e)),20)),b=e.state.tr.delete(E,D),w=d.resolve(f.start).marksAcross(d.resolve(f.endA));else if(f.endA==f.endB&&(x=function(e,t){let r,n,i,s=e.firstChild.marks,a=t.firstChild.marks,o=s,l=a;for(let e=0;e<a.length;e++)o=a[e].removeFromSet(o);for(let e=0;e<s.length;e++)l=s[e].removeFromSet(l);if(1==o.length&&0==l.length)n=o[0],r="add",i=e=>e.mark(n.addToSet(e.marks));else{if(0!=o.length||1!=l.length)return null;n=l[0],r="remove",i=e=>e.mark(n.removeFromSet(e.marks))}let u=[];for(let e=0;e<t.childCount;e++)u.push(i(t.child(e)));if(Zi.from(u).eq(e))return{mark:n,type:r}}(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,f.endA-y.start()))))b=e.state.tr,"add"==x.type?b.addMark(E,D,x.mark):b.removeMark(E,D,x.mark);else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let t=m.parent.textBetween(m.parentOffset,g.parentOffset);if(e.someProp("handleTextInput",(r=>r(e,E,D,t))))return;b=e.state.tr.insertText(t,E,D)}if(b||(b=e.state.tr.replace(E,D,c.doc.slice(f.start-c.from,f.endB-c.from))),c.sel){let t=cc(e,b.doc,c.sel);t&&!(Lo&&Bo&&e.composing&&t.empty&&(f.start!=f.endB||e.input.lastAndroidDelete<Date.now()-100)&&(t.head==E||t.head==b.mapping.map(D)-1)||ko&&t.empty&&t.head==E)&&b.setSelection(t)}w&&b.ensureMarks(w),e.dispatch(b.scrollIntoView())}function cc(e,t,r){return Math.max(r.anchor,r.head)>t.content.size?null:Ul(e,t.resolve(r.anchor),t.resolve(r.head))}function dc(e,t,r){let n=e.depth,i=t?e.end():e.pos;for(;n>0&&(t||e.indexAfter(n)==e.node(n).childCount);)n--,i++,t=!1;if(r){let t=e.node(n).maybeChild(e.indexAfter(n));for(;t&&!t.isLeaf;)t=t.firstChild,i++}return i}class hc{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new mu,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(yc),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=mc(this),pc(this),this.nodeViews=gc(this),this.docView=pl(this.state.doc,fc(this),tc(this),this.dom,this),this.domObserver=new sc(this,((e,t,r,n)=>uc(this,e,t,r,n))),this.domObserver.start(),function(e){for(let t in hu){let r=hu[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!bu(e,t)||vu(e,t)||!e.editable&&t.type in fu||r(e,t)},pu[t]?{passive:!0}:void 0)}Ro&&e.dom.addEventListener("input",(()=>null)),yu(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&yu(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(yc),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let e in this._props)t[e]=this._props[e];t.state=this.state;for(let r in e)t[r]=e[r];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let r=this.state,n=!1,i=!1;e.storedMarks&&this.composing&&(Fu(this),i=!0),this.state=e;let s=r.plugins!=e.plugins||this._props.plugins!=t.plugins;if(s||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=gc(this);(function(e,t){let r=0,n=0;for(let n in e){if(e[n]!=t[n])return!0;r++}for(let e in t)n++;return r!=n})(e,this.nodeViews)&&(this.nodeViews=e,n=!0)}(s||t.handleDOMEvents!=this._props.handleDOMEvents)&&yu(this),this.editable=mc(this),pc(this);let a=tc(this),o=fc(this),l=r.plugins==e.plugins||r.doc.eq(e.doc)?e.scrollToSelection>r.scrollToSelection?"to selection":"preserve":"reset",u=n||!this.docView.matchesNode(e.doc,o,a);!u&&e.selection.eq(r.selection)||(i=!0);let c="preserve"==l&&i&&null==this.dom.style.overflowAnchor&&function(e){let t,r,n=e.dom.getBoundingClientRect(),i=Math.max(0,n.top);for(let s=(n.left+n.right)/2,a=i+1;a<Math.min(innerHeight,n.bottom);a+=5){let n=e.root.elementFromPoint(s,a);if(!n||n==e.dom||!e.dom.contains(n))continue;let o=n.getBoundingClientRect();if(o.top>=i-20){t=n,r=o.top;break}}return{refDOM:t,refTop:r,stack:Vo(e.dom)}}(this);if(i){this.domObserver.stop();let t=u&&(ko||Lo)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&function(e,t){let r=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(r)!=t.$anchor.start(r)}(r.selection,e.selection);if(u){let r=Lo?this.trackWrites=this.domSelectionRange().focusNode:null;!n&&this.docView.update(e.doc,o,a,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=pl(e.doc,o,a,this.dom,this)),r&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),r=e.domSelectionRange();return go(t.node,t.offset,r.anchorNode,r.anchorOffset)}(this))?Fl(this,t):(Pl(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():c&&function({refDOM:e,refTop:t,stack:r}){let n=e?e.getBoundingClientRect().top:0;Go(r,0==n?0:n-t)}(c)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(e=>e(this))));else if(this.state.selection instanceof Wa){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&Ho(this,t.getBoundingClientRect(),e)}else Ho(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}someProp(e,t){let r,n=this._props&&this._props[e];if(null!=n&&(r=t?t(n):n))return r;for(let n=0;n<this.directPlugins.length;n++){let i=this.directPlugins[n].props[e];if(null!=i&&(r=t?t(i):i))return r}let i=this.state.plugins;if(i)for(let n=0;n<i.length;n++){let s=i[n].props[e];if(null!=s&&(r=t?t(s):s))return r}}hasFocus(){if(ko){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(Ko)return e.focus(Ko);let t=Vo(e);e.focus(null==Ko?{get preventScroll(){return Ko={preventScroll:!0},!0}}:void 0),Ko||(Ko=!1,Go(t,0))}(this.dom),Fl(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e;return e||document}posAtCoords(e){return Zo(this,e)}coordsAtPos(e,t=1){return el(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,r=-1){let n=this.docView.posFromDOM(e,t,r);if(null==n)throw new RangeError("DOM position not inside the editor");return n}endOfTextblock(e,t){return ll(this,t||this.state,e)}pasteHTML(e,t){return Ru(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Ru(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],tc(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){vu(e,t)||!hu[t.type]||!e.editable&&t.type in fu||hu[t.type](e,t)}(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return Ro&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom?function(e){let t;function r(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}e.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",r,!0);let n=t.startContainer,i=t.startOffset,s=t.endContainer,a=t.endOffset,o=e.domAtPos(e.state.selection.anchor);return go(o.node,o.offset,s,a)&&([n,i,s,a]=[s,a,n,i]),{anchorNode:n,anchorOffset:i,focusNode:s,focusOffset:a}}(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function fc(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),t.translate="no",e.someProp("attributes",(r=>{if("function"==typeof r&&(r=r(e.state)),r)for(let e in r)"class"==e&&(t.class+=" "+r[e]),"style"==e?t.style=(t.style?t.style+";":"")+r[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(r[e]))})),[ju.node(0,e.state.doc.content.size,t)]}function pc(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:ju.widget(e.state.selection.head,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function mc(e){return!e.someProp("editable",(t=>!1===t(e.state)))}function gc(e){let t=Object.create(null);function r(e){for(let r in e)Object.prototype.hasOwnProperty.call(t,r)||(t[r]=e[r])}return e.someProp("nodeViews",r),e.someProp("markViews",r),t}function yc(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}for(var vc={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},bc={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},wc="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),xc=("undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)),Ec="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Dc=xc||wc&&+wc[1]<57,Sc=0;Sc<10;Sc++)vc[48+Sc]=vc[96+Sc]=String(Sc);for(Sc=1;Sc<=24;Sc++)vc[Sc+111]="F"+Sc;for(Sc=65;Sc<=90;Sc++)vc[Sc]=String.fromCharCode(Sc+32),bc[Sc]=String.fromCharCode(Sc);for(var Ac in vc)bc.hasOwnProperty(Ac)||(bc[Ac]=vc[Ac]);const Tc="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function Cc(e){let t,r,n,i,s=e.split(/-(?!$)/),a=s[s.length-1];"Space"==a&&(a=" ");for(let e=0;e<s.length-1;e++){let a=s[e];if(/^(cmd|meta|m)$/i.test(a))i=!0;else if(/^a(lt)?$/i.test(a))t=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))n=!0;else{if(!/^mod$/i.test(a))throw new Error("Unrecognized modifier name: "+a);Tc?i=!0:r=!0}}return t&&(a="Alt-"+a),r&&(a="Ctrl-"+a),i&&(a="Meta-"+a),n&&(a="Shift-"+a),a}function Nc(e,t,r=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),r&&t.shiftKey&&(e="Shift-"+e),e}function kc(e){let t=function(e){let t=Object.create(null);for(let r in e)t[Cc(r)]=e[r];return t}(e);return function(e,r){let n,i=function(e){var t=!(Dc&&(e.ctrlKey||e.altKey||e.metaKey)||Ec&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?bc:vc)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(r),s=t[Nc(i,r)];if(s&&s(e.state,e.dispatch,e))return!0;if(1==i.length&&" "!=i){if(r.shiftKey){let n=t[Nc(i,r,!1)];if(n&&n(e.state,e.dispatch,e))return!0}if((r.shiftKey||r.altKey||r.metaKey||i.charCodeAt(0)>127)&&(n=vc[r.keyCode])&&n!=i){let i=t[Nc(n,r)];if(i&&i(e.state,e.dispatch,e))return!0}}return!1}}const Mc=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function Oc(e,t){let{$cursor:r}=e.selection;return!r||(t?!t.endOfTextblock("backward",e):r.parentOffset>0)?null:r}const Fc=(e,t,r)=>{let n=Oc(e,r);if(!n)return!1;let i=Rc(n);if(!i){let r=n.blockRange(),i=r&&ba(r);return null!=i&&(t&&t(e.tr.lift(r,i).scrollIntoView()),!0)}let s=i.nodeBefore;if(!s.type.spec.isolating&&Kc(e,i,t))return!0;if(0==n.parent.content.size&&(Lc(s,"end")||Wa.isSelectable(s))){let r=Ca(e.doc,n.before(),n.after(),ns.empty);if(r&&r.slice.size<r.to-r.from){if(t){let n=e.tr.step(r);n.setSelection(Lc(s,"end")?ja.findFrom(n.doc.resolve(n.mapping.map(i.pos,-1)),-1):Wa.create(n.doc,i.pos-s.nodeSize)),t(n.scrollIntoView())}return!0}}return!(!s.isAtom||i.depth!=n.depth-1)&&(t&&t(e.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0)};function Lc(e,t,r=!1){for(let n=e;n;n="start"==t?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&1!=n.childCount)return!1}return!1}const _c=(e,t,r)=>{let{$head:n,empty:i}=e.selection,s=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",e):n.parentOffset>0)return!1;s=Rc(n)}let a=s&&s.nodeBefore;return!(!a||!Wa.isSelectable(a))&&(t&&t(e.tr.setSelection(Wa.create(e.doc,s.pos-a.nodeSize)).scrollIntoView()),!0)};function Rc(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function Ic(e,t){let{$cursor:r}=e.selection;return!r||(t?!t.endOfTextblock("forward",e):r.parentOffset<r.parent.content.size)?null:r}const Pc=(e,t,r)=>{let n=Ic(e,r);if(!n)return!1;let i=Uc(n);if(!i)return!1;let s=i.nodeAfter;if(Kc(e,i,t))return!0;if(0==n.parent.content.size&&(Lc(s,"start")||Wa.isSelectable(s))){let r=Ca(e.doc,n.before(),n.after(),ns.empty);if(r&&r.slice.size<r.to-r.from){if(t){let n=e.tr.step(r);n.setSelection(Lc(s,"start")?ja.findFrom(n.doc.resolve(n.mapping.map(i.pos)),1):Wa.create(n.doc,n.mapping.map(i.pos))),t(n.scrollIntoView())}return!0}}return!(!s.isAtom||i.depth!=n.depth-1)&&(t&&t(e.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0)},Bc=(e,t,r)=>{let{$head:n,empty:i}=e.selection,s=n;if(!i)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)return!1;s=Uc(n)}let a=s&&s.nodeAfter;return!(!a||!Wa.isSelectable(a))&&(t&&t(e.tr.setSelection(Wa.create(e.doc,s.pos)).scrollIntoView()),!0)};function Uc(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let r=e.node(t);if(e.index(t)+1<r.childCount)return e.doc.resolve(e.after(t+1));if(r.type.spec.isolating)break}return null}const $c=(e,t)=>{let{$head:r,$anchor:n}=e.selection;return!(!r.parent.type.spec.code||!r.sameParent(n))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function zc(e){for(let t=0;t<e.edgeCount;t++){let{type:r}=e.edge(t);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const jc=(e,t)=>{let{$head:r,$anchor:n}=e.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let i=r.node(-1),s=r.indexAfter(-1),a=zc(i.contentMatchAt(s));if(!a||!i.canReplaceWith(s,s,a))return!1;if(t){let n=r.after(),i=e.tr.replaceWith(n,n,a.createAndFill());i.setSelection(ja.near(i.doc.resolve(n),1)),t(i.scrollIntoView())}return!0},qc=(e,t)=>{let r=e.selection,{$from:n,$to:i}=r;if(r instanceof Ja||n.parent.inlineContent||i.parent.inlineContent)return!1;let s=zc(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(t){let r=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,a=e.tr.insert(r,s.createAndFill());a.setSelection(Ga.create(a.doc,r+1)),t(a.scrollIntoView())}return!0},Hc=(e,t)=>{let{$cursor:r}=e.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let n=r.before();if(Ea(e.doc,n))return t&&t(e.tr.split(n).scrollIntoView()),!0}let n=r.blockRange(),i=n&&ba(n);return null!=i&&(t&&t(e.tr.lift(n,i).scrollIntoView()),!0)};const Vc=(e,t)=>{let{$from:r,$to:n}=e.selection;if(e.selection instanceof Wa&&e.selection.node.isBlock)return!(!r.parentOffset||!Ea(e.doc,r.pos)||(t&&t(e.tr.split(r.pos).scrollIntoView()),0));if(!r.parent.isBlock)return!1;if(t){let i=n.parentOffset==n.parent.content.size,s=e.tr;(e.selection instanceof Ga||e.selection instanceof Ja)&&s.deleteSelection();let a=0==r.depth?null:zc(r.node(-1).contentMatchAt(r.indexAfter(-1))),o=Gc&&Gc(n.parent,i),l=o?[o]:i&&a?[{type:a}]:void 0,u=Ea(s.doc,s.mapping.map(r.pos),1,l);if(l||u||!Ea(s.doc,s.mapping.map(r.pos),1,a?[{type:a}]:void 0)||(a&&(l=[{type:a}]),u=!0),u&&(s.split(s.mapping.map(r.pos),1,l),!i&&!r.parentOffset&&r.parent.type!=a)){let e=s.mapping.map(r.before()),t=s.doc.resolve(e);a&&r.node(-1).canReplaceWith(t.index(),t.index()+1,a)&&s.setNodeMarkup(s.mapping.map(r.before()),a)}t(s.scrollIntoView())}return!0};var Gc;function Kc(e,t,r){let n,i,s=t.nodeBefore,a=t.nodeAfter;if(s.type.spec.isolating||a.type.spec.isolating)return!1;if(function(e,t,r){let n=t.nodeBefore,i=t.nodeAfter,s=t.index();return!(!(n&&i&&n.type.compatibleContent(i.type))||(!n.content.size&&t.parent.canReplace(s-1,s)?(r&&r(e.tr.delete(t.pos-n.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(s,s+1)||!i.isTextblock&&!Da(e.doc,t.pos)||(r&&r(e.tr.clearIncompatible(t.pos,n.type,n.contentMatchAt(n.childCount)).join(t.pos).scrollIntoView()),0)))}(e,t,r))return!0;let o=t.parent.canReplace(t.index(),t.index()+1);if(o&&(n=(i=s.contentMatchAt(s.childCount)).findWrapping(a.type))&&i.matchType(n[0]||a.type).validEnd){if(r){let i=t.pos+a.nodeSize,o=Zi.empty;for(let e=n.length-1;e>=0;e--)o=Zi.from(n[e].create(null,o));o=Zi.from(s.copy(o));let l=e.tr.step(new ga(t.pos-1,i,t.pos,i,new ns(o,1,0),n.length,!0)),u=i+2*n.length;Da(l.doc,u)&&l.join(u),r(l.scrollIntoView())}return!0}let l=ja.findFrom(t,1),u=l&&l.$from.blockRange(l.$to),c=u&&ba(u);if(null!=c&&c>=t.depth)return r&&r(e.tr.lift(u,c).scrollIntoView()),!0;if(o&&Lc(a,"start",!0)&&Lc(s,"end")){let n=s,i=[];for(;i.push(n),!n.isTextblock;)n=n.lastChild;let o=a,l=1;for(;!o.isTextblock;o=o.firstChild)l++;if(n.canReplace(n.childCount,n.childCount,o.content)){if(r){let n=Zi.empty;for(let e=i.length-1;e>=0;e--)n=Zi.from(i[e].copy(n));r(e.tr.step(new ga(t.pos-i.length,t.pos+a.nodeSize,t.pos+l,t.pos+a.nodeSize-l,new ns(n,i.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Wc(e){return function(t,r){let n=t.selection,i=e<0?n.$from:n.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return!!i.node(s).isTextblock&&(r&&r(t.tr.setSelection(Ga.create(t.doc,e<0?i.start(s):i.end(s)))),!0)}}const Yc=Wc(-1),Jc=Wc(1);function Zc(e,t=null){return function(r,n){let i=!1;for(let n=0;n<r.selection.ranges.length&&!i;n++){let{$from:{pos:s},$to:{pos:a}}=r.selection.ranges[n];r.doc.nodesBetween(s,a,((n,s)=>{if(i)return!1;if(n.isTextblock&&!n.hasMarkup(e,t))if(n.type==e)i=!0;else{let t=r.doc.resolve(s),n=t.index();i=t.parent.canReplaceWith(n,n+1,e)}}))}if(!i)return!1;if(n){let i=r.tr;for(let n=0;n<r.selection.ranges.length;n++){let{$from:{pos:s},$to:{pos:a}}=r.selection.ranges[n];i.setBlockType(s,a,e,t)}n(i.scrollIntoView())}return!0}}function Xc(...e){return function(t,r,n){for(let i=0;i<e.length;i++)if(e[i](t,r,n))return!0;return!1}}let Qc=Xc(Mc,Fc,_c),ed=Xc(Mc,Pc,Bc);const td={Enter:Xc($c,qc,Hc,Vc),"Mod-Enter":jc,Backspace:Qc,"Mod-Backspace":Qc,"Shift-Backspace":Qc,Delete:ed,"Mod-Delete":ed,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new Ja(e.doc))),!0)},rd={"Ctrl-h":td.Backspace,"Alt-Backspace":td["Mod-Backspace"],"Ctrl-d":td.Delete,"Ctrl-Alt-Backspace":td["Mod-Delete"],"Alt-Delete":td["Mod-Delete"],"Alt-d":td["Mod-Delete"],"Ctrl-a":Yc,"Ctrl-e":Jc};for(let e in td)rd[e]=td[e];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&os.platform();function nd(e,t=null){return function(r,n){let{$from:i,$to:s}=r.selection,a=i.blockRange(s),o=!1,l=a;if(!a)return!1;if(a.depth>=2&&i.node(a.depth-1).type.compatibleContent(e)&&0==a.startIndex){if(0==i.index(a.depth-1))return!1;let e=r.doc.resolve(a.start-2);l=new ws(e,e,a.depth),a.endIndex<a.parent.childCount&&(a=new ws(i,r.doc.resolve(s.end(a.depth)),a.depth)),o=!0}let u=wa(l,e,t,a);return!!u&&(n&&n(function(e,t,r,n,i){let s=Zi.empty;for(let e=r.length-1;e>=0;e--)s=Zi.from(r[e].type.create(r[e].attrs,s));e.step(new ga(t.start-(n?2:0),t.end,t.start,t.end,new ns(s,0,0),r.length,!0));let a=0;for(let e=0;e<r.length;e++)r[e].type==i&&(a=e+1);let o=r.length-a,l=t.start+r.length-(n?2:0),u=t.parent;for(let r=t.startIndex,n=t.endIndex,i=!0;r<n;r++,i=!1)!i&&Ea(e.doc,l,o)&&(e.split(l,o),l+=2*o),l+=u.child(r).nodeSize;return e}(r.tr,a,u,o,e).scrollIntoView()),!0)}}function id(e){return function(t,r){let{$from:n,$to:i}=t.selection,s=n.blockRange(i,(t=>t.childCount>0&&t.firstChild.type==e));return!!s&&(!r||(n.node(s.depth-1).type==e?function(e,t,r,n){let i=e.tr,s=n.end,a=n.$to.end(n.depth);s<a&&(i.step(new ga(s-1,a,s,a,new ns(Zi.from(r.create(null,n.parent.copy())),1,0),1,!0)),n=new ws(i.doc.resolve(n.$from.pos),i.doc.resolve(a),n.depth));const o=ba(n);if(null==o)return!1;i.lift(n,o);let l=i.mapping.map(s,-1)-1;Da(i.doc,l)&&i.join(l);return t(i.scrollIntoView()),!0}(t,r,e,s):function(e,t,r){let n=e.tr,i=r.parent;for(let e=r.end,t=r.endIndex-1,s=r.startIndex;t>s;t--)e-=i.child(t).nodeSize,n.delete(e-1,e+1);let s=n.doc.resolve(r.start),a=s.nodeAfter;if(n.mapping.map(r.end)!=r.start+s.nodeAfter.nodeSize)return!1;let o=0==r.startIndex,l=r.endIndex==i.childCount,u=s.node(-1),c=s.index(-1);if(!u.canReplace(c+(o?0:1),c+1,a.content.append(l?Zi.empty:Zi.from(i))))return!1;let d=s.pos,h=d+a.nodeSize;return n.step(new ga(d-(o?1:0),h+(l?1:0),d+1,h-1,new ns((o?Zi.empty:Zi.from(i.copy(Zi.empty))).append(l?Zi.empty:Zi.from(i.copy(Zi.empty))),o?0:1,l?0:1),o?0:1)),t(n.scrollIntoView()),!0}(t,r,s)))}}function sd(e){const{state:t,transaction:r}=e;let{selection:n}=r,{doc:i}=r,{storedMarks:s}=r;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),filterTransaction:t.filterTransaction,plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=r.selection,i=r.doc,s=r.storedMarks,r}}}class ad{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:r}=this,{view:n}=t,{tr:i}=r,s=this.buildProps(i);return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,(...e)=>{const r=t(...e)(s);return i.getMeta("preventDispatch")||this.hasCustomState||n.dispatch(i),r}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:r,editor:n,state:i}=this,{view:s}=n,a=[],o=!!e,l=e||i.tr,u={...Object.fromEntries(Object.entries(r).map((([e,r])=>[e,(...e)=>{const n=this.buildProps(l,t),i=r(...e)(n);return a.push(i),u}]))),run:()=>(o||!t||l.getMeta("preventDispatch")||this.hasCustomState||s.dispatch(l),a.every((e=>!0===e)))};return u}createCan(e){const{rawCommands:t,state:r}=this,n=e||r.tr,i=this.buildProps(n,false),s=Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:void 0})])));return{...s,chain:()=>this.createChain(n,false)}}buildProps(e,t=!0){const{rawCommands:r,editor:n,state:i}=this,{view:s}=n;i.storedMarks&&e.setStoredMarks(i.storedMarks);const a={tr:e,editor:n,view:s,state:sd({state:i,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map((([e,t])=>[e,(...e)=>t(...e)(a)])))}};return a}}class od{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const r=this.callbacks[e];return r&&r.forEach((e=>e.apply(this,t))),this}off(e,t){const r=this.callbacks[e];return r&&(t?this.callbacks[e]=r.filter((e=>e!==t)):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function ld(e,t,r){if(void 0===e.config[t]&&e.parent)return ld(e.parent,t,r);if("function"==typeof e.config[t]){return e.config[t].bind({...r,parent:e.parent?ld(e.parent,t,r):null})}return e.config[t]}function ud(e){return{baseExtensions:e.filter((e=>"extension"===e.type)),nodeExtensions:e.filter((e=>"node"===e.type)),markExtensions:e.filter((e=>"mark"===e.type))}}function cd(e){const t=[],{nodeExtensions:r,markExtensions:n}=ud(e),i=[...r,...n],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach((e=>{const r=ld(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage});if(!r)return;r().forEach((e=>{e.types.forEach((r=>{Object.entries(e.attributes).forEach((([e,n])=>{t.push({type:r,name:e,attribute:{...s,...n}})}))}))}))})),i.forEach((e=>{const r={name:e.name,options:e.options,storage:e.storage},n=ld(e,"addAttributes",r);if(!n)return;const i=n();Object.entries(i).forEach((([r,n])=>{const i={...s,...n};(null==n?void 0:n.isRequired)&&void 0===(null==n?void 0:n.default)&&delete i.default,t.push({type:e.name,name:r,attribute:i})}))})),t}function dd(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function hd(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const r={...e};return Object.entries(t).forEach((([e,t])=>{r[e]?r[e]="class"===e?[r[e],t].join(" "):"style"===e?[r[e],t].join("; "):t:r[e]=t})),r}),{})}function fd(e,t){return t.filter((e=>e.attribute.rendered)).map((t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]})).reduce(((e,t)=>hd(e,t)),{})}function pd(e){return"function"==typeof e}function md(e,t=void 0,...r){return pd(e)?t?e.bind(t)(...r):e(...r):e}function gd(e,t){return e.style?e:{...e,getAttrs:r=>{const n=e.getAttrs?e.getAttrs(r):e.attrs;if(!1===n)return!1;const i=t.reduce(((e,t)=>{const n=t.attribute.parseHTML?t.attribute.parseHTML(r):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(r.getAttribute(t.name));return null==n?e:{...e,[t.name]:n}}),{});return{...n,...i}}}}function yd(e){return Object.fromEntries(Object.entries(e).filter((([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t)))}function vd(e){var t;const r=cd(e),{nodeExtensions:n,markExtensions:i}=ud(e),s=null===(t=n.find((e=>ld(e,"topNode"))))||void 0===t?void 0:t.name,a=Object.fromEntries(n.map((t=>{const n=r.filter((e=>e.type===t.name)),i={name:t.name,options:t.options,storage:t.storage},s=e.reduce(((e,r)=>{const n=ld(r,"extendNodeSchema",i);return{...e,...n?n(t):{}}}),{}),a=yd({...s,content:md(ld(t,"content",i)),marks:md(ld(t,"marks",i)),group:md(ld(t,"group",i)),inline:md(ld(t,"inline",i)),atom:md(ld(t,"atom",i)),selectable:md(ld(t,"selectable",i)),draggable:md(ld(t,"draggable",i)),code:md(ld(t,"code",i)),defining:md(ld(t,"defining",i)),isolating:md(ld(t,"isolating",i)),attrs:Object.fromEntries(n.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),o=md(ld(t,"parseHTML",i));o&&(a.parseDOM=o.map((e=>gd(e,n))));const l=ld(t,"renderHTML",i);l&&(a.toDOM=e=>l({node:e,HTMLAttributes:fd(e,n)}));const u=ld(t,"renderText",i);return u&&(a.toText=u),[t.name,a]}))),o=Object.fromEntries(i.map((t=>{const n=r.filter((e=>e.type===t.name)),i={name:t.name,options:t.options,storage:t.storage},s=e.reduce(((e,r)=>{const n=ld(r,"extendMarkSchema",i);return{...e,...n?n(t):{}}}),{}),a=yd({...s,inclusive:md(ld(t,"inclusive",i)),excludes:md(ld(t,"excludes",i)),group:md(ld(t,"group",i)),spanning:md(ld(t,"spanning",i)),code:md(ld(t,"code",i)),attrs:Object.fromEntries(n.map((e=>{var t;return[e.name,{default:null===(t=null==e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),o=md(ld(t,"parseHTML",i));o&&(a.parseDOM=o.map((e=>gd(e,n))));const l=ld(t,"renderHTML",i);return l&&(a.toDOM=e=>l({mark:e,HTMLAttributes:fd(e,n)})),[t.name,a]})));return new $s({topNode:s,nodes:a,marks:o})}function bd(e,t){return t.nodes[e]||t.marks[e]||null}function wd(e,t){return Array.isArray(t)?t.some((t=>("string"==typeof t?t:t.name)===e.name)):t}const xd=(e,t=500)=>{let r="";const n=e.parentOffset;return e.parent.nodesBetween(Math.max(0,n-t),n,((e,t,i,s)=>{var a,o;const l=(null===(o=(a=e.type.spec).toText)||void 0===o?void 0:o.call(a,{node:e,pos:t,parent:i,index:s}))||e.textContent||"%leaf%";r+=l.slice(0,Math.max(0,n-t))})),r};function Ed(e){return"[object RegExp]"===Object.prototype.toString.call(e)}class Dd{constructor(e){this.find=e.find,this.handler=e.handler}}const Sd=(e,t)=>{if(Ed(t))return t.exec(e);const r=t(e);if(!r)return null;const n=[r.text];return n.index=r.index,n.input=e,n.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(r.replaceWith)),n};function Ad(e){var t;const{editor:r,from:n,to:i,text:s,rules:a,plugin:o}=e,{view:l}=r;if(l.composing)return!1;const u=l.state.doc.resolve(n);if(u.parent.type.spec.code||(null===(t=u.nodeBefore||u.nodeAfter)||void 0===t?void 0:t.marks.find((e=>e.type.spec.code))))return!1;let c=!1;const d=xd(u)+s;return a.forEach((e=>{if(c)return;const t=Sd(d,e.find);if(!t)return;const a=l.state.tr,u=sd({state:l.state,transaction:a}),h={from:n-(t[0].length-s.length),to:i},{commands:f,chain:p,can:m}=new ad({editor:r,state:u});null!==e.handler({state:u,range:h,match:t,commands:f,chain:p,can:m})&&a.steps.length&&(a.setMeta(o,{transform:a,from:n,to:i,text:s}),l.dispatch(a),c=!0)})),c}function Td(e){const{editor:t,rules:r}=e,n=new oo({state:{init:()=>null,apply(e,t){const r=e.getMeta(n);return r||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput:(e,i,s,a)=>Ad({editor:t,from:i,to:s,text:a,rules:r,plugin:n}),handleDOMEvents:{compositionend:e=>(setTimeout((()=>{const{$cursor:i}=e.state.selection;i&&Ad({editor:t,from:i.pos,to:i.pos,text:"",rules:r,plugin:n})})),!1)},handleKeyDown(e,i){if("Enter"!==i.key)return!1;const{$cursor:s}=e.state.selection;return!!s&&Ad({editor:t,from:s.pos,to:s.pos,text:"\n",rules:r,plugin:n})}},isInputRules:!0});return n}class Cd{constructor(e){this.find=e.find,this.handler=e.handler}}const Nd=(e,t)=>{if(Ed(t))return[...e.matchAll(t)];const r=t(e);return r?r.map((t=>{const r=[t.text];return r.index=t.index,r.input=e,r.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),r.push(t.replaceWith)),r})):[]};function kd(e){const{editor:t,rules:r}=e;let n=null,i=!1,s=!1;const a=r.map((e=>new oo({view(e){const t=t=>{var r;n=(null===(r=e.dom.parentElement)||void 0===r?void 0:r.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",t),{destroy(){window.removeEventListener("dragstart",t)}}},props:{handleDOMEvents:{drop:e=>(s=n===e.dom.parentElement,!1),paste:(e,t)=>{var r;const n=null===(r=t.clipboardData)||void 0===r?void 0:r.getData("text/html");return i=!!(null==n?void 0:n.includes("data-pm-slice")),!1}}},appendTransaction:(r,n,a)=>{const o=r[0],l="paste"===o.getMeta("uiEvent")&&!i,u="drop"===o.getMeta("uiEvent")&&!s;if(!l&&!u)return;const c=n.doc.content.findDiffStart(a.doc.content),d=n.doc.content.findDiffEnd(a.doc.content);if("number"!=typeof c||!d||c===d.b)return;const h=a.tr,f=sd({state:a,transaction:h}),p=function(e){const{editor:t,state:r,from:n,to:i,rule:s}=e,{commands:a,chain:o,can:l}=new ad({editor:t,state:r}),u=[];r.doc.nodesBetween(n,i,((e,t)=>{if(!e.isTextblock||e.type.spec.code)return;const c=Math.max(n,t),d=Math.min(i,t+e.content.size),h=e.textBetween(c-t,d-t,void 0,"￼");Nd(h,s.find).forEach((e=>{if(void 0===e.index)return;const t=c+e.index+1,n=t+e[0].length,i={from:r.tr.mapping.map(t),to:r.tr.mapping.map(n)},d=s.handler({state:r,range:i,match:e,commands:a,chain:o,can:l});u.push(d)}))}));const c=u.every((e=>null!==e));return c}({editor:t,state:f,from:Math.max(c-1,0),to:d.b-1,rule:e});return p&&h.steps.length?h:void 0}})));return a}class Md{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=Md.resolve(e),this.schema=vd(this.extensions),this.extensions.forEach((e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:bd(e.name,this.schema)};if("mark"===e.type){(null===(t=md(ld(e,"keepOnSplit",r)))||void 0===t||t)&&this.splittableMarks.push(e.name)}const n=ld(e,"onBeforeCreate",r);n&&this.editor.on("beforeCreate",n);const i=ld(e,"onCreate",r);i&&this.editor.on("create",i);const s=ld(e,"onUpdate",r);s&&this.editor.on("update",s);const a=ld(e,"onSelectionUpdate",r);a&&this.editor.on("selectionUpdate",a);const o=ld(e,"onTransaction",r);o&&this.editor.on("transaction",o);const l=ld(e,"onFocus",r);l&&this.editor.on("focus",l);const u=ld(e,"onBlur",r);u&&this.editor.on("blur",u);const c=ld(e,"onDestroy",r);c&&this.editor.on("destroy",c)}))}static resolve(e){const t=Md.sort(Md.flatten(e)),r=function(e){const t=e.filter(((t,r)=>e.indexOf(t)!==r));return[...new Set(t)]}(t.map((e=>e.name)));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map((e=>`'${e}'`)).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map((e=>{const t=ld(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...this.flatten(t())]:e})).flat(10)}static sort(e){return e.sort(((e,t)=>{const r=ld(e,"priority")||100,n=ld(t,"priority")||100;return r>n?-1:r<n?1:0}))}get commands(){return this.extensions.reduce(((e,t)=>{const r=ld(t,"addCommands",{name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:bd(t.name,this.schema)});return r?{...e,...r()}:e}),{})}get plugins(){const{editor:e}=this,t=Md.sort([...this.extensions].reverse()),r=[],n=[],i=t.map((t=>{const i={name:t.name,options:t.options,storage:t.storage,editor:e,type:bd(t.name,this.schema)},s=[],a=ld(t,"addKeyboardShortcuts",i);let o={};if("mark"===t.type&&t.config.exitable&&(o.ArrowRight=()=>Ah.handleExit({editor:e,mark:t})),a){const t=Object.fromEntries(Object.entries(a()).map((([t,r])=>[t,()=>r({editor:e})])));o={...o,...t}}const l=new oo({props:{handleKeyDown:kc(o)}});s.push(l);const u=ld(t,"addInputRules",i);wd(t,e.options.enableInputRules)&&u&&r.push(...u());const c=ld(t,"addPasteRules",i);wd(t,e.options.enablePasteRules)&&c&&n.push(...c());const d=ld(t,"addProseMirrorPlugins",i);if(d){const e=d();s.push(...e)}return s})).flat();return[Td({editor:e,rules:r}),...kd({editor:e,rules:n}),...i]}get attributes(){return cd(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=ud(this.extensions);return Object.fromEntries(t.filter((e=>!!ld(e,"addNodeView"))).map((t=>{const r=this.attributes.filter((e=>e.type===t.name)),n={name:t.name,options:t.options,storage:t.storage,editor:e,type:dd(t.name,this.schema)},i=ld(t,"addNodeView",n);if(!i)return[];return[t.name,(n,s,a,o)=>{const l=fd(n,r);return i()({editor:e,node:n,getPos:a,decorations:o,HTMLAttributes:l,extension:t})}]})))}}function Od(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Fd(e,t){const r={...e};return Od(e)&&Od(t)&&Object.keys(t).forEach((n=>{Od(t[n])?n in e?r[n]=Fd(e[n],t[n]):Object.assign(r,{[n]:t[n]}):Object.assign(r,{[n]:t[n]})})),r}class Ld{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=md(ld(this,"addOptions",{name:this.name}))),this.storage=md(ld(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ld(e)}configure(e={}){const t=this.extend();return t.options=Fd(this.options,e),t.storage=md(ld(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Ld(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=md(ld(t,"addOptions",{name:t.name})),t.storage=md(ld(t,"addStorage",{name:t.name,options:t.options})),t}}function _d(e,t,r){const{from:n,to:i}=t,{blockSeparator:s="\n\n",textSerializers:a={}}=r||{};let o="",l=!0;return e.nodesBetween(n,i,((e,r,u,c)=>{var d;const h=null==a?void 0:a[e.type.name];h?(e.isBlock&&!l&&(o+=s,l=!0),u&&(o+=h({node:e,pos:r,parent:u,index:c,range:t}))):e.isText?(o+=null===(d=null==e?void 0:e.text)||void 0===d?void 0:d.slice(Math.max(n,r)-r,i-r),l=!1):e.isBlock&&!l&&(o+=s,l=!0)})),o}function Rd(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}const Id=Ld.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new oo({key:new co("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:r}=e,{doc:n,selection:i}=t,{ranges:s}=i,a=Math.min(...s.map((e=>e.$from.pos))),o=Math.max(...s.map((e=>e.$to.pos)));return _d(n,{from:a,to:o},{textSerializers:Rd(r)})}}})]}});function Pd(e,t,r={strict:!0}){const n=Object.keys(t);return!n.length||n.every((n=>r.strict?t[n]===e[n]:Ed(t[n])?t[n].test(e[n]):t[n]===e[n]))}function Bd(e,t,r={}){return e.find((e=>e.type===t&&Pd(e.attrs,r)))}function Ud(e,t,r={}){return!!Bd(e,t,r)}function $d(e,t,r={}){if(!e||!t)return;let n=e.parent.childAfter(e.parentOffset);if(e.parentOffset===n.offset&&0!==n.offset&&(n=e.parent.childBefore(e.parentOffset)),!n.node)return;const i=Bd([...n.node.marks],t,r);if(!i)return;let s=n.index,a=e.start()+n.offset,o=s+1,l=a+n.node.nodeSize;for(Bd([...n.node.marks],t,r);s>0&&i.isInSet(e.parent.child(s-1).marks);)s-=1,a-=e.parent.child(s).nodeSize;for(;o<e.parent.childCount&&Ud([...e.parent.child(o).marks],t,r);)l+=e.parent.child(o).nodeSize,o+=1;return{from:a,to:l}}function zd(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}function jd(e){return e instanceof Ga}function qd(e=0,t=0,r=0){return Math.min(Math.max(e,t),r)}function Hd(e,t=null){if(!t)return null;const r=ja.atStart(e),n=ja.atEnd(e);if("start"===t||!0===t)return r;if("end"===t)return n;const i=r.from,s=n.to;return"all"===t?Ga.create(e,qd(0,i,s),qd(e.content.size,i,s)):Ga.create(e,qd(t,i,s),qd(t,i,s))}function Vd(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Gd(e){const t=`<body>${e}</body>`;return(new window.DOMParser).parseFromString(t,"text/html").body}function Kd(e,t,r){if(r={slice:!0,parseOptions:{},...r},"object"==typeof e&&null!==e)try{return Array.isArray(e)?Zi.fromArray(e.map((e=>t.nodeFromJSON(e)))):t.nodeFromJSON(e)}catch(n){return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",n),Kd("",t,r)}if("string"==typeof e){const n=js.fromSchema(t);return r.slice?n.parseSlice(Gd(e),r.parseOptions).content:n.parse(Gd(e),r.parseOptions)}return Kd("",t,r)}function Wd(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function Yd(e,t,r={}){const{from:n,to:i,empty:s}=e.selection,a=t?dd(t,e.schema):null,o=[];e.doc.nodesBetween(n,i,((e,t)=>{if(e.isText)return;const r=Math.max(n,t),s=Math.min(i,t+e.nodeSize);o.push({node:e,from:r,to:s})}));const l=i-n,u=o.filter((e=>!a||a.name===e.node.type.name)).filter((e=>Pd(e.node.attrs,r,{strict:!1})));if(s)return!!u.length;const c=u.reduce(((e,t)=>e+t.to-t.from),0);return c>=l}function Jd(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function Zd(e,t){const r="string"==typeof t?[t]:t;return Object.keys(e).reduce(((t,n)=>(r.includes(n)||(t[n]=e[n]),t)),{})}function Xd(e,t,r={}){return Kd(e,t,{slice:!1,parseOptions:r})}function Qd(e){return t=>function(e,t){for(let r=e.depth;r>0;r-=1){const n=e.node(r);if(t(n))return{pos:r>0?e.before(r):0,start:e.start(r),depth:r,node:n}}}(t.$from,e)}function eh(e,t){const r=Xs.fromSchema(t).serializeFragment(e),n=document.implementation.createHTMLDocument().createElement("div");return n.appendChild(r),n.innerHTML}function th(e,t){return _d(e,{from:0,to:e.content.size},t)}function rh(e,t){const r=zd(t,e.schema),{from:n,to:i,empty:s}=e.selection,a=[];s?(e.storedMarks&&a.push(...e.storedMarks),a.push(...e.selection.$head.marks())):e.doc.nodesBetween(n,i,(e=>{a.push(...e.marks)}));const o=a.find((e=>e.type.name===r.name));return o?{...o.attrs}:{}}function nh(e,t){const r=Jd("string"==typeof t?t:t.name,e.schema);return"node"===r?function(e,t){const r=dd(t,e.schema),{from:n,to:i}=e.selection,s=[];e.doc.nodesBetween(n,i,(e=>{s.push(e)}));const a=s.reverse().find((e=>e.type.name===r.name));return a?{...a.attrs}:{}}(e,t):"mark"===r?rh(e,t):{}}function ih(e){const t=function(e,t=JSON.stringify){const r={};return e.filter((e=>{const n=t(e);return!Object.prototype.hasOwnProperty.call(r,n)&&(r[n]=!0)}))}(e);return 1===t.length?t:t.filter(((e,r)=>{const n=t.filter(((e,t)=>t!==r));return!n.some((t=>e.oldRange.from>=t.oldRange.from&&e.oldRange.to<=t.oldRange.to&&e.newRange.from>=t.newRange.from&&e.newRange.to<=t.newRange.to))}))}function sh(e,t,r){const n=[];return e===t?r.resolve(e).marks().forEach((t=>{const i=$d(r.resolve(e-1),t.type);i&&n.push({mark:t,...i})})):r.nodesBetween(e,t,((e,t)=>{n.push(...e.marks.map((r=>({from:t,to:t+e.nodeSize,mark:r}))))})),n}function ah(e,t,r={}){const{empty:n,ranges:i}=e.selection,s=t?zd(t,e.schema):null;if(n)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!s||s.name===e.type.name)).find((e=>Pd(e.attrs,r,{strict:!1})));let a=0;const o=[];if(i.forEach((({$from:t,$to:r})=>{const n=t.pos,i=r.pos;e.doc.nodesBetween(n,i,((e,t)=>{if(!e.isText&&!e.marks.length)return;const r=Math.max(n,t),s=Math.min(i,t+e.nodeSize);a+=s-r,o.push(...e.marks.map((e=>({mark:e,from:r,to:s}))))}))})),0===a)return!1;const l=o.filter((e=>!s||s.name===e.mark.type.name)).filter((e=>Pd(e.mark.attrs,r,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),u=o.filter((e=>!s||e.mark.type!==s&&e.mark.type.excludes(s))).reduce(((e,t)=>e+t.to-t.from),0);return(l>0?l+u:l)>=a}function oh(e,t){const{nodeExtensions:r}=ud(t),n=r.find((t=>t.name===e));if(!n)return!1;const i=md(ld(n,"group",{name:n.name,options:n.options,storage:n.storage}));return"string"==typeof i&&i.split(" ").includes("list")}function lh(e,t,r){return Object.fromEntries(Object.entries(r).filter((([r])=>{const n=e.find((e=>e.type===t&&e.name===r));return!!n&&n.attribute.keepOnSplit})))}function uh(e,t){const r=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(r){const n=r.filter((e=>null==t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(n)}}const ch=(e,t)=>{const r=Qd((e=>e.type===t))(e.selection);if(!r)return!0;const n=e.doc.resolve(Math.max(0,r.pos-1)).before(r.depth);if(void 0===n)return!0;const i=e.doc.nodeAt(n);return r.node.type!==(null==i?void 0:i.type)||!Da(e.doc,r.pos)||(e.join(r.pos),!0)},dh=(e,t)=>{const r=Qd((e=>e.type===t))(e.selection);if(!r)return!0;const n=e.doc.resolve(r.start).after(r.depth);if(void 0===n)return!0;const i=e.doc.nodeAt(n);return r.node.type!==(null==i?void 0:i.type)||!Da(e.doc,n)||(e.join(n),!0)};var hh=Object.freeze({__proto__:null,blur:()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var r;e.isDestroyed||(t.dom.blur(),null===(r=null===window||void 0===window?void 0:window.getSelection())||void 0===r||r.removeAllRanges())})),!0),clearContent:(e=!1)=>({commands:t})=>t.setContent("",e),clearNodes:()=>({state:e,tr:t,dispatch:r})=>{const{selection:n}=t,{ranges:i}=n;return!r||(i.forEach((({$from:r,$to:n})=>{e.doc.nodesBetween(r.pos,n.pos,((e,r)=>{if(e.type.isText)return;const{doc:n,mapping:i}=t,s=n.resolve(i.map(r)),a=n.resolve(i.map(r+e.nodeSize)),o=s.blockRange(a);if(!o)return;const l=ba(o);if(e.type.isTextblock){const{defaultType:e}=s.parent.contentMatchAt(s.index());t.setNodeMarkup(o.start,e)}(l||0===l)&&t.lift(o,l)}))})),!0)},command:e=>t=>e(t),createParagraphNear:()=>({state:e,dispatch:t})=>qc(e,t),deleteCurrentNode:()=>({tr:e,dispatch:t})=>{const{selection:r}=e,n=r.$anchor.node();if(n.content.size>0)return!1;const i=e.selection.$anchor;for(let r=i.depth;r>0;r-=1){if(i.node(r).type===n.type){if(t){const t=i.before(r),n=i.after(r);e.delete(t,n).scrollIntoView()}return!0}}return!1},deleteNode:e=>({tr:t,state:r,dispatch:n})=>{const i=dd(e,r.schema),s=t.selection.$anchor;for(let e=s.depth;e>0;e-=1){if(s.node(e).type===i){if(n){const r=s.before(e),n=s.after(e);t.delete(r,n).scrollIntoView()}return!0}}return!1},deleteRange:e=>({tr:t,dispatch:r})=>{const{from:n,to:i}=e;return r&&t.delete(n,i),!0},deleteSelection:()=>({state:e,dispatch:t})=>Mc(e,t),enter:()=>({commands:e})=>e.keyboardShortcut("Enter"),exitCode:()=>({state:e,dispatch:t})=>jc(e,t),extendMarkRange:(e,t={})=>({tr:r,state:n,dispatch:i})=>{const s=zd(e,n.schema),{doc:a,selection:o}=r,{$from:l,from:u,to:c}=o;if(i){const e=$d(l,s,t);if(e&&e.from<=u&&e.to>=c){const t=Ga.create(a,e.from,e.to);r.setSelection(t)}}return!0},first:e=>t=>{const r="function"==typeof e?e(t):e;for(let e=0;e<r.length;e+=1)if(r[e](t))return!0;return!1},focus:(e=null,t={})=>({editor:r,view:n,tr:i,dispatch:s})=>{t={scrollIntoView:!0,...t};const a=()=>{Vd()&&n.dom.focus(),requestAnimationFrame((()=>{r.isDestroyed||(n.focus(),(null==t?void 0:t.scrollIntoView)&&r.commands.scrollIntoView())}))};if(n.hasFocus()&&null===e||!1===e)return!0;if(s&&null===e&&!jd(r.state.selection))return a(),!0;const o=Hd(i.doc,e)||r.state.selection,l=r.state.selection.eq(o);return s&&(l||i.setSelection(o),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),a()),!0},forEach:(e,t)=>r=>e.every(((e,n)=>t(e,{...r,index:n}))),insertContent:(e,t)=>({tr:r,commands:n})=>n.insertContentAt({from:r.selection.from,to:r.selection.to},e,t),insertContentAt:(e,t,r)=>({tr:n,dispatch:i,editor:s})=>{if(i){r={parseOptions:{},updateSelection:!0,...r};const i=Kd(t,s.schema,{parseOptions:{preserveWhitespace:"full",...r.parseOptions}});if("<>"===i.toString())return!0;let{from:a,to:o}="number"==typeof e?{from:e,to:e}:e,l=!0,u=!0;if((i.toString().startsWith("<")?i:[i]).forEach((e=>{e.check(),l=!!l&&(e.isText&&0===e.marks.length),u=!!u&&e.isBlock})),a===o&&u){const{parent:e}=n.doc.resolve(a);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(a-=1,o+=1)}l?n.insertText(t,a,o):n.replaceWith(a,o,i),r.updateSelection&&function(e,t,r){const n=e.steps.length-1;if(n<t)return;const i=e.steps[n];if(!(i instanceof ma||i instanceof ga))return;const s=e.mapping.maps[n];let a=0;s.forEach(((e,t,r,n)=>{0===a&&(a=n)})),e.setSelection(ja.near(e.doc.resolve(a),r))}(n,n.steps.length-1,-1)}return!0},joinUp:()=>({state:e,dispatch:t})=>((e,t)=>{let r,n=e.selection,i=n instanceof Wa;if(i){if(n.node.isTextblock||!Da(e.doc,n.from))return!1;r=n.from}else if(r=Aa(e.doc,n.from,-1),null==r)return!1;if(t){let n=e.tr.join(r);i&&n.setSelection(Wa.create(n.doc,r-e.doc.resolve(r).nodeBefore.nodeSize)),t(n.scrollIntoView())}return!0})(e,t),joinDown:()=>({state:e,dispatch:t})=>((e,t)=>{let r,n=e.selection;if(n instanceof Wa){if(n.node.isTextblock||!Da(e.doc,n.to))return!1;r=n.to}else if(r=Aa(e.doc,n.to,1),null==r)return!1;return t&&t(e.tr.join(r).scrollIntoView()),!0})(e,t),joinBackward:()=>({state:e,dispatch:t})=>Fc(e,t),joinForward:()=>({state:e,dispatch:t})=>Pc(e,t),keyboardShortcut:e=>({editor:t,view:r,tr:n,dispatch:i})=>{const s=function(e){const t=e.split(/-(?!$)/);let r,n,i,s,a=t[t.length-1];"Space"===a&&(a=" ");for(let e=0;e<t.length-1;e+=1){const a=t[e];if(/^(cmd|meta|m)$/i.test(a))s=!0;else if(/^a(lt)?$/i.test(a))r=!0;else if(/^(c|ctrl|control)$/i.test(a))n=!0;else if(/^s(hift)?$/i.test(a))i=!0;else{if(!/^mod$/i.test(a))throw new Error(`Unrecognized modifier name: ${a}`);Vd()||Wd()?s=!0:n=!0}}return r&&(a=`Alt-${a}`),n&&(a=`Ctrl-${a}`),s&&(a=`Meta-${a}`),i&&(a=`Shift-${a}`),a}(e).split(/-(?!$)/),a=s.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),o=new KeyboardEvent("keydown",{key:"Space"===a?" ":a,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction((()=>{r.someProp("handleKeyDown",(e=>e(r,o)))}));return null==l||l.steps.forEach((e=>{const t=e.map(n.mapping);t&&i&&n.maybeStep(t)})),!0},lift:(e,t={})=>({state:r,dispatch:n})=>!!Yd(r,dd(e,r.schema),t)&&((e,t)=>{let{$from:r,$to:n}=e.selection,i=r.blockRange(n),s=i&&ba(i);return null!=s&&(t&&t(e.tr.lift(i,s).scrollIntoView()),!0)})(r,n),liftEmptyBlock:()=>({state:e,dispatch:t})=>Hc(e,t),liftListItem:e=>({state:t,dispatch:r})=>id(dd(e,t.schema))(t,r),newlineInCode:()=>({state:e,dispatch:t})=>$c(e,t),resetAttributes:(e,t)=>({tr:r,state:n,dispatch:i})=>{let s=null,a=null;const o=Jd("string"==typeof e?e:e.name,n.schema);return!!o&&("node"===o&&(s=dd(e,n.schema)),"mark"===o&&(a=zd(e,n.schema)),i&&r.selection.ranges.forEach((e=>{n.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,n)=>{s&&s===e.type&&r.setNodeMarkup(n,void 0,Zd(e.attrs,t)),a&&e.marks.length&&e.marks.forEach((i=>{a===i.type&&r.addMark(n,n+e.nodeSize,a.create(Zd(i.attrs,t)))}))}))})),!0)},scrollIntoView:()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),selectAll:()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),selectNodeBackward:()=>({state:e,dispatch:t})=>_c(e,t),selectNodeForward:()=>({state:e,dispatch:t})=>Bc(e,t),selectParentNode:()=>({state:e,dispatch:t})=>((e,t)=>{let r,{$from:n,to:i}=e.selection,s=n.sharedDepth(i);return 0!=s&&(r=n.before(s),t&&t(e.tr.setSelection(Wa.create(e.doc,r))),!0)})(e,t),selectTextblockEnd:()=>({state:e,dispatch:t})=>Jc(e,t),selectTextblockStart:()=>({state:e,dispatch:t})=>Yc(e,t),setContent:(e,t=!1,r={})=>({tr:n,editor:i,dispatch:s})=>{const{doc:a}=n,o=Xd(e,i.schema,r);return s&&n.replaceWith(0,a.content.size,o).setMeta("preventUpdate",!t),!0},setMark:(e,t={})=>({tr:r,state:n,dispatch:i})=>{const{selection:s}=r,{empty:a,ranges:o}=s,l=zd(e,n.schema);if(i)if(a){const e=rh(n,l);r.addStoredMark(l.create({...e,...t}))}else o.forEach((e=>{const i=e.$from.pos,s=e.$to.pos;n.doc.nodesBetween(i,s,((e,n)=>{const a=Math.max(n,i),o=Math.min(n+e.nodeSize,s);e.marks.find((e=>e.type===l))?e.marks.forEach((e=>{l===e.type&&r.addMark(a,o,l.create({...e.attrs,...t}))})):r.addMark(a,o,l.create(t))}))}));return function(e,t,r){var n;const{selection:i}=t;let s=null;if(jd(i)&&(s=i.$cursor),s){const t=null!==(n=e.storedMarks)&&void 0!==n?n:s.marks();return!!r.isInSet(t)||!t.some((e=>e.type.excludes(r)))}const{ranges:a}=i;return a.some((({$from:t,$to:n})=>{let i=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(r);return e.doc.nodesBetween(t.pos,n.pos,((e,t,n)=>{if(i)return!1;if(e.isInline){const t=!n||n.type.allowsMarkType(r),s=!!r.isInSet(e.marks)||!e.marks.some((e=>e.type.excludes(r)));i=t&&s}return!i})),i}))}(n,r,l)},setMeta:(e,t)=>({tr:r})=>(r.setMeta(e,t),!0),setNode:(e,t={})=>({state:r,dispatch:n,chain:i})=>{const s=dd(e,r.schema);return s.isTextblock?i().command((({commands:e})=>!!Zc(s,t)(r)||e.clearNodes())).command((({state:e})=>Zc(s,t)(e,n))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection:e=>({tr:t,dispatch:r})=>{if(r){const{doc:r}=t,n=qd(e,0,r.content.size),i=Wa.create(r,n);t.setSelection(i)}return!0},setTextSelection:e=>({tr:t,dispatch:r})=>{if(r){const{doc:r}=t,{from:n,to:i}="number"==typeof e?{from:e,to:e}:e,s=Ga.atStart(r).from,a=Ga.atEnd(r).to,o=qd(n,s,a),l=qd(i,s,a),u=Ga.create(r,o,l);t.setSelection(u)}return!0},sinkListItem:e=>({state:t,dispatch:r})=>{const n=dd(e,t.schema);return(i=n,function(e,t){let{$from:r,$to:n}=e.selection,s=r.blockRange(n,(e=>e.childCount>0&&e.firstChild.type==i));if(!s)return!1;let a=s.startIndex;if(0==a)return!1;let o=s.parent,l=o.child(a-1);if(l.type!=i)return!1;if(t){let r=l.lastChild&&l.lastChild.type==o.type,n=Zi.from(r?i.create():null),a=new ns(Zi.from(i.create(null,Zi.from(o.type.create(null,n)))),r?3:1,0),u=s.start,c=s.end;t(e.tr.step(new ga(u-(r?3:1),c,u,c,a,1,!0)).scrollIntoView())}return!0})(t,r);var i},splitBlock:({keepMarks:e=!0}={})=>({tr:t,state:r,dispatch:n,editor:i})=>{const{selection:s,doc:a}=t,{$from:o,$to:l}=s,u=lh(i.extensionManager.attributes,o.node().type.name,o.node().attrs);if(s instanceof Wa&&s.node.isBlock)return!(!o.parentOffset||!Ea(a,o.pos))&&(n&&(e&&uh(r,i.extensionManager.splittableMarks),t.split(o.pos).scrollIntoView()),!0);if(!o.parent.isBlock)return!1;if(n){const n=l.parentOffset===l.parent.content.size;s instanceof Ga&&t.deleteSelection();const a=0===o.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:r}=e.edge(t);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}(o.node(-1).contentMatchAt(o.indexAfter(-1)));let c=n&&a?[{type:a,attrs:u}]:void 0,d=Ea(t.doc,t.mapping.map(o.pos),1,c);if(c||d||!Ea(t.doc,t.mapping.map(o.pos),1,a?[{type:a}]:void 0)||(d=!0,c=a?[{type:a,attrs:u}]:void 0),d&&(t.split(t.mapping.map(o.pos),1,c),a&&!n&&!o.parentOffset&&o.parent.type!==a)){const e=t.mapping.map(o.before()),r=t.doc.resolve(e);o.node(-1).canReplaceWith(r.index(),r.index()+1,a)&&t.setNodeMarkup(t.mapping.map(o.before()),a)}e&&uh(r,i.extensionManager.splittableMarks),t.scrollIntoView()}return!0},splitListItem:e=>({tr:t,state:r,dispatch:n,editor:i})=>{var s;const a=dd(e,r.schema),{$from:o,$to:l}=r.selection,u=r.selection.node;if(u&&u.isBlock||o.depth<2||!o.sameParent(l))return!1;const c=o.node(-1);if(c.type!==a)return!1;const d=i.extensionManager.attributes;if(0===o.parent.content.size&&o.node(-1).childCount===o.indexAfter(-1)){if(2===o.depth||o.node(-3).type!==a||o.index(-2)!==o.node(-2).childCount-1)return!1;if(n){let e=Zi.empty;const r=o.index(-1)?1:o.index(-2)?2:3;for(let t=o.depth-r;t>=o.depth-3;t-=1)e=Zi.from(o.node(t).copy(e));const n=o.indexAfter(-1)<o.node(-2).childCount?1:o.indexAfter(-2)<o.node(-3).childCount?2:3,i=lh(d,o.node().type.name,o.node().attrs),l=(null===(s=a.contentMatch.defaultType)||void 0===s?void 0:s.createAndFill(i))||void 0;e=e.append(Zi.from(a.createAndFill(null,l)||void 0));const u=o.before(o.depth-(r-1));t.replace(u,o.after(-n),new ns(e,4-r,0));let c=-1;t.doc.nodesBetween(u,t.doc.content.size,((e,t)=>{if(c>-1)return!1;e.isTextblock&&0===e.content.size&&(c=t+1)})),c>-1&&t.setSelection(Ga.near(t.doc.resolve(c))),t.scrollIntoView()}return!0}const h=l.pos===o.end()?c.contentMatchAt(0).defaultType:null,f=lh(d,c.type.name,c.attrs),p=lh(d,o.node().type.name,o.node().attrs);t.delete(o.pos,l.pos);const m=h?[{type:a,attrs:f},{type:h,attrs:p}]:[{type:a,attrs:f}];return!!Ea(t.doc,o.pos,2)&&(n&&t.split(o.pos,2,m).scrollIntoView(),!0)},toggleList:(e,t)=>({editor:r,tr:n,state:i,dispatch:s,chain:a,commands:o,can:l})=>{const{extensions:u}=r.extensionManager,c=dd(e,i.schema),d=dd(t,i.schema),{selection:h}=i,{$from:f,$to:p}=h,m=f.blockRange(p);if(!m)return!1;const g=Qd((e=>oh(e.type.name,u)))(h);if(m.depth>=1&&g&&m.depth-g.depth<=1){if(g.node.type===c)return o.liftListItem(d);if(oh(g.node.type.name,u)&&c.validContent(g.node.content)&&s)return a().command((()=>(n.setNodeMarkup(g.pos,c),!0))).command((()=>ch(n,c))).command((()=>dh(n,c))).run()}return a().command((()=>!!l().wrapInList(c)||o.clearNodes())).wrapInList(c).command((()=>ch(n,c))).command((()=>dh(n,c))).run()},toggleMark:(e,t={},r={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=r,a=zd(e,n.schema);return ah(n,a,t)?i.unsetMark(a,{extendEmptyMarkRange:s}):i.setMark(a,t)},toggleNode:(e,t,r={})=>({state:n,commands:i})=>{const s=dd(e,n.schema),a=dd(t,n.schema);return Yd(n,s,r)?i.setNode(a):i.setNode(s,r)},toggleWrap:(e,t={})=>({state:r,commands:n})=>{const i=dd(e,r.schema);return Yd(r,i,t)?n.lift(i):n.wrapIn(i,t)},undoInputRule:()=>({state:e,dispatch:t})=>{const r=e.plugins;for(let n=0;n<r.length;n+=1){const i=r[n];let s;if(i.spec.isInputRules&&(s=i.getState(e))){if(t){const t=e.tr,r=s.transform;for(let e=r.steps.length-1;e>=0;e-=1)t.step(r.steps[e].invert(r.docs[e]));if(s.text){const r=t.doc.resolve(s.from).marks();t.replaceWith(s.from,s.to,e.schema.text(s.text,r))}else t.delete(s.from,s.to)}return!0}}return!1},unsetAllMarks:()=>({tr:e,dispatch:t})=>{const{selection:r}=e,{empty:n,ranges:i}=r;return n||t&&i.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0},unsetMark:(e,t={})=>({tr:r,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:a=!1}=t,{selection:o}=r,l=zd(e,n.schema),{$from:u,empty:c,ranges:d}=o;if(!i)return!0;if(c&&a){let{from:e,to:t}=o;const n=null===(s=u.marks().find((e=>e.type===l)))||void 0===s?void 0:s.attrs,i=$d(u,l,n);i&&(e=i.from,t=i.to),r.removeMark(e,t,l)}else d.forEach((e=>{r.removeMark(e.$from.pos,e.$to.pos,l)}));return r.removeStoredMark(l),!0},updateAttributes:(e,t={})=>({tr:r,state:n,dispatch:i})=>{let s=null,a=null;const o=Jd("string"==typeof e?e:e.name,n.schema);return!!o&&("node"===o&&(s=dd(e,n.schema)),"mark"===o&&(a=zd(e,n.schema)),i&&r.selection.ranges.forEach((e=>{const i=e.$from.pos,o=e.$to.pos;n.doc.nodesBetween(i,o,((e,n)=>{s&&s===e.type&&r.setNodeMarkup(n,void 0,{...e.attrs,...t}),a&&e.marks.length&&e.marks.forEach((s=>{if(a===s.type){const l=Math.max(n,i),u=Math.min(n+e.nodeSize,o);r.addMark(l,u,a.create({...s.attrs,...t}))}}))}))})),!0)},wrapIn:(e,t={})=>({state:r,dispatch:n})=>function(e,t=null){return function(r,n){let{$from:i,$to:s}=r.selection,a=i.blockRange(s),o=a&&wa(a,e,t);return!!o&&(n&&n(r.tr.wrap(a,o).scrollIntoView()),!0)}}(dd(e,r.schema),t)(r,n),wrapInList:(e,t={})=>({state:r,dispatch:n})=>nd(dd(e,r.schema),t)(r,n)});const fh=Ld.create({name:"commands",addCommands:()=>({...hh})}),ph=Ld.create({name:"editable",addProseMirrorPlugins(){return[new oo({key:new co("editable"),props:{editable:()=>this.editor.options.editable}})]}}),mh=Ld.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new oo({key:new co("focusEvents"),props:{handleDOMEvents:{focus:(t,r)=>{e.isFocused=!0;const n=e.state.tr.setMeta("focus",{event:r}).setMeta("addToHistory",!1);return t.dispatch(n),!1},blur:(t,r)=>{e.isFocused=!1;const n=e.state.tr.setMeta("blur",{event:r}).setMeta("addToHistory",!1);return t.dispatch(n),!1}}}})]}}),gh=Ld.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:r,doc:n}=t,{empty:i,$anchor:s}=r,{pos:a,parent:o}=s,l=ja.atStart(n).from===a;return!(!(i&&l&&o.type.isTextblock)||o.textContent.length)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()])),r={Enter:()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},n={...r},i={...r,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Vd()||Wd()?i:n},addProseMirrorPlugins(){return[new oo({key:new co("clearDocument"),appendTransaction:(e,t,r)=>{if(!(e.some((e=>e.docChanged))&&!t.doc.eq(r.doc)))return;const{empty:n,from:i,to:s}=t.selection,a=ja.atStart(t.doc).from,o=ja.atEnd(t.doc).to,l=i===a&&s===o,u=0===r.doc.textBetween(0,r.doc.content.size," "," ").length;if(n||!l||!u)return;const c=r.tr,d=sd({state:r,transaction:c}),{commands:h}=new ad({editor:this.editor,state:d});return h.clearNodes(),c.steps.length?c:void 0}})]}}),yh=Ld.create({name:"tabindex",addProseMirrorPlugins(){return[new oo({key:new co("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var vh=Object.freeze({__proto__:null,ClipboardTextSerializer:Id,Commands:fh,Editable:ph,FocusEvents:mh,Keymap:gh,Tabindex:yh});class bh extends od{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(e,t){const r=document.querySelector("style[data-tiptap-style]");if(null!==r)return r;const n=document.createElement("style");return t&&n.setAttribute("nonce",t),n.setAttribute("data-tiptap-style",""),n.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(n),n}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 1px !important;\n  height: 1px !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const r=pd(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],n=this.state.reconfigure({plugins:r});this.view.updateState(n)}unregisterPlugin(e){if(this.isDestroyed)return;const t="string"==typeof e?`${e}$`:e.key,r=this.state.reconfigure({plugins:this.state.plugins.filter((e=>!e.key.startsWith(t)))});this.view.updateState(r)}createExtensionManager(){const e=[...this.options.enableCoreExtensions?Object.values(vh):[],...this.options.extensions].filter((e=>["extension","node","mark"].includes(null==e?void 0:e.type)));this.extensionManager=new Md(e,this)}createCommandManager(){this.commandManager=new ad({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=Xd(this.options.content,this.schema,this.options.parseOptions),t=Hd(e,this.options.autofocus);this.view=new hc(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:so.create({doc:e,selection:t||void 0})});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews();this.view.dom.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach((e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)})):void(this.capturedTransaction=e);const t=this.state.apply(e),r=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const n=e.getMeta("focus"),i=e.getMeta("blur");n&&this.emit("focus",{editor:this,event:n.event,transaction:e}),i&&this.emit("blur",{editor:this,event:i.event,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return nh(this.state,e)}isActive(e,t){const r="string"==typeof e?e:null,n="string"==typeof e?t:e;return function(e,t,r={}){if(!t)return Yd(e,null,r)||ah(e,null,r);const n=Jd(t,e.schema);return"node"===n?Yd(e,t,r):"mark"===n&&ah(e,t,r)}(this.state,r,n)}getJSON(){return this.state.doc.toJSON()}getHTML(){return eh(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:r={}}=e||{};return th(this.state.doc,{blockSeparator:t,textSerializers:{...r,...Rd(this.schema)}})}get isEmpty(){return function(e){var t;const r=null===(t=e.type.createAndFill())||void 0===t?void 0:t.toJSON(),n=e.toJSON();return JSON.stringify(r)===JSON.stringify(n)}(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}}function wh(e){return new Dd({find:e.find,handler:({state:t,range:r,match:n})=>{const i=md(e.getAttributes,void 0,n);if(!1===i||null===i)return null;const{tr:s}=t,a=n[n.length-1],o=n[0];let l=r.to;if(a){const n=o.search(/\S/),u=r.from+o.indexOf(a),c=u+a.length;if(sh(r.from,r.to,t.doc).filter((t=>t.mark.type.excluded.find((r=>r===e.type&&r!==t.mark.type)))).filter((e=>e.to>u)).length)return null;c<r.to&&s.delete(c,r.to),u>r.from&&s.delete(r.from+n,u),l=r.from+n+a.length,s.addMark(r.from+n,l,e.type.create(i||{})),s.removeStoredMark(e.type)}}})}function xh(e){return new Dd({find:e.find,handler:({state:t,range:r,match:n})=>{const i=md(e.getAttributes,void 0,n)||{},{tr:s}=t,a=r.from;let o=r.to;if(n[1]){let t=a+n[0].lastIndexOf(n[1]);t>o?t=o:o=t+n[1].length;const r=n[0][n[0].length-1];s.insertText(r,a+n[0].length-1),s.replaceWith(t,o,e.type.create(i))}else n[0]&&s.replaceWith(a,o,e.type.create(i))}})}function Eh(e){return new Dd({find:e.find,handler:({state:t,range:r,match:n})=>{const i=t.doc.resolve(r.from),s=md(e.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),e.type))return null;t.tr.delete(r.from,r.to).setBlockType(r.from,r.from,e.type,s)}})}function Dh(e){return new Dd({find:e.find,handler:({state:t,range:r,match:n})=>{let i=e.replace,s=r.from;const a=r.to;if(n[1]){const e=n[0].lastIndexOf(n[1]);i+=n[0].slice(e+n[1].length),s+=e;const t=s-a;t>0&&(i=n[0].slice(e-t,e)+i,s=a)}t.tr.insertText(i,s,a)}})}function Sh(e){return new Dd({find:e.find,handler:({state:t,range:r,match:n})=>{const i=md(e.getAttributes,void 0,n)||{},s=t.tr.delete(r.from,r.to),a=s.doc.resolve(r.from).blockRange(),o=a&&wa(a,e.type,i);if(!o)return null;s.wrap(a,o);const l=s.doc.resolve(r.from-1).nodeBefore;l&&l.type===e.type&&Da(s.doc,r.from-1)&&(!e.joinPredicate||e.joinPredicate(n,l))&&s.join(r.from-1)}})}class Ah{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=md(ld(this,"addOptions",{name:this.name}))),this.storage=md(ld(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ah(e)}configure(e={}){const t=this.extend();return t.options=Fd(this.options,e),t.storage=md(ld(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Ah(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=md(ld(t,"addOptions",{name:t.name})),t.storage=md(ld(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:r}=e.state,n=e.state.selection.$from;if(n.pos===n.end()){const i=n.marks();if(!!!i.find((e=>(null==e?void 0:e.type.name)===t.name)))return!1;const s=i.find((e=>(null==e?void 0:e.type.name)===t.name));return s&&r.removeStoredMark(s),r.insertText(" ",n.pos),e.view.dispatch(r),!0}return!1}}class Th{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=md(ld(this,"addOptions",{name:this.name}))),this.storage=md(ld(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Th(e)}configure(e={}){const t=this.extend();return t.options=Fd(this.options,e),t.storage=md(ld(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Th(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=md(ld(t,"addOptions",{name:t.name})),t.storage=md(ld(t,"addStorage",{name:t.name,options:t.options})),t}}function Ch(e){return new Cd({find:e.find,handler:({state:t,range:r,match:n})=>{const i=md(e.getAttributes,void 0,n);if(!1===i||null===i)return null;const{tr:s}=t,a=n[n.length-1],o=n[0];let l=r.to;if(a){const n=o.search(/\S/),u=r.from+o.indexOf(a),c=u+a.length;if(sh(r.from,r.to,t.doc).filter((t=>t.mark.type.excluded.find((r=>r===e.type&&r!==t.mark.type)))).filter((e=>e.to>u)).length)return null;c<r.to&&s.delete(c,r.to),u>r.from&&s.delete(r.from+n,u),l=r.from+n+a.length,s.addMark(r.from+n,l,e.type.create(i||{})),s.removeStoredMark(e.type)}}})}const Nh=/^\s*>\s$/,kh=Th.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return["blockquote",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Sh({find:Nh,type:this.type})]}}),Mh=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,Oh=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,Fh=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,Lh=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,_h=Ah.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],renderHTML({HTMLAttributes:e}){return["strong",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[wh({find:Mh,type:this.type}),wh({find:Fh,type:this.type})]},addPasteRules(){return[Ch({find:Oh,type:this.type}),Ch({find:Lh,type:this.type})]}}),Rh=/^\s*([-+*])\s$/,Ih=Th.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Sh({find:Rh,type:this.type})]}}),Ph=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,Bh=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,Uh=Ah.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[wh({find:Ph,type:this.type})]},addPasteRules(){return[Ch({find:Bh,type:this.type})]}}),$h=/^```([a-z]+)?[\s\n]$/,zh=/^~~~([a-z]+)?[\s\n]$/,jh=Th.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;const{languageClassPrefix:r}=this.options,n=[...(null===(t=e.firstElementChild)||void 0===t?void 0:t.classList)||[]].filter((e=>e.startsWith(r))).map((e=>e.replace(r,"")))[0];return n||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",hd(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,r=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&(!(!r&&t.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:r}=t,{$from:n,empty:i}=r;if(!i||n.parent.type!==this.type)return!1;const s=n.parentOffset===n.parent.nodeSize-2,a=n.parent.textContent.endsWith("\n\n");return!(!s||!a)&&e.chain().command((({tr:e})=>(e.delete(n.pos-2,n.pos),!0))).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:r,doc:n}=t,{$from:i,empty:s}=r;if(!s||i.parent.type!==this.type)return!1;if(!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();if(void 0===a)return!1;return!n.nodeAt(a)&&e.commands.exitCode()}}},addInputRules(){return[Eh({find:$h,type:this.type,getAttributes:e=>({language:e[1]})}),Eh({find:zh,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new oo({key:new co("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const r=t.clipboardData.getData("text/plain"),n=t.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,s=null==i?void 0:i.mode;if(!r||!s)return!1;const{tr:a}=e.state;return a.replaceSelectionWith(this.type.create({language:s})),a.setSelection(Ga.near(a.doc.resolve(Math.max(0,a.selection.from-2)))),a.insertText(r.replace(/\r\n?/g,"\n")),a.setMeta("paste",!0),e.dispatch(a),!0}}})]}}),qh=Th.create({name:"doc",topNode:!0,content:"block+"});function Hh(e={}){return new oo({view:t=>new Vh(t,e)})}class Vh{constructor(e,t){this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=t.width||1,this.color=t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let r=e=>{this[t](e)};return e.dom.addEventListener(t,r),{name:t,handler:r}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),r=!t.parent.inlineContent;if(r){let r=t.nodeBefore,n=t.nodeAfter;if(r||n){let t=this.editorView.nodeDOM(this.cursorPos-(r?r.nodeSize:0));if(t){let i=t.getBoundingClientRect(),s=r?i.bottom:i.top;r&&n&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:i.left,right:i.right,top:s-this.width/2,bottom:s+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let n,i,s=this.editorView.dom.offsetParent;if(this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r),!s||s==document.body&&"static"==getComputedStyle(s).position)n=-pageXOffset,i=-pageYOffset;else{let e=s.getBoundingClientRect();n=e.left-s.scrollLeft,i=e.top-s.scrollTop}this.element.style.left=e.left-n+"px",this.element.style.top=e.top-i+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),n=r&&r.type.spec.disableDropCursor,i="function"==typeof n?n(this.editorView,t,e):n;if(t&&!i){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(e=Ta(this.editorView.state.doc,e,this.editorView.dragging.slice),null==e))return this.setCursor(null);this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Gh=Ld.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[Hh(this.options)]}});class Kh extends ja{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return Kh.valid(r)?new Kh(r):ja.near(r)}content(){return ns.empty}eq(e){return e instanceof Kh&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new Kh(e.resolve(t.pos))}getBookmark(){return new Wh(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let r=e.index(t),n=e.node(t);if(0!=r)for(let e=n.child(r-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(n.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let r=e.indexAfter(t),n=e.node(t);if(r!=n.childCount)for(let e=n.child(r);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(n.type.spec.isolating)return!0}return!0}(e))return!1;let r=t.type.spec.allowGapCursor;if(null!=r)return r;let n=t.contentMatchAt(e.index()).defaultType;return n&&n.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&Kh.valid(e))return e;let n=e.pos,i=null;for(let r=e.depth;;r--){let s=e.node(r);if(t>0?e.indexAfter(r)<s.childCount:e.index(r)>0){i=s.child(t>0?e.indexAfter(r):e.index(r)-1);break}if(0==r)return null;n+=t;let a=e.doc.resolve(n);if(Kh.valid(a))return a}for(;;){let s=t>0?i.firstChild:i.lastChild;if(!s){if(i.isAtom&&!i.isText&&!Wa.isSelectable(i)){e=e.doc.resolve(n+i.nodeSize*t),r=!1;continue e}break}i=s,n+=t;let a=e.doc.resolve(n);if(Kh.valid(a))return a}return null}}}Kh.prototype.visible=!1,Kh.findFrom=Kh.findGapCursorFrom,ja.jsonID("gapcursor",Kh);class Wh{constructor(e){this.pos=e}map(e){return new Wh(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Kh.valid(t)?new Kh(t):ja.near(t)}}const Yh=kc({ArrowLeft:Jh("horiz",-1),ArrowRight:Jh("horiz",1),ArrowUp:Jh("vert",-1),ArrowDown:Jh("vert",1)});function Jh(e,t){const r="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,n,i){let s=e.selection,a=t>0?s.$to:s.$from,o=s.empty;if(s instanceof Ga){if(!i.endOfTextblock(r)||0==a.depth)return!1;o=!1,a=e.doc.resolve(t>0?a.after():a.before())}let l=Kh.findGapCursorFrom(a,t,o);return!!l&&(n&&n(e.tr.setSelection(new Kh(l))),!0)}}function Zh(e,t,r){if(!e||!e.editable)return!1;let n=e.state.doc.resolve(t);if(!Kh.valid(n))return!1;let i=e.posAtCoords({left:r.clientX,top:r.clientY});return!(i&&i.inside>-1&&Wa.isSelectable(e.state.doc.nodeAt(i.inside)))&&(e.dispatch(e.state.tr.setSelection(new Kh(n))),!0)}function Xh(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof Kh))return!1;let{$from:r}=e.state.selection,n=r.parent.contentMatchAt(r.index()).findWrapping(e.state.schema.nodes.text);if(!n)return!1;let i=Zi.empty;for(let e=n.length-1;e>=0;e--)i=Zi.from(n[e].createAndFill(null,i));let s=e.state.tr.replace(r.pos,r.pos,new ns(i,0,0));return s.setSelection(Ga.near(s.doc.resolve(r.pos+1))),e.dispatch(s),!1}function Qh(e){if(!(e.selection instanceof Kh))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",Vu.create(e.doc,[ju.widget(e.selection.head,t,{key:"gapcursor"})])}const ef=Ld.create({name:"gapCursor",addProseMirrorPlugins:()=>[new oo({props:{decorations:Qh,createSelectionBetween:(e,t,r)=>t.pos==r.pos&&Kh.valid(r)?new Kh(r):null,handleClick:Zh,handleKeyDown:Yh,handleDOMEvents:{beforeinput:Xh}}})],extendNodeSchema(e){var t;return{allowGapCursor:null!==(t=md(ld(e,"allowGapCursor",{name:e.name,options:e.options,storage:e.storage})))&&void 0!==t?t:null}}}),tf=Th.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",hd(this.options.HTMLAttributes,e)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:r,editor:n})=>e.first([()=>e.exitCode(),()=>e.command((()=>{const{selection:e,storedMarks:i}=r;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:a}=n.extensionManager,o=i||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{if(t&&o&&s){const t=o.filter((e=>a.includes(e.type.name)));e.ensureMarks(t)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),rf=Th.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map((e=>({tag:`h${e}`,attrs:{level:e}})))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,hd(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce(((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})})),{})},addInputRules(){return this.options.levels.map((e=>Eh({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}})))}});var nf=200,sf=function(){};sf.prototype.append=function(e){return e.length?(e=sf.from(e),!this.length&&e||e.length<nf&&this.leafAppend(e)||this.length<nf&&e.leafPrepend(this)||this.appendInner(e)):this},sf.prototype.prepend=function(e){return e.length?sf.from(e).append(this):this},sf.prototype.appendInner=function(e){return new of(this,e)},sf.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?sf.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},sf.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},sf.prototype.forEach=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)},sf.prototype.map=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=this.length);var n=[];return this.forEach((function(t,r){return n.push(e(t,r))}),t,r),n},sf.from=function(e){return e instanceof sf?e:e&&e.length?new af(e):sf.empty};var af=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,r){return 0==e&&r==this.length?this:new t(this.values.slice(e,r))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,r,n){for(var i=t;i<r;i++)if(!1===e(this.values[i],n+i))return!1},t.prototype.forEachInvertedInner=function(e,t,r,n){for(var i=t-1;i>=r;i--)if(!1===e(this.values[i],n+i))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=nf)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=nf)return new t(e.flatten().concat(this.values))},r.length.get=function(){return this.values.length},r.depth.get=function(){return 0},Object.defineProperties(t.prototype,r),t}(sf);sf.empty=new af([]);var of=function(e){function t(t,r){e.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,r,n){var i=this.left.length;return!(t<i&&!1===this.left.forEachInner(e,t,Math.min(r,i),n))&&(!(r>i&&!1===this.right.forEachInner(e,Math.max(t-i,0),Math.min(this.length,r)-i,n+i))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,r,n){var i=this.left.length;return!(t>i&&!1===this.right.forEachInvertedInner(e,t-i,Math.max(r,i)-i,n+i))&&(!(r<i&&!1===this.left.forEachInvertedInner(e,Math.min(t,i),r,n))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var r=this.left.length;return t<=r?this.left.slice(e,t):e>=r?this.right.slice(e-r,t-r):this.left.slice(e,r).append(this.right.slice(0,t-r))},t.prototype.leafAppend=function(e){var r=this.right.leafAppend(e);if(r)return new t(this.left,r)},t.prototype.leafPrepend=function(e){var r=this.left.leafPrepend(e);if(r)return new t(r,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(sf);const lf=sf;class uf{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let r,n,i=this.items.length;for(;;i--){if(this.items.get(i-1).selection){--i;break}}t&&(r=this.remapping(i,this.items.length),n=r.maps.length);let s,a,o=e.tr,l=[],u=[];return this.items.forEach(((e,t)=>{if(!e.step)return r||(r=this.remapping(i,t+1),n=r.maps.length),n--,void u.push(e);if(r){u.push(new cf(e.map));let t,i=e.step.map(r.slice(n));i&&o.maybeStep(i).doc&&(t=o.mapping.maps[o.mapping.maps.length-1],l.push(new cf(t,void 0,void 0,l.length+u.length))),n--,t&&r.appendMap(t,n)}else o.maybeStep(e.step);return e.selection?(s=r?e.selection.map(r.slice(n)):e.selection,a=new uf(this.items.slice(0,i).append(u.reverse().concat(l)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:a,transform:o,selection:s}}addTransform(e,t,r,n){let i=[],s=this.eventCount,a=this.items,o=!n&&a.length?a.get(a.length-1):null;for(let r=0;r<e.steps.length;r++){let l,u=e.steps[r].invert(e.docs[r]),c=new cf(e.mapping.maps[r],u,t);(l=o&&o.merge(c))&&(c=l,r?i.pop():a=a.slice(0,a.length-1)),i.push(c),t&&(s++,t=void 0),n||(o=c)}let l=s-r.depth;return l>hf&&(a=function(e,t){let r;return e.forEach(((e,n)=>{if(e.selection&&0==t--)return r=n,!1})),e.slice(r)}(a,l),s-=l),new uf(a.append(i),s)}remapping(e,t){let r=new aa;return this.items.forEach(((t,n)=>{let i=null!=t.mirrorOffset&&n-t.mirrorOffset>=e?r.maps.length-t.mirrorOffset:void 0;r.appendMap(t.map,i)}),e,t),r}addMaps(e){return 0==this.eventCount?this:new uf(this.items.append(e.map((e=>new cf(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],n=Math.max(0,this.items.length-t),i=e.mapping,s=e.steps.length,a=this.eventCount;this.items.forEach((e=>{e.selection&&a--}),n);let o=t;this.items.forEach((t=>{let n=i.getMirror(--o);if(null==n)return;s=Math.min(s,n);let l=i.maps[n];if(t.step){let s=e.steps[n].invert(e.docs[n]),u=t.selection&&t.selection.map(i.slice(o+1,n));u&&a++,r.push(new cf(l,s,u))}else r.push(new cf(l))}),n);let l=[];for(let e=t;e<s;e++)l.push(new cf(i.maps[e]));let u=this.items.slice(0,n).append(l).append(r),c=new uf(u,a);return c.emptyItemCount()>500&&(c=c.compress(this.items.length-r.length)),c}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,n=[],i=0;return this.items.forEach(((s,a)=>{if(a>=e)n.push(s),s.selection&&i++;else if(s.step){let e=s.step.map(t.slice(r)),a=e&&e.getMap();if(r--,a&&t.appendMap(a,r),e){let o=s.selection&&s.selection.map(t.slice(r));o&&i++;let l,u=new cf(a.invert(),e,o),c=n.length-1;(l=n.length&&n[c].merge(u))?n[c]=l:n.push(u)}}else s.map&&r--}),this.items.length,0),new uf(lf.from(n.reverse()),i)}}uf.empty=new uf(lf.empty,0);class cf{constructor(e,t,r,n){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=n}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new cf(t.getMap().invert(),t,this.selection)}}}class df{constructor(e,t,r,n){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=n}}const hf=20;function ff(e){let t=[];return e.forEach(((e,r,n,i)=>t.push(n,i))),t}function pf(e,t){if(!e)return null;let r=[];for(let n=0;n<e.length;n+=2){let i=t.map(e[n],1),s=t.map(e[n+1],-1);i<=s&&r.push(i,s)}return r}function mf(e,t,r,n){let i=vf(t),s=bf.get(t).spec.config,a=(n?e.undone:e.done).popEvent(t,i);if(!a)return;let o=a.selection.resolve(a.transform.doc),l=(n?e.done:e.undone).addTransform(a.transform,t.selection.getBookmark(),s,i),u=new df(n?l:a.remaining,n?a.remaining:l,null,0);r(a.transform.setSelection(o).setMeta(bf,{redo:n,historyState:u}).scrollIntoView())}let gf=!1,yf=null;function vf(e){let t=e.plugins;if(yf!=t){gf=!1,yf=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){gf=!0;break}}return gf}const bf=new co("history"),wf=new co("closeHistory");function xf(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new oo({key:bf,state:{init:()=>new df(uf.empty,uf.empty,null,0),apply:(t,r,n)=>function(e,t,r,n){let i,s=r.getMeta(bf);if(s)return s.historyState;r.getMeta(wf)&&(e=new df(e.done,e.undone,null,0));let a=r.getMeta("appendedTransaction");if(0==r.steps.length)return e;if(a&&a.getMeta(bf))return a.getMeta(bf).redo?new df(e.done.addTransform(r,void 0,n,vf(t)),e.undone,ff(r.mapping.maps[r.steps.length-1]),e.prevTime):new df(e.done,e.undone.addTransform(r,void 0,n,vf(t)),null,e.prevTime);if(!1===r.getMeta("addToHistory")||a&&!1===a.getMeta("addToHistory"))return(i=r.getMeta("rebased"))?new df(e.done.rebased(r,i),e.undone.rebased(r,i),pf(e.prevRanges,r.mapping),e.prevTime):new df(e.done.addMaps(r.mapping.maps),e.undone.addMaps(r.mapping.maps),pf(e.prevRanges,r.mapping),e.prevTime);{let i=0==e.prevTime||!a&&(e.prevTime<(r.time||0)-n.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let r=!1;return e.mapping.maps[0].forEach(((e,n)=>{for(let i=0;i<t.length;i+=2)e<=t[i+1]&&n>=t[i]&&(r=!0)})),r}(r,e.prevRanges)),s=a?pf(e.prevRanges,r.mapping):ff(r.mapping.maps[r.steps.length-1]);return new df(e.done.addTransform(r,i?t.selection.getBookmark():void 0,n,vf(t)),uf.empty,s,r.time)}}(r,n,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,n="historyUndo"==r?Ef:"historyRedo"==r?Df:null;return!!n&&(t.preventDefault(),n(e.state,e.dispatch))}}}})}const Ef=(e,t)=>{let r=bf.getState(e);return!(!r||0==r.done.eventCount)&&(t&&mf(r,e,t,!1),!0)},Df=(e,t)=>{let r=bf.getState(e);return!(!r||0==r.undone.eventCount)&&(t&&mf(r,e,t,!0),!0)};const Sf=Ld.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>Ef(e,t),redo:()=>({state:e,dispatch:t})=>Df(e,t)}),addProseMirrorPlugins(){return[xf(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Af=Th.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",hd(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e})=>e().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{var r;if(t){const{$to:t}=e.selection,n=t.end();if(t.nodeAfter)e.setSelection(Ga.create(e.doc,t.pos));else{const i=null===(r=t.parent.type.contentMatch.defaultType)||void 0===r?void 0:r.create();i&&(e.insert(n,i),e.setSelection(Ga.create(e.doc,n)))}e.scrollIntoView()}return!0})).run()}},addInputRules(){return[xh({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),Tf=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,Cf=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,Nf=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,kf=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,Mf=Ah.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=italic"}],renderHTML({HTMLAttributes:e}){return["em",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[wh({find:Tf,type:this.type}),wh({find:Nf,type:this.type})]},addPasteRules(){return[Ch({find:Cf,type:this.type}),Ch({find:kf,type:this.type})]}}),Of=Th.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",hd(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Ff=/^(\d+)\.\s$/,Lf=Th.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){const{start:t,...r}=e;return 1===t?["ol",hd(this.options.HTMLAttributes,r),0]:["ol",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Sh({find:Ff,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]})]}}),_f=Th.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Rf=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,If=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,Pf=Ah.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[wh({find:Rf,type:this.type})]},addPasteRules(){return[Ch({find:If,type:this.type})]}}),Bf=Th.create({name:"text",group:"inline"}),Uf=Ld.create({name:"starterKit",addExtensions(){var e,t,r,n,i,s,a,o,l,u,c,d,h,f,p,m,g,y;const v=[];return!1!==this.options.blockquote&&v.push(kh.configure(null===(e=this.options)||void 0===e?void 0:e.blockquote)),!1!==this.options.bold&&v.push(_h.configure(null===(t=this.options)||void 0===t?void 0:t.bold)),!1!==this.options.bulletList&&v.push(Ih.configure(null===(r=this.options)||void 0===r?void 0:r.bulletList)),!1!==this.options.code&&v.push(Uh.configure(null===(n=this.options)||void 0===n?void 0:n.code)),!1!==this.options.codeBlock&&v.push(jh.configure(null===(i=this.options)||void 0===i?void 0:i.codeBlock)),!1!==this.options.document&&v.push(qh.configure(null===(s=this.options)||void 0===s?void 0:s.document)),!1!==this.options.dropcursor&&v.push(Gh.configure(null===(a=this.options)||void 0===a?void 0:a.dropcursor)),!1!==this.options.gapcursor&&v.push(ef.configure(null===(o=this.options)||void 0===o?void 0:o.gapcursor)),!1!==this.options.hardBreak&&v.push(tf.configure(null===(l=this.options)||void 0===l?void 0:l.hardBreak)),!1!==this.options.heading&&v.push(rf.configure(null===(u=this.options)||void 0===u?void 0:u.heading)),!1!==this.options.history&&v.push(Sf.configure(null===(c=this.options)||void 0===c?void 0:c.history)),!1!==this.options.horizontalRule&&v.push(Af.configure(null===(d=this.options)||void 0===d?void 0:d.horizontalRule)),!1!==this.options.italic&&v.push(Mf.configure(null===(h=this.options)||void 0===h?void 0:h.italic)),!1!==this.options.listItem&&v.push(Of.configure(null===(f=this.options)||void 0===f?void 0:f.listItem)),!1!==this.options.orderedList&&v.push(Lf.configure(null===(p=this.options)||void 0===p?void 0:p.orderedList)),!1!==this.options.paragraph&&v.push(_f.configure(null===(m=this.options)||void 0===m?void 0:m.paragraph)),!1!==this.options.strike&&v.push(Pf.configure(null===(g=this.options)||void 0===g?void 0:g.strike)),!1!==this.options.text&&v.push(Bf.configure(null===(y=this.options)||void 0===y?void 0:y.text)),v}}),$f=Ld.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new oo({props:{decorations:({doc:e,selection:t})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=t,i=[];if(!r)return null;const s=e.type.createAndFill(),a=(null==s?void 0:s.sameMarkup(e))&&null===s.content.findDiffStart(e.content);return e.descendants(((e,t)=>{const r=n>=t&&n<=t+e.nodeSize,s=!e.isLeaf&&!e.childCount;if((r||!this.options.showOnlyCurrent)&&s){const n=[this.options.emptyNodeClass];a&&n.push(this.options.emptyEditorClass);const s=ju.node(t,t+e.nodeSize,{class:n.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:e,pos:t,hasAnchor:r}):this.options.placeholder});i.push(s)}return this.options.includeChildren})),Vu.create(e,i)}}})]}});function zf(e){this.j={},this.jr=[],this.jd=null,this.t=e}zf.prototype={accepts:function(){return!!this.t},tt:function(e,t){if(t&&t.j)return this.j[e]=t,t;var r=t,n=this.j[e];if(n)return r&&(n.t=r),n;n=jf();var i=Gf(this,e);return i?(Object.assign(n.j,i.j),n.jr.append(i.jr),n.jr=i.jd,n.t=r||i.t):n.t=r,this.j[e]=n,n}};var jf=function(){return new zf},qf=function(e){return new zf(e)},Hf=function(e,t,r){e.j[t]||(e.j[t]=r)},Vf=function(e,t,r){e.jr.push([t,r])},Gf=function(e,t){var r=e.j[t];if(r)return r;for(var n=0;n<e.jr.length;n++){var i=e.jr[n][0],s=e.jr[n][1];if(i.test(t))return s}return e.jd},Kf=function(e,t,r){for(var n=0;n<t.length;n++)Hf(e,t[n],r)},Wf=function(e,t){for(var r=0;r<t.length;r++){var n=t[r][0],i=t[r][1];Hf(e,n,i)}},Yf=function(e,t,r,n){for(var i,s=0,a=t.length;s<a&&(i=e.j[t[s]]);)e=i,s++;if(s>=a)return[];for(;s<a-1;)i=n(),Hf(e,t[s],i),e=i,s++;Hf(e,t[a-1],r)},Jf="DOMAIN",Zf="LOCALHOST",Xf="TLD",Qf="NUM",ep="PROTOCOL",tp="MAILTO",rp="WS",np="NL",ip="OPENBRACE",sp="OPENBRACKET",ap="OPENANGLEBRACKET",op="OPENPAREN",lp="CLOSEBRACE",cp="CLOSEBRACKET",dp="CLOSEANGLEBRACKET",hp="CLOSEPAREN",fp="AMPERSAND",pp="APOSTROPHE",mp="ASTERISK",gp="AT",yp="BACKSLASH",vp="BACKTICK",bp="CARET",wp="COLON",xp="COMMA",Ep="DOLLAR",Dp="DOT",Sp="EQUALS",Ap="EXCLAMATION",Tp="HYPHEN",Cp="PERCENT",Np="PIPE",kp="PLUS",Mp="POUND",Op="QUERY",Fp="QUOTE",Lp="SEMI",_p="SLASH",Rp="TILDE",Ip="UNDERSCORE",Pp="SYM",Bp=Object.freeze({__proto__:null,DOMAIN:Jf,LOCALHOST:Zf,TLD:Xf,NUM:Qf,PROTOCOL:ep,MAILTO:tp,WS:rp,NL:np,OPENBRACE:ip,OPENBRACKET:sp,OPENANGLEBRACKET:ap,OPENPAREN:op,CLOSEBRACE:lp,CLOSEBRACKET:cp,CLOSEANGLEBRACKET:dp,CLOSEPAREN:hp,AMPERSAND:fp,APOSTROPHE:pp,ASTERISK:mp,AT:gp,BACKSLASH:yp,BACKTICK:vp,CARET:bp,COLON:wp,COMMA:xp,DOLLAR:Ep,DOT:Dp,EQUALS:Sp,EXCLAMATION:Ap,HYPHEN:Tp,PERCENT:Cp,PIPE:Np,PLUS:kp,POUND:Mp,QUERY:Op,QUOTE:Fp,SEMI:Lp,SLASH:_p,TILDE:Rp,UNDERSCORE:Ip,SYM:Pp}),Up="aaa aarp abarth abb abbott abbvie abc able abogado abudhabi ac academy accenture accountant accountants aco actor ad adac ads adult ae aeg aero aetna af afamilycompany afl africa ag agakhan agency ai aig airbus airforce airtel akdn al alfaromeo alibaba alipay allfinanz allstate ally alsace alstom am amazon americanexpress americanfamily amex amfam amica amsterdam analytics android anquan anz ao aol apartments app apple aq aquarelle ar arab aramco archi army arpa art arte as asda asia associates at athleta attorney au auction audi audible audio auspost author auto autos avianca aw aws ax axa az azure ba baby baidu banamex bananarepublic band bank bar barcelona barclaycard barclays barefoot bargains baseball basketball bauhaus bayern bb bbc bbt bbva bcg bcn bd be beats beauty beer bentley berlin best bestbuy bet bf bg bh bharti bi bible bid bike bing bingo bio biz bj black blackfriday blockbuster blog bloomberg blue bm bms bmw bn bnpparibas bo boats boehringer bofa bom bond boo book booking bosch bostik boston bot boutique box br bradesco bridgestone broadway broker brother brussels bs bt budapest bugatti build builders business buy buzz bv bw by bz bzh ca cab cafe cal call calvinklein cam camera camp cancerresearch canon capetown capital capitalone car caravan cards care career careers cars casa case cash casino cat catering catholic cba cbn cbre cbs cc cd center ceo cern cf cfa cfd cg ch chanel channel charity chase chat cheap chintai christmas chrome church ci cipriani circle cisco citadel citi citic city cityeats ck cl claims cleaning click clinic clinique clothing cloud club clubmed cm cn co coach codes coffee college cologne com comcast commbank community company compare computer comsec condos construction consulting contact contractors cooking cookingchannel cool coop corsica country coupon coupons courses cpa cr credit creditcard creditunion cricket crown crs cruise cruises csc cu cuisinella cv cw cx cy cymru cyou cz dabur dad dance data date dating datsun day dclk dds de deal dealer deals degree delivery dell deloitte delta democrat dental dentist desi design dev dhl diamonds diet digital direct directory discount discover dish diy dj dk dm dnp do docs doctor dog domains dot download drive dtv dubai duck dunlop dupont durban dvag dvr dz earth eat ec eco edeka edu education ee eg email emerck energy engineer engineering enterprises epson equipment er ericsson erni es esq estate et etisalat eu eurovision eus events exchange expert exposed express extraspace fage fail fairwinds faith family fan fans farm farmers fashion fast fedex feedback ferrari ferrero fi fiat fidelity fido film final finance financial fire firestone firmdale fish fishing fit fitness fj fk flickr flights flir florist flowers fly fm fo foo food foodnetwork football ford forex forsale forum foundation fox fr free fresenius frl frogans frontdoor frontier ftr fujitsu fujixerox fun fund furniture futbol fyi ga gal gallery gallo gallup game games gap garden gay gb gbiz gd gdn ge gea gent genting george gf gg ggee gh gi gift gifts gives giving gl glade glass gle global globo gm gmail gmbh gmo gmx gn godaddy gold goldpoint golf goo goodyear goog google gop got gov gp gq gr grainger graphics gratis green gripe grocery group gs gt gu guardian gucci guge guide guitars guru gw gy hair hamburg hangout haus hbo hdfc hdfcbank health healthcare help helsinki here hermes hgtv hiphop hisamitsu hitachi hiv hk hkt hm hn hockey holdings holiday homedepot homegoods homes homesense honda horse hospital host hosting hot hoteles hotels hotmail house how hr hsbc ht hu hughes hyatt hyundai ibm icbc ice icu id ie ieee ifm ikano il im imamat imdb immo immobilien in inc industries infiniti info ing ink institute insurance insure int international intuit investments io ipiranga iq ir irish is ismaili ist istanbul it itau itv iveco jaguar java jcb je jeep jetzt jewelry jio jll jm jmp jnj jo jobs joburg jot joy jp jpmorgan jprs juegos juniper kaufen kddi ke kerryhotels kerrylogistics kerryproperties kfh kg kh ki kia kim kinder kindle kitchen kiwi km kn koeln komatsu kosher kp kpmg kpn kr krd kred kuokgroup kw ky kyoto kz la lacaixa lamborghini lamer lancaster lancia land landrover lanxess lasalle lat latino latrobe law lawyer lb lc lds lease leclerc lefrak legal lego lexus lgbt li lidl life lifeinsurance lifestyle lighting like lilly limited limo lincoln linde link lipsy live living lixil lk llc llp loan loans locker locus loft lol london lotte lotto love lpl lplfinancial lr ls lt ltd ltda lu lundbeck luxe luxury lv ly ma macys madrid maif maison makeup man management mango map market marketing markets marriott marshalls maserati mattel mba mc mckinsey md me med media meet melbourne meme memorial men menu merckmsd mg mh miami microsoft mil mini mint mit mitsubishi mk ml mlb mls mm mma mn mo mobi mobile moda moe moi mom monash money monster mormon mortgage moscow moto motorcycles mov movie mp mq mr ms msd mt mtn mtr mu museum mutual mv mw mx my mz na nab nagoya name nationwide natura navy nba nc ne nec net netbank netflix network neustar new news next nextdirect nexus nf nfl ng ngo nhk ni nico nike nikon ninja nissan nissay nl no nokia northwesternmutual norton now nowruz nowtv np nr nra nrw ntt nu nyc nz obi observer off office okinawa olayan olayangroup oldnavy ollo om omega one ong onl online onyourside ooo open oracle orange org organic origins osaka otsuka ott ovh pa page panasonic paris pars partners parts party passagens pay pccw pe pet pf pfizer pg ph pharmacy phd philips phone photo photography photos physio pics pictet pictures pid pin ping pink pioneer pizza pk pl place play playstation plumbing plus pm pn pnc pohl poker politie porn post pr pramerica praxi press prime pro prod productions prof progressive promo properties property protection pru prudential ps pt pub pw pwc py qa qpon quebec quest qvc racing radio raid re read realestate realtor realty recipes red redstone redumbrella rehab reise reisen reit reliance ren rent rentals repair report republican rest restaurant review reviews rexroth rich richardli ricoh ril rio rip rmit ro rocher rocks rodeo rogers room rs rsvp ru rugby ruhr run rw rwe ryukyu sa saarland safe safety sakura sale salon samsclub samsung sandvik sandvikcoromant sanofi sap sarl sas save saxo sb sbi sbs sc sca scb schaeffler schmidt scholarships school schule schwarz science scjohnson scot sd se search seat secure security seek select sener services ses seven sew sex sexy sfr sg sh shangrila sharp shaw shell shia shiksha shoes shop shopping shouji show showtime si silk sina singles site sj sk ski skin sky skype sl sling sm smart smile sn sncf so soccer social softbank software sohu solar solutions song sony soy spa space sport spot spreadbetting sr srl ss st stada staples star statebank statefarm stc stcgroup stockholm storage store stream studio study style su sucks supplies supply support surf surgery suzuki sv swatch swiftcover swiss sx sy sydney systems sz tab taipei talk taobao target tatamotors tatar tattoo tax taxi tc tci td tdk team tech technology tel temasek tennis teva tf tg th thd theater theatre tiaa tickets tienda tiffany tips tires tirol tj tjmaxx tjx tk tkmaxx tl tm tmall tn to today tokyo tools top toray toshiba total tours town toyota toys tr trade trading training travel travelchannel travelers travelersinsurance trust trv tt tube tui tunes tushu tv tvs tw tz ua ubank ubs ug uk unicom university uno uol ups us uy uz va vacations vana vanguard vc ve vegas ventures verisign versicherung vet vg vi viajes video vig viking villas vin vip virgin visa vision viva vivo vlaanderen vn vodka volkswagen volvo vote voting voto voyage vu vuelos wales walmart walter wang wanggou watch watches weather weatherchannel webcam weber website wed wedding weibo weir wf whoswho wien wiki williamhill win windows wine winners wme wolterskluwer woodside work works world wow ws wtc wtf xbox xerox xfinity xihuan xin xxx xyz yachts yahoo yamaxun yandex ye yodobashi yoga yokohama you youtube yt yun za zappos zara zero zip zm zone zuerich zw vermögensberater-ctb vermögensberatung-pwb ελ ευ бг бел дети ею католик ком қаз мкд мон москва онлайн орг рус рф сайт срб укр გე հայ ישראל קום ابوظبي اتصالات ارامكو الاردن البحرين الجزائر السعودية العليان المغرب امارات ایران بارت بازار بھارت بيتك پاکستان ڀارت تونس سودان سورية شبكة عراق عرب عمان فلسطين قطر كاثوليك كوم مصر مليسيا موريتانيا موقع همراه कॉम नेट भारत भारतम् भारोत संगठन বাংলা ভারত ভাৰত ਭਾਰਤ ભારત ଭାରତ இந்தியா இலங்கை சிங்கப்பூர் భారత్ ಭಾರತ ഭാരതം ලංකා คอม ไทย ລາວ 닷넷 닷컴 삼성 한국 アマゾン グーグル クラウド コム ストア セール ファッション ポイント みんな 世界 中信 中国 中國 中文网 亚马逊 企业 佛山 信息 健康 八卦 公司 公益 台湾 台灣 商城 商店 商标 嘉里 嘉里大酒店 在线 大众汽车 大拿 天主教 娱乐 家電 广东 微博 慈善 我爱你 手机 招聘 政务 政府 新加坡 新闻 时尚 書籍 机构 淡马锡 游戏 澳門 点看 移动 组织机构 网址 网店 网站 网络 联通 诺基亚 谷歌 购物 通販 集团 電訊盈科 飞利浦 食品 餐厅 香格里拉 香港".split(" "),$p=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,zp=/(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEDD-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDDFF\uDE70-\uDE74\uDE78-\uDE7C\uDE80-\uDE86\uDE90-\uDEAC\uDEB0-\uDEBA\uDEC0-\uDEC5\uDED0-\uDED9\uDEE0-\uDEE7\uDEF0-\uDEF6])/,jp=/\uFE0F/,qp=/\d/,Hp=/\s/;function Vp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=jf(),r=qf(Qf),n=qf(Jf),i=jf(),s=qf(rp),a=[[qp,n],[$p,n],[zp,n],[jp,n]],o=function(){var e=qf(Jf);return e.j={"-":i},e.jr=[].concat(a),e},l=function(e){var t=o();return t.t=e,t};Wf(t,[["'",qf(pp)],["{",qf(ip)],["[",qf(sp)],["<",qf(ap)],["(",qf(op)],["}",qf(lp)],["]",qf(cp)],[">",qf(dp)],[")",qf(hp)],["&",qf(fp)],["*",qf(mp)],["@",qf(gp)],["`",qf(vp)],["^",qf(bp)],[":",qf(wp)],[",",qf(xp)],["$",qf(Ep)],[".",qf(Dp)],["=",qf(Sp)],["!",qf(Ap)],["-",qf(Tp)],["%",qf(Cp)],["|",qf(Np)],["+",qf(kp)],["#",qf(Mp)],["?",qf(Op)],['"',qf(Fp)],["/",qf(_p)],[";",qf(Lp)],["~",qf(Rp)],["_",qf(Ip)],["\\",qf(yp)]]),Hf(t,"\n",qf(np)),Vf(t,Hp,s),Hf(s,"\n",jf()),Vf(s,Hp,s);for(var u=0;u<Up.length;u++)Yf(t,Up[u],l(Xf),o);var c=o(),d=o(),h=o(),f=o();Yf(t,"file",c,o),Yf(t,"ftp",d,o),Yf(t,"http",h,o),Yf(t,"mailto",f,o);var p=o(),m=qf(ep),g=qf(tp);Hf(d,"s",p),Hf(d,":",m),Hf(h,"s",p),Hf(h,":",m),Hf(c,":",m),Hf(p,":",m),Hf(f,":",g);for(var y=o(),v=0;v<e.length;v++)Yf(t,e[v],y,o);return Hf(y,":",m),Yf(t,"localhost",l(Zf),o),Vf(t,qp,r),Vf(t,$p,n),Vf(t,zp,n),Vf(t,jp,n),Vf(r,qp,r),Vf(r,$p,n),Vf(r,zp,n),Vf(r,jp,n),Hf(r,"-",i),Hf(n,"-",i),Hf(i,"-",i),Vf(n,qp,n),Vf(n,$p,n),Vf(n,zp,n),Vf(n,jp,n),Vf(i,qp,n),Vf(i,$p,n),Vf(i,zp,n),Vf(i,jp,n),t.jd=qf(Pp),t}function Gp(e){return Gp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gp(e)}var Kp={defaultProtocol:"http",events:null,format:Yp,formatHref:Yp,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:0,className:null,attributes:null,ignoreTags:[]};function Wp(e){e=e||{},this.defaultProtocol="defaultProtocol"in e?e.defaultProtocol:Kp.defaultProtocol,this.events="events"in e?e.events:Kp.events,this.format="format"in e?e.format:Kp.format,this.formatHref="formatHref"in e?e.formatHref:Kp.formatHref,this.nl2br="nl2br"in e?e.nl2br:Kp.nl2br,this.tagName="tagName"in e?e.tagName:Kp.tagName,this.target="target"in e?e.target:Kp.target,this.rel="rel"in e?e.rel:Kp.rel,this.validate="validate"in e?e.validate:Kp.validate,this.truncate="truncate"in e?e.truncate:Kp.truncate,this.className="className"in e?e.className:Kp.className,this.attributes=e.attributes||Kp.attributes,this.ignoreTags=[];for(var t=("ignoreTags"in e?e.ignoreTags:Kp.ignoreTags),r=0;r<t.length;r++)this.ignoreTags.push(t[r].toUpperCase())}function Yp(e){return e}Wp.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),rel:this.get("rel",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e),truncate:this.get("truncate",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(e,t,r){var n,i=this[e];if(!i)return i;switch(Gp(i)){case"function":return i(t,r.t);case"object":return"function"==typeof(n=r.t in i?i[r.t]:Kp[e])?n(t,r.t):n}return i},getObject:function(e,t,r){var n=this[e];return"function"==typeof n?n(t,r.t):n}};function Jp(){}function Zp(e,t){function r(t,r){this.t=e,this.v=t,this.tk=r}return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.create(e.prototype);for(var i in r)n[i]=r[i];n.constructor=t,t.prototype=n}(Jp,r,t),r}Jp.prototype={t:"token",isLink:!1,toString:function(){return this.v},toHref:function(){return this.toString()},startIndex:function(){return this.tk[0].s},endIndex:function(){return this.tk[this.tk.length-1].e},toObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kp.defaultProtocol;return{type:this.t,value:this.v,isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}}};var Xp=Zp("email",{isLink:!0}),Qp=Zp("email",{isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),em=Zp("text"),tm=Zp("nl"),rm=Zp("url",{isLink:!0,toHref:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kp.defaultProtocol,t=this.tk,r=!1,n=!1,i=[],s=0;t[s].t===ep;)r=!0,i.push(t[s].v),s++;for(;t[s].t===_p;)n=!0,i.push(t[s].v),s++;for(;s<t.length;s++)i.push(t[s].v);return i=i.join(""),r||n||(i="".concat(e,"://").concat(i)),i},hasProtocol:function(){return this.tk[0].t===ep}}),nm=Object.freeze({__proto__:null,MultiToken:Jp,Base:Jp,createTokenClass:Zp,MailtoEmail:Xp,Email:Qp,Text:em,Nl:tm,Url:rm});function im(){var e=jf(),t=jf(),r=jf(),n=jf(),i=jf(),s=jf(),a=jf(),o=qf(rm),l=jf(),u=qf(rm),c=qf(rm),d=jf(),h=jf(),f=jf(),p=jf(),m=jf(),g=qf(rm),y=qf(rm),v=qf(rm),b=qf(rm),w=jf(),x=jf(),E=jf(),D=jf(),S=jf(),A=jf(),T=qf(Qp),C=jf(),N=qf(Qp),k=qf(Xp),M=jf(),O=jf(),F=jf(),L=jf(),_=qf(tm);Hf(e,np,_),Hf(e,ep,t),Hf(e,tp,r),Hf(t,_p,n),Hf(n,_p,i),Hf(e,Xf,s),Hf(e,Jf,s),Hf(e,Zf,o),Hf(e,Qf,s),Hf(i,Xf,c),Hf(i,Jf,c),Hf(i,Qf,c),Hf(i,Zf,c),Hf(s,Dp,a),Hf(S,Dp,A),Hf(a,Xf,o),Hf(a,Jf,s),Hf(a,Qf,s),Hf(a,Zf,s),Hf(A,Xf,T),Hf(A,Jf,S),Hf(A,Qf,S),Hf(A,Zf,S),Hf(o,Dp,a),Hf(T,Dp,A),Hf(o,wp,l),Hf(o,_p,c),Hf(l,Qf,u),Hf(u,_p,c),Hf(T,wp,C),Hf(C,Qf,N);var R=[fp,mp,gp,yp,vp,bp,Ep,Jf,Sp,Tp,Zf,Qf,Cp,Np,kp,Mp,ep,_p,Pp,Rp,Xf,Ip],I=[pp,dp,lp,cp,hp,wp,xp,Dp,Ap,ap,ip,sp,op,Op,Fp,Lp];Hf(c,ip,h),Hf(c,sp,f),Hf(c,ap,p),Hf(c,op,m),Hf(d,ip,h),Hf(d,sp,f),Hf(d,ap,p),Hf(d,op,m),Hf(h,lp,c),Hf(f,cp,c),Hf(p,dp,c),Hf(m,hp,c),Hf(g,lp,c),Hf(y,cp,c),Hf(v,dp,c),Hf(b,hp,c),Hf(w,lp,c),Hf(x,cp,c),Hf(E,dp,c),Hf(D,hp,c),Kf(h,R,g),Kf(f,R,y),Kf(p,R,v),Kf(m,R,b),Kf(h,I,w),Kf(f,I,x),Kf(p,I,E),Kf(m,I,D),Kf(g,R,g),Kf(y,R,y),Kf(v,R,v),Kf(b,R,b),Kf(g,I,g),Kf(y,I,y),Kf(v,I,v),Kf(b,I,b),Kf(w,R,g),Kf(x,R,y),Kf(E,R,v),Kf(D,R,b),Kf(w,I,w),Kf(x,I,x),Kf(E,I,E),Kf(D,I,D),Kf(c,R,c),Kf(d,R,c),Kf(c,I,d),Kf(d,I,d),Hf(r,Xf,k),Hf(r,Jf,k),Hf(r,Qf,k),Hf(r,Zf,k),Kf(k,R,k),Kf(k,I,M),Kf(M,R,k),Kf(M,I,M);var P=[fp,pp,mp,yp,vp,bp,lp,Ep,Jf,Sp,Tp,Qf,ip,Cp,Np,kp,Mp,Op,_p,Pp,Rp,Xf,Ip];return Kf(s,P,O),Hf(s,gp,F),Kf(o,P,O),Hf(o,gp,F),Kf(a,P,O),Kf(O,P,O),Hf(O,gp,F),Hf(O,Dp,L),Kf(L,P,O),Hf(F,Xf,S),Hf(F,Jf,S),Hf(F,Qf,S),Hf(F,Zf,T),e}function sm(e,t,r){var n=r[0].s,i=r[r.length-1].e;return new e(t.substr(n,i-n),r)}var am="undefined"!=typeof console&&console&&console.warn||function(){},om={scanner:null,parser:null,pluginQueue:[],customProtocols:[],initialized:!1};function lm(e){if(om.initialized&&am('linkifyjs: already initialized - will not register custom protocol "'.concat(e,'" until you manually call linkify.init(). To avoid this warning, please register all custom protocols before invoking linkify the first time.')),!/^[a-z-]+$/.test(e))throw Error("linkifyjs: protocols containing characters other than a-z or - (hyphen) are not supported");om.customProtocols.push(e)}function um(e){return om.initialized||function(){om.scanner={start:Vp(om.customProtocols),tokens:Bp},om.parser={start:im(),tokens:nm};for(var e={createTokenClass:Zp},t=0;t<om.pluginQueue.length;t++)om.pluginQueue[t][1]({scanner:om.scanner,parser:om.parser,utils:e});om.initialized=!0}(),function(e,t,r){for(var n=r.length,i=0,s=[],a=[];i<n;){for(var o=e,l=null,u=null,c=0,d=null,h=-1;i<n&&!(l=Gf(o,r[i].t));)a.push(r[i++]);for(;i<n&&(u=l||Gf(o,r[i].t));)l=null,(o=u).accepts()?(h=0,d=o):h>=0&&h++,i++,c++;if(h<0)for(var f=i-c;f<i;f++)a.push(r[f]);else{a.length>0&&(s.push(sm(em,t,a)),a=[]),i-=h,c-=h;var p=d.t,m=r.slice(i-c,i);s.push(sm(p,t,m))}}return a.length>0&&s.push(sm(em,t,a)),s}(om.parser.start,e,function(e,t){for(var r=function(e){for(var t=[],r=e.length,n=0;n<r;){var i=e.charCodeAt(n),s=void 0,a=i<55296||i>56319||n+1===r||(s=e.charCodeAt(n+1))<56320||s>57343?e[n]:e.slice(n,n+2);t.push(a),n+=a.length}return t}(t.replace(/[A-Z]/g,(function(e){return e.toLowerCase()}))),n=r.length,i=[],s=0,a=0;a<n;){for(var o=e,l=null,u=0,c=null,d=-1,h=-1;a<n&&(l=Gf(o,r[a]));)(o=l).accepts()?(d=0,h=0,c=o):d>=0&&(d+=r[a].length,h++),u+=r[a].length,s+=r[a].length,a++;s-=d,a-=h,u-=d,i.push({t:c.t,v:t.substr(s-u,u),s:s-u,e:s})}return i}(om.scanner.start,e))}function cm(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=um(e),n=[],i=0;i<r.length;i++){var s=r[i];!s.isLink||t&&s.t!==t||n.push(s.toObject())}return n}function dm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=um(e);return 1===r.length&&r[0].isLink&&(!t||r[0].t===t)}function hm(e){return new oo({key:new co("autolink"),appendTransaction:(t,r,n)=>{const i=t.some((e=>e.docChanged))&&!r.doc.eq(n.doc),s=t.some((e=>e.getMeta("preventAutolink")));if(!i||s)return;const{tr:a}=n,o=function(e,t){const r=new $a(e);return t.forEach((e=>{e.steps.forEach((e=>{r.step(e)}))})),r}(r.doc,[...t]),{mapping:l}=o,u=function(e){const{mapping:t,steps:r}=e,n=[];return t.maps.forEach(((e,i)=>{const s=[];if(e.ranges.length)e.forEach(((e,t)=>{s.push({from:e,to:t})}));else{const{from:e,to:t}=r[i];if(void 0===e||void 0===t)return;s.push({from:e,to:t})}s.forEach((({from:e,to:r})=>{const s=t.slice(i).map(e,-1),a=t.slice(i).map(r),o=t.invert().map(s,-1),l=t.invert().map(a);n.push({oldRange:{from:o,to:l},newRange:{from:s,to:a}})}))})),ih(n)}(o);return u.forEach((({oldRange:t,newRange:i})=>{sh(t.from,t.to,r.doc).filter((t=>t.mark.type===e.type)).forEach((t=>{const i=sh(l.map(t.from),l.map(t.to),n.doc).filter((t=>t.mark.type===e.type));if(!i.length)return;const s=i[0],o=r.doc.textBetween(t.from,t.to,void 0," "),u=n.doc.textBetween(s.from,s.to,void 0," "),c=dm(o),d=dm(u);c&&!d&&a.removeMark(s.from,s.to,e.type)}));const s=function(e,t,r){const n=[];return e.nodesBetween(t.from,t.to,((e,t)=>{r(e)&&n.push({node:e,pos:t})})),n}(n.doc,i,(e=>e.isTextblock));let o,u;if(s.length>1?(o=s[0],u=n.doc.textBetween(o.pos,o.pos+o.node.nodeSize,void 0," ")):s.length&&n.doc.textBetween(i.from,i.to," "," ").endsWith(" ")&&(o=s[0],u=n.doc.textBetween(o.pos,i.to,void 0," ")),o&&u){const t=u.split(" ").filter((e=>""!==e));if(t.length<=0)return!1;const r=t[t.length-1],n=o.pos+u.lastIndexOf(r);if(!r)return!1;cm(r).filter((e=>e.isLink)).filter((t=>!e.validate||e.validate(t.value))).map((e=>({...e,from:n+e.start+1,to:n+e.end+1}))).forEach((t=>{a.addMark(t.from,t.to,e.type.create({href:t.href}))}))}})),a.steps.length?a:void 0}})}const fm=Ah.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(lm)},onDestroy(){om.scanner=null,om.parser=null,om.pluginQueue=[],om.customProtocols=[],om.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}),addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},class:{default:this.options.HTMLAttributes.class}}},parseHTML:()=>[{tag:'a[href]:not([href *= "javascript:" i])'}],renderHTML({HTMLAttributes:e}){return["a",hd(this.options.HTMLAttributes,e),0]},addCommands(){return{setLink:e=>({chain:t})=>t().setMark(this.name,e).setMeta("preventAutolink",!0).run(),toggleLink:e=>({chain:t})=>t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ch({find:e=>cm(e).filter((e=>!this.options.validate||this.options.validate(e.value))).filter((e=>e.isLink)).map((e=>({text:e.value,index:e.start,data:e}))),type:this.type,getAttributes:e=>{var t;return{href:null===(t=e.data)||void 0===t?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[];return this.options.autolink&&e.push(hm({type:this.type,validate:this.options.validate})),this.options.openOnClick&&e.push(function(e){return new oo({key:new co("handleClickLink"),props:{handleClick:(t,r,n)=>{var i,s,a;const o=nh(t.state,e.type.name),l=null===(i=n.target)||void 0===i?void 0:i.closest("a"),u=null!==(s=null==l?void 0:l.href)&&void 0!==s?s:o.href,c=null!==(a=null==l?void 0:l.target)&&void 0!==a?a:o.target;return!(!l||!u||(window.open(u,c),0))}}})}({type:this.type})),this.options.linkOnPaste&&e.push(function(e){return new oo({key:new co("handlePasteLink"),props:{handlePaste:(t,r,n)=>{const{state:i}=t,{selection:s}=i,{empty:a}=s;if(a)return!1;let o="";n.content.forEach((e=>{o+=e.textContent}));const l=cm(o).find((e=>e.isLink&&e.value===o));return!(!o||!l||(e.editor.commands.setMark(e.type,{href:l.href}),0))}}})}({editor:this.editor,type:this.type})),e}});const pm=new co("suggestion");function mm({pluginKey:e=pm,editor:t,char:r="@",allowSpaces:n=!1,allowedPrefixes:i=[" "],startOfLine:s=!1,decorationTag:a="span",decorationClass:o="suggestion",command:l=(()=>null),items:u=(()=>[]),render:c=(()=>({})),allow:d=(()=>!0)}){let h;const f=null==c?void 0:c(),p=new oo({key:e,view(){return{update:async(e,r)=>{var n,i,s,a,o,c,d;const p=null===(n=this.key)||void 0===n?void 0:n.getState(r),m=null===(i=this.key)||void 0===i?void 0:i.getState(e.state),g=p.active&&m.active&&p.range.from!==m.range.from,y=!p.active&&m.active,v=p.active&&!m.active,b=y||g,w=!y&&!v&&p.query!==m.query&&!g,x=v||g;if(!b&&!w&&!x)return;const E=x&&!b?p:m,D=e.dom.querySelector(`[data-decoration-id="${E.decorationId}"]`);h={editor:t,range:E.range,query:E.query,text:E.text,items:[],command:e=>{l({editor:t,range:E.range,props:e})},decorationNode:D,clientRect:D?()=>{var r;const{decorationId:n}=null===(r=this.key)||void 0===r?void 0:r.getState(t.state),i=e.dom.querySelector(`[data-decoration-id="${n}"]`);return(null==i?void 0:i.getBoundingClientRect())||null}:null},b&&(null===(s=null==f?void 0:f.onBeforeStart)||void 0===s||s.call(f,h)),w&&(null===(a=null==f?void 0:f.onBeforeUpdate)||void 0===a||a.call(f,h)),(w||b)&&(h.items=await u({editor:t,query:E.query})),x&&(null===(o=null==f?void 0:f.onExit)||void 0===o||o.call(f,h)),w&&(null===(c=null==f?void 0:f.onUpdate)||void 0===c||c.call(f,h)),b&&(null===(d=null==f?void 0:f.onStart)||void 0===d||d.call(f,h))},destroy:()=>{var e;h&&(null===(e=null==f?void 0:f.onExit)||void 0===e||e.call(f,h))}}},state:{init:()=>({active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}),apply(e,a,o,l){const{isEditable:u}=t,{composing:c}=t.view,{selection:h}=e,{empty:f,from:p}=h,m={...a};if(m.composing=c,u&&(f||t.view.composing)){!(p<a.range.from||p>a.range.to)||c||a.composing||(m.active=!1);const e=function(e){var t;const{char:r,allowSpaces:n,allowedPrefixes:i,startOfLine:s,$position:a}=e,o=function(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}(r),l=new RegExp(`\\s${o}$`),u=s?"^":"",c=n?new RegExp(`${u}${o}.*?(?=\\s${o}|$)`,"gm"):new RegExp(`${u}(?:^)?${o}[^\\s${o}]*`,"gm"),d=(null===(t=a.nodeBefore)||void 0===t?void 0:t.isText)&&a.nodeBefore.text;if(!d)return null;const h=a.pos-d.length,f=Array.from(d.matchAll(c)).pop();if(!f||void 0===f.input||void 0===f.index)return null;const p=f.input.slice(Math.max(0,f.index-1),f.index),m=new RegExp(`^[${null==i?void 0:i.join("")}\0]?$`).test(p);if(null!==i&&!m)return null;const g=h+f.index;let y=g+f[0].length;return n&&l.test(d.slice(y-1,y+1))&&(f[0]+=" ",y+=1),g<a.pos&&y>=a.pos?{range:{from:g,to:y},query:f[0].slice(r.length),text:f[0]}:null}({char:r,allowSpaces:n,allowedPrefixes:i,startOfLine:s,$position:h.$from}),o=`id_${Math.floor(4294967295*Math.random())}`;e&&d({editor:t,state:l,range:e.range})?(m.active=!0,m.decorationId=a.decorationId?a.decorationId:o,m.range=e.range,m.query=e.query,m.text=e.text):m.active=!1}else m.active=!1;return m.active||(m.decorationId=null,m.range={from:0,to:0},m.query=null,m.text=null),m}},props:{handleKeyDown(e,t){var r;const{active:n,range:i}=p.getState(e.state);return n&&(null===(r=null==f?void 0:f.onKeyDown)||void 0===r?void 0:r.call(f,{view:e,event:t,range:i}))||!1},decorations(e){const{active:t,range:r,decorationId:n}=p.getState(e);return t?Vu.create(e.doc,[ju.inline(r.from,r.to,{nodeName:a,class:o,"data-decoration-id":n})]):null}}});return p}function gm(e){return gm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gm(e)}function ym(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vm(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ym(Object(r),!0).forEach((function(t){bm(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ym(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function bm(e,t,r){return t=function(e){var t=function(e,t){if("object"!==gm(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==gm(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===gm(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const wm=Ld.create({name:"commands",addOptions:function(){return{suggestion:{char:"/",command:function(e){var t=e.editor,r=e.range;e.props.command({editor:t,range:r})}}}},addProseMirrorPlugins:function(){return[mm(vm({editor:this.editor},this.options.suggestion))]}});function xm(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Em(e){return e instanceof xm(e).Element||e instanceof Element}function Dm(e){return e instanceof xm(e).HTMLElement||e instanceof HTMLElement}function Sm(e){return"undefined"!=typeof ShadowRoot&&(e instanceof xm(e).ShadowRoot||e instanceof ShadowRoot)}var Am=Math.max,Tm=Math.min,Cm=Math.round;function Nm(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function km(){return!/^((?!chrome|android).)*safari/i.test(Nm())}function Mm(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n=e.getBoundingClientRect(),i=1,s=1;t&&Dm(e)&&(i=e.offsetWidth>0&&Cm(n.width)/e.offsetWidth||1,s=e.offsetHeight>0&&Cm(n.height)/e.offsetHeight||1);var a=(Em(e)?xm(e):window).visualViewport,o=!km()&&r,l=(n.left+(o&&a?a.offsetLeft:0))/i,u=(n.top+(o&&a?a.offsetTop:0))/s,c=n.width/i,d=n.height/s;return{width:c,height:d,top:u,right:l+c,bottom:u+d,left:l,x:l,y:u}}function Om(e){var t=xm(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Fm(e){return e?(e.nodeName||"").toLowerCase():null}function Lm(e){return((Em(e)?e.ownerDocument:e.document)||window.document).documentElement}function _m(e){return Mm(Lm(e)).left+Om(e).scrollLeft}function Rm(e){return xm(e).getComputedStyle(e)}function Im(e){var t=Rm(e),r=t.overflow,n=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+n)}function Pm(e,t,r){void 0===r&&(r=!1);var n,i,s=Dm(t),a=Dm(t)&&function(e){var t=e.getBoundingClientRect(),r=Cm(t.width)/e.offsetWidth||1,n=Cm(t.height)/e.offsetHeight||1;return 1!==r||1!==n}(t),o=Lm(t),l=Mm(e,a,r),u={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(s||!s&&!r)&&(("body"!==Fm(t)||Im(o))&&(u=(n=t)!==xm(n)&&Dm(n)?{scrollLeft:(i=n).scrollLeft,scrollTop:i.scrollTop}:Om(n)),Dm(t)?((c=Mm(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):o&&(c.x=_m(o))),{x:l.left+u.scrollLeft-c.x,y:l.top+u.scrollTop-c.y,width:l.width,height:l.height}}function Bm(e){var t=Mm(e),r=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:n}}function Um(e){return"html"===Fm(e)?e:e.assignedSlot||e.parentNode||(Sm(e)?e.host:null)||Lm(e)}function $m(e){return["html","body","#document"].indexOf(Fm(e))>=0?e.ownerDocument.body:Dm(e)&&Im(e)?e:$m(Um(e))}function zm(e,t){var r;void 0===t&&(t=[]);var n=$m(e),i=n===(null==(r=e.ownerDocument)?void 0:r.body),s=xm(n),a=i?[s].concat(s.visualViewport||[],Im(n)?n:[]):n,o=t.concat(a);return i?o:o.concat(zm(Um(a)))}function jm(e){return["table","td","th"].indexOf(Fm(e))>=0}function qm(e){return Dm(e)&&"fixed"!==Rm(e).position?e.offsetParent:null}function Hm(e){for(var t=xm(e),r=qm(e);r&&jm(r)&&"static"===Rm(r).position;)r=qm(r);return r&&("html"===Fm(r)||"body"===Fm(r)&&"static"===Rm(r).position)?t:r||function(e){var t=/firefox/i.test(Nm());if(/Trident/i.test(Nm())&&Dm(e)&&"fixed"===Rm(e).position)return null;var r=Um(e);for(Sm(r)&&(r=r.host);Dm(r)&&["html","body"].indexOf(Fm(r))<0;){var n=Rm(r);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||t&&"filter"===n.willChange||t&&n.filter&&"none"!==n.filter)return r;r=r.parentNode}return null}(e)||t}var Vm="top",Gm="bottom",Km="right",Wm="left",Ym="auto",Jm=[Vm,Gm,Km,Wm],Zm="start",Xm="end",Qm="clippingParents",eg="viewport",tg="popper",rg="reference",ng=Jm.reduce((function(e,t){return e.concat([t+"-"+Zm,t+"-"+Xm])}),[]),ig=[].concat(Jm,[Ym]).reduce((function(e,t){return e.concat([t,t+"-"+Zm,t+"-"+Xm])}),[]),sg=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function ag(e){var t=new Map,r=new Set,n=[];function i(e){r.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!r.has(e)){var n=t.get(e);n&&i(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){r.has(e.name)||i(e)})),n}var og={placement:"bottom",modifiers:[],strategy:"absolute"};function lg(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function ug(e){void 0===e&&(e={});var t=e,r=t.defaultModifiers,n=void 0===r?[]:r,i=t.defaultOptions,s=void 0===i?og:i;return function(e,t,r){void 0===r&&(r=s);var i,a,o={placement:"bottom",orderedModifiers:[],options:Object.assign({},og,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],u=!1,c={state:o,setOptions:function(r){var i="function"==typeof r?r(o.options):r;d(),o.options=Object.assign({},s,o.options,i),o.scrollParents={reference:Em(e)?zm(e):e.contextElement?zm(e.contextElement):[],popper:zm(t)};var a=function(e){var t=ag(e);return sg.reduce((function(e,r){return e.concat(t.filter((function(e){return e.phase===r})))}),[])}(function(e){var t=e.reduce((function(e,t){var r=e[t.name];return e[t.name]=r?Object.assign({},r,t,{options:Object.assign({},r.options,t.options),data:Object.assign({},r.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(n,o.options.modifiers)));return o.orderedModifiers=a.filter((function(e){return e.enabled})),o.orderedModifiers.forEach((function(e){var t=e.name,r=e.options,n=void 0===r?{}:r,i=e.effect;if("function"==typeof i){var s=i({state:o,name:t,instance:c,options:n}),a=function(){};l.push(s||a)}})),c.update()},forceUpdate:function(){if(!u){var e=o.elements,t=e.reference,r=e.popper;if(lg(t,r)){o.rects={reference:Pm(t,Hm(r),"fixed"===o.options.strategy),popper:Bm(r)},o.reset=!1,o.placement=o.options.placement,o.orderedModifiers.forEach((function(e){return o.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0;n<o.orderedModifiers.length;n++)if(!0!==o.reset){var i=o.orderedModifiers[n],s=i.fn,a=i.options,l=void 0===a?{}:a,d=i.name;"function"==typeof s&&(o=s({state:o,options:l,name:d,instance:c})||o)}else o.reset=!1,n=-1}}},update:(i=function(){return new Promise((function(e){c.forceUpdate(),e(o)}))},function(){return a||(a=new Promise((function(e){Promise.resolve().then((function(){a=void 0,e(i())}))}))),a}),destroy:function(){d(),u=!0}};if(!lg(e,t))return c;function d(){l.forEach((function(e){return e()})),l=[]}return c.setOptions(r).then((function(e){!u&&r.onFirstUpdate&&r.onFirstUpdate(e)})),c}}var cg={passive:!0};const dg={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,r=e.instance,n=e.options,i=n.scroll,s=void 0===i||i,a=n.resize,o=void 0===a||a,l=xm(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&u.forEach((function(e){e.addEventListener("scroll",r.update,cg)})),o&&l.addEventListener("resize",r.update,cg),function(){s&&u.forEach((function(e){e.removeEventListener("scroll",r.update,cg)})),o&&l.removeEventListener("resize",r.update,cg)}},data:{}};function hg(e){return e.split("-")[0]}function fg(e){return e.split("-")[1]}function pg(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function mg(e){var t,r=e.reference,n=e.element,i=e.placement,s=i?hg(i):null,a=i?fg(i):null,o=r.x+r.width/2-n.width/2,l=r.y+r.height/2-n.height/2;switch(s){case Vm:t={x:o,y:r.y-n.height};break;case Gm:t={x:o,y:r.y+r.height};break;case Km:t={x:r.x+r.width,y:l};break;case Wm:t={x:r.x-n.width,y:l};break;default:t={x:r.x,y:r.y}}var u=s?pg(s):null;if(null!=u){var c="y"===u?"height":"width";switch(a){case Zm:t[u]=t[u]-(r[c]/2-n[c]/2);break;case Xm:t[u]=t[u]+(r[c]/2-n[c]/2)}}return t}var gg={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yg(e){var t,r=e.popper,n=e.popperRect,i=e.placement,s=e.variation,a=e.offsets,o=e.position,l=e.gpuAcceleration,u=e.adaptive,c=e.roundOffsets,d=e.isFixed,h=a.x,f=void 0===h?0:h,p=a.y,m=void 0===p?0:p,g="function"==typeof c?c({x:f,y:m}):{x:f,y:m};f=g.x,m=g.y;var y=a.hasOwnProperty("x"),v=a.hasOwnProperty("y"),b=Wm,w=Vm,x=window;if(u){var E=Hm(r),D="clientHeight",S="clientWidth";if(E===xm(r)&&"static"!==Rm(E=Lm(r)).position&&"absolute"===o&&(D="scrollHeight",S="scrollWidth"),i===Vm||(i===Wm||i===Km)&&s===Xm)w=Gm,m-=(d&&E===x&&x.visualViewport?x.visualViewport.height:E[D])-n.height,m*=l?1:-1;if(i===Wm||(i===Vm||i===Gm)&&s===Xm)b=Km,f-=(d&&E===x&&x.visualViewport?x.visualViewport.width:E[S])-n.width,f*=l?1:-1}var A,T=Object.assign({position:o},u&&gg),C=!0===c?function(e){var t=e.x,r=e.y,n=window.devicePixelRatio||1;return{x:Cm(t*n)/n||0,y:Cm(r*n)/n||0}}({x:f,y:m}):{x:f,y:m};return f=C.x,m=C.y,l?Object.assign({},T,((A={})[w]=v?"0":"",A[b]=y?"0":"",A.transform=(x.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",A)):Object.assign({},T,((t={})[w]=v?m+"px":"",t[b]=y?f+"px":"",t.transform="",t))}const vg={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,r=e.options,n=r.gpuAcceleration,i=void 0===n||n,s=r.adaptive,a=void 0===s||s,o=r.roundOffsets,l=void 0===o||o,u={placement:hg(t.placement),variation:fg(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,yg(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,yg(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};const bg={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var r=t.styles[e]||{},n=t.attributes[e]||{},i=t.elements[e];Dm(i)&&Fm(i)&&(Object.assign(i.style,r),Object.keys(n).forEach((function(e){var t=n[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach((function(e){var n=t.elements[e],i=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:r[e]).reduce((function(e,t){return e[t]="",e}),{});Dm(n)&&Fm(n)&&(Object.assign(n.style,s),Object.keys(i).forEach((function(e){n.removeAttribute(e)})))}))}},requires:["computeStyles"]};const wg={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,r=e.options,n=e.name,i=r.offset,s=void 0===i?[0,0]:i,a=ig.reduce((function(e,r){return e[r]=function(e,t,r){var n=hg(e),i=[Wm,Vm].indexOf(n)>=0?-1:1,s="function"==typeof r?r(Object.assign({},t,{placement:e})):r,a=s[0],o=s[1];return a=a||0,o=(o||0)*i,[Wm,Km].indexOf(n)>=0?{x:o,y:a}:{x:a,y:o}}(r,t.rects,s),e}),{}),o=a[t.placement],l=o.x,u=o.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=u),t.modifiersData[n]=a}};var xg={left:"right",right:"left",bottom:"top",top:"bottom"};function Eg(e){return e.replace(/left|right|bottom|top/g,(function(e){return xg[e]}))}var Dg={start:"end",end:"start"};function Sg(e){return e.replace(/start|end/g,(function(e){return Dg[e]}))}function Ag(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&Sm(r)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Tg(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Cg(e,t,r){return t===eg?Tg(function(e,t){var r=xm(e),n=Lm(e),i=r.visualViewport,s=n.clientWidth,a=n.clientHeight,o=0,l=0;if(i){s=i.width,a=i.height;var u=km();(u||!u&&"fixed"===t)&&(o=i.offsetLeft,l=i.offsetTop)}return{width:s,height:a,x:o+_m(e),y:l}}(e,r)):Em(t)?function(e,t){var r=Mm(e,!1,"fixed"===t);return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}(t,r):Tg(function(e){var t,r=Lm(e),n=Om(e),i=null==(t=e.ownerDocument)?void 0:t.body,s=Am(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=Am(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),o=-n.scrollLeft+_m(e),l=-n.scrollTop;return"rtl"===Rm(i||r).direction&&(o+=Am(r.clientWidth,i?i.clientWidth:0)-s),{width:s,height:a,x:o,y:l}}(Lm(e)))}function Ng(e,t,r,n){var i="clippingParents"===t?function(e){var t=zm(Um(e)),r=["absolute","fixed"].indexOf(Rm(e).position)>=0&&Dm(e)?Hm(e):e;return Em(r)?t.filter((function(e){return Em(e)&&Ag(e,r)&&"body"!==Fm(e)})):[]}(e):[].concat(t),s=[].concat(i,[r]),a=s[0],o=s.reduce((function(t,r){var i=Cg(e,r,n);return t.top=Am(i.top,t.top),t.right=Tm(i.right,t.right),t.bottom=Tm(i.bottom,t.bottom),t.left=Am(i.left,t.left),t}),Cg(e,a,n));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function kg(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Mg(e,t){return t.reduce((function(t,r){return t[r]=e,t}),{})}function Og(e,t){void 0===t&&(t={});var r=t,n=r.placement,i=void 0===n?e.placement:n,s=r.strategy,a=void 0===s?e.strategy:s,o=r.boundary,l=void 0===o?Qm:o,u=r.rootBoundary,c=void 0===u?eg:u,d=r.elementContext,h=void 0===d?tg:d,f=r.altBoundary,p=void 0!==f&&f,m=r.padding,g=void 0===m?0:m,y=kg("number"!=typeof g?g:Mg(g,Jm)),v=h===tg?rg:tg,b=e.rects.popper,w=e.elements[p?v:h],x=Ng(Em(w)?w:w.contextElement||Lm(e.elements.popper),l,c,a),E=Mm(e.elements.reference),D=mg({reference:E,element:b,strategy:"absolute",placement:i}),S=Tg(Object.assign({},b,D)),A=h===tg?S:E,T={top:x.top-A.top+y.top,bottom:A.bottom-x.bottom+y.bottom,left:x.left-A.left+y.left,right:A.right-x.right+y.right},C=e.modifiersData.offset;if(h===tg&&C){var N=C[i];Object.keys(T).forEach((function(e){var t=[Km,Gm].indexOf(e)>=0?1:-1,r=[Vm,Gm].indexOf(e)>=0?"y":"x";T[e]+=N[r]*t}))}return T}const Fg={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var i=r.mainAxis,s=void 0===i||i,a=r.altAxis,o=void 0===a||a,l=r.fallbackPlacements,u=r.padding,c=r.boundary,d=r.rootBoundary,h=r.altBoundary,f=r.flipVariations,p=void 0===f||f,m=r.allowedAutoPlacements,g=t.options.placement,y=hg(g),v=l||(y===g||!p?[Eg(g)]:function(e){if(hg(e)===Ym)return[];var t=Eg(e);return[Sg(e),t,Sg(t)]}(g)),b=[g].concat(v).reduce((function(e,r){return e.concat(hg(r)===Ym?function(e,t){void 0===t&&(t={});var r=t,n=r.placement,i=r.boundary,s=r.rootBoundary,a=r.padding,o=r.flipVariations,l=r.allowedAutoPlacements,u=void 0===l?ig:l,c=fg(n),d=c?o?ng:ng.filter((function(e){return fg(e)===c})):Jm,h=d.filter((function(e){return u.indexOf(e)>=0}));0===h.length&&(h=d);var f=h.reduce((function(t,r){return t[r]=Og(e,{placement:r,boundary:i,rootBoundary:s,padding:a})[hg(r)],t}),{});return Object.keys(f).sort((function(e,t){return f[e]-f[t]}))}(t,{placement:r,boundary:c,rootBoundary:d,padding:u,flipVariations:p,allowedAutoPlacements:m}):r)}),[]),w=t.rects.reference,x=t.rects.popper,E=new Map,D=!0,S=b[0],A=0;A<b.length;A++){var T=b[A],C=hg(T),N=fg(T)===Zm,k=[Vm,Gm].indexOf(C)>=0,M=k?"width":"height",O=Og(t,{placement:T,boundary:c,rootBoundary:d,altBoundary:h,padding:u}),F=k?N?Km:Wm:N?Gm:Vm;w[M]>x[M]&&(F=Eg(F));var L=Eg(F),_=[];if(s&&_.push(O[C]<=0),o&&_.push(O[F]<=0,O[L]<=0),_.every((function(e){return e}))){S=T,D=!1;break}E.set(T,_)}if(D)for(var R=function(e){var t=b.find((function(t){var r=E.get(t);if(r)return r.slice(0,e).every((function(e){return e}))}));if(t)return S=t,"break"},I=p?3:1;I>0;I--){if("break"===R(I))break}t.placement!==S&&(t.modifiersData[n]._skip=!0,t.placement=S,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Lg(e,t,r){return Am(e,Tm(t,r))}const _g={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,n=e.name,i=r.mainAxis,s=void 0===i||i,a=r.altAxis,o=void 0!==a&&a,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,d=r.padding,h=r.tether,f=void 0===h||h,p=r.tetherOffset,m=void 0===p?0:p,g=Og(t,{boundary:l,rootBoundary:u,padding:d,altBoundary:c}),y=hg(t.placement),v=fg(t.placement),b=!v,w=pg(y),x="x"===w?"y":"x",E=t.modifiersData.popperOffsets,D=t.rects.reference,S=t.rects.popper,A="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,T="number"==typeof A?{mainAxis:A,altAxis:A}:Object.assign({mainAxis:0,altAxis:0},A),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,N={x:0,y:0};if(E){if(s){var k,M="y"===w?Vm:Wm,O="y"===w?Gm:Km,F="y"===w?"height":"width",L=E[w],_=L+g[M],R=L-g[O],I=f?-S[F]/2:0,P=v===Zm?D[F]:S[F],B=v===Zm?-S[F]:-D[F],U=t.elements.arrow,$=f&&U?Bm(U):{width:0,height:0},z=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},j=z[M],q=z[O],H=Lg(0,D[F],$[F]),V=b?D[F]/2-I-H-j-T.mainAxis:P-H-j-T.mainAxis,G=b?-D[F]/2+I+H+q+T.mainAxis:B+H+q+T.mainAxis,K=t.elements.arrow&&Hm(t.elements.arrow),W=K?"y"===w?K.clientTop||0:K.clientLeft||0:0,Y=null!=(k=null==C?void 0:C[w])?k:0,J=L+G-Y,Z=Lg(f?Tm(_,L+V-Y-W):_,L,f?Am(R,J):R);E[w]=Z,N[w]=Z-L}if(o){var X,Q="x"===w?Vm:Wm,ee="x"===w?Gm:Km,te=E[x],re="y"===x?"height":"width",ne=te+g[Q],ie=te-g[ee],se=-1!==[Vm,Wm].indexOf(y),ae=null!=(X=null==C?void 0:C[x])?X:0,oe=se?ne:te-D[re]-S[re]-ae+T.altAxis,le=se?te+D[re]+S[re]-ae-T.altAxis:ie,ue=f&&se?function(e,t,r){var n=Lg(e,t,r);return n>r?r:n}(oe,te,le):Lg(f?oe:ne,te,f?le:ie);E[x]=ue,N[x]=ue-te}t.modifiersData[n]=N}},requiresIfExists:["offset"]};const Rg={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,r=e.state,n=e.name,i=e.options,s=r.elements.arrow,a=r.modifiersData.popperOffsets,o=hg(r.placement),l=pg(o),u=[Wm,Km].indexOf(o)>=0?"height":"width";if(s&&a){var c=function(e,t){return kg("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Mg(e,Jm))}(i.padding,r),d=Bm(s),h="y"===l?Vm:Wm,f="y"===l?Gm:Km,p=r.rects.reference[u]+r.rects.reference[l]-a[l]-r.rects.popper[u],m=a[l]-r.rects.reference[l],g=Hm(s),y=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,v=p/2-m/2,b=c[h],w=y-d[u]-c[f],x=y/2-d[u]/2+v,E=Lg(b,x,w),D=l;r.modifiersData[n]=((t={})[D]=E,t.centerOffset=E-x,t)}},effect:function(e){var t=e.state,r=e.options.element,n=void 0===r?"[data-popper-arrow]":r;null!=n&&("string"!=typeof n||(n=t.elements.popper.querySelector(n)))&&Ag(t.elements.popper,n)&&(t.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ig(e,t,r){return void 0===r&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function Pg(e){return[Vm,Km,Gm,Wm].some((function(t){return e[t]>=0}))}var Bg=ug({defaultModifiers:[dg,{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,r=e.name;t.modifiersData[r]=mg({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},vg,bg,wg,Fg,_g,Rg,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,r=e.name,n=t.rects.reference,i=t.rects.popper,s=t.modifiersData.preventOverflow,a=Og(t,{elementContext:"reference"}),o=Og(t,{altBoundary:!0}),l=Ig(a,n),u=Ig(o,i,s),c=Pg(l),d=Pg(u);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}}]}),Ug="tippy-content",$g="tippy-backdrop",zg="tippy-arrow",jg="tippy-svg-arrow",qg={passive:!0,capture:!0},Hg=function(){return document.body};function Vg(e,t,r){if(Array.isArray(e)){var n=e[t];return null==n?Array.isArray(r)?r[t]:r:n}return e}function Gg(e,t){var r={}.toString.call(e);return 0===r.indexOf("[object")&&r.indexOf(t+"]")>-1}function Kg(e,t){return"function"==typeof e?e.apply(void 0,t):e}function Wg(e,t){return 0===t?e:function(n){clearTimeout(r),r=setTimeout((function(){e(n)}),t)};var r}function Yg(e){return[].concat(e)}function Jg(e,t){-1===e.indexOf(t)&&e.push(t)}function Zg(e){return e.split("-")[0]}function Xg(e){return[].slice.call(e)}function Qg(e){return Object.keys(e).reduce((function(t,r){return void 0!==e[r]&&(t[r]=e[r]),t}),{})}function ey(){return document.createElement("div")}function ty(e){return["Element","Fragment"].some((function(t){return Gg(e,t)}))}function ry(e){return Gg(e,"MouseEvent")}function ny(e){return!(!e||!e._tippy||e._tippy.reference!==e)}function iy(e){return ty(e)?[e]:function(e){return Gg(e,"NodeList")}(e)?Xg(e):Array.isArray(e)?e:Xg(document.querySelectorAll(e))}function sy(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function ay(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function oy(e){var t,r=Yg(e)[0];return null!=r&&null!=(t=r.ownerDocument)&&t.body?r.ownerDocument:document}function ly(e,t,r){var n=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[n](t,r)}))}function uy(e,t){for(var r=t;r;){var n;if(e.contains(r))return!0;r=null==r.getRootNode||null==(n=r.getRootNode())?void 0:n.host}return!1}var cy={isTouch:!1},dy=0;function hy(){cy.isTouch||(cy.isTouch=!0,window.performance&&document.addEventListener("mousemove",fy))}function fy(){var e=performance.now();e-dy<20&&(cy.isTouch=!1,document.removeEventListener("mousemove",fy)),dy=e}function py(){var e=document.activeElement;if(ny(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var my=!!("undefined"!=typeof window&&"undefined"!=typeof document)&&!!window.msCrypto;var gy={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},yy=Object.assign({appendTo:Hg,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},gy,{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),vy=Object.keys(yy);function by(e){var t=(e.plugins||[]).reduce((function(t,r){var n,i=r.name,s=r.defaultValue;i&&(t[i]=void 0!==e[i]?e[i]:null!=(n=yy[i])?n:s);return t}),{});return Object.assign({},e,t)}function wy(e,t){var r=Object.assign({},t,{content:Kg(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(by(Object.assign({},yy,{plugins:t}))):vy).reduce((function(t,r){var n=(e.getAttribute("data-tippy-"+r)||"").trim();if(!n)return t;if("content"===r)t[r]=n;else try{t[r]=JSON.parse(n)}catch(e){t[r]=n}return t}),{})}(e,t.plugins));return r.aria=Object.assign({},yy.aria,r.aria),r.aria={expanded:"auto"===r.aria.expanded?t.interactive:r.aria.expanded,content:"auto"===r.aria.content?t.interactive?null:"describedby":r.aria.content},r}var xy=function(){return"innerHTML"};function Ey(e,t){e[xy()]=t}function Dy(e){var t=ey();return!0===e?t.className=zg:(t.className=jg,ty(e)?t.appendChild(e):Ey(t,e)),t}function Sy(e,t){ty(t.content)?(Ey(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?Ey(e,t.content):e.textContent=t.content)}function Ay(e){var t=e.firstElementChild,r=Xg(t.children);return{box:t,content:r.find((function(e){return e.classList.contains(Ug)})),arrow:r.find((function(e){return e.classList.contains(zg)||e.classList.contains(jg)})),backdrop:r.find((function(e){return e.classList.contains($g)}))}}function Ty(e){var t=ey(),r=ey();r.className="tippy-box",r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var n=ey();function i(r,n){var i=Ay(t),s=i.box,a=i.content,o=i.arrow;n.theme?s.setAttribute("data-theme",n.theme):s.removeAttribute("data-theme"),"string"==typeof n.animation?s.setAttribute("data-animation",n.animation):s.removeAttribute("data-animation"),n.inertia?s.setAttribute("data-inertia",""):s.removeAttribute("data-inertia"),s.style.maxWidth="number"==typeof n.maxWidth?n.maxWidth+"px":n.maxWidth,n.role?s.setAttribute("role",n.role):s.removeAttribute("role"),r.content===n.content&&r.allowHTML===n.allowHTML||Sy(a,e.props),n.arrow?o?r.arrow!==n.arrow&&(s.removeChild(o),s.appendChild(Dy(n.arrow))):s.appendChild(Dy(n.arrow)):o&&s.removeChild(o)}return n.className=Ug,n.setAttribute("data-state","hidden"),Sy(n,e.props),t.appendChild(r),r.appendChild(n),i(e.props,e.props),{popper:t,onUpdate:i}}Ty.$$tippy=!0;var Cy=1,Ny=[],ky=[];function My(e,t){var r,n,i,s,a,o,l,u,c=wy(e,Object.assign({},yy,by(Qg(t)))),d=!1,h=!1,f=!1,p=!1,m=[],g=Wg(K,c.interactiveDebounce),y=Cy++,v=(u=c.plugins).filter((function(e,t){return u.indexOf(e)===t})),b={id:y,reference:e,popper:ey(),popperInstance:null,props:c,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:v,clearDelayTimeouts:function(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(i)},setProps:function(t){0;if(b.state.isDestroyed)return;L("onBeforeUpdate",[b,t]),V();var r=b.props,n=wy(e,Object.assign({},r,Qg(t),{ignoreAttributes:!0}));b.props=n,H(),r.interactiveDebounce!==n.interactiveDebounce&&(I(),g=Wg(K,n.interactiveDebounce));r.triggerTarget&&!n.triggerTarget?Yg(r.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):n.triggerTarget&&e.removeAttribute("aria-expanded");R(),F(),E&&E(r,n);b.popperInstance&&(Z(),Q().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)})));L("onAfterUpdate",[b,t])},setContent:function(e){b.setProps({content:e})},show:function(){0;var e=b.state.isVisible,t=b.state.isDestroyed,r=!b.state.isEnabled,n=cy.isTouch&&!b.props.touch,i=Vg(b.props.duration,0,yy.duration);if(e||t||r||n)return;if(N().hasAttribute("disabled"))return;if(L("onShow",[b],!1),!1===b.props.onShow(b))return;b.state.isVisible=!0,C()&&(x.style.visibility="visible");F(),$(),b.state.isMounted||(x.style.transition="none");if(C()){var s=M();sy([s.box,s.content],0)}o=function(){var e;if(b.state.isVisible&&!p){if(p=!0,x.offsetHeight,x.style.transition=b.props.moveTransition,C()&&b.props.animation){var t=M(),r=t.box,n=t.content;sy([r,n],i),ay([r,n],"visible")}_(),R(),Jg(ky,b),null==(e=b.popperInstance)||e.forceUpdate(),L("onMount",[b]),b.props.animation&&C()&&function(e,t){j(e,t)}(i,(function(){b.state.isShown=!0,L("onShown",[b])}))}},function(){var e,t=b.props.appendTo,r=N();e=b.props.interactive&&t===Hg||"parent"===t?r.parentNode:Kg(t,[r]);e.contains(x)||e.appendChild(x);b.state.isMounted=!0,Z(),!1}()},hide:function(){0;var e=!b.state.isVisible,t=b.state.isDestroyed,r=!b.state.isEnabled,n=Vg(b.props.duration,1,yy.duration);if(e||t||r)return;if(L("onHide",[b],!1),!1===b.props.onHide(b))return;b.state.isVisible=!1,b.state.isShown=!1,p=!1,d=!1,C()&&(x.style.visibility="hidden");if(I(),z(),F(!0),C()){var i=M(),s=i.box,a=i.content;b.props.animation&&(sy([s,a],n),ay([s,a],"hidden"))}_(),R(),b.props.animation?C()&&function(e,t){j(e,(function(){!b.state.isVisible&&x.parentNode&&x.parentNode.contains(x)&&t()}))}(n,b.unmount):b.unmount()},hideWithInteractivity:function(e){0;k().addEventListener("mousemove",g),Jg(Ny,g),g(e)},enable:function(){b.state.isEnabled=!0},disable:function(){b.hide(),b.state.isEnabled=!1},unmount:function(){0;b.state.isVisible&&b.hide();if(!b.state.isMounted)return;X(),Q().forEach((function(e){e._tippy.unmount()})),x.parentNode&&x.parentNode.removeChild(x);ky=ky.filter((function(e){return e!==b})),b.state.isMounted=!1,L("onHidden",[b])},destroy:function(){0;if(b.state.isDestroyed)return;b.clearDelayTimeouts(),b.unmount(),V(),delete e._tippy,b.state.isDestroyed=!0,L("onDestroy",[b])}};if(!c.render)return b;var w=c.render(b),x=w.popper,E=w.onUpdate;x.setAttribute("data-tippy-root",""),x.id="tippy-"+b.id,b.popper=x,e._tippy=b,x._tippy=b;var D=v.map((function(e){return e.fn(b)})),S=e.hasAttribute("aria-expanded");return H(),R(),F(),L("onCreate",[b]),c.showOnCreate&&ee(),x.addEventListener("mouseenter",(function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()})),x.addEventListener("mouseleave",(function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&k().addEventListener("mousemove",g)})),b;function A(){var e=b.props.touch;return Array.isArray(e)?e:[e,0]}function T(){return"hold"===A()[0]}function C(){var e;return!(null==(e=b.props.render)||!e.$$tippy)}function N(){return l||e}function k(){var e=N().parentNode;return e?oy(e):document}function M(){return Ay(x)}function O(e){return b.state.isMounted&&!b.state.isVisible||cy.isTouch||s&&"focus"===s.type?0:Vg(b.props.delay,e?0:1,yy.delay)}function F(e){void 0===e&&(e=!1),x.style.pointerEvents=b.props.interactive&&!e?"":"none",x.style.zIndex=""+b.props.zIndex}function L(e,t,r){var n;(void 0===r&&(r=!0),D.forEach((function(r){r[e]&&r[e].apply(r,t)})),r)&&(n=b.props)[e].apply(n,t)}function _(){var t=b.props.aria;if(t.content){var r="aria-"+t.content,n=x.id;Yg(b.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(r);if(b.state.isVisible)e.setAttribute(r,t?t+" "+n:n);else{var i=t&&t.replace(n,"").trim();i?e.setAttribute(r,i):e.removeAttribute(r)}}))}}function R(){!S&&b.props.aria.expanded&&Yg(b.props.triggerTarget||e).forEach((function(e){b.props.interactive?e.setAttribute("aria-expanded",b.state.isVisible&&e===N()?"true":"false"):e.removeAttribute("aria-expanded")}))}function I(){k().removeEventListener("mousemove",g),Ny=Ny.filter((function(e){return e!==g}))}function P(t){if(!cy.isTouch||!f&&"mousedown"!==t.type){var r=t.composedPath&&t.composedPath()[0]||t.target;if(!b.props.interactive||!uy(x,r)){if(Yg(b.props.triggerTarget||e).some((function(e){return uy(e,r)}))){if(cy.isTouch)return;if(b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else L("onClickOutside",[b,t]);!0===b.props.hideOnClick&&(b.clearDelayTimeouts(),b.hide(),h=!0,setTimeout((function(){h=!1})),b.state.isMounted||z())}}}function B(){f=!0}function U(){f=!1}function $(){var e=k();e.addEventListener("mousedown",P,!0),e.addEventListener("touchend",P,qg),e.addEventListener("touchstart",U,qg),e.addEventListener("touchmove",B,qg)}function z(){var e=k();e.removeEventListener("mousedown",P,!0),e.removeEventListener("touchend",P,qg),e.removeEventListener("touchstart",U,qg),e.removeEventListener("touchmove",B,qg)}function j(e,t){var r=M().box;function n(e){e.target===r&&(ly(r,"remove",n),t())}if(0===e)return t();ly(r,"remove",a),ly(r,"add",n),a=n}function q(t,r,n){void 0===n&&(n=!1),Yg(b.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,r,n),m.push({node:e,eventType:t,handler:r,options:n})}))}function H(){var e;T()&&(q("touchstart",G,{passive:!0}),q("touchend",W,{passive:!0})),(e=b.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(q(e,G),e){case"mouseenter":q("mouseleave",W);break;case"focus":q(my?"focusout":"blur",Y);break;case"focusin":q("focusout",Y)}}))}function V(){m.forEach((function(e){var t=e.node,r=e.eventType,n=e.handler,i=e.options;t.removeEventListener(r,n,i)})),m=[]}function G(e){var t,r=!1;if(b.state.isEnabled&&!J(e)&&!h){var n="focus"===(null==(t=s)?void 0:t.type);s=e,l=e.currentTarget,R(),!b.state.isVisible&&ry(e)&&Ny.forEach((function(t){return t(e)})),"click"===e.type&&(b.props.trigger.indexOf("mouseenter")<0||d)&&!1!==b.props.hideOnClick&&b.state.isVisible?r=!0:ee(e),"click"===e.type&&(d=!r),r&&!n&&te(e)}}function K(e){var t=e.target,r=N().contains(t)||x.contains(t);if("mousemove"!==e.type||!r){var n=Q().concat(x).map((function(e){var t,r=null==(t=e._tippy.popperInstance)?void 0:t.state;return r?{popperRect:e.getBoundingClientRect(),popperState:r,props:c}:null})).filter(Boolean);(function(e,t){var r=t.clientX,n=t.clientY;return e.every((function(e){var t=e.popperRect,i=e.popperState,s=e.props.interactiveBorder,a=Zg(i.placement),o=i.modifiersData.offset;if(!o)return!0;var l="bottom"===a?o.top.y:0,u="top"===a?o.bottom.y:0,c="right"===a?o.left.x:0,d="left"===a?o.right.x:0,h=t.top-n+l>s,f=n-t.bottom-u>s,p=t.left-r+c>s,m=r-t.right-d>s;return h||f||p||m}))})(n,e)&&(I(),te(e))}}function W(e){J(e)||b.props.trigger.indexOf("click")>=0&&d||(b.props.interactive?b.hideWithInteractivity(e):te(e))}function Y(e){b.props.trigger.indexOf("focusin")<0&&e.target!==N()||b.props.interactive&&e.relatedTarget&&x.contains(e.relatedTarget)||te(e)}function J(e){return!!cy.isTouch&&T()!==e.type.indexOf("touch")>=0}function Z(){X();var t=b.props,r=t.popperOptions,n=t.placement,i=t.offset,s=t.getReferenceClientRect,a=t.moveTransition,l=C()?Ay(x).arrow:null,u=s?{getBoundingClientRect:s,contextElement:s.contextElement||N()}:e,c={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(C()){var r=M().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?r.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?r.setAttribute("data-"+e,""):r.removeAttribute("data-"+e)})),t.attributes.popper={}}}},d=[{name:"offset",options:{offset:i}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!a}},c];C()&&l&&d.push({name:"arrow",options:{element:l,padding:3}}),d.push.apply(d,(null==r?void 0:r.modifiers)||[]),b.popperInstance=Bg(u,x,Object.assign({},r,{placement:n,onFirstUpdate:o,modifiers:d}))}function X(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function Q(){return Xg(x.querySelectorAll("[data-tippy-root]"))}function ee(e){b.clearDelayTimeouts(),e&&L("onTrigger",[b,e]),$();var t=O(!0),n=A(),i=n[0],s=n[1];cy.isTouch&&"hold"===i&&s&&(t=s),t?r=setTimeout((function(){b.show()}),t):b.show()}function te(e){if(b.clearDelayTimeouts(),L("onUntrigger",[b,e]),b.state.isVisible){if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&d)){var t=O(!1);t?n=setTimeout((function(){b.state.isVisible&&b.hide()}),t):i=requestAnimationFrame((function(){b.hide()}))}}else z()}}function Oy(e,t){void 0===t&&(t={});var r=yy.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",hy,qg),window.addEventListener("blur",py);var n=Object.assign({},t,{plugins:r}),i=iy(e).reduce((function(e,t){var r=t&&My(t,n);return r&&e.push(r),e}),[]);return ty(e)?i[0]:i}Oy.defaultProps=yy,Oy.setDefaultProps=function(e){Object.keys(e).forEach((function(t){yy[t]=e[t]}))},Oy.currentInput=cy;Object.assign({},bg,{effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow)}});Oy.setDefaultProps({render:Ty});const Fy=Oy;var Ly=[{name:"h2",title:"Heading 2",inline:!0,basic:!1,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setNode("heading",{level:2}).run();n.toggleHeading({level:2}).run()}},{name:"h3",title:"Heading 3",inline:!0,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setNode("heading",{level:3}).run();n.toggleHeading({level:3}).run()}},{name:"h4",title:"Heading 4",inline:!0,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setNode("heading",{level:4}).run();n.toggleHeading({level:4}).run()}},{name:"bold",title:"Bold",inline:!0,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setMark("bold").run();n.toggleMark("bold").run()}},{name:"italic",title:"Italic",inline:!0,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setMark("italic").run();n.toggleItalic().run()}},{name:"strike",title:"Strikethrough",inline:!0,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setMark("strikethrough").run();n.toggleStrike().run()}},{name:"blockquote",title:"Blockquote",inline:!1,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setBlockquote("blockquote").run();n.toggleBlockquote().run()}},{name:"hr",title:"Horizontal Rule",inline:!1,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).setHorizontalRule("hr").run();n.setHorizontalRule("hr").run()}},{name:"ul",title:"Unordered List",inline:!1,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).toggleBulletList().run();n.toggleBulletList().run()}},{name:"ol",title:"Ordered List",inline:!1,command:function(e){var t=e.editor,r=e.range,n=t.chain().focus();if(r)return n.deleteRange(r).toggleOrderedList().run();n.toggleOrderedList().run()}},{name:"img",title:"Image",inline:!1,command:function(e){var t=e.editor,r=e.range,n=window.prompt("Enter the image URL");if(null!==n)return t.chain().focus().deleteRange(r).setImage({src:n,alt:"TODO"}).run()}},{name:"link",title:"Link",inline:!0,command:function(e){var t=e.editor,r=e.range,n=t.getAttributes("link").href,i=window.prompt("Enter your link URL",n);if(null!==i){var s=t.chain().focus();r&&s.deleteRange(r),""!==i?s.extendMarkRange("link").setLink({href:i}).run():s.extendMarkRange("link").unsetLink().run()}}},{name:"html",title:"HTML",inline:!1,basic:!1,command:function(e){var t=e.editor,r=e.range,n=window.prompt("Enter your HTML");null!==n&&(r&&t.chain().focus().deleteRange(r).run(),t.commands.insertContent(n))}}];function _y(e){return _y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_y(e)}function Ry(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Iy(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ry(Object(r),!0).forEach((function(t){Py(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ry(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Py(e,t,r){return t=function(e){var t=function(e,t){if("object"!==_y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===_y(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function By(e){return function(e){if(Array.isArray(e))return Uy(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Uy(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uy(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Uy(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var zy=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},jy="object"==typeof $y&&$y&&$y.Object===Object&&$y,qy="object"==typeof self&&self&&self.Object===Object&&self,Hy=jy||qy||Function("return this")(),Vy=Hy,Gy=function(){return Vy.Date.now()},Ky=/\s/;var Wy=function(e){for(var t=e.length;t--&&Ky.test(e.charAt(t)););return t},Yy=Wy,Jy=/^\s+/;var Zy=function(e){return e?e.slice(0,Yy(e)+1).replace(Jy,""):e},Xy=Hy.Symbol,Qy=Xy,ev=Object.prototype,tv=ev.hasOwnProperty,rv=ev.toString,nv=Qy?Qy.toStringTag:void 0;var iv=function(e){var t=tv.call(e,nv),r=e[nv];try{e[nv]=void 0;var n=!0}catch(e){}var i=rv.call(e);return n&&(t?e[nv]=r:delete e[nv]),i},sv=Object.prototype.toString;var av=iv,ov=function(e){return sv.call(e)},lv=Xy?Xy.toStringTag:void 0;var uv=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":lv&&lv in Object(e)?av(e):ov(e)},cv=function(e){return null!=e&&"object"==typeof e};var dv=Zy,hv=zy,fv=function(e){return"symbol"==typeof e||cv(e)&&"[object Symbol]"==uv(e)},pv=/^[-+]0x[0-9a-f]+$/i,mv=/^0b[01]+$/i,gv=/^0o[0-7]+$/i,yv=parseInt;var vv=function(e){if("number"==typeof e)return e;if(fv(e))return NaN;if(hv(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=hv(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=dv(e);var r=mv.test(e);return r||gv.test(e)?yv(e.slice(2),r?2:8):pv.test(e)?NaN:+e},bv=zy,wv=Gy,xv=vv,Ev=Math.max,Dv=Math.min;var Sv=function(e,t,r){var n,i,s,a,o,l,u=0,c=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var r=n,s=i;return n=i=void 0,u=t,a=e.apply(s,r)}function p(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-u>=s}function m(){var e=wv();if(p(e))return g(e);o=setTimeout(m,function(e){var r=t-(e-l);return d?Dv(r,s-(e-u)):r}(e))}function g(e){return o=void 0,h&&n?f(e):(n=i=void 0,a)}function y(){var e=wv(),r=p(e);if(n=arguments,i=this,l=e,r){if(void 0===o)return function(e){return u=e,o=setTimeout(m,t),c?f(e):a}(l);if(d)return clearTimeout(o),o=setTimeout(m,t),f(l)}return void 0===o&&(o=setTimeout(m,t)),a}return t=xv(t)||0,bv(r)&&(c=!!r.leading,s=(d="maxWait"in r)?Ev(xv(r.maxWait)||0,t):s,h="trailing"in r?!!r.trailing:h),y.cancel=function(){void 0!==o&&clearTimeout(o),u=0,n=l=i=o=void 0},y.flush=function(){return void 0===o?a:g(wv())},y};class Av{constructor({editor:e,element:t,view:r,tippyOptions:n={},updateDelay:i=250,shouldShow:s}){this.preventHide=!1,this.shouldShow=({view:e,state:t,from:r,to:n})=>{const{doc:i,selection:s}=t,{empty:a}=s,o=!i.textBetween(r,n).length&&jd(t.selection),l=this.element.contains(document.activeElement);return!(!e.hasFocus()&&!l||a||o||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:e})=>{var t;this.preventHide?this.preventHide=!1:(null==e?void 0:e.relatedTarget)&&(null===(t=this.element.parentNode)||void 0===t?void 0:t.contains(e.relatedTarget))||this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.updateHandler=(e,t)=>{var r,n,i;const{state:s,composing:a}=e,{doc:o,selection:l}=s,u=t&&t.doc.eq(o)&&t.selection.eq(l);if(a||u)return;this.createTooltip();const{ranges:c}=l,d=Math.min(...c.map((e=>e.$from.pos))),h=Math.max(...c.map((e=>e.$to.pos)));(null===(r=this.shouldShow)||void 0===r?void 0:r.call(this,{editor:this.editor,view:e,state:s,oldState:t,from:d,to:h}))?(null===(n=this.tippy)||void 0===n||n.setProps({getReferenceClientRect:(null===(i=this.tippyOptions)||void 0===i?void 0:i.getReferenceClientRect)||(()=>{if(s.selection instanceof Wa){const t=e.nodeDOM(d);if(t)return t.getBoundingClientRect()}return function(e,t,r){const n=e.state.doc.content.size,i=qd(t,0,n),s=qd(r,0,n),a=e.coordsAtPos(i),o=e.coordsAtPos(s,-1),l=Math.min(a.top,o.top),u=Math.max(a.bottom,o.bottom),c=Math.min(a.left,o.left),d=Math.max(a.right,o.right),h={top:l,bottom:u,left:c,right:d,width:d-c,height:u-l,x:c,y:l};return{...h,toJSON:()=>h}}(e,d,h)})}),this.show()):this.hide()},this.editor=e,this.element=t,this.view=r,this.updateDelay=i,s&&(this.shouldShow=s),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=n,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;!this.tippy&&t&&(this.tippy=Fy(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){const{state:r}=e,n=r.selection.$from.pos!==r.selection.$to.pos;this.updateDelay>0&&n?Sv(this.updateHandler,this.updateDelay)(e,t):this.updateHandler(e,t)}show(){var e;null===(e=this.tippy)||void 0===e||e.show()}hide(){var e;null===(e=this.tippy)||void 0===e||e.hide()}destroy(){var e,t;(null===(e=this.tippy)||void 0===e?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(t=this.tippy)||void 0===t||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Tv=e=>new oo({key:"string"==typeof e.pluginKey?new co(e.pluginKey):e.pluginKey,view:t=>new Av({view:t,...e})}),Cv=Ld.create({name:"bubbleMenu",addOptions:()=>({element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}),addProseMirrorPlugins(){return this.options.element?[Tv({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});var Nv=[{name:"Select Language",code:""},{name:"HTML",code:"html"},{name:"Edge",code:"edge"},{name:"CSS",code:"css"},{name:"JavaScript",code:"js"},{name:"ABAP",code:"abap"},{name:"Augmented Backus-Naur form",code:"abnf"},{name:"ActionScript",code:"actionscript"},{name:"Ada",code:"ada"},{name:"AL",code:"al"},{name:"ANTLR4",code:"antlr4"},{name:"Apache Configuration",code:"apacheconf"},{name:"APL",code:"apl"},{name:"AppleScript",code:"applescript"},{name:"AQL",code:"aql"},{name:"Arduino",code:"arduino"},{name:"ARFF",code:"arff"},{name:"AsciiDoc",code:"asciidoc"},{name:"6502 Assembly",code:"asm6502"},{name:"ASP.NET (C#)",code:"aspnet"},{name:"AutoHotkey",code:"autohotkey"},{name:"AutoIt",code:"autoit"},{name:"Bash",code:"bash"},{name:"BASIC",code:"basic"},{name:"Batch",code:"batch"},{name:"BBcode",code:"bbcode"},{name:"Bison",code:"bison"},{name:"Backus–Naur form",code:"bnf"},{name:"Brainfuck",code:"brainfuck"},{name:"BrightScript",code:"brightscript"},{name:"Bro",code:"bro"},{name:"C",code:"c"},{name:"Concurnas",code:"concurnas"},{name:"C#",code:"csharp"},{name:"C++",code:"cpp"},{name:"CIL",code:"cil"},{name:"CoffeeScript",code:"coffeescript"},{name:"CMake",code:"cmake"},{name:"Clojure",code:"clojure"},{name:"Crystal",code:"crystal"},{name:"Content-Security-Policy",code:"csp"},{name:"CSS Extras",code:"css-extras"},{name:"D",code:"d"},{name:"Dart",code:"dart"},{name:"DAX",code:"dax"},{name:"Diff",code:"diff"},{name:"DNS zone file",code:"dns-zone-file"},{name:"Docker",code:"docker"},{name:"Extended Backus–Naur form",code:"ebnf"},{name:"Eiffel",code:"eiffel"},{name:"EJS",code:"ejs"},{name:"Elixir",code:"elixir"},{name:"Elm",code:"elm"},{name:"Embedded Lua templating",code:"etlua"},{name:"ERB",code:"erb"},{name:"Erlang",code:"erlang"},{name:"Excel Formula",code:"xlsx"},{name:"F#",code:"fsharp"},{name:"Factor",code:"factor"},{name:"Firestore security rules",code:"firestore-security-rules"},{name:"Flow",code:"flow"},{name:"Fortran",code:"fortran"},{name:"FreeMarker Template Language",code:"ftl"},{name:"G-code",code:"gcode"},{name:"GDScript",code:"gdscript"},{name:"GEDCOM",code:"gedcom"},{name:"Gherkin",code:"gherkin"},{name:"Git",code:"git"},{name:"GLSL",code:"glsl"},{name:"GameMaker Language",code:"gml"},{name:"Go",code:"go"},{name:"GraphQL",code:"graphql"},{name:"Groovy",code:"groovy"},{name:"Haml",code:"haml"},{name:"Handlebars",code:"handlebars"},{name:"Haskell",code:"haskell"},{name:"Haxe",code:"haxe"},{name:"HCL",code:"hcl"},{name:"HLSL",code:"hlsl"},{name:"HTTP",code:"http"},{name:"HTTP Public-Key-Pins",code:"hpkp"},{name:"HTTP Strict-Transport-Security",code:"hsts"},{name:"IchigoJam",code:"ichigojam"},{name:"Icon",code:"icon"},{name:"Structured Text (IEC 61131-3)",code:"iecst"},{name:"Inform 7",code:"inform7"},{name:"Ini",code:"ini"},{name:"Io",code:"io"},{name:"J",code:"j"},{name:"Java",code:"java"},{name:"JavaDoc",code:"javadoc"},{name:"JavaDoc-like",code:"javadoclike"},{name:"Java stack trace",code:"javastacktrace"},{name:"Jinja2",code:"jinja2"},{name:"Jolie",code:"jolie"},{name:"JQ",code:"jq"},{name:"JSDoc",code:"jsdoc"},{name:"JS Extras",code:"js-extras"},{name:"JS Templates",code:"js-templates"},{name:"JSON",code:"json"},{name:"JSONP",code:"jsonp"},{name:"JSON5",code:"json5"},{name:"Julia",code:"julia"},{name:"Keyman",code:"keyman"},{name:"Kotlin",code:"kotlin"},{name:"LaTeX",code:"latex"},{name:"Latte",code:"latte"},{name:"Less",code:"less"},{name:"LilyPond",code:"lilypond"},{name:"Liquid",code:"liquid"},{name:"Lisp",code:"lisp"},{name:"LiveScript",code:"livescript"},{name:"LLVM IR",code:"llvm"},{name:"LOLCODE",code:"lolcode"},{name:"Lua",code:"lua"},{name:"Makefile",code:"makefile"},{name:"Markdown",code:"markdown"},{name:"Markup templating",code:"markup-templating"},{name:"MATLAB",code:"matlab"},{name:"MEL",code:"mel"},{name:"Mizar",code:"mizar"},{name:"Monkey",code:"monkey"},{name:"MoonScript",code:"moonscript"},{name:"N1QL",code:"n1ql"},{name:"N4JS",code:"n4js"},{name:"Nand To Tetris HDL",code:"nand2tetris-hdl"},{name:"NASM",code:"nasm"},{name:"NEON",code:"neon"},{name:"nginx",code:"nginx"},{name:"Nim",code:"nim"},{name:"Nix",code:"nix"},{name:"NSIS",code:"nsis"},{name:"Objective-C",code:"objectivec"},{name:"OCaml",code:"ocaml"},{name:"OpenCL",code:"opencl"},{name:"Oz",code:"oz"},{name:"PARI/GP",code:"parigp"},{name:"Parser",code:"parser"},{name:"Pascal",code:"pascal"},{name:"Pascaligo",code:"pascaligo"},{name:"PC-Axis",code:"pcaxis"},{name:"PeopleCode",code:"peoplecode"},{name:"Perl",code:"perl"},{name:"PHP",code:"php"},{name:"PHPDoc",code:"phpdoc"},{name:"PHP Extras",code:"php-extras"},{name:"PL/SQL",code:"plsql"},{name:"PowerQuery",code:"powerquery"},{name:"PowerShell",code:"powershell"},{name:"Processing",code:"processing"},{name:"Prolog",code:"prolog"},{name:".properties",code:"properties"},{name:"Protocol Buffers",code:"protobuf"},{name:"Pug",code:"pug"},{name:"Puppet",code:"puppet"},{name:"Pure",code:"pure"},{name:"PureBasic",code:"purebasic"},{name:"Python",code:"python"},{name:"Q (kdb+ database)",code:"q"},{name:"QML",code:"qml"},{name:"Qore",code:"qore"},{name:"R",code:"r"},{name:"Racket",code:"racket"},{name:"React JSX",code:"jsx"},{name:"React TSX",code:"tsx"},{name:"Ren'py",code:"renpy"},{name:"Reason",code:"reason"},{name:"Regex",code:"regex"},{name:"reST (reStructuredText)",code:"rest"},{name:"Rip",code:"rip"},{name:"Roboconf",code:"roboconf"},{name:"Robot Framework",code:"robotframework"},{name:"Ruby",code:"ruby"},{name:"Rust",code:"rust"},{name:"SAS",code:"sas"},{name:"Sass (Sass)",code:"sass"},{name:"Sass (Scss)",code:"scss"},{name:"Scala",code:"scala"},{name:"Scheme",code:"scheme"},{name:"Shell session",code:"shell-session"},{name:"Smalltalk",code:"smalltalk"},{name:"Smarty",code:"smarty"},{name:"Solidity (Ethereum)",code:"solidity"},{name:"Solution file",code:"solution-file"},{name:"Soy (Closure Template)",code:"soy"},{name:"SPARQL",code:"sparql"},{name:"Splunk SPL",code:"splunk-spl"},{name:"SQF: Status Quo Function (Arma 3)",code:"sqf"},{name:"SQL",code:"sql"},{name:"Stylus",code:"stylus"},{name:"Swift",code:"swift"},{name:"TAP",code:"tap"},{name:"Tcl",code:"tcl"},{name:"Textile",code:"textile"},{name:"TOML",code:"toml"},{name:"Template Toolkit 2",code:"tt2"},{name:"Turtle",code:"turtle"},{name:"Twig",code:"twig"},{name:"TypeScript",code:"typescript"},{name:"T4 Text Templates (C#)",code:"t4-cs"},{name:"T4 Text Templates (VB)",code:"t4-vb"},{name:"T4 templating",code:"t4-templating"},{name:"UnrealScript",code:"unrealscript"},{name:"Vala",code:"vala"},{name:"VB.Net",code:"vbnet"},{name:"Velocity",code:"velocity"},{name:"Verilog",code:"verilog"},{name:"VHDL",code:"vhdl"},{name:"vim",code:"vim"},{name:"Visual Basic",code:"visual-basic"},{name:"WarpScript",code:"warpscript"},{name:"WebAssembly",code:"wasm"},{name:"Wiki markup",code:"wiki"},{name:"Xeora",code:"xeora"},{name:"XML doc (.net)",code:"xml-doc"},{name:"Xojo (REALbasic)",code:"xojo"},{name:"XQuery",code:"xquery"},{name:"YAML",code:"yaml"},{name:"Zig",code:"zig"}];const kv=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Mv=Th.create({name:"image",addOptions:()=>({inline:!1,allowBase64:!1,HTMLAttributes:{}}),inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes:()=>({src:{default:null},alt:{default:null},title:{default:null}}),parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:e}){return["img",hd(this.options.HTMLAttributes,e)]},addCommands(){return{setImage:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[xh({find:kv,type:this.type,getAttributes:e=>{const[,,t,r,n]=e;return{src:r,alt:t,title:n}}})]}}),Ov=Dh({find:/--$/,replace:"—"}),Fv=Dh({find:/\.\.\.$/,replace:"…"}),Lv=Dh({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:"“"}),_v=Dh({find:/"$/,replace:"”"}),Rv=Dh({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:"‘"}),Iv=Dh({find:/'$/,replace:"’"}),Pv=Dh({find:/<-$/,replace:"←"}),Bv=Dh({find:/->$/,replace:"→"}),Uv=Dh({find:/\(c\)$/,replace:"©"}),$v=Dh({find:/\(tm\)$/,replace:"™"}),zv=Dh({find:/\(sm\)$/,replace:"℠"}),jv=Dh({find:/\(r\)$/,replace:"®"}),qv=Dh({find:/(?:^|\s)(1\/2)$/,replace:"½"}),Hv=Dh({find:/\+\/-$/,replace:"±"}),Vv=Dh({find:/!=$/,replace:"≠"}),Gv=Dh({find:/<<$/,replace:"«"}),Kv=Dh({find:/>>$/,replace:"»"}),Wv=Dh({find:/\d+\s?([*x])\s?\d+$/,replace:"×"}),Yv=Dh({find:/\^2$/,replace:"²"}),Jv=Dh({find:/\^3$/,replace:"³"}),Zv=Dh({find:/(?:^|\s)(1\/4)$/,replace:"¼"}),Xv=Dh({find:/(?:^|\s)(3\/4)$/,replace:"¾"}),Qv=Ld.create({name:"typography",addInputRules(){const e=[];return!1!==this.options.emDash&&e.push(Ov),!1!==this.options.ellipsis&&e.push(Fv),!1!==this.options.openDoubleQuote&&e.push(Lv),!1!==this.options.closeDoubleQuote&&e.push(_v),!1!==this.options.openSingleQuote&&e.push(Rv),!1!==this.options.closeSingleQuote&&e.push(Iv),!1!==this.options.leftArrow&&e.push(Pv),!1!==this.options.rightArrow&&e.push(Bv),!1!==this.options.copyright&&e.push(Uv),!1!==this.options.trademark&&e.push($v),!1!==this.options.servicemark&&e.push(zv),!1!==this.options.registeredTrademark&&e.push(jv),!1!==this.options.oneHalf&&e.push(qv),!1!==this.options.plusMinus&&e.push(Hv),!1!==this.options.notEqual&&e.push(Vv),!1!==this.options.laquo&&e.push(Gv),!1!==this.options.raquo&&e.push(Kv),!1!==this.options.multiplication&&e.push(Wv),!1!==this.options.superscriptTwo&&e.push(Yv),!1!==this.options.superscriptThree&&e.push(Jv),!1!==this.options.oneQuarter&&e.push(Zv),!1!==this.options.threeQuarters&&e.push(Xv),e}});function eb(e){return function(e){if(Array.isArray(e))return tb(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return tb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tb(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tb(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}window.setupEditor=function(e){var t;return{isInitialized:!1,isFocused:!1,content:e,updatedAt:Date.now(),language:"ts",languages:eb(Nv),isActive:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isActive(e,r)},chain:function(){return t.chain()},command:function(e){return Ly.find((function(t){return t.name===e})).command({editor:t})},init:function(e){var r,n,i,s=this;e&&(t=new bh({element:e,extensions:[Uf,Cv.configure({element:document.querySelector(".bubble-menu")}),$f.configure({placeholder:"Type / to see available commands"}),fm.configure({autolink:!0,linkOnPaste:!0,HTMLAttributes:{target:"_blank",rel:"nofollow noopener noreferrer"}}),kh.configure({}),Gh.configure({}),tf.configure({}),Mv.configure({}),Qv.configure({openDoubleQuote:!1,closeDoubleQuote:!1,openSingleQuote:!1,closeSingleQuote:!1}),jh.configure({languageClassPrefix:"language-",HTMLAttributes:{class:"code-block"}}).extend({addNodeView:function(){return function(e){var t=document.createElement("div");t.classList.add("code-block","relative"),t.dataset.nodeViewWrapper="";var r=document.createElement("pre"),n=document.createElement("code");n.style="white-space: pre-wrap;",r.append(n),t.append(r);var i=document.createElement("select");return i.classList.add("absolute","top-1","right-1","rounded","text-xs","text-gray-200","bg-gray-900","border-gray-800","px-2","py-1"),i.contentEditable=!1,i.addEventListener("change",(function(t){var r=e.editor.view,n=t.target.value;r.dispatch(r.state.tr.setNodeMarkup(e.getPos(),void 0,{language:n}))})),Nv.map((function(t){var r=document.createElement("option");r.value=t.code,r.textContent=t.name,r.selected=t.code===e.node.attrs.language,i.append(r)})),t.append(i),{dom:t,contentDOM:r}}}}),wm.configure({suggestion:(r={isBasic:!0},n=r.isBasic,i=void 0===n||n,{items:function(e){var t=e.query;return By(Ly).filter((function(e){var r=e.title.toLowerCase().startsWith(t.toLowerCase()),n=e.name.toLowerCase().startsWith(t.toLowerCase());return(!i||!1!==e.basic)&&(r||n)}))},render:function(){var e,t,r,n=document.getElementById("context"),i=function(e,t){var r=new CustomEvent("mounted",{detail:{name:e,data:t}});n.dispatchEvent(r)},s=function(e,t,r){var i=new CustomEvent("call",{detail:{namespace:e,name:t,args:r}});n.dispatchEvent(i)};return{onStart:function(a){r={selectedIndex:0,items:(e=a).items,onClick:function(t){var r=this.items[t];r&&e.command(r)},onKeyDown:function(e){var t=e.event;return"ArrowUp"===t.key?(s("tiptapCommand","upHandler"),!0):"ArrowDown"===t.key?(s("tiptapCommand","downHandler"),!0):"Enter"===t.key&&(s("tiptapCommand","enterHandler"),!0)},upHandler:function(){this.selectedIndex=(this.selectedIndex+this.items.length-1)%this.items.length},downHandler:function(){this.selectedIndex=(this.selectedIndex+1)%this.items.length},enterHandler:function(){this.onClick(this.selectedIndex)}},t=Fy("body",{allowHTML:!0,getReferenceClientRect:e.clientRect,appendTo:function(){return n},content:'\n          <div class="items flex flex-col bg-slate-100 border border-slate-200 shadow-xl rounded-lg p-2">\n            <template x-for="(item, index) in state.tiptapCommand.items" :key="index">\n              <button class="item w-full pl-3 pr-12 rounded-lg text-left" :class="{ \'bg-brand-400\': state.tiptapCommand.selectedIndex === index }" @click="state.tiptapCommand.onClick(index)" class="block py-1">\n                <div class="title" class="text-left" x-text="item.title"></div>\n              </button>\n            </template>\n            <div x-show="!state.tiptapCommand.items.length" class="text-slate-600">\n              No results found\n            </div>\n          </div>\n        ',showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"}),i("tiptapCommand",r)},onUpdate:function(n){e=n,r.selectedIndex=0,r.items=n.items,i("tiptapCommand",Iy(Iy({},r),n)),t[0].setProps({getReferenceClientRect:n.clientRect})},onKeyDown:function(e){return"Escape"===e.event.key?(t[0].hide(),!0):r.onKeyDown(e)},onExit:function(){t[0].destroy()}}}})})],content:this.content,onUpdate:function(e){var t=e.editor;s.content=t.getHTML()},onFocus:function(){s.isFocused=!0},onBlur:function(){s.isFocused=!1},onSelectionUpdate:function(){s.updatedAt=Date.now()}}),this.isInitialized=!0)}}};var rb,nb,ib,sb,ab=!1,ob=!1,lb=[],ub=-1;function cb(e){!function(e){lb.includes(e)||lb.push(e);ob||ab||(ab=!0,queueMicrotask(hb))}(e)}function db(e){let t=lb.indexOf(e);-1!==t&&t>ub&&lb.splice(t,1)}function hb(){ab=!1,ob=!0;for(let e=0;e<lb.length;e++)lb[e](),ub=e;lb.length=0,ub=-1,ob=!1}var fb=!0;function pb(e){nb=e}var mb=[],gb=[],yb=[];function vb(e,t){"function"==typeof t?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,gb.push(t))}function bb(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach((([r,n])=>{(void 0===t||t.includes(r))&&(n.forEach((e=>e())),delete e._x_attributeCleanups[r])}))}var wb=new MutationObserver(kb),xb=!1;function Eb(){wb.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),xb=!0}function Db(){(Sb=Sb.concat(wb.takeRecords())).length&&!Ab&&(Ab=!0,queueMicrotask((()=>{kb(Sb),Sb.length=0,Ab=!1}))),wb.disconnect(),xb=!1}var Sb=[],Ab=!1;function Tb(e){if(!xb)return e();Db();let t=e();return Eb(),t}var Cb=!1,Nb=[];function kb(e){if(Cb)return void(Nb=Nb.concat(e));let t=[],r=[],n=new Map,i=new Map;for(let s=0;s<e.length;s++)if(!e[s].target._x_ignoreMutationObserver&&("childList"===e[s].type&&(e[s].addedNodes.forEach((e=>1===e.nodeType&&t.push(e))),e[s].removedNodes.forEach((e=>1===e.nodeType&&r.push(e)))),"attributes"===e[s].type)){let t=e[s].target,r=e[s].attributeName,a=e[s].oldValue,o=()=>{n.has(t)||n.set(t,[]),n.get(t).push({name:r,value:t.getAttribute(r)})},l=()=>{i.has(t)||i.set(t,[]),i.get(t).push(r)};t.hasAttribute(r)&&null===a?o():t.hasAttribute(r)?(l(),o()):l()}i.forEach(((e,t)=>{bb(t,e)})),n.forEach(((e,t)=>{mb.forEach((r=>r(t,e)))}));for(let e of r)if(!t.includes(e)&&(gb.forEach((t=>t(e))),e._x_cleanups))for(;e._x_cleanups.length;)e._x_cleanups.pop()();t.forEach((e=>{e._x_ignoreSelf=!0,e._x_ignore=!0}));for(let e of t)r.includes(e)||e.isConnected&&(delete e._x_ignoreSelf,delete e._x_ignore,yb.forEach((t=>t(e))),e._x_ignore=!0,e._x_ignoreSelf=!0);t.forEach((e=>{delete e._x_ignoreSelf,delete e._x_ignore})),t=null,r=null,n=null,i=null}function Mb(e){return Lb(Fb(e))}function Ob(e,t,r){return e._x_dataStack=[t,...Fb(r||e)],()=>{e._x_dataStack=e._x_dataStack.filter((e=>e!==t))}}function Fb(e){return e._x_dataStack?e._x_dataStack:"function"==typeof ShadowRoot&&e instanceof ShadowRoot?Fb(e.host):e.parentNode?Fb(e.parentNode):[]}function Lb(e){let t=new Proxy({},{ownKeys:()=>Array.from(new Set(e.flatMap((e=>Object.keys(e))))),has:(t,r)=>e.some((e=>e.hasOwnProperty(r))),get:(r,n)=>(e.find((e=>{if(e.hasOwnProperty(n)){let r=Object.getOwnPropertyDescriptor(e,n);if(r.get&&r.get._x_alreadyBound||r.set&&r.set._x_alreadyBound)return!0;if((r.get||r.set)&&r.enumerable){let i=r.get,s=r.set,a=r;i=i&&i.bind(t),s=s&&s.bind(t),i&&(i._x_alreadyBound=!0),s&&(s._x_alreadyBound=!0),Object.defineProperty(e,n,{...a,get:i,set:s})}return!0}return!1}))||{})[n],set:(t,r,n)=>{let i=e.find((e=>e.hasOwnProperty(r)));return i?i[r]=n:e[e.length-1][r]=n,!0}});return t}function _b(e){let t=(r,n="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach((([i,{value:s,enumerable:a}])=>{if(!1===a||void 0===s)return;let o=""===n?i:`${n}.${i}`;var l;"object"==typeof s&&null!==s&&s._x_interceptor?r[i]=s.initialize(e,o,i):"object"!=typeof(l=s)||Array.isArray(l)||null===l||s===r||s instanceof Element||t(s,o)}))};return t(e)}function Rb(e,t=(()=>{})){let r={initialValue:void 0,_x_interceptor:!0,initialize(t,r,n){return e(this.initialValue,(()=>function(e,t){return t.split(".").reduce(((e,t)=>e[t]),e)}(t,r)),(e=>Ib(t,r,e)),r,n)}};return t(r),e=>{if("object"==typeof e&&null!==e&&e._x_interceptor){let t=r.initialize.bind(r);r.initialize=(n,i,s)=>{let a=e.initialize(n,i,s);return r.initialValue=a,t(n,i,s)}}else r.initialValue=e;return r}}function Ib(e,t,r){if("string"==typeof t&&(t=t.split(".")),1!==t.length){if(0===t.length)throw error;return e[t[0]]||(e[t[0]]={}),Ib(e[t[0]],t.slice(1),r)}e[t[0]]=r}var Pb={};function Bb(e,t){Pb[e]=t}function Ub(e,t){return Object.entries(Pb).forEach((([r,n])=>{let i=null;Object.defineProperty(e,`$${r}`,{get:()=>n(t,function(){if(i)return i;{let[e,r]=sw(t);return i={interceptor:Rb,...e},vb(t,r),i}}()),enumerable:!1})})),e}function $b(e,t,r,...n){try{return r(...n)}catch(r){zb(r,e,t)}}function zb(e,t,r=void 0){Object.assign(e,{el:t,expression:r}),console.warn(`Alpine Expression Error: ${e.message}\n\n${r?'Expression: "'+r+'"\n\n':""}`,t),setTimeout((()=>{throw e}),0)}var jb=!0;function qb(e){let t=jb;jb=!1;let r=e();return jb=t,r}function Hb(e,t,r={}){let n;return Vb(e,t)((e=>n=e),r),n}function Vb(...e){return Gb(...e)}var Gb=Kb;function Kb(e,t){let r={};Ub(r,e);let n=[r,...Fb(e)],i="function"==typeof t?function(e,t){return(r=(()=>{}),{scope:n={},params:i=[]}={})=>{Yb(r,t.apply(Lb([n,...e]),i))}}(n,t):function(e,t,r){let n=function(e,t){if(Wb[e])return Wb[e];let r=Object.getPrototypeOf((async function(){})).constructor,n=/^[\n\s]*if.*\(.*\)/.test(e)||/^(let|const)\s/.test(e)?`(async()=>{ ${e} })()`:e;const i=()=>{try{return new r(["__self","scope"],`with (scope) { __self.result = ${n} }; __self.finished = true; return __self.result;`)}catch(r){return zb(r,t,e),Promise.resolve()}};let s=i();return Wb[e]=s,s}(t,r);return(i=(()=>{}),{scope:s={},params:a=[]}={})=>{n.result=void 0,n.finished=!1;let o=Lb([s,...e]);if("function"==typeof n){let e=n(n,o).catch((e=>zb(e,r,t)));n.finished?(Yb(i,n.result,o,a,r),n.result=void 0):e.then((e=>{Yb(i,e,o,a,r)})).catch((e=>zb(e,r,t))).finally((()=>n.result=void 0))}}}(n,t,e);return $b.bind(null,e,t,i)}var Wb={};function Yb(e,t,r,n,i){if(jb&&"function"==typeof t){let s=t.apply(r,n);s instanceof Promise?s.then((t=>Yb(e,t,r,n))).catch((e=>zb(e,i,t))):e(s)}else"object"==typeof t&&t instanceof Promise?t.then((t=>e(t))):e(t)}var Jb="x-";function Zb(e=""){return Jb+e}var Xb={};function Qb(e,t){return Xb[e]=t,{before(t){if(!Xb[t])return void console.warn("Cannot find directive `${directive}`. `${name}` will use the default order of execution");const r=fw.indexOf(t);fw.splice(r>=0?r:fw.indexOf("DEFAULT"),0,e)}}}function ew(e,t,r){if(t=Array.from(t),e._x_virtualDirectives){let r=Object.entries(e._x_virtualDirectives).map((([e,t])=>({name:e,value:t}))),n=tw(r);r=r.map((e=>n.find((t=>t.name===e.name))?{name:`x-bind:${e.name}`,value:`"${e.value}"`}:e)),t=t.concat(r)}let n={},i=t.map(ow(((e,t)=>n[e]=t))).filter(cw).map(function(e,t){return({name:r,value:n})=>{let i=r.match(dw()),s=r.match(/:([a-zA-Z0-9\-:]+)/),a=r.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],o=t||e[r]||r;return{type:i?i[1]:null,value:s?s[1]:null,modifiers:a.map((e=>e.replace(".",""))),expression:n,original:o}}}(n,r)).sort(pw);return i.map((t=>function(e,t){let r=()=>{},n=Xb[t.type]||r,[i,s]=sw(e);!function(e,t,r){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(r)}(e,t.original,s);let a=()=>{e._x_ignore||e._x_ignoreSelf||(n.inline&&n.inline(e,t,i),n=n.bind(n,e,t,i),rw?nw.get(iw).push(n):n())};return a.runCleanups=s,a}(e,t)))}function tw(e){return Array.from(e).map(ow()).filter((e=>!cw(e)))}var rw=!1,nw=new Map,iw=Symbol();function sw(e){let t=[],[r,n]=function(e){let t=()=>{};return[r=>{let n=nb(r);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach((e=>e()))}),e._x_effects.add(n),t=()=>{void 0!==n&&(e._x_effects.delete(n),ib(n))},n},()=>{t()}]}(e);t.push(n);return[{Alpine:nx,effect:r,cleanup:e=>t.push(e),evaluateLater:Vb.bind(Vb,e),evaluate:Hb.bind(Hb,e)},()=>t.forEach((e=>e()))]}var aw=(e,t)=>({name:r,value:n})=>(r.startsWith(e)&&(r=r.replace(e,t)),{name:r,value:n});function ow(e=(()=>{})){return({name:t,value:r})=>{let{name:n,value:i}=lw.reduce(((e,t)=>t(e)),{name:t,value:r});return n!==t&&e(n,t),{name:n,value:i}}}var lw=[];function uw(e){lw.push(e)}function cw({name:e}){return dw().test(e)}var dw=()=>new RegExp(`^${Jb}([^:^.]+)\\b`);var hw="DEFAULT",fw=["ignore","ref","data","id","bind","init","for","model","modelable","transition","show","if",hw,"teleport"];function pw(e,t){let r=-1===fw.indexOf(e.type)?hw:e.type,n=-1===fw.indexOf(t.type)?hw:t.type;return fw.indexOf(r)-fw.indexOf(n)}function mw(e,t,r={}){e.dispatchEvent(new CustomEvent(t,{detail:r,bubbles:!0,composed:!0,cancelable:!0}))}function gw(e,t){if("function"==typeof ShadowRoot&&e instanceof ShadowRoot)return void Array.from(e.children).forEach((e=>gw(e,t)));let r=!1;if(t(e,(()=>r=!0)),r)return;let n=e.firstElementChild;for(;n;)gw(n,t),n=n.nextElementSibling}function yw(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var vw=!1;var bw=[],ww=[];function xw(){return bw.map((e=>e()))}function Ew(){return bw.concat(ww).map((e=>e()))}function Dw(e){bw.push(e)}function Sw(e){ww.push(e)}function Aw(e,t=!1){return Tw(e,(e=>{if((t?Ew():xw()).some((t=>e.matches(t))))return!0}))}function Tw(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),e.parentElement)return Tw(e.parentElement,t)}}var Cw=[];function Nw(e,t=gw,r=(()=>{})){!function(e){rw=!0;let t=Symbol();iw=t,nw.set(t,[]);let r=()=>{for(;nw.get(t).length;)nw.get(t).shift()();nw.delete(t)};e(r),rw=!1,r()}((()=>{t(e,((e,t)=>{r(e,t),Cw.forEach((r=>r(e,t))),ew(e,e.attributes).forEach((e=>e())),e._x_ignore&&t()}))}))}function kw(e){gw(e,(e=>bb(e)))}var Mw=[],Ow=!1;function Fw(e=(()=>{})){return queueMicrotask((()=>{Ow||setTimeout((()=>{Lw()}))})),new Promise((t=>{Mw.push((()=>{e(),t()}))}))}function Lw(){for(Ow=!1;Mw.length;)Mw.shift()()}function _w(e,t){return Array.isArray(t)?Rw(e,t.join(" ")):"object"==typeof t&&null!==t?function(e,t){let r=e=>e.split(" ").filter(Boolean),n=Object.entries(t).flatMap((([e,t])=>!!t&&r(e))).filter(Boolean),i=Object.entries(t).flatMap((([e,t])=>!t&&r(e))).filter(Boolean),s=[],a=[];return i.forEach((t=>{e.classList.contains(t)&&(e.classList.remove(t),a.push(t))})),n.forEach((t=>{e.classList.contains(t)||(e.classList.add(t),s.push(t))})),()=>{a.forEach((t=>e.classList.add(t))),s.forEach((t=>e.classList.remove(t)))}}(e,t):"function"==typeof t?_w(e,t()):Rw(e,t)}function Rw(e,t){return t=!0===t?t="":t||"",(t=>(e.classList.add(...t),()=>{e.classList.remove(...t)}))(t.split(" ").filter((t=>!e.classList.contains(t))).filter(Boolean))}function Iw(e,t){return"object"==typeof t&&null!==t?function(e,t){let r={};return Object.entries(t).forEach((([t,n])=>{r[t]=e.style[t],t.startsWith("--")||(t=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),e.style.setProperty(t,n)})),setTimeout((()=>{0===e.style.length&&e.removeAttribute("style")})),()=>{Iw(e,r)}}(e,t):function(e,t){let r=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",r||"")}}(e,t)}function Pw(e,t=(()=>{})){let r=!1;return function(){r?t.apply(this,arguments):(r=!0,e.apply(this,arguments))}}function Bw(e,t,r={}){e._x_transition||(e._x_transition={enter:{during:r,start:r,end:r},leave:{during:r,start:r,end:r},in(r=(()=>{}),n=(()=>{})){$w(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,n)},out(r=(()=>{}),n=(()=>{})){$w(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,n)}})}function Uw(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:Uw(t)}function $w(e,t,{during:r,start:n,end:i}={},s=(()=>{}),a=(()=>{})){if(e._x_transitioning&&e._x_transitioning.cancel(),0===Object.keys(r).length&&0===Object.keys(n).length&&0===Object.keys(i).length)return s(),void a();let o,l,u;!function(e,t){let r,n,i,s=Pw((()=>{Tb((()=>{r=!0,n||t.before(),i||(t.end(),Lw()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning}))}));e._x_transitioning={beforeCancels:[],beforeCancel(e){this.beforeCancels.push(e)},cancel:Pw((function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();s()})),finish:s},Tb((()=>{t.start(),t.during()})),Ow=!0,requestAnimationFrame((()=>{if(r)return;let s=1e3*Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s","")),a=1e3*Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""));0===s&&(s=1e3*Number(getComputedStyle(e).animationDuration.replace("s",""))),Tb((()=>{t.before()})),n=!0,requestAnimationFrame((()=>{r||(Tb((()=>{t.end()})),Lw(),setTimeout(e._x_transitioning.finish,s+a),i=!0)}))}))}(e,{start(){o=t(e,n)},during(){l=t(e,r)},before:s,end(){o(),u=t(e,i)},after:a,cleanup(){l(),u()}})}function zw(e,t,r){if(-1===e.indexOf(t))return r;const n=e[e.indexOf(t)+1];if(!n)return r;if("scale"===t&&isNaN(n))return r;if("duration"===t||"delay"===t){let e=n.match(/([0-9]+)ms/);if(e)return e[1]}return"origin"===t&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[n,e[e.indexOf(t)+2]].join(" "):n}Qb("transition",((e,{value:t,modifiers:r,expression:n},{evaluate:i})=>{"function"==typeof n&&(n=i(n)),!1!==n&&(n&&"boolean"!=typeof n?function(e,t,r){Bw(e,_w,"");let n={enter:t=>{e._x_transition.enter.during=t},"enter-start":t=>{e._x_transition.enter.start=t},"enter-end":t=>{e._x_transition.enter.end=t},leave:t=>{e._x_transition.leave.during=t},"leave-start":t=>{e._x_transition.leave.start=t},"leave-end":t=>{e._x_transition.leave.end=t}};n[r](t)}(e,n,t):function(e,t,r){Bw(e,Iw);let n=!t.includes("in")&&!t.includes("out")&&!r,i=n||t.includes("in")||["enter"].includes(r),s=n||t.includes("out")||["leave"].includes(r);t.includes("in")&&!n&&(t=t.filter(((e,r)=>r<t.indexOf("out"))));t.includes("out")&&!n&&(t=t.filter(((e,r)=>r>t.indexOf("out"))));let a=!t.includes("opacity")&&!t.includes("scale"),o=a||t.includes("opacity"),l=a||t.includes("scale"),u=o?0:1,c=l?zw(t,"scale",95)/100:1,d=zw(t,"delay",0)/1e3,h=zw(t,"origin","center"),f="opacity, transform",p=zw(t,"duration",150)/1e3,m=zw(t,"duration",75)/1e3,g="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(e._x_transition.enter.during={transformOrigin:h,transitionDelay:`${d}s`,transitionProperty:f,transitionDuration:`${p}s`,transitionTimingFunction:g},e._x_transition.enter.start={opacity:u,transform:`scale(${c})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"});s&&(e._x_transition.leave.during={transformOrigin:h,transitionDelay:`${d}s`,transitionProperty:f,transitionDuration:`${m}s`,transitionTimingFunction:g},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:u,transform:`scale(${c})`})}(e,r,t))})),window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,r,n){const i="visible"===document.visibilityState?requestAnimationFrame:setTimeout;let s=()=>i(r);t?e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(r):s():e._x_transition?e._x_transition.in(r):s():(e._x_hidePromise=e._x_transition?new Promise(((t,r)=>{e._x_transition.out((()=>{}),(()=>t(n))),e._x_transitioning.beforeCancel((()=>r({isFromCancelledTransition:!0})))})):Promise.resolve(n),queueMicrotask((()=>{let t=Uw(e);t?(t._x_hideChildren||(t._x_hideChildren=[]),t._x_hideChildren.push(e)):i((()=>{let t=e=>{let r=Promise.all([e._x_hidePromise,...(e._x_hideChildren||[]).map(t)]).then((([e])=>e()));return delete e._x_hidePromise,delete e._x_hideChildren,r};t(e).catch((e=>{if(!e.isFromCancelledTransition)throw e}))}))})))};var jw=!1;function qw(e,t=(()=>{})){return(...r)=>jw?t(...r):e(...r)}function Hw(e,t,r,n=[]){switch(e._x_bindings||(e._x_bindings=rb({})),e._x_bindings[t]=r,t=n.includes("camel")?t.toLowerCase().replace(/-(\w)/g,((e,t)=>t.toUpperCase())):t){case"value":!function(e,t){if("radio"===e.type)void 0===e.attributes.value&&(e.value=t),window.fromModel&&(e.checked=Gw(e.value,t));else if("checkbox"===e.type)Number.isInteger(t)?e.value=t:Number.isInteger(t)||Array.isArray(t)||"boolean"==typeof t||[null,void 0].includes(t)?Array.isArray(t)?e.checked=t.some((t=>Gw(t,e.value))):e.checked=!!t:e.value=String(t);else if("SELECT"===e.tagName)!function(e,t){const r=[].concat(t).map((e=>e+""));Array.from(e.options).forEach((e=>{e.selected=r.includes(e.value)}))}(e,t);else{if(e.value===t)return;e.value=t}}(e,r);break;case"style":!function(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles();e._x_undoAddedStyles=Iw(e,t)}(e,r);break;case"class":!function(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses();e._x_undoAddedClasses=_w(e,t)}(e,r);break;case"selected":case"checked":!function(e,t,r){Vw(e,t,r),function(e,t,r){e[t]!==r&&(e[t]=r)}(e,t,r)}(e,t,r);break;default:Vw(e,t,r)}}function Vw(e,t,r){[null,void 0,!1].includes(r)&&function(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}(t)?e.removeAttribute(t):(Kw(t)&&(r=t),function(e,t,r){e.getAttribute(t)!=r&&e.setAttribute(t,r)}(e,t,r))}function Gw(e,t){return e==t}function Kw(e){return["disabled","checked","required","readonly","hidden","open","selected","autofocus","itemscope","multiple","novalidate","allowfullscreen","allowpaymentrequest","formnovalidate","autoplay","controls","loop","muted","playsinline","default","ismap","reversed","async","defer","nomodule"].includes(e)}function Ww(e,t,r){let n=e.getAttribute(t);return null===n?"function"==typeof r?r():r:""===n||(Kw(t)?!![t,"true"].includes(n):n)}function Yw(e,t){var r;return function(){var n=this,i=arguments;clearTimeout(r),r=setTimeout((function(){r=null,e.apply(n,i)}),t)}}function Jw(e,t){let r;return function(){let n=this,i=arguments;r||(e.apply(n,i),r=!0,setTimeout((()=>r=!1),t))}}var Zw={},Xw=!1;var Qw={};function ex(e,t,r){let n=[];for(;n.length;)n.pop()();let i=Object.entries(t).map((([e,t])=>({name:e,value:t}))),s=tw(i);i=i.map((e=>s.find((t=>t.name===e.name))?{name:`x-bind:${e.name}`,value:`"${e.value}"`}:e)),ew(e,i,r).map((e=>{n.push(e.runCleanups),e()}))}var tx={};var rx={get reactive(){return rb},get release(){return ib},get effect(){return nb},get raw(){return sb},version:"3.12.3",flushAndStopDeferringMutations:function(){Cb=!1,kb(Nb),Nb=[]},dontAutoEvaluateFunctions:qb,disableEffectScheduling:function(e){fb=!1,e(),fb=!0},startObservingMutations:Eb,stopObservingMutations:Db,setReactivityEngine:function(e){rb=e.reactive,ib=e.release,nb=t=>e.effect(t,{scheduler:e=>{fb?cb(e):e()}}),sb=e.raw},closestDataStack:Fb,skipDuringClone:qw,onlyDuringClone:function(e){return(...t)=>jw&&e(...t)},addRootSelector:Dw,addInitSelector:Sw,addScopeToNode:Ob,deferMutations:function(){Cb=!0},mapAttributes:uw,evaluateLater:Vb,interceptInit:function(e){Cw.push(e)},setEvaluator:function(e){Gb=e},mergeProxies:Lb,extractProp:function(e,t,r,n=!0){if(e._x_bindings&&void 0!==e._x_bindings[t])return e._x_bindings[t];if(e._x_inlineBindings&&void 0!==e._x_inlineBindings[t]){let r=e._x_inlineBindings[t];return r.extract=n,qb((()=>Hb(e,r.expression)))}return Ww(e,t,r)},findClosest:Tw,closestRoot:Aw,destroyTree:kw,interceptor:Rb,transition:$w,setStyles:Iw,mutateDom:Tb,directive:Qb,throttle:Jw,debounce:Yw,evaluate:Hb,initTree:Nw,nextTick:Fw,prefixed:Zb,prefix:function(e){Jb=e},plugin:function(e){(Array.isArray(e)?e:[e]).forEach((e=>e(nx)))},magic:Bb,store:function(e,t){if(Xw||(Zw=rb(Zw),Xw=!0),void 0===t)return Zw[e];Zw[e]=t,"object"==typeof t&&null!==t&&t.hasOwnProperty("init")&&"function"==typeof t.init&&Zw[e].init(),_b(Zw[e])},start:function(){var e;vw&&yw("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),vw=!0,document.body||yw("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),mw(document,"alpine:init"),mw(document,"alpine:initializing"),Eb(),e=e=>Nw(e,gw),yb.push(e),vb((e=>kw(e))),function(e){mb.push(e)}(((e,t)=>{ew(e,t).forEach((e=>e()))})),Array.from(document.querySelectorAll(Ew())).filter((e=>!Aw(e.parentElement,!0))).forEach((e=>{Nw(e)})),mw(document,"alpine:initialized")},clone:function(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),jw=!0,function(e){let t=nb;pb(((e,r)=>{let n=t(e);return ib(n),()=>{}})),e(),pb(t)}((()=>{!function(e){let t=!1;Nw(e,((e,r)=>{gw(e,((e,n)=>{if(t&&function(e){return xw().some((t=>e.matches(t)))}(e))return n();t=!0,r(e,n)}))}))}(t)})),jw=!1},bound:function(e,t,r){return e._x_bindings&&void 0!==e._x_bindings[t]?e._x_bindings[t]:Ww(e,t,r)},$data:Mb,walk:gw,data:function(e,t){tx[e]=t},bind:function(e,t){let r="function"!=typeof t?()=>t:t;e instanceof Element?ex(e,r()):Qw[e]=r}},nx=rx;function ix(e,t){const r=Object.create(null),n=e.split(",");for(let e=0;e<n.length;e++)r[n[e]]=!0;return t?e=>!!r[e.toLowerCase()]:e=>!!r[e]}var sx,ax=Object.freeze({}),ox=(Object.freeze([]),Object.assign),lx=Object.prototype.hasOwnProperty,ux=(e,t)=>lx.call(e,t),cx=Array.isArray,dx=e=>"[object Map]"===mx(e),hx=e=>"symbol"==typeof e,fx=e=>null!==e&&"object"==typeof e,px=Object.prototype.toString,mx=e=>px.call(e),gx=e=>mx(e).slice(8,-1),yx=e=>"string"==typeof e&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,vx=e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))},bx=/-(\w)/g,wx=(vx((e=>e.replace(bx,((e,t)=>t?t.toUpperCase():"")))),/\B([A-Z])/g),xx=(vx((e=>e.replace(wx,"-$1").toLowerCase())),vx((e=>e.charAt(0).toUpperCase()+e.slice(1)))),Ex=(vx((e=>e?`on${xx(e)}`:"")),(e,t)=>e!==t&&(e==e||t==t)),Dx=new WeakMap,Sx=[],Ax=Symbol("iterate"),Tx=Symbol("Map key iterate");var Cx=0;function Nx(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}var kx=!0,Mx=[];function Ox(){const e=Mx.pop();kx=void 0===e||e}function Fx(e,t,r){if(!kx||void 0===sx)return;let n=Dx.get(e);n||Dx.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=new Set),i.has(sx)||(i.add(sx),sx.deps.push(i),sx.options.onTrack&&sx.options.onTrack({effect:sx,target:e,type:t,key:r}))}function Lx(e,t,r,n,i,s){const a=Dx.get(e);if(!a)return;const o=new Set,l=e=>{e&&e.forEach((e=>{(e!==sx||e.allowRecurse)&&o.add(e)}))};if("clear"===t)a.forEach(l);else if("length"===r&&cx(e))a.forEach(((e,t)=>{("length"===t||t>=n)&&l(e)}));else switch(void 0!==r&&l(a.get(r)),t){case"add":cx(e)?yx(r)&&l(a.get("length")):(l(a.get(Ax)),dx(e)&&l(a.get(Tx)));break;case"delete":cx(e)||(l(a.get(Ax)),dx(e)&&l(a.get(Tx)));break;case"set":dx(e)&&l(a.get(Ax))}o.forEach((a=>{a.options.onTrigger&&a.options.onTrigger({effect:a,target:e,key:r,type:t,newValue:n,oldValue:i,oldTarget:s}),a.options.scheduler?a.options.scheduler(a):a()}))}var _x=ix("__proto__,__v_isRef,__isVue"),Rx=new Set(Object.getOwnPropertyNames(Symbol).map((e=>Symbol[e])).filter(hx)),Ix=zx(),Px=zx(!1,!0),Bx=zx(!0),Ux=zx(!0,!0),$x={};function zx(e=!1,t=!1){return function(r,n,i){if("__v_isReactive"===n)return!e;if("__v_isReadonly"===n)return e;if("__v_raw"===n&&i===(e?t?gE:mE:t?pE:fE).get(r))return r;const s=cx(r);if(!e&&s&&ux($x,n))return Reflect.get($x,n,i);const a=Reflect.get(r,n,i);if(hx(n)?Rx.has(n):_x(n))return a;if(e||Fx(r,"get",n),t)return a;if(xE(a)){return!s||!yx(n)?a.value:a}return fx(a)?e?vE(a):yE(a):a}}function jx(e=!1){return function(t,r,n,i){let s=t[r];if(!e&&(n=wE(n),s=wE(s),!cx(t)&&xE(s)&&!xE(n)))return s.value=n,!0;const a=cx(t)&&yx(r)?Number(r)<t.length:ux(t,r),o=Reflect.set(t,r,n,i);return t===wE(i)&&(a?Ex(n,s)&&Lx(t,"set",r,n,s):Lx(t,"add",r,n)),o}}["includes","indexOf","lastIndexOf"].forEach((e=>{const t=Array.prototype[e];$x[e]=function(...e){const r=wE(this);for(let e=0,t=this.length;e<t;e++)Fx(r,"get",e+"");const n=t.apply(r,e);return-1===n||!1===n?t.apply(r,e.map(wE)):n}})),["push","pop","shift","unshift","splice"].forEach((e=>{const t=Array.prototype[e];$x[e]=function(...e){Mx.push(kx),kx=!1;const r=t.apply(this,e);return Ox(),r}}));var qx={get:Ix,set:jx(),deleteProperty:function(e,t){const r=ux(e,t),n=e[t],i=Reflect.deleteProperty(e,t);return i&&r&&Lx(e,"delete",t,void 0,n),i},has:function(e,t){const r=Reflect.has(e,t);return hx(t)&&Rx.has(t)||Fx(e,"has",t),r},ownKeys:function(e){return Fx(e,"iterate",cx(e)?"length":Ax),Reflect.ownKeys(e)}},Hx={get:Bx,set:(e,t)=>(console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0),deleteProperty:(e,t)=>(console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0)},Vx=(ox({},qx,{get:Px,set:jx(!0)}),ox({},Hx,{get:Ux}),e=>fx(e)?yE(e):e),Gx=e=>fx(e)?vE(e):e,Kx=e=>e,Wx=e=>Reflect.getPrototypeOf(e);function Yx(e,t,r=!1,n=!1){const i=wE(e=e.__v_raw),s=wE(t);t!==s&&!r&&Fx(i,"get",t),!r&&Fx(i,"get",s);const{has:a}=Wx(i),o=n?Kx:r?Gx:Vx;return a.call(i,t)?o(e.get(t)):a.call(i,s)?o(e.get(s)):void(e!==i&&e.get(t))}function Jx(e,t=!1){const r=this.__v_raw,n=wE(r),i=wE(e);return e!==i&&!t&&Fx(n,"has",e),!t&&Fx(n,"has",i),e===i?r.has(e):r.has(e)||r.has(i)}function Zx(e,t=!1){return e=e.__v_raw,!t&&Fx(wE(e),"iterate",Ax),Reflect.get(e,"size",e)}function Xx(e){e=wE(e);const t=wE(this);return Wx(t).has.call(t,e)||(t.add(e),Lx(t,"add",e,e)),this}function Qx(e,t){t=wE(t);const r=wE(this),{has:n,get:i}=Wx(r);let s=n.call(r,e);s?hE(r,n,e):(e=wE(e),s=n.call(r,e));const a=i.call(r,e);return r.set(e,t),s?Ex(t,a)&&Lx(r,"set",e,t,a):Lx(r,"add",e,t),this}function eE(e){const t=wE(this),{has:r,get:n}=Wx(t);let i=r.call(t,e);i?hE(t,r,e):(e=wE(e),i=r.call(t,e));const s=n?n.call(t,e):void 0,a=t.delete(e);return i&&Lx(t,"delete",e,void 0,s),a}function tE(){const e=wE(this),t=0!==e.size,r=dx(e)?new Map(e):new Set(e),n=e.clear();return t&&Lx(e,"clear",void 0,void 0,r),n}function rE(e,t){return function(r,n){const i=this,s=i.__v_raw,a=wE(s),o=t?Kx:e?Gx:Vx;return!e&&Fx(a,"iterate",Ax),s.forEach(((e,t)=>r.call(n,o(e),o(t),i)))}}function nE(e,t,r){return function(...n){const i=this.__v_raw,s=wE(i),a=dx(s),o="entries"===e||e===Symbol.iterator&&a,l="keys"===e&&a,u=i[e](...n),c=r?Kx:t?Gx:Vx;return!t&&Fx(s,"iterate",l?Tx:Ax),{next(){const{value:e,done:t}=u.next();return t?{value:e,done:t}:{value:o?[c(e[0]),c(e[1])]:c(e),done:t}},[Symbol.iterator](){return this}}}}function iE(e){return function(...t){{const r=t[0]?`on key "${t[0]}" `:"";console.warn(`${xx(e)} operation ${r}failed: target is readonly.`,wE(this))}return"delete"!==e&&this}}var sE={get(e){return Yx(this,e)},get size(){return Zx(this)},has:Jx,add:Xx,set:Qx,delete:eE,clear:tE,forEach:rE(!1,!1)},aE={get(e){return Yx(this,e,!1,!0)},get size(){return Zx(this)},has:Jx,add:Xx,set:Qx,delete:eE,clear:tE,forEach:rE(!1,!0)},oE={get(e){return Yx(this,e,!0)},get size(){return Zx(this,!0)},has(e){return Jx.call(this,e,!0)},add:iE("add"),set:iE("set"),delete:iE("delete"),clear:iE("clear"),forEach:rE(!0,!1)},lE={get(e){return Yx(this,e,!0,!0)},get size(){return Zx(this,!0)},has(e){return Jx.call(this,e,!0)},add:iE("add"),set:iE("set"),delete:iE("delete"),clear:iE("clear"),forEach:rE(!0,!0)};function uE(e,t){const r=t?e?lE:aE:e?oE:sE;return(t,n,i)=>"__v_isReactive"===n?!e:"__v_isReadonly"===n?e:"__v_raw"===n?t:Reflect.get(ux(r,n)&&n in t?r:t,n,i)}["keys","values","entries",Symbol.iterator].forEach((e=>{sE[e]=nE(e,!1,!1),oE[e]=nE(e,!0,!1),aE[e]=nE(e,!1,!0),lE[e]=nE(e,!0,!0)}));var cE={get:uE(!1,!1)},dE=(uE(!1,!0),{get:uE(!0,!1)});uE(!0,!0);function hE(e,t,r){const n=wE(r);if(n!==r&&t.call(e,n)){const t=gx(e);console.warn(`Reactive ${t} contains both the raw and reactive versions of the same object${"Map"===t?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var fE=new WeakMap,pE=new WeakMap,mE=new WeakMap,gE=new WeakMap;function yE(e){return e&&e.__v_isReadonly?e:bE(e,!1,qx,cE,fE)}function vE(e){return bE(e,!0,Hx,dE,mE)}function bE(e,t,r,n,i){if(!fx(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const s=i.get(e);if(s)return s;const a=(o=e).__v_skip||!Object.isExtensible(o)?0:function(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(gx(o));var o;if(0===a)return e;const l=new Proxy(e,2===a?n:r);return i.set(e,l),l}function wE(e){return e&&wE(e.__v_raw)||e}function xE(e){return Boolean(e&&!0===e.__v_isRef)}Bb("nextTick",(()=>Fw)),Bb("dispatch",(e=>mw.bind(mw,e))),Bb("watch",((e,{evaluateLater:t,effect:r})=>(n,i)=>{let s,a=t(n),o=!0,l=r((()=>a((e=>{JSON.stringify(e),o?s=e:queueMicrotask((()=>{i(e,s),s=e})),o=!1}))));e._x_effects.delete(l)})),Bb("store",(function(){return Zw})),Bb("data",(e=>Mb(e))),Bb("root",(e=>Aw(e))),Bb("refs",(e=>(e._x_refs_proxy||(e._x_refs_proxy=Lb(function(e){let t=[],r=e;for(;r;)r._x_refs&&t.push(r._x_refs),r=r.parentNode;return t}(e))),e._x_refs_proxy)));var EE={};function DE(e){return EE[e]||(EE[e]=0),++EE[e]}function SE(e,t,r){Bb(t,(t=>yw(`You can't use [$${directiveName}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${r}`,t)))}Bb("id",(e=>(t,r=null)=>{let n=function(e,t){return Tw(e,(e=>{if(e._x_ids&&e._x_ids[t])return!0}))}(e,t),i=n?n._x_ids[t]:DE(t);return r?`${t}-${i}-${r}`:`${t}-${i}`})),Bb("el",(e=>e)),SE("Focus","focus","focus"),SE("Persist","persist","persist"),Qb("modelable",((e,{expression:t},{effect:r,evaluateLater:n,cleanup:i})=>{let s=n(t),a=()=>{let e;return s((t=>e=t)),e},o=n(`${t} = __placeholder`),l=e=>o((()=>{}),{scope:{__placeholder:e}}),u=a();l(u),queueMicrotask((()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let t=e._x_model.get,r=e._x_model.set,n=function({get:e,set:t},{get:r,set:n}){let i,s,a,o,l=!0,u=nb((()=>{let u,c;l?(u=e(),n(u),c=r(),l=!1):(u=e(),c=r(),a=JSON.stringify(u),o=JSON.stringify(c),a!==i?(c=r(),n(u),c=u):(t(c),u=c)),i=JSON.stringify(u),s=JSON.stringify(c)}));return()=>{ib(u)}}({get:()=>t(),set(e){r(e)}},{get:()=>a(),set(e){l(e)}});i(n)}))}));var AE=document.createElement("div");Qb("teleport",((e,{modifiers:t,expression:r},{cleanup:n})=>{"template"!==e.tagName.toLowerCase()&&yw("x-teleport can only be used on a <template> tag",e);let i=qw((()=>document.querySelector(r)),(()=>AE))();i||yw(`Cannot find x-teleport element for selector: "${r}"`);let s=e.content.cloneNode(!0).firstElementChild;e._x_teleport=s,s._x_teleportBack=e,e._x_forwardEvents&&e._x_forwardEvents.forEach((t=>{s.addEventListener(t,(t=>{t.stopPropagation(),e.dispatchEvent(new t.constructor(t.type,t))}))})),Ob(s,{},e),Tb((()=>{t.includes("prepend")?i.parentNode.insertBefore(s,i):t.includes("append")?i.parentNode.insertBefore(s,i.nextSibling):i.appendChild(s),Nw(s),s._x_ignore=!0})),n((()=>s.remove()))}));var TE=()=>{};function CE(e,t,r,n){let i=e,s=e=>n(e),a={},o=(e,t)=>r=>t(e,r);if(r.includes("dot")&&(t=t.replace(/-/g,".")),r.includes("camel")&&(t=function(e){return e.toLowerCase().replace(/-(\w)/g,((e,t)=>t.toUpperCase()))}(t)),r.includes("passive")&&(a.passive=!0),r.includes("capture")&&(a.capture=!0),r.includes("window")&&(i=window),r.includes("document")&&(i=document),r.includes("debounce")){let e=r[r.indexOf("debounce")+1]||"invalid-wait",t=NE(e.split("ms")[0])?Number(e.split("ms")[0]):250;s=Yw(s,t)}if(r.includes("throttle")){let e=r[r.indexOf("throttle")+1]||"invalid-wait",t=NE(e.split("ms")[0])?Number(e.split("ms")[0]):250;s=Jw(s,t)}return r.includes("prevent")&&(s=o(s,((e,t)=>{t.preventDefault(),e(t)}))),r.includes("stop")&&(s=o(s,((e,t)=>{t.stopPropagation(),e(t)}))),r.includes("self")&&(s=o(s,((t,r)=>{r.target===e&&t(r)}))),(r.includes("away")||r.includes("outside"))&&(i=document,s=o(s,((t,r)=>{e.contains(r.target)||!1!==r.target.isConnected&&(e.offsetWidth<1&&e.offsetHeight<1||!1!==e._x_isShown&&t(r))}))),r.includes("once")&&(s=o(s,((e,r)=>{e(r),i.removeEventListener(t,s,a)}))),s=o(s,((e,n)=>{(function(e){return["keydown","keyup"].includes(e)})(t)&&function(e,t){let r=t.filter((e=>!["window","document","prevent","stop","once","capture"].includes(e)));if(r.includes("debounce")){let e=r.indexOf("debounce");r.splice(e,NE((r[e+1]||"invalid-wait").split("ms")[0])?2:1)}if(r.includes("throttle")){let e=r.indexOf("throttle");r.splice(e,NE((r[e+1]||"invalid-wait").split("ms")[0])?2:1)}if(0===r.length)return!1;if(1===r.length&&kE(e.key).includes(r[0]))return!1;const n=["ctrl","shift","alt","meta","cmd","super"].filter((e=>r.includes(e)));if(r=r.filter((e=>!n.includes(e))),n.length>0){if(n.filter((t=>("cmd"!==t&&"super"!==t||(t="meta"),e[`${t}Key`]))).length===n.length&&kE(e.key).includes(r[0]))return!1}return!0}(n,r)||e(n)})),i.addEventListener(t,s,a),()=>{i.removeEventListener(t,s,a)}}function NE(e){return!Array.isArray(e)&&!isNaN(e)}function kE(e){if(!e)return[];var t;e=[" ","_"].includes(t=e)?t:t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase();let r={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",equal:"=",minus:"-",underscore:"_"};return r[e]=e,Object.keys(r).map((t=>{if(r[t]===e)return t})).filter((e=>e))}function ME(e){let t=e?parseFloat(e):null;return r=t,Array.isArray(r)||isNaN(r)?e:t;var r}function OE(e){return null!==e&&"object"==typeof e&&"function"==typeof e.get&&"function"==typeof e.set}TE.inline=(e,{modifiers:t},{cleanup:r})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,r((()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore}))},Qb("ignore",TE),Qb("effect",((e,{expression:t},{effect:r})=>r(Vb(e,t)))),Qb("model",((e,{modifiers:t,expression:r},{effect:n,cleanup:i})=>{let s=e;t.includes("parent")&&(s=e.parentNode);let a,o=Vb(s,r);a="string"==typeof r?Vb(s,`${r} = __placeholder`):"function"==typeof r&&"string"==typeof r()?Vb(s,`${r()} = __placeholder`):()=>{};let l=()=>{let e;return o((t=>e=t)),OE(e)?e.get():e},u=e=>{let t;o((e=>t=e)),OE(t)?t.set(e):a((()=>{}),{scope:{__placeholder:e}})};"string"==typeof r&&"radio"===e.type&&Tb((()=>{e.hasAttribute("name")||e.setAttribute("name",r)}));var c="select"===e.tagName.toLowerCase()||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input";let d=jw?()=>{}:CE(e,c,t,(r=>{u(function(e,t,r,n){return Tb((()=>{if(r instanceof CustomEvent&&void 0!==r.detail)return r.detail??r.target.value;if("checkbox"===e.type){if(Array.isArray(n)){let e=t.includes("number")?ME(r.target.value):r.target.value;return r.target.checked?n.concat([e]):n.filter((t=>!(t==e)))}return r.target.checked}if("select"===e.tagName.toLowerCase()&&e.multiple)return t.includes("number")?Array.from(r.target.selectedOptions).map((e=>ME(e.value||e.text))):Array.from(r.target.selectedOptions).map((e=>e.value||e.text));{let e=r.target.value;return t.includes("number")?ME(e):t.includes("trim")?e.trim():e}}))}(e,t,r,l()))}));if(t.includes("fill")&&[null,""].includes(l())&&e.dispatchEvent(new Event(c,{})),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=d,i((()=>e._x_removeModelListeners.default())),e.form){let t=CE(e.form,"reset",[],(t=>{Fw((()=>e._x_model&&e._x_model.set(e.value)))}));i((()=>t()))}e._x_model={get:()=>l(),set(e){u(e)}},e._x_forceModelUpdate=t=>{void 0===(t=void 0===t?l():t)&&"string"==typeof r&&r.match(/\./)&&(t=""),window.fromModel=!0,Tb((()=>Hw(e,"value",t))),delete window.fromModel},n((()=>{let r=l();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(r)}))})),Qb("cloak",(e=>queueMicrotask((()=>Tb((()=>e.removeAttribute(Zb("cloak")))))))),Sw((()=>`[${Zb("init")}]`)),Qb("init",qw(((e,{expression:t},{evaluate:r})=>"string"==typeof t?!!t.trim()&&r(t,{},!1):r(t,{},!1)))),Qb("text",((e,{expression:t},{effect:r,evaluateLater:n})=>{let i=n(t);r((()=>{i((t=>{Tb((()=>{e.textContent=t}))}))}))})),Qb("html",((e,{expression:t},{effect:r,evaluateLater:n})=>{let i=n(t);r((()=>{i((t=>{Tb((()=>{e.innerHTML=t,e._x_ignoreSelf=!0,Nw(e),delete e._x_ignoreSelf}))}))}))})),uw(aw(":",Zb("bind:")));var FE=(e,{value:t,modifiers:r,expression:n,original:i},{effect:s})=>{if(!t){let t={};return a=t,Object.entries(Qw).forEach((([e,t])=>{Object.defineProperty(a,e,{get:()=>(...e)=>t(...e)})})),void Vb(e,n)((t=>{ex(e,t,i)}),{scope:t})}var a;if("key"===t)return function(e,t){e._x_keyExpression=t}(e,n);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let o=Vb(e,n);s((()=>o((i=>{void 0===i&&"string"==typeof n&&n.match(/\./)&&(i=""),Tb((()=>Hw(e,t,i,r)))}))))};function LE(e,t,r,n){let i={};if(/^\[.*\]$/.test(e.item)&&Array.isArray(t)){let r=e.item.replace("[","").replace("]","").split(",").map((e=>e.trim()));r.forEach(((e,r)=>{i[e]=t[r]}))}else if(/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&"object"==typeof t){let r=e.item.replace("{","").replace("}","").split(",").map((e=>e.trim()));r.forEach((e=>{i[e]=t[e]}))}else i[e.item]=t;return e.index&&(i[e.index]=r),e.collection&&(i[e.collection]=n),i}function _E(){}function RE(e,t,r){Qb(t,(n=>yw(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${r}`,n)))}FE.inline=(e,{value:t,modifiers:r,expression:n})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:n,extract:!1})},Qb("bind",FE),Dw((()=>`[${Zb("data")}]`)),Qb("data",qw(((e,{expression:t},{cleanup:r})=>{t=""===t?"{}":t;let n={};Ub(n,e);let i={};var s,a;s=i,a=n,Object.entries(tx).forEach((([e,t])=>{Object.defineProperty(s,e,{get:()=>(...e)=>t.bind(a)(...e),enumerable:!1})}));let o=Hb(e,t,{scope:i});void 0!==o&&!0!==o||(o={}),Ub(o,e);let l=rb(o);_b(l);let u=Ob(e,l);l.init&&Hb(e,l.init),r((()=>{l.destroy&&Hb(e,l.destroy),u()}))}))),Qb("show",((e,{modifiers:t,expression:r},{effect:n})=>{let i=Vb(e,r);e._x_doHide||(e._x_doHide=()=>{Tb((()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)}))}),e._x_doShow||(e._x_doShow=()=>{Tb((()=>{1===e.style.length&&"none"===e.style.display?e.removeAttribute("style"):e.style.removeProperty("display")}))});let s,a=()=>{e._x_doHide(),e._x_isShown=!1},o=()=>{e._x_doShow(),e._x_isShown=!0},l=()=>setTimeout(o),u=Pw((e=>e?o():a()),(t=>{"function"==typeof e._x_toggleAndCascadeWithTransitions?e._x_toggleAndCascadeWithTransitions(e,t,o,a):t?l():a()})),c=!0;n((()=>i((e=>{(c||e!==s)&&(t.includes("immediate")&&(e?l():a()),u(e),s=e,c=!1)}))))})),Qb("for",((e,{expression:t},{effect:r,cleanup:n})=>{let i=function(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,n=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=e.match(n);if(!i)return;let s={};s.items=i[2].trim();let a=i[1].replace(r,"").trim(),o=a.match(t);o?(s.item=a.replace(t,"").trim(),s.index=o[1].trim(),o[2]&&(s.collection=o[2].trim())):s.item=a;return s}(t),s=Vb(e,i.items),a=Vb(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},r((()=>function(e,t,r,n){let i=e=>"object"==typeof e&&!Array.isArray(e),s=e;r((r=>{var a;a=r,!Array.isArray(a)&&!isNaN(a)&&r>=0&&(r=Array.from(Array(r).keys(),(e=>e+1))),void 0===r&&(r=[]);let o=e._x_lookup,l=e._x_prevKeys,u=[],c=[];if(i(r))r=Object.entries(r).map((([e,i])=>{let s=LE(t,i,e,r);n((e=>c.push(e)),{scope:{index:e,...s}}),u.push(s)}));else for(let e=0;e<r.length;e++){let i=LE(t,r[e],e,r);n((e=>c.push(e)),{scope:{index:e,...i}}),u.push(i)}let d=[],h=[],f=[],p=[];for(let e=0;e<l.length;e++){let t=l[e];-1===c.indexOf(t)&&f.push(t)}l=l.filter((e=>!f.includes(e)));let m="template";for(let e=0;e<c.length;e++){let t=c[e],r=l.indexOf(t);if(-1===r)l.splice(e,0,t),d.push([m,e]);else if(r!==e){let t=l.splice(e,1)[0],n=l.splice(r-1,1)[0];l.splice(e,0,n),l.splice(r,0,t),h.push([t,n])}else p.push(t);m=t}for(let e=0;e<f.length;e++){let t=f[e];o[t]._x_effects&&o[t]._x_effects.forEach(db),o[t].remove(),o[t]=null,delete o[t]}for(let e=0;e<h.length;e++){let[t,r]=h[e],n=o[t],i=o[r],a=document.createElement("div");Tb((()=>{i||yw('x-for ":key" is undefined or invalid',s),i.after(a),n.after(i),i._x_currentIfEl&&i.after(i._x_currentIfEl),a.before(n),n._x_currentIfEl&&n.after(n._x_currentIfEl),a.remove()})),i._x_refreshXForScope(u[c.indexOf(r)])}for(let e=0;e<d.length;e++){let[t,r]=d[e],n="template"===t?s:o[t];n._x_currentIfEl&&(n=n._x_currentIfEl);let i=u[r],a=c[r],l=document.importNode(s.content,!0).firstElementChild,h=rb(i);Ob(l,h,s),l._x_refreshXForScope=e=>{Object.entries(e).forEach((([e,t])=>{h[e]=t}))},Tb((()=>{n.after(l),Nw(l)})),"object"==typeof a&&yw("x-for key cannot be an object, it must be a string or an integer",s),o[a]=l}for(let e=0;e<p.length;e++)o[p[e]]._x_refreshXForScope(u[c.indexOf(p[e])]);s._x_prevKeys=c}))}(e,i,s,a))),n((()=>{Object.values(e._x_lookup).forEach((e=>e.remove())),delete e._x_prevKeys,delete e._x_lookup}))})),_E.inline=(e,{expression:t},{cleanup:r})=>{let n=Aw(e);n._x_refs||(n._x_refs={}),n._x_refs[t]=e,r((()=>delete n._x_refs[t]))},Qb("ref",_E),Qb("if",((e,{expression:t},{effect:r,cleanup:n})=>{let i=Vb(e,t);r((()=>i((t=>{t?(()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let t=e.content.cloneNode(!0).firstElementChild;Ob(t,{},e),Tb((()=>{e.after(t),Nw(t)})),e._x_currentIfEl=t,e._x_undoIf=()=>{gw(t,(e=>{e._x_effects&&e._x_effects.forEach(db)})),t.remove(),delete e._x_currentIfEl}})():e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)})))),n((()=>e._x_undoIf&&e._x_undoIf()))})),Qb("id",((e,{expression:t},{evaluate:r})=>{r(t).forEach((t=>function(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=DE(t))}(e,t)))})),uw(aw("@",Zb("on:"))),Qb("on",qw(((e,{value:t,modifiers:r,expression:n},{cleanup:i})=>{let s=n?Vb(e,n):()=>{};"template"===e.tagName.toLowerCase()&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let a=CE(e,t,r,(e=>{s((()=>{}),{scope:{$event:e},params:[e]})}));i((()=>a()))}))),RE("Collapse","collapse","collapse"),RE("Intersect","intersect","intersect"),RE("Focus","trap","focus"),RE("Mask","mask","mask"),nx.setEvaluator(Kb),nx.setReactivityEngine({reactive:yE,effect:function(e,t=ax){(function(e){return e&&!0===e._isEffect})(e)&&(e=e.raw);const r=function(e,t){const r=function(){if(!r.active)return e();if(!Sx.includes(r)){Nx(r);try{return Mx.push(kx),kx=!0,Sx.push(r),sx=r,e()}finally{Sx.pop(),Ox(),sx=Sx[Sx.length-1]}}};return r.id=Cx++,r.allowRecurse=!!t.allowRecurse,r._isEffect=!0,r.active=!0,r.raw=e,r.deps=[],r.options=t,r}(e,t);return t.lazy||r(),r},release:function(e){e.active&&(Nx(e),e.options.onStop&&e.options.onStop(),e.active=!1)},raw:wE});var IE=nx;function PE(e){if(e.includes("full"))return.99;if(e.includes("half"))return.5;if(!e.includes("threshold"))return 0;let t=e[e.indexOf("threshold")+1];return"100"===t?1:"0"===t?0:Number(`.${t}`)}function BE(e){let t=e.match(/^(-?[0-9]+)(px|%)?$/);return t?t[1]+(t[2]||"px"):void 0}function UE(e){const t="0px 0px 0px 0px",r=e.indexOf("margin");if(-1===r)return t;let n=[];for(let t=1;t<5;t++)n.push(BE(e[r+t]||""));return n=n.filter((e=>void 0!==e)),n.length?n.join(" ").trim():t}var $E=function(e){e.directive("intersect",((e,{value:t,expression:r,modifiers:n},{evaluateLater:i,cleanup:s})=>{let a=i(r),o={rootMargin:UE(n),threshold:PE(n)},l=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting!==("leave"===t)&&(a(),n.includes("once")&&l.disconnect())}))}),o);l.observe(e),s((()=>{l.disconnect()}))}))};function zE(){return zE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zE.apply(this,arguments)}var jE={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null},qE=["Matrix","Array"],HE=["number","BigNumber","Fraction"];var VE=function(e){if(e)throw new Error("The global config is readonly. \nPlease create a mathjs instance if you want to change the default configuration. \nExample:\n\n  import { create, all } from 'mathjs';\n  const mathjs = create(all);\n  mathjs.config({ number: 'BigNumber' });\n");return Object.freeze(jE)};function GE(e){return"number"==typeof e}function KE(e){return!(!e||"object"!=typeof e||"function"!=typeof e.constructor)&&(!0===e.isBigNumber&&"object"==typeof e.constructor.prototype&&!0===e.constructor.prototype.isBigNumber||"function"==typeof e.constructor.isDecimal&&!0===e.constructor.isDecimal(e))}function WE(e){return e&&"object"==typeof e&&!0===Object.getPrototypeOf(e).isComplex||!1}function YE(e){return e&&"object"==typeof e&&!0===Object.getPrototypeOf(e).isFraction||!1}function JE(e){return e&&!0===e.constructor.prototype.isUnit||!1}function ZE(e){return"string"==typeof e}zE(VE,jE,{MATRIX_OPTIONS:qE,NUMBER_OPTIONS:HE});var XE=Array.isArray;function QE(e){return e&&!0===e.constructor.prototype.isMatrix||!1}function eD(e){return Array.isArray(e)||QE(e)}function tD(e){return e&&e.isDenseMatrix&&!0===e.constructor.prototype.isMatrix||!1}function rD(e){return e&&e.isSparseMatrix&&!0===e.constructor.prototype.isMatrix||!1}function nD(e){return e&&!0===e.constructor.prototype.isRange||!1}function iD(e){return e&&!0===e.constructor.prototype.isIndex||!1}function sD(e){return"boolean"==typeof e}function aD(e){return e&&!0===e.constructor.prototype.isResultSet||!1}function oD(e){return e&&!0===e.constructor.prototype.isHelp||!1}function lD(e){return"function"==typeof e}function uD(e){return e instanceof Date}function cD(e){return e instanceof RegExp}function dD(e){return!(!e||"object"!=typeof e||e.constructor!==Object||WE(e)||YE(e))}function hD(e){return null===e}function fD(e){return void 0===e}function pD(e){return e&&!0===e.isAccessorNode&&!0===e.constructor.prototype.isNode||!1}function mD(e){return e&&!0===e.isArrayNode&&!0===e.constructor.prototype.isNode||!1}function gD(e){return e&&!0===e.isAssignmentNode&&!0===e.constructor.prototype.isNode||!1}function yD(e){return e&&!0===e.isBlockNode&&!0===e.constructor.prototype.isNode||!1}function vD(e){return e&&!0===e.isConditionalNode&&!0===e.constructor.prototype.isNode||!1}function bD(e){return e&&!0===e.isConstantNode&&!0===e.constructor.prototype.isNode||!1}function wD(e){return bD(e)||TD(e)&&1===e.args.length&&bD(e.args[0])&&"-+~".includes(e.op)}function xD(e){return e&&!0===e.isFunctionAssignmentNode&&!0===e.constructor.prototype.isNode||!1}function ED(e){return e&&!0===e.isFunctionNode&&!0===e.constructor.prototype.isNode||!1}function DD(e){return e&&!0===e.isIndexNode&&!0===e.constructor.prototype.isNode||!1}function SD(e){return e&&!0===e.isNode&&!0===e.constructor.prototype.isNode||!1}function AD(e){return e&&!0===e.isObjectNode&&!0===e.constructor.prototype.isNode||!1}function TD(e){return e&&!0===e.isOperatorNode&&!0===e.constructor.prototype.isNode||!1}function CD(e){return e&&!0===e.isParenthesisNode&&!0===e.constructor.prototype.isNode||!1}function ND(e){return e&&!0===e.isRangeNode&&!0===e.constructor.prototype.isNode||!1}function kD(e){return e&&!0===e.isRelationalNode&&!0===e.constructor.prototype.isNode||!1}function MD(e){return e&&!0===e.isSymbolNode&&!0===e.constructor.prototype.isNode||!1}function OD(e){return e&&!0===e.constructor.prototype.isChain||!1}function FD(e){var t=typeof e;return"object"===t?null===e?"null":KE(e)?"BigNumber":e.constructor&&e.constructor.name?e.constructor.name:"Object":t}var LD=new Set(["end"]);function _D(e){var t=typeof e;if("number"===t||"string"===t||"boolean"===t||null==e)return e;if("function"==typeof e.clone)return e.clone();if(Array.isArray(e))return e.map((function(e){return _D(e)}));if(e instanceof Date)return new Date(e.valueOf());if(KE(e))return e;if(e instanceof RegExp)throw new TypeError("Cannot clone "+e);return function(e,t){var r={};for(var n in e)PD(e,n)&&(r[n]=t(e[n]));return r}(e,_D)}function RD(e,t){for(var r in t)PD(t,r)&&(e[r]=t[r]);return e}function ID(e,t){var r,n,i;if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(n=0,i=e.length;n<i;n++)if(!ID(e[n],t[n]))return!1;return!0}if("function"==typeof e)return e===t;if(e instanceof Object){if(Array.isArray(t)||!(t instanceof Object))return!1;for(r in e)if(!(r in t)||!ID(e[r],t[r]))return!1;for(r in t)if(!(r in e))return!1;return!0}return e===t}function PD(e,t){return e&&Object.hasOwnProperty.call(e,t)}function BD(e,t,r,n){function i(n){var i=function(e,t){for(var r={},n=0;n<t.length;n++){var i=t[n],s=e[i];void 0!==s&&(r[i]=s)}return r}(n,t.map(UD));return function(e,t,r){var n=t.filter((e=>!function(e){return e&&"?"===e[0]}(e))).every((e=>void 0!==r[e]));if(!n){var i=t.filter((e=>void 0===r[e]));throw new Error('Cannot create function "'.concat(e,'", ')+"some dependencies are missing: ".concat(i.map((e=>'"'.concat(e,'"'))).join(", "),"."))}}(e,t,n),r(i)}return i.isFactory=!0,i.fn=e,i.dependencies=t.slice().sort(),n&&(i.meta=n),i}function UD(e){return e&&"?"===e[0]?e.slice(1):e}function $D(e,t){if(HD(e)&&jD(e,t))return e[t];if("function"==typeof e[t]&&qD(e,t))throw new Error('Cannot access method "'+t+'" as a property');throw new Error('No access to property "'+t+'"')}function zD(e,t,r){if(HD(e)&&jD(e,t))return e[t]=r,r;throw new Error('No access to property "'+t+'"')}function jD(e,t){return!(!e||"object"!=typeof e)&&(!!PD(VD,t)||!(t in Object.prototype)&&!(t in Function.prototype))}function qD(e,t){return null!=e&&"function"==typeof e[t]&&(!(PD(e,t)&&Object.getPrototypeOf&&t in Object.getPrototypeOf(e))&&(!!PD(GD,t)||!(t in Object.prototype)&&!(t in Function.prototype)))}function HD(e){return"object"==typeof e&&e&&e.constructor===Object}var VD={length:!0,name:!0},GD={toString:!0,valueOf:!0,toLocaleString:!0};class KD{constructor(e){this.wrappedObject=e}keys(){return Object.keys(this.wrappedObject)}get(e){return $D(this.wrappedObject,e)}set(e,t){return zD(this.wrappedObject,e,t),this}has(e){return t=this.wrappedObject,e in t;var t}}function WD(){return new Map}function YD(e){if(!e)return WD();if(JD(e))return e;if(dD(e))return new KD(e);throw new Error("createMap can create maps from objects or Maps")}function JD(e){return!!e&&(e instanceof Map||e instanceof KD||"function"==typeof e.set&&"function"==typeof e.get&&"function"==typeof e.keys&&"function"==typeof e.has)}function ZD(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i of r)if(i)if(JD(i))for(var s of i.keys())e.set(s,i.get(s));else if(dD(i))for(var a of Object.keys(i))e.set(a,i[a]);return e}var XD=BD("Node",["mathWithTransform"],(e=>{var{mathWithTransform:t}=e;return class{get type(){return"Node"}get isNode(){return!0}evaluate(e){return this.compile().evaluate(e)}compile(){var e=this._compile(t,{}),r={};return{evaluate:function(t){var n=YD(t);return function(e){for(var t of[...LD])if(e.has(t))throw new Error('Scope contains an illegal symbol, "'+t+'" is a reserved keyword')}(n),e(n,r,null)}}}_compile(e,t){throw new Error("Method _compile must be implemented by type "+this.type)}forEach(e){throw new Error("Cannot run forEach on a Node interface")}map(e){throw new Error("Cannot run map on a Node interface")}_ifNode(e){if(!SD(e))throw new TypeError("Callback function must return a Node");return e}traverse(e){e(this,null,null),function e(t,r){t.forEach((function(t,n,i){r(t,n,i),e(t,r)}))}(this,e)}transform(e){return function t(r,n,i){var s=e(r,n,i);return s!==r?s:r.map(t)}(this,null,null)}filter(e){var t=[];return this.traverse((function(r,n,i){e(r,n,i)&&t.push(r)})),t}clone(){throw new Error("Cannot clone a Node interface")}cloneDeep(){return this.map((function(e){return e.cloneDeep()}))}equals(e){return!!e&&(this.type===e.type&&ID(this,e))}toString(e){var t=this._getCustomString(e);return void 0!==t?t:this._toString(e)}toJSON(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)}toHTML(e){var t=this._getCustomString(e);return void 0!==t?t:this.toHTML(e)}_toString(){throw new Error("_toString not implemented for "+this.type)}toTex(e){var t=this._getCustomString(e);return void 0!==t?t:this._toTex(e)}_toTex(e){throw new Error("_toTex not implemented for "+this.type)}_getCustomString(e){if(e&&"object"==typeof e)switch(typeof e.handler){case"object":case"undefined":return;case"function":return e.handler(this,e);default:throw new TypeError("Object or function expected as callback")}}getIdentifier(){return this.type}getContent(){return this}}}),{isClass:!0,isNode:!0});function QD(e){return QD="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},QD(e)}function eS(e){var t=function(e,t){if("object"!==QD(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==QD(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===QD(t)?t:String(t)}function tS(e,t,r){return(t=eS(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rS(e){return"boolean"==typeof e||!!isFinite(e)&&e===Math.round(e)}var nS=Math.sign||function(e){return e>0?1:e<0?-1:0},iS=Math.log2||function(e){return Math.log(e)/Math.LN2},sS=Math.log10||function(e){return Math.log(e)/Math.LN10},aS=Math.log1p||function(e){return Math.log(e+1)},oS=Math.cbrt||function(e){if(0===e)return e;var t,r=e<0;return r&&(e=-e),t=isFinite(e)?(e/((t=Math.exp(Math.log(e)/3))*t)+2*t)/3:e,r?-t:t},lS=Math.expm1||function(e){return e>=2e-4||e<=-2e-4?Math.exp(e)-1:e+e*e/2+e*e*e/6};function uS(e,t,r){var n={2:"0b",8:"0o",16:"0x"}[t],i="";if(r){if(r<1)throw new Error("size must be in greater than 0");if(!rS(r))throw new Error("size must be an integer");if(e>2**(r-1)-1||e<-(2**(r-1)))throw new Error("Value must be in range [-2^".concat(r-1,", 2^").concat(r-1,"-1]"));if(!rS(e))throw new Error("Value must be an integer");e<0&&(e+=2**r),i="i".concat(r)}var s="";return e<0&&(e=-e,s="-"),"".concat(s).concat(n).concat(e.toString(t)).concat(i)}function cS(e,t){if("function"==typeof t)return t(e);if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN";var r,n,i="auto";if(t&&(t.notation&&(i=t.notation),GE(t)?r=t:GE(t.precision)&&(r=t.precision),t.wordSize&&"number"!=typeof(n=t.wordSize)))throw new Error('Option "wordSize" must be a number');switch(i){case"fixed":return hS(e,r);case"exponential":return fS(e,r);case"engineering":return function(e,t){if(isNaN(e)||!isFinite(e))return String(e);var r=dS(e),n=pS(r,t),i=n.exponent,s=n.coefficients,a=i%3==0?i:i<0?i-3-i%3:i-i%3;if(GE(t))for(;t>s.length||i-a+1>s.length;)s.push(0);else for(var o=Math.abs(i-a)-(s.length-1),l=0;l<o;l++)s.push(0);var u=Math.abs(i-a),c=1;for(;u>0;)c++,u--;var d=s.slice(c).join(""),h=GE(t)&&d.length||d.match(/[1-9]/)?"."+d:"",f=s.slice(0,c).join("")+h+"e"+(i>=0?"+":"")+a.toString();return n.sign+f}(e,r);case"bin":return uS(e,2,n);case"oct":return uS(e,8,n);case"hex":return uS(e,16,n);case"auto":return function(e,t,r){if(isNaN(e)||!isFinite(e))return String(e);var n=r&&void 0!==r.lowerExp?r.lowerExp:-3,i=r&&void 0!==r.upperExp?r.upperExp:5,s=dS(e),a=t?pS(s,t):s;if(a.exponent<n||a.exponent>=i)return fS(e,t);var o=a.coefficients,l=a.exponent;o.length<t&&(o=o.concat(mS(t-o.length))),o=o.concat(mS(l-o.length+1+(o.length<t?t-o.length:0)));var u=l>0?l:0;return u<(o=mS(-l).concat(o)).length-1&&o.splice(u+1,0,"."),a.sign+o.join("")}(e,r,t&&t).replace(/((\.\d*?)(0+))($|e)/,(function(){var e=arguments[2],t=arguments[4];return"."!==e?e+t:t}));default:throw new Error('Unknown notation "'+i+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}function dS(e){var t=String(e).toLowerCase().match(/^(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!t)throw new SyntaxError("Invalid number "+e);var r=t[1],n=t[2],i=parseFloat(t[4]||"0"),s=n.indexOf(".");i+=-1!==s?s-1:n.length-1;var a=n.replace(".","").replace(/^0*/,(function(e){return i-=e.length,""})).replace(/0*$/,"").split("").map((function(e){return parseInt(e)}));return 0===a.length&&(a.push(0),i++),{sign:r,coefficients:a,exponent:i}}function hS(e,t){if(isNaN(e)||!isFinite(e))return String(e);var r=dS(e),n="number"==typeof t?pS(r,r.exponent+1+t):r,i=n.coefficients,s=n.exponent+1,a=s+(t||0);return i.length<a&&(i=i.concat(mS(a-i.length))),s<0&&(i=mS(1-s).concat(i),s=1),s<i.length&&i.splice(s,0,0===s?"0.":"."),n.sign+i.join("")}function fS(e,t){if(isNaN(e)||!isFinite(e))return String(e);var r=dS(e),n=t?pS(r,t):r,i=n.coefficients,s=n.exponent;i.length<t&&(i=i.concat(mS(t-i.length)));var a=i.shift();return n.sign+a+(i.length>0?"."+i.join(""):"")+"e"+(s>=0?"+":"")+s}function pS(e,t){for(var r={sign:e.sign,coefficients:e.coefficients,exponent:e.exponent},n=r.coefficients;t<=0;)n.unshift(0),r.exponent++,t++;if(n.length>t&&n.splice(t,n.length-t)[0]>=5){var i=t-1;for(n[i]++;10===n[i];)n.pop(),0===i&&(n.unshift(0),r.exponent++,i++),n[--i]++}return r}function mS(e){for(var t=[],r=0;r<e;r++)t.push(0);return t}var gS=Number.EPSILON||2220446049250313e-31;function yS(e,t,r){if(null==r)return e===t;if(e===t)return!0;if(isNaN(e)||isNaN(t))return!1;if(isFinite(e)&&isFinite(t)){var n=Math.abs(e-t);return n<gS||n<=Math.max(Math.abs(e),Math.abs(t))*r}return!1}var vS=Math.acosh||function(e){return Math.log(Math.sqrt(e*e-1)+e)},bS=Math.asinh||function(e){return Math.log(Math.sqrt(e*e+1)+e)},wS=Math.atanh||function(e){return Math.log((1+e)/(1-e))/2},xS=Math.cosh||function(e){return(Math.exp(e)+Math.exp(-e))/2},ES=Math.sinh||function(e){return(Math.exp(e)-Math.exp(-e))/2},DS=Math.tanh||function(e){var t=Math.exp(2*e);return(t-1)/(t+1)};function SS(e,t,r){var n=new(0,e.constructor)(2),i="";if(r){if(r<1)throw new Error("size must be in greater than 0");if(!rS(r))throw new Error("size must be an integer");if(e.greaterThan(n.pow(r-1).sub(1))||e.lessThan(n.pow(r-1).mul(-1)))throw new Error("Value must be in range [-2^".concat(r-1,", 2^").concat(r-1,"-1]"));if(!e.isInteger())throw new Error("Value must be an integer");e.lessThan(0)&&(e=e.add(n.pow(r))),i="i".concat(r)}switch(t){case 2:return"".concat(e.toBinary()).concat(i);case 8:return"".concat(e.toOctal()).concat(i);case 16:return"".concat(e.toHexadecimal()).concat(i);default:throw new Error("Base ".concat(t," not supported "))}}function AS(e,t){if("function"==typeof t)return t(e);if(!e.isFinite())return e.isNaN()?"NaN":e.gt(0)?"Infinity":"-Infinity";var r,n,i="auto";if(void 0!==t&&(t.notation&&(i=t.notation),"number"==typeof t?r=t:void 0!==t.precision&&(r=t.precision),t.wordSize&&"number"!=typeof(n=t.wordSize)))throw new Error('Option "wordSize" must be a number');switch(i){case"fixed":return function(e,t){return e.toFixed(t)}(e,r);case"exponential":return TS(e,r);case"engineering":return function(e,t){var r=e.e,n=r%3==0?r:r<0?r-3-r%3:r-r%3,i=e.mul(Math.pow(10,-n)),s=i.toPrecision(t);if(-1!==s.indexOf("e")){s=new(0,e.constructor)(s).toFixed()}return s+"e"+(r>=0?"+":"")+n.toString()}(e,r);case"bin":return SS(e,2,n);case"oct":return SS(e,8,n);case"hex":return SS(e,16,n);case"auto":var s=t&&void 0!==t.lowerExp?t.lowerExp:-3,a=t&&void 0!==t.upperExp?t.upperExp:5;if(e.isZero())return"0";var o=e.toSignificantDigits(r),l=o.e;return(l>=s&&l<a?o.toFixed():TS(e,r)).replace(/((\.\d*?)(0+))($|e)/,(function(){var e=arguments[2],t=arguments[4];return"."!==e?e+t:t}));default:throw new Error('Unknown notation "'+i+'". Choose "auto", "exponential", "fixed", "bin", "oct", or "hex.')}}function TS(e,t){return void 0!==t?e.toExponential(t-1):e.toExponential()}function CS(e,t){var r=e.length-t.length,n=e.length;return e.substring(r,n)===t}function NS(e,t){var r=function(e,t){if("number"==typeof e)return cS(e,t);if(KE(e))return AS(e,t);if(function(e){return e&&"object"==typeof e&&"number"==typeof e.s&&"number"==typeof e.n&&"number"==typeof e.d||!1}(e))return t&&"decimal"===t.fraction?e.toString():e.s*e.n+"/"+e.d;if(Array.isArray(e))return OS(e,t);if(ZE(e))return'"'+e+'"';if("function"==typeof e)return e.syntax?String(e.syntax):"function";if(e&&"object"==typeof e){return"function"==typeof e.format?e.format(t):e&&e.toString(t)!=={}.toString()?e.toString(t):"{"+Object.keys(e).map((r=>'"'+r+'": '+NS(e[r],t))).join(", ")+"}"}return String(e)}(e,t);return t&&"object"==typeof t&&"truncate"in t&&r.length>t.truncate?r.substring(0,t.truncate-3)+"...":r}function kS(e){for(var t=String(e),r="",n=0;n<t.length;){var i=t.charAt(n);"\\"===i?(r+=i,n++,""!==(i=t.charAt(n))&&-1!=='"\\/bfnrtu'.indexOf(i)||(r+="\\"),r+=i):r+='"'===i?'\\"':i,n++}return'"'+r+'"'}function MS(e){var t=String(e);return t=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function OS(e,t){if(Array.isArray(e)){for(var r="[",n=e.length,i=0;i<n;i++)0!==i&&(r+=", "),r+=OS(e[i],t);return r+="]"}return NS(e,t)}function FS(e,t){if(!ZE(e))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+FD(e)+", index: 0)");if(!ZE(t))throw new TypeError("Unexpected type of argument in function compareText (expected: string or Array or Matrix, actual: "+FD(t)+", index: 1)");return e===t?0:e>t?1:-1}var LS="ObjectNode",_S=BD(LS,["Node"],(e=>{var{Node:t}=e;class r extends t{constructor(e){if(super(),this.properties=e||{},e&&("object"!=typeof e||!Object.keys(e).every((function(t){return SD(e[t])}))))throw new TypeError("Object containing Nodes expected")}get type(){return LS}get isObjectNode(){return!0}_compile(e,t){var r={};for(var n in this.properties)if(PD(this.properties,n)){var i=kS(n),s=JSON.parse(i),a=$D(this.properties,n);r[s]=a._compile(e,t)}return function(e,t,n){var i={};for(var s in r)PD(r,s)&&(i[s]=r[s](e,t,n));return i}}forEach(e){for(var t in this.properties)PD(this.properties,t)&&e(this.properties[t],"properties["+kS(t)+"]",this)}map(e){var t={};for(var n in this.properties)PD(this.properties,n)&&(t[n]=this._ifNode(e(this.properties[n],"properties["+kS(n)+"]",this)));return new r(t)}clone(){var e={};for(var t in this.properties)PD(this.properties,t)&&(e[t]=this.properties[t]);return new r(e)}_toString(e){var t=[];for(var r in this.properties)PD(this.properties,r)&&t.push(kS(r)+": "+this.properties[r].toString(e));return"{"+t.join(", ")+"}"}toJSON(){return{mathjs:LS,properties:this.properties}}static fromJSON(e){return new r(e.properties)}toHTML(e){var t=[];for(var r in this.properties)PD(this.properties,r)&&t.push('<span class="math-symbol math-property">'+MS(r)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[r].toHTML(e));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'}_toTex(e){var t=[];for(var r in this.properties)PD(this.properties,r)&&t.push("\\mathbf{"+r+":} & "+this.properties[r].toTex(e)+"\\\\");return"\\left\\{\\begin{array}{ll}"+t.join("\n")+"\\end{array}\\right\\}"}}return tS(r,"name",LS),r}),{isClass:!0,isNode:!0});function RS(e,t,r){if(!(this instanceof RS))throw new SyntaxError("Constructor must be called with the new operator");this.actual=e,this.expected=t,this.relation=r,this.message="Dimension mismatch ("+(Array.isArray(e)?"["+e.join(", ")+"]":e)+" "+(this.relation||"!=")+" "+(Array.isArray(t)?"["+t.join(", ")+"]":t)+")",this.stack=(new Error).stack}function IS(e,t,r){if(!(this instanceof IS))throw new SyntaxError("Constructor must be called with the new operator");this.index=e,arguments.length<3?(this.min=0,this.max=t):(this.min=t,this.max=r),void 0!==this.min&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":void 0!==this.max&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=(new Error).stack}function PS(e){for(var t=[];Array.isArray(e);)t.push(e.length),e=e[0];return t}function BS(e,t,r){var n,i=e.length;if(i!==t[r])throw new RS(i,t[r]);if(r<t.length-1){var s=r+1;for(n=0;n<i;n++){var a=e[n];if(!Array.isArray(a))throw new RS(t.length-1,t.length,"<");BS(e[n],t,s)}}else for(n=0;n<i;n++)if(Array.isArray(e[n]))throw new RS(t.length+1,t.length,">")}function US(e,t){if(0===t.length){if(Array.isArray(e))throw new RS(e.length,0)}else BS(e,t,0)}function $S(e,t){if(!GE(e)||!rS(e))throw new TypeError("Index must be an integer (value: "+e+")");if(e<0||"number"==typeof t&&e>=t)throw new IS(e,t)}function zS(e,t,r){if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Array expected");if(0===t.length)throw new Error("Resizing to scalar is not supported");return t.forEach((function(e){if(!GE(e)||!rS(e)||e<0)throw new TypeError("Invalid size, must contain positive integers (size: "+NS(t)+")")})),jS(e,t,0,void 0!==r?r:0),e}function jS(e,t,r,n){var i,s,a=e.length,o=t[r],l=Math.min(a,o);if(e.length=o,r<t.length-1){var u=r+1;for(i=0;i<l;i++)s=e[i],Array.isArray(s)||(s=[s],e[i]=s),jS(s,t,u,n);for(i=l;i<o;i++)s=[],e[i]=s,jS(s,t,u,n)}else{for(i=0;i<l;i++)for(;Array.isArray(e[i]);)e[i]=e[i][0];for(i=l;i<o;i++)e[i]=n}}function qS(e,t){var r=JS(e),n=r.length;if(!Array.isArray(e)||!Array.isArray(t))throw new TypeError("Array expected");if(0===t.length)throw new RS(0,n,"!=");var i=VS(t=HS(t,n));if(n!==i)throw new RS(i,n,"!=");try{return function(e,t){for(var r,n=e,i=t.length-1;i>0;i--){var s=t[i];r=[];for(var a=n.length/s,o=0;o<a;o++)r.push(n.slice(o*s,(o+1)*s));n=r}return n}(r,t)}catch(e){if(e instanceof RS)throw new RS(i,n,"!=");throw e}}function HS(e,t){var r=VS(e),n=e.slice(),i=e.indexOf(-1);if(e.indexOf(-1,i+1)>=0)throw new Error("More than one wildcard in sizes");if(i>=0){if(!(t%r==0))throw new Error("Could not replace wildcard, since "+t+" is no multiple of "+-r);n[i]=-t/r}return n}function VS(e){return e.reduce(((e,t)=>e*t),1)}function GS(e,t){for(var r=t||PS(e);Array.isArray(e)&&1===e.length;)e=e[0],r.shift();for(var n=r.length;1===r[n-1];)n--;return n<r.length&&(e=KS(e,n,0),r.length=n),e}function KS(e,t,r){var n,i;if(r<t){var s=r+1;for(n=0,i=e.length;n<i;n++)e[n]=KS(e[n],t,s)}else for(;Array.isArray(e);)e=e[0];return e}function WS(e,t,r,n){var i=n||PS(e);if(r)for(var s=0;s<r;s++)e=[e],i.unshift(1);for(e=YS(e,t,0);i.length<t;)i.push(1);return e}function YS(e,t,r){var n,i;if(Array.isArray(e)){var s=r+1;for(n=0,i=e.length;n<i;n++)e[n]=YS(e[n],t,s)}else for(var a=r;a<t;a++)e=[e];return e}function JS(e){if(!Array.isArray(e))return e;var t=[];return e.forEach((function e(r){Array.isArray(r)?r.forEach(e):t.push(r)})),t}function ZS(e,t){return Array.prototype.map.call(e,t)}function XS(e,t){Array.prototype.forEach.call(e,t)}function QS(e,t){if(1!==PS(e).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(e,t)}function eA(e,t){if(1!==PS(e).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(e,(e=>t.test(e)))}function tA(e,t){return Array.prototype.join.call(e,t)}function rA(e){if(!Array.isArray(e))throw new TypeError("Array input expected");if(0===e.length)return e;var t=[],r=0;t[0]={value:e[0],identifier:0};for(var n=1;n<e.length;n++)e[n]===e[n-1]?r++:r=0,t.push({value:e[n],identifier:r});return t}function nA(e){if(!Array.isArray(e))throw new TypeError("Array input expected");if(0===e.length)return e;for(var t=[],r=0;r<e.length;r++)t.push(e[r].value);return t}function iA(e,t){for(var r,n=0,i=0;i<e.length;i++){var s=e[i],a=Array.isArray(s);if(0===i&&a&&(n=s.length),a&&s.length!==n)return;var o=a?iA(s,t):t(s);if(void 0===r)r=o;else if(r!==o)return"mixed"}return r}RS.prototype=new RangeError,RS.prototype.constructor=RangeError,RS.prototype.name="DimensionError",RS.prototype.isDimensionError=!0,IS.prototype=new RangeError,IS.prototype.constructor=RangeError,IS.prototype.name="IndexError",IS.prototype.isIndexError=!0;var sA=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{op:"or",associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{op:"xor",associativity:"left",associativeWith:[]}},{"OperatorNode:and":{op:"and",associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{op:"|",associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{op:"^|",associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{op:"&",associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{op:"==",associativity:"left",associativeWith:[]},"OperatorNode:unequal":{op:"!=",associativity:"left",associativeWith:[]},"OperatorNode:smaller":{op:"<",associativity:"left",associativeWith:[]},"OperatorNode:larger":{op:">",associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{op:"<=",associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{op:">=",associativity:"left",associativeWith:[]},RelationalNode:{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{op:"<<",associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{op:">>",associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{op:">>>",associativity:"left",associativeWith:[]}},{"OperatorNode:to":{op:"to",associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{op:"+",associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{op:"-",associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{op:"*",associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{op:"/",associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{op:".*",associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{op:"./",associativity:"left",associativeWith:[]},"OperatorNode:mod":{op:"mod",associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]}},{"OperatorNode:unaryPlus":{op:"+",associativity:"right"},"OperatorNode:unaryMinus":{op:"-",associativity:"right"},"OperatorNode:bitNot":{op:"~",associativity:"right"},"OperatorNode:not":{op:"not",associativity:"right"}},{"OperatorNode:pow":{op:"^",associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{op:".^",associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{op:"!",associativity:"left"}},{"OperatorNode:ctranspose":{op:"'",associativity:"left"}}];function aA(e,t){if(!t||"auto"!==t)return e;for(var r=e;CD(r);)r=r.content;return r}function oA(e,t,r,n){var i=e;"keep"!==t&&(i=e.getContent());for(var s=i.getIdentifier(),a=null,o=0;o<sA.length;o++)if(s in sA[o]){a=o;break}if("OperatorNode:multiply"===s&&i.implicit&&"show"!==r){var l=aA(i.args[0],t);bD(l)&&n&&"OperatorNode:divide"===n.getIdentifier()&&wD(aA(n.args[0],t))||"OperatorNode:divide"===l.getIdentifier()&&wD(aA(l.args[0],t))&&bD(aA(l.args[1]))||(a+=1)}return a}function lA(e,t){var r=e;"keep"!==t&&(r=e.getContent());var n=r.getIdentifier(),i=oA(r,t);if(null===i)return null;var s=sA[i][n];if(PD(s,"associativity")){if("left"===s.associativity)return"left";if("right"===s.associativity)return"right";throw Error("'"+n+"' has the invalid associativity '"+s.associativity+"'.")}return null}function uA(e,t,r){var n="keep"!==r?e.getContent():e,i="keep"!==r?e.getContent():t,s=n.getIdentifier(),a=i.getIdentifier(),o=oA(n,r);if(null===o)return null;var l=sA[o][s];if(PD(l,"associativeWith")&&l.associativeWith instanceof Array){for(var u=0;u<l.associativeWith.length;u++)if(l.associativeWith[u]===a)return!0;return!1}return null}var cA=r(7928),dA={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},hA={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},fA={abs:{1:"\\left|${args[0]}\\right|"},add:{2:"\\left(${args[0]}".concat(hA.add,"${args[1]}\\right)")},cbrt:{1:"\\sqrt[3]{${args[0]}}"},ceil:{1:"\\left\\lceil${args[0]}\\right\\rceil"},cube:{1:"\\left(${args[0]}\\right)^3"},divide:{2:"\\frac{${args[0]}}{${args[1]}}"},dotDivide:{2:"\\left(${args[0]}".concat(hA.dotDivide,"${args[1]}\\right)")},dotMultiply:{2:"\\left(${args[0]}".concat(hA.dotMultiply,"${args[1]}\\right)")},dotPow:{2:"\\left(${args[0]}".concat(hA.dotPow,"${args[1]}\\right)")},exp:{1:"\\exp\\left(${args[0]}\\right)"},expm1:"\\left(e".concat(hA.pow,"{${args[0]}}-1\\right)"),fix:{1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},floor:{1:"\\left\\lfloor${args[0]}\\right\\rfloor"},gcd:"\\gcd\\left(${args}\\right)",hypot:"\\hypot\\left(${args}\\right)",log:{1:"\\ln\\left(${args[0]}\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}\\right)"},log10:{1:"\\log_{10}\\left(${args[0]}\\right)"},log1p:{1:"\\ln\\left(${args[0]}+1\\right)",2:"\\log_{${args[1]}}\\left(${args[0]}+1\\right)"},log2:"\\log_{2}\\left(${args[0]}\\right)",mod:{2:"\\left(${args[0]}".concat(hA.mod,"${args[1]}\\right)")},multiply:{2:"\\left(${args[0]}".concat(hA.multiply,"${args[1]}\\right)")},norm:{1:"\\left\\|${args[0]}\\right\\|",2:void 0},nthRoot:{2:"\\sqrt[${args[1]}]{${args[0]}}"},nthRoots:{2:"\\{y : $y^{args[1]} = {${args[0]}}\\}"},pow:{2:"\\left(${args[0]}\\right)".concat(hA.pow,"{${args[1]}}")},round:{1:"\\left\\lfloor${args[0]}\\right\\rceil",2:void 0},sign:{1:"\\mathrm{${name}}\\left(${args[0]}\\right)"},sqrt:{1:"\\sqrt{${args[0]}}"},square:{1:"\\left(${args[0]}\\right)^2"},subtract:{2:"\\left(${args[0]}".concat(hA.subtract,"${args[1]}\\right)")},unaryMinus:{1:"".concat(hA.unaryMinus,"\\left(${args[0]}\\right)")},unaryPlus:{1:"".concat(hA.unaryPlus,"\\left(${args[0]}\\right)")},bitAnd:{2:"\\left(${args[0]}".concat(hA.bitAnd,"${args[1]}\\right)")},bitNot:{1:hA.bitNot+"\\left(${args[0]}\\right)"},bitOr:{2:"\\left(${args[0]}".concat(hA.bitOr,"${args[1]}\\right)")},bitXor:{2:"\\left(${args[0]}".concat(hA.bitXor,"${args[1]}\\right)")},leftShift:{2:"\\left(${args[0]}".concat(hA.leftShift,"${args[1]}\\right)")},rightArithShift:{2:"\\left(${args[0]}".concat(hA.rightArithShift,"${args[1]}\\right)")},rightLogShift:{2:"\\left(${args[0]}".concat(hA.rightLogShift,"${args[1]}\\right)")},bellNumbers:{1:"\\mathrm{B}_{${args[0]}}"},catalan:{1:"\\mathrm{C}_{${args[0]}}"},stirlingS2:{2:"\\mathrm{S}\\left(${args}\\right)"},arg:{1:"\\arg\\left(${args[0]}\\right)"},conj:{1:"\\left(${args[0]}\\right)^*"},im:{1:"\\Im\\left\\lbrace${args[0]}\\right\\rbrace"},re:{1:"\\Re\\left\\lbrace${args[0]}\\right\\rbrace"},and:{2:"\\left(${args[0]}".concat(hA.and,"${args[1]}\\right)")},not:{1:hA.not+"\\left(${args[0]}\\right)"},or:{2:"\\left(${args[0]}".concat(hA.or,"${args[1]}\\right)")},xor:{2:"\\left(${args[0]}".concat(hA.xor,"${args[1]}\\right)")},cross:{2:"\\left(${args[0]}\\right)\\times\\left(${args[1]}\\right)"},ctranspose:{1:"\\left(${args[0]}\\right)".concat(hA.ctranspose)},det:{1:"\\det\\left(${args[0]}\\right)"},dot:{2:"\\left(${args[0]}\\cdot${args[1]}\\right)"},expm:{1:"\\exp\\left(${args[0]}\\right)"},inv:{1:"\\left(${args[0]}\\right)^{-1}"},pinv:{1:"\\left(${args[0]}\\right)^{+}"},sqrtm:{1:"{${args[0]}}".concat(hA.pow,"{\\frac{1}{2}}")},trace:{1:"\\mathrm{tr}\\left(${args[0]}\\right)"},transpose:{1:"\\left(${args[0]}\\right)".concat(hA.transpose)},combinations:{2:"\\binom{${args[0]}}{${args[1]}}"},combinationsWithRep:{2:"\\left(\\!\\!{\\binom{${args[0]}}{${args[1]}}}\\!\\!\\right)"},factorial:{1:"\\left(${args[0]}\\right)".concat(hA.factorial)},gamma:{1:"\\Gamma\\left(${args[0]}\\right)"},lgamma:{1:"\\ln\\Gamma\\left(${args[0]}\\right)"},equal:{2:"\\left(${args[0]}".concat(hA.equal,"${args[1]}\\right)")},larger:{2:"\\left(${args[0]}".concat(hA.larger,"${args[1]}\\right)")},largerEq:{2:"\\left(${args[0]}".concat(hA.largerEq,"${args[1]}\\right)")},smaller:{2:"\\left(${args[0]}".concat(hA.smaller,"${args[1]}\\right)")},smallerEq:{2:"\\left(${args[0]}".concat(hA.smallerEq,"${args[1]}\\right)")},unequal:{2:"\\left(${args[0]}".concat(hA.unequal,"${args[1]}\\right)")},erf:{1:"erf\\left(${args[0]}\\right)"},max:"\\max\\left(${args}\\right)",min:"\\min\\left(${args}\\right)",variance:"\\mathrm{Var}\\left(${args}\\right)",acos:{1:"\\cos^{-1}\\left(${args[0]}\\right)"},acosh:{1:"\\cosh^{-1}\\left(${args[0]}\\right)"},acot:{1:"\\cot^{-1}\\left(${args[0]}\\right)"},acoth:{1:"\\coth^{-1}\\left(${args[0]}\\right)"},acsc:{1:"\\csc^{-1}\\left(${args[0]}\\right)"},acsch:{1:"\\mathrm{csch}^{-1}\\left(${args[0]}\\right)"},asec:{1:"\\sec^{-1}\\left(${args[0]}\\right)"},asech:{1:"\\mathrm{sech}^{-1}\\left(${args[0]}\\right)"},asin:{1:"\\sin^{-1}\\left(${args[0]}\\right)"},asinh:{1:"\\sinh^{-1}\\left(${args[0]}\\right)"},atan:{1:"\\tan^{-1}\\left(${args[0]}\\right)"},atan2:{2:"\\mathrm{atan2}\\left(${args}\\right)"},atanh:{1:"\\tanh^{-1}\\left(${args[0]}\\right)"},cos:{1:"\\cos\\left(${args[0]}\\right)"},cosh:{1:"\\cosh\\left(${args[0]}\\right)"},cot:{1:"\\cot\\left(${args[0]}\\right)"},coth:{1:"\\coth\\left(${args[0]}\\right)"},csc:{1:"\\csc\\left(${args[0]}\\right)"},csch:{1:"\\mathrm{csch}\\left(${args[0]}\\right)"},sec:{1:"\\sec\\left(${args[0]}\\right)"},sech:{1:"\\mathrm{sech}\\left(${args[0]}\\right)"},sin:{1:"\\sin\\left(${args[0]}\\right)"},sinh:{1:"\\sinh\\left(${args[0]}\\right)"},tan:{1:"\\tan\\left(${args[0]}\\right)"},tanh:{1:"\\tanh\\left(${args[0]}\\right)"},to:{2:"\\left(${args[0]}".concat(hA.to,"${args[1]}\\right)")},numeric:function(e,t){return e.args[0].toTex()},number:{0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},string:{0:'\\mathtt{""}',1:"\\mathrm{string}\\left(${args[0]}\\right)"},bignumber:{0:"0",1:"\\left(${args[0]}\\right)"},complex:{0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)+".concat(dA.i,"\\cdot\\left(${args[1]}\\right)\\right)")},matrix:{0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},sparse:{0:"\\begin{bsparse}\\end{bsparse}",1:"\\left(${args[0]}\\right)"},unit:{1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"}},pA={deg:"^\\circ"};function mA(e){return cA(e,{preserveFormatting:!0})}function gA(e,t){return(t=void 0!==t&&t)?PD(pA,e)?pA[e]:"\\mathrm{"+mA(e)+"}":PD(dA,e)?dA[e]:mA(e)}var yA="OperatorNode",vA=BD(yA,["Node"],(e=>{var{Node:t}=e;function r(e,t){var n=e;if("auto"===t)for(;CD(n);)n=n.content;return!!bD(n)||!!TD(n)&&r(n.args[0],t)}function n(e,t,n,i,s){var a,o=oA(e,t,n),l=lA(e,t);if("all"===t||i.length>2&&"OperatorNode:add"!==e.getIdentifier()&&"OperatorNode:multiply"!==e.getIdentifier())return i.map((function(e){switch(e.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}}));switch(i.length){case 0:a=[];break;case 1:var u=oA(i[0],t,n,e);if(s&&null!==u){var c,d;if("keep"===t?(c=i[0].getIdentifier(),d=e.getIdentifier()):(c=i[0].getContent().getIdentifier(),d=e.getContent().getIdentifier()),!1===sA[o][d].latexLeftParens){a=[!1];break}if(!1===sA[u][c].latexParens){a=[!1];break}}if(null===u){a=[!1];break}if(u<=o){a=[!0];break}a=[!1];break;case 2:var h,f,p=oA(i[0],t,n,e),m=uA(e,i[0],t);h=null!==p&&(p===o&&"right"===l&&!m||p<o);var g,y,v,b=oA(i[1],t,n,e),w=uA(e,i[1],t);if(f=null!==b&&(b===o&&"left"===l&&!w||b<o),s)"keep"===t?(g=e.getIdentifier(),y=e.args[0].getIdentifier(),v=e.args[1].getIdentifier()):(g=e.getContent().getIdentifier(),y=e.args[0].getContent().getIdentifier(),v=e.args[1].getContent().getIdentifier()),null!==p&&(!1===sA[o][g].latexLeftParens&&(h=!1),!1===sA[p][y].latexParens&&(h=!1)),null!==b&&(!1===sA[o][g].latexRightParens&&(f=!1),!1===sA[b][v].latexParens&&(f=!1));a=[h,f];break;default:"OperatorNode:add"!==e.getIdentifier()&&"OperatorNode:multiply"!==e.getIdentifier()||(a=i.map((function(r){var i=oA(r,t,n,e),s=uA(e,r,t),a=lA(r,t);return null!==i&&(o===i&&l===a&&!s||i<o)})))}if(i.length>=2&&"OperatorNode:multiply"===e.getIdentifier()&&e.implicit&&"all"!==t&&"hide"===n)for(var x=1;x<a.length;++x)!r(i[x],t)||a[x-1]||"keep"===t&&CD(i[x-1])||(a[x]=!0);return a}class i extends t{constructor(e,t,r,n,i){if(super(),"string"!=typeof e)throw new TypeError('string expected for parameter "op"');if("string"!=typeof t)throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(r)||!r.every(SD))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=!0===n,this.isPercentage=!0===i,this.op=e,this.fn=t,this.args=r||[]}get type(){return yA}get isOperatorNode(){return!0}_compile(e,t){if("string"!=typeof this.fn||!qD(e,this.fn))throw e[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var r=$D(e,this.fn),n=ZS(this.args,(function(r){return r._compile(e,t)}));if(1===n.length){var i=n[0];return function(e,t,n){return r(i(e,t,n))}}if(2===n.length){var s=n[0],a=n[1];return function(e,t,n){return r(s(e,t,n),a(e,t,n))}}return function(e,t,i){return r.apply(null,ZS(n,(function(r){return r(e,t,i)})))}}forEach(e){for(var t=0;t<this.args.length;t++)e(this.args[t],"args["+t+"]",this)}map(e){for(var t=[],r=0;r<this.args.length;r++)t[r]=this._ifNode(e(this.args[r],"args["+r+"]",this));return new i(this.op,this.fn,t,this.implicit,this.isPercentage)}clone(){return new i(this.op,this.fn,this.args.slice(0),this.implicit,this.isPercentage)}isUnary(){return 1===this.args.length}isBinary(){return 2===this.args.length}_toString(e){var t=e&&e.parenthesis?e.parenthesis:"keep",r=e&&e.implicit?e.implicit:"hide",i=this.args,s=n(this,t,r,i,!1);if(1===i.length){var a=lA(this,t),o=i[0].toString(e);s[0]&&(o="("+o+")");var l=/[a-zA-Z]+/.test(this.op);return"right"===a?this.op+(l?" ":"")+o:"left"===a?o+(l?" ":"")+this.op:o+this.op}if(2===i.length){var u=i[0].toString(e),c=i[1].toString(e);return s[0]&&(u="("+u+")"),s[1]&&(c="("+c+")"),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?u+" "+c:u+" "+this.op+" "+c}if(i.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var d=i.map((function(t,r){return t=t.toString(e),s[r]&&(t="("+t+")"),t}));return this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?d.join(" "):d.join(" "+this.op+" ")}return this.fn+"("+this.args.join(", ")+")"}toJSON(){return{mathjs:yA,op:this.op,fn:this.fn,args:this.args,implicit:this.implicit,isPercentage:this.isPercentage}}static fromJSON(e){return new i(e.op,e.fn,e.args,e.implicit,e.isPercentage)}toHTML(e){var t=e&&e.parenthesis?e.parenthesis:"keep",r=e&&e.implicit?e.implicit:"hide",i=this.args,s=n(this,t,r,i,!1);if(1===i.length){var a=lA(this,t),o=i[0].toHTML(e);return s[0]&&(o='<span class="math-parenthesis math-round-parenthesis">(</span>'+o+'<span class="math-parenthesis math-round-parenthesis">)</span>'),"right"===a?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+MS(this.op)+"</span>"+o:o+'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+MS(this.op)+"</span>"}if(2===i.length){var l=i[0].toHTML(e),u=i[1].toHTML(e);return s[0]&&(l='<span class="math-parenthesis math-round-parenthesis">(</span>'+l+'<span class="math-parenthesis math-round-parenthesis">)</span>'),s[1]&&(u='<span class="math-parenthesis math-round-parenthesis">(</span>'+u+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?l+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+u:l+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+MS(this.op)+"</span>"+u}var c=i.map((function(t,r){return t=t.toHTML(e),s[r]&&(t='<span class="math-parenthesis math-round-parenthesis">(</span>'+t+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t}));return i.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())?this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?c.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):c.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+MS(this.op)+"</span>"):'<span class="math-function">'+MS(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+c.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'}_toTex(e){var t=e&&e.parenthesis?e.parenthesis:"keep",r=e&&e.implicit?e.implicit:"hide",i=this.args,s=n(this,t,r,i,!0),a=hA[this.fn];if(a=void 0===a?this.op:a,1===i.length){var o=lA(this,t),l=i[0].toTex(e);return s[0]&&(l="\\left(".concat(l,"\\right)")),"right"===o?a+l:l+a}if(2===i.length){var u=i[0],c=u.toTex(e);s[0]&&(c="\\left(".concat(c,"\\right)"));var d,h=i[1].toTex(e);switch(s[1]&&(h="\\left(".concat(h,"\\right)")),d="keep"===t?u.getIdentifier():u.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return a+"{"+c+"}{"+h+"}";case"OperatorNode:pow":switch(c="{"+c+"}",h="{"+h+"}",d){case"ConditionalNode":case"OperatorNode:divide":c="\\left(".concat(c,"\\right)")}break;case"OperatorNode:multiply":if(this.implicit&&"hide"===r)return c+"~"+h}return c+a+h}if(i.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var f=i.map((function(t,r){return t=t.toTex(e),s[r]&&(t="\\left(".concat(t,"\\right)")),t}));return"OperatorNode:multiply"===this.getIdentifier()&&this.implicit&&"hide"===r?f.join("~"):f.join(a)}return"\\mathrm{"+this.fn+"}\\left("+i.map((function(t){return t.toTex(e)})).join(",")+"\\right)"}getIdentifier(){return this.type+":"+this.fn}}return tS(i,"name",yA),i}),{isClass:!0,isNode:!0}),bA="ParenthesisNode",wA=BD(bA,["Node"],(e=>{var{Node:t}=e;class r extends t{constructor(e){if(super(),!SD(e))throw new TypeError('Node expected for parameter "content"');this.content=e}get type(){return bA}get isParenthesisNode(){return!0}_compile(e,t){return this.content._compile(e,t)}getContent(){return this.content.getContent()}forEach(e){e(this.content,"content",this)}map(e){var t=e(this.content,"content",this);return new r(t)}clone(){return new r(this.content)}_toString(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?"("+this.content.toString(e)+")":this.content.toString(e)}toJSON(){return{mathjs:bA,content:this.content}}static fromJSON(e){return new r(e.content)}toHTML(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(e)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(e)}_toTex(e){return!e||e&&!e.parenthesis||e&&"keep"===e.parenthesis?"\\left(".concat(this.content.toTex(e),"\\right)"):this.content.toTex(e)}}return tS(r,"name",bA),r}),{isClass:!0,isNode:!0}),xA="RelationalNode",EA=BD(xA,["Node"],(e=>{var{Node:t}=e,r={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="};class n extends t{constructor(e,t){if(super(),!Array.isArray(e))throw new TypeError("Parameter conditionals must be an array");if(!Array.isArray(t))throw new TypeError("Parameter params must be an array");if(e.length!==t.length-1)throw new TypeError("Parameter params must contain exactly one more element than parameter conditionals");this.conditionals=e,this.params=t}get type(){return xA}get isRelationalNode(){return!0}_compile(e,t){var r=this,n=this.params.map((r=>r._compile(e,t)));return function(t,i,s){for(var a,o=n[0](t,i,s),l=0;l<r.conditionals.length;l++){if(a=o,o=n[l+1](t,i,s),!$D(e,r.conditionals[l])(a,o))return!1}return!0}}forEach(e){this.params.forEach(((t,r)=>e(t,"params["+r+"]",this)),this)}map(e){return new n(this.conditionals.slice(),this.params.map(((t,r)=>this._ifNode(e(t,"params["+r+"]",this))),this))}clone(){return new n(this.conditionals,this.params)}_toString(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",n=oA(this,t,e&&e.implicit),i=this.params.map((function(r,i){var s=oA(r,t,e&&e.implicit);return"all"===t||null!==s&&s<=n?"("+r.toString(e)+")":r.toString(e)})),s=i[0],a=0;a<this.conditionals.length;a++)s+=" "+r[this.conditionals[a]],s+=" "+i[a+1];return s}toJSON(){return{mathjs:xA,conditionals:this.conditionals,params:this.params}}static fromJSON(e){return new n(e.conditionals,e.params)}toHTML(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",n=oA(this,t,e&&e.implicit),i=this.params.map((function(r,i){var s=oA(r,t,e&&e.implicit);return"all"===t||null!==s&&s<=n?'<span class="math-parenthesis math-round-parenthesis">(</span>'+r.toHTML(e)+'<span class="math-parenthesis math-round-parenthesis">)</span>':r.toHTML(e)})),s=i[0],a=0;a<this.conditionals.length;a++)s+='<span class="math-operator math-binary-operator math-explicit-binary-operator">'+MS(r[this.conditionals[a]])+"</span>"+i[a+1];return s}_toTex(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",r=oA(this,t,e&&e.implicit),n=this.params.map((function(n,i){var s=oA(n,t,e&&e.implicit);return"all"===t||null!==s&&s<=r?"\\left("+n.toTex(e)+"\right)":n.toTex(e)})),i=n[0],s=0;s<this.conditionals.length;s++)i+=hA[this.conditionals[s]]+n[s+1];return i}}return tS(n,"name",xA),n}),{isClass:!0,isNode:!0}),DA="ArrayNode",SA=BD(DA,["Node"],(e=>{var{Node:t}=e;class r extends t{constructor(e){if(super(),this.items=e||[],!Array.isArray(this.items)||!this.items.every(SD))throw new TypeError("Array containing Nodes expected")}get type(){return DA}get isArrayNode(){return!0}_compile(e,t){var r=ZS(this.items,(function(r){return r._compile(e,t)}));if("Array"!==e.config.matrix){var n=e.matrix;return function(e,t,i){return n(ZS(r,(function(r){return r(e,t,i)})))}}return function(e,t,n){return ZS(r,(function(r){return r(e,t,n)}))}}forEach(e){for(var t=0;t<this.items.length;t++){e(this.items[t],"items["+t+"]",this)}}map(e){for(var t=[],n=0;n<this.items.length;n++)t[n]=this._ifNode(e(this.items[n],"items["+n+"]",this));return new r(t)}clone(){return new r(this.items.slice(0))}_toString(e){return"["+this.items.map((function(t){return t.toString(e)})).join(", ")+"]"}toJSON(){return{mathjs:DA,items:this.items}}static fromJSON(e){return new r(e.items)}toHTML(e){return'<span class="math-parenthesis math-square-parenthesis">[</span>'+this.items.map((function(t){return t.toHTML(e)})).join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'}_toTex(e){return function t(r,n){var i=r.some(mD)&&!r.every(mD),s=n||i,a=s?"&":"\\\\",o=r.map((function(r){return r.items?t(r.items,!n):r.toTex(e)})).join(a);return i||!s||s&&!n?"\\begin{bmatrix}"+o+"\\end{bmatrix}":o}(this.items,!1)}}return tS(r,"name",DA),r}),{isClass:!0,isNode:!0}),AA="BlockNode",TA=BD(AA,["ResultSet","Node"],(e=>{var{ResultSet:t,Node:r}=e;class n extends r{constructor(e){if(super(),!Array.isArray(e))throw new Error("Array expected");this.blocks=e.map((function(e){var t=e&&e.node,r=!e||void 0===e.visible||e.visible;if(!SD(t))throw new TypeError('Property "node" must be a Node');if("boolean"!=typeof r)throw new TypeError('Property "visible" must be a boolean');return{node:t,visible:r}}))}get type(){return AA}get isBlockNode(){return!0}_compile(e,r){var n=ZS(this.blocks,(function(t){return{evaluate:t.node._compile(e,r),visible:t.visible}}));return function(e,r,i){var s=[];return XS(n,(function(t){var n=t.evaluate(e,r,i);t.visible&&s.push(n)})),new t(s)}}forEach(e){for(var t=0;t<this.blocks.length;t++)e(this.blocks[t].node,"blocks["+t+"].node",this)}map(e){for(var t=[],r=0;r<this.blocks.length;r++){var i=this.blocks[r],s=this._ifNode(e(i.node,"blocks["+r+"].node",this));t[r]={node:s,visible:i.visible}}return new n(t)}clone(){var e=this.blocks.map((function(e){return{node:e.node,visible:e.visible}}));return new n(e)}_toString(e){return this.blocks.map((function(t){return t.node.toString(e)+(t.visible?"":";")})).join("\n")}toJSON(){return{mathjs:AA,blocks:this.blocks}}static fromJSON(e){return new n(e.blocks)}toHTML(e){return this.blocks.map((function(t){return t.node.toHTML(e)+(t.visible?"":'<span class="math-separator">;</span>')})).join('<span class="math-separator"><br /></span>')}_toTex(e){return this.blocks.map((function(t){return t.node.toTex(e)+(t.visible?"":";")})).join("\\;\\;\n")}}return tS(n,"name",AA),n}),{isClass:!0,isNode:!0}),CA="ConditionalNode",NA=BD(CA,["Node"],(e=>{var{Node:t}=e;class r extends t{constructor(e,t,r){if(super(),!SD(e))throw new TypeError("Parameter condition must be a Node");if(!SD(t))throw new TypeError("Parameter trueExpr must be a Node");if(!SD(r))throw new TypeError("Parameter falseExpr must be a Node");this.condition=e,this.trueExpr=t,this.falseExpr=r}get type(){return CA}get isConditionalNode(){return!0}_compile(e,t){var r=this.condition._compile(e,t),n=this.trueExpr._compile(e,t),i=this.falseExpr._compile(e,t);return function(e,t,s){return function(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e)return!!e;if(e){if(KE(e))return!e.isZero();if(WE(e))return!(!e.re&&!e.im);if(JE(e))return!!e.value}if(null==e)return!1;throw new TypeError('Unsupported type of condition "'+FD(e)+'"')}(r(e,t,s))?n(e,t,s):i(e,t,s)}}forEach(e){e(this.condition,"condition",this),e(this.trueExpr,"trueExpr",this),e(this.falseExpr,"falseExpr",this)}map(e){return new r(this._ifNode(e(this.condition,"condition",this)),this._ifNode(e(this.trueExpr,"trueExpr",this)),this._ifNode(e(this.falseExpr,"falseExpr",this)))}clone(){return new r(this.condition,this.trueExpr,this.falseExpr)}_toString(e){var t=e&&e.parenthesis?e.parenthesis:"keep",r=oA(this,t,e&&e.implicit),n=this.condition.toString(e),i=oA(this.condition,t,e&&e.implicit);("all"===t||"OperatorNode"===this.condition.type||null!==i&&i<=r)&&(n="("+n+")");var s=this.trueExpr.toString(e),a=oA(this.trueExpr,t,e&&e.implicit);("all"===t||"OperatorNode"===this.trueExpr.type||null!==a&&a<=r)&&(s="("+s+")");var o=this.falseExpr.toString(e),l=oA(this.falseExpr,t,e&&e.implicit);return("all"===t||"OperatorNode"===this.falseExpr.type||null!==l&&l<=r)&&(o="("+o+")"),n+" ? "+s+" : "+o}toJSON(){return{mathjs:CA,condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}}static fromJSON(e){return new r(e.condition,e.trueExpr,e.falseExpr)}toHTML(e){var t=e&&e.parenthesis?e.parenthesis:"keep",r=oA(this,t,e&&e.implicit),n=this.condition.toHTML(e),i=oA(this.condition,t,e&&e.implicit);("all"===t||"OperatorNode"===this.condition.type||null!==i&&i<=r)&&(n='<span class="math-parenthesis math-round-parenthesis">(</span>'+n+'<span class="math-parenthesis math-round-parenthesis">)</span>');var s=this.trueExpr.toHTML(e),a=oA(this.trueExpr,t,e&&e.implicit);("all"===t||"OperatorNode"===this.trueExpr.type||null!==a&&a<=r)&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>');var o=this.falseExpr.toHTML(e),l=oA(this.falseExpr,t,e&&e.implicit);return("all"===t||"OperatorNode"===this.falseExpr.type||null!==l&&l<=r)&&(o='<span class="math-parenthesis math-round-parenthesis">(</span>'+o+'<span class="math-parenthesis math-round-parenthesis">)</span>'),n+'<span class="math-operator math-conditional-operator">?</span>'+s+'<span class="math-operator math-conditional-operator">:</span>'+o}_toTex(e){return"\\begin{cases} {"+this.trueExpr.toTex(e)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(e)+"}\\\\{"+this.falseExpr.toTex(e)+"}, &\\quad{\\text{otherwise}}\\end{cases}"}}return tS(r,"name",CA),r}),{isClass:!0,isNode:!0}),kA="ConstantNode",MA=BD(kA,["Node"],(e=>{var{Node:t}=e;class r extends t{constructor(e){super(),this.value=e}get type(){return kA}get isConstantNode(){return!0}_compile(e,t){var r=this.value;return function(){return r}}forEach(e){}map(e){return this.clone()}clone(){return new r(this.value)}_toString(e){return NS(this.value,e)}toHTML(e){var t=this._toString(e);switch(FD(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+t+"</span>";case"string":return'<span class="math-string">'+t+"</span>";case"boolean":return'<span class="math-boolean">'+t+"</span>";case"null":return'<span class="math-null-symbol">'+t+"</span>";case"undefined":return'<span class="math-undefined">'+t+"</span>";default:return'<span class="math-symbol">'+t+"</span>"}}toJSON(){return{mathjs:kA,value:this.value}}static fromJSON(e){return new r(e.value)}_toTex(e){var t=this._toString(e);switch(FD(this.value)){case"string":return"\\mathtt{"+mA(t)+"}";case"number":case"BigNumber":if(!isFinite(this.value))return this.value.valueOf()<0?"-\\infty":"\\infty";var r=t.toLowerCase().indexOf("e");return-1!==r?t.substring(0,r)+"\\cdot10^{"+t.substring(r+1)+"}":t;case"Fraction":return this.value.toLatex();default:return t}}}return tS(r,"name",kA),r}),{isClass:!0,isNode:!0}),OA="RangeNode",FA=BD(OA,["Node"],(e=>{var{Node:t}=e;function r(e,t,r){var n=oA(e,t,r),i={},s=oA(e.start,t,r);if(i.start=null!==s&&s<=n||"all"===t,e.step){var a=oA(e.step,t,r);i.step=null!==a&&a<=n||"all"===t}var o=oA(e.end,t,r);return i.end=null!==o&&o<=n||"all"===t,i}class n extends t{constructor(e,t,r){if(super(),!SD(e))throw new TypeError("Node expected");if(!SD(t))throw new TypeError("Node expected");if(r&&!SD(r))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=e,this.end=t,this.step=r||null}get type(){return OA}get isRangeNode(){return!0}needsEnd(){return this.filter((function(e){return MD(e)&&"end"===e.name})).length>0}_compile(e,t){var r=e.range,n=this.start._compile(e,t),i=this.end._compile(e,t);if(this.step){var s=this.step._compile(e,t);return function(e,t,a){return r(n(e,t,a),i(e,t,a),s(e,t,a))}}return function(e,t,s){return r(n(e,t,s),i(e,t,s))}}forEach(e){e(this.start,"start",this),e(this.end,"end",this),this.step&&e(this.step,"step",this)}map(e){return new n(this._ifNode(e(this.start,"start",this)),this._ifNode(e(this.end,"end",this)),this.step&&this._ifNode(e(this.step,"step",this)))}clone(){return new n(this.start,this.end,this.step&&this.step)}_toString(e){var t,n=r(this,e&&e.parenthesis?e.parenthesis:"keep",e&&e.implicit),i=this.start.toString(e);if(n.start&&(i="("+i+")"),t=i,this.step){var s=this.step.toString(e);n.step&&(s="("+s+")"),t+=":"+s}var a=this.end.toString(e);return n.end&&(a="("+a+")"),t+=":"+a}toJSON(){return{mathjs:OA,start:this.start,end:this.end,step:this.step}}static fromJSON(e){return new n(e.start,e.end,e.step)}toHTML(e){var t,n=r(this,e&&e.parenthesis?e.parenthesis:"keep",e&&e.implicit),i=this.start.toHTML(e);if(n.start&&(i='<span class="math-parenthesis math-round-parenthesis">(</span>'+i+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t=i,this.step){var s=this.step.toHTML(e);n.step&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+='<span class="math-operator math-range-operator">:</span>'+s}var a=this.end.toHTML(e);return n.end&&(a='<span class="math-parenthesis math-round-parenthesis">(</span>'+a+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+='<span class="math-operator math-range-operator">:</span>'+a}_toTex(e){var t=r(this,e&&e.parenthesis?e.parenthesis:"keep",e&&e.implicit),n=this.start.toTex(e);if(t.start&&(n="\\left(".concat(n,"\\right)")),this.step){var i=this.step.toTex(e);t.step&&(i="\\left(".concat(i,"\\right)")),n+=":"+i}var s=this.end.toTex(e);return t.end&&(s="\\left(".concat(s,"\\right)")),n+=":"+s}}return tS(n,"name",OA),n}),{isClass:!0,isNode:!0}),LA=BD("reviver",["classes"],(e=>{var{classes:t}=e;return function(e,r){var n=t[r&&r.mathjs];return n&&"function"==typeof n.fromJSON?n.fromJSON(r):r}})),_A=BD("Chain",["?on","math","typed"],(e=>{var{on:t,math:r,typed:n}=e;function i(e){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");OD(e)?this.value=e.value:this.value=e}function s(e,t){var r,n,s,o,l;r=i.prototype,n=e,s=function(){var e=t();if("function"==typeof e)return a(e)},l=!0,Object.defineProperty(r,n,{get:function(){return l&&(o=s(),l=!1),o},set:function(e){o=e,l=!1},configurable:!0,enumerable:!0})}function a(e){return function(){if(0===arguments.length)return new i(e(this.value));for(var t=[this.value],r=0;r<arguments.length;r++)t[r+1]=arguments[r];if(n.isTypedFunction(e)){var s=n.resolve(e,t);if(1===s.params.length)throw new Error("chain function "+e.name+" cannot match rest parameter between chain value and additional arguments.");return new i(s.implementation.apply(e,t))}return new i(e.apply(e,t))}}i.prototype.type="Chain",i.prototype.isChain=!0,i.prototype.done=function(){return this.value},i.prototype.valueOf=function(){return this.value},i.prototype.toString=function(){return NS(this.value)},i.prototype.toJSON=function(){return{mathjs:"Chain",value:this.value}},i.fromJSON=function(e){return new i(e.value)},i.createProxy=function(e,t){if("string"==typeof e)l=e,"function"==typeof(u=t)&&(i.prototype[l]=a(u));else{var r=function(t){PD(e,t)&&void 0===o[t]&&s(t,(()=>e[t]))};for(var n in e)r(n)}var l,u};var o={expression:!0,docs:!0,type:!0,classes:!0,json:!0,error:!0,isChain:!0};return i.createProxy(r),t&&t("import",(function(e,t,r){r||s(e,t)})),i}),{isClass:!0}),RA="FunctionAssignmentNode",IA=BD(RA,["typed","Node"],(e=>{var{typed:t,Node:r}=e;function n(e,t,r){var n=oA(e,t,r),i=oA(e.expr,t,r);return"all"===t||null!==i&&i<=n}class i extends r{constructor(e,t,r){if(super(),"string"!=typeof e)throw new TypeError('String expected for parameter "name"');if(!Array.isArray(t))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!SD(r))throw new TypeError('Node expected for parameter "expr"');if(LD.has(e))throw new Error('Illegal function name, "'+e+'" is a reserved keyword');var n=new Set;for(var i of t){var s="string"==typeof i?i:i.name;if(n.has(s))throw new Error('Duplicate parameter name "'.concat(s,'"'));n.add(s)}this.name=e,this.params=t.map((function(e){return e&&e.name||e})),this.types=t.map((function(e){return e&&e.type||"any"})),this.expr=r}get type(){return RA}get isFunctionAssignmentNode(){return!0}_compile(e,r){var n=Object.create(r);XS(this.params,(function(e){n[e]=!0}));var i=this.expr._compile(e,n),s=this.name,a=this.params,o=tA(this.types,","),l=s+"("+tA(this.params,", ")+")";return function(e,r,n){var u={};u[o]=function(){for(var t=Object.create(r),s=0;s<a.length;s++)t[a[s]]=arguments[s];return i(e,t,n)};var c=t(s,u);return c.syntax=l,e.set(s,c),c}}forEach(e){e(this.expr,"expr",this)}map(e){var t=this._ifNode(e(this.expr,"expr",this));return new i(this.name,this.params.slice(0),t)}clone(){return new i(this.name,this.params.slice(0),this.expr)}_toString(e){var t=e&&e.parenthesis?e.parenthesis:"keep",r=this.expr.toString(e);return n(this,t,e&&e.implicit)&&(r="("+r+")"),this.name+"("+this.params.join(", ")+") = "+r}toJSON(){var e=this.types;return{mathjs:RA,name:this.name,params:this.params.map((function(t,r){return{name:t,type:e[r]}})),expr:this.expr}}static fromJSON(e){return new i(e.name,e.params,e.expr)}toHTML(e){for(var t=e&&e.parenthesis?e.parenthesis:"keep",r=[],i=0;i<this.params.length;i++)r.push('<span class="math-symbol math-parameter">'+MS(this.params[i])+"</span>");var s=this.expr.toHTML(e);return n(this,t,e&&e.implicit)&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+MS(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+r.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+s}_toTex(e){var t=e&&e.parenthesis?e.parenthesis:"keep",r=this.expr.toTex(e);return n(this,t,e&&e.implicit)&&(r="\\left(".concat(r,"\\right)")),"\\mathrm{"+this.name+"}\\left("+this.params.map(gA).join(",")+"\\right):="+r}}return tS(i,"name",RA),i}),{isClass:!0,isNode:!0}),PA="chain",BA=BD(PA,["typed","Chain"],(e=>{var{typed:t,Chain:r}=e;return t(PA,{"":function(){return new r},any:function(e){return new r(e)}})}));function UA(e){return e&&e.isIndexError?new IS(e.index+1,e.min+1,void 0!==e.max?e.max+1:void 0):e}function $A(e){var{subset:t}=e;return function(e,r){try{if(Array.isArray(e))return t(e,r);if(e&&"function"==typeof e.subset)return e.subset(r);if("string"==typeof e)return t(e,r);if("object"==typeof e){if(!r.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return $D(e,r.getObjectProperty())}throw new TypeError("Cannot apply index: unsupported type of object")}catch(e){throw UA(e)}}}var zA="AccessorNode",jA=BD(zA,["subset","Node"],(e=>{var{subset:t,Node:r}=e,n=$A({subset:t});function i(e){return!(pD(e)||mD(e)||bD(e)||ED(e)||AD(e)||CD(e)||MD(e))}class s extends r{constructor(e,t){if(super(),!SD(e))throw new TypeError('Node expected for parameter "object"');if(!DD(t))throw new TypeError('IndexNode expected for parameter "index"');this.object=e,this.index=t}get name(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}get type(){return zA}get isAccessorNode(){return!0}_compile(e,t){var r=this.object._compile(e,t),i=this.index._compile(e,t);if(this.index.isObjectProperty()){var s=this.index.getObjectProperty();return function(e,t,n){return $D(r(e,t,n),s)}}return function(e,t,s){var a=r(e,t,s),o=i(e,t,a);return n(a,o)}}forEach(e){e(this.object,"object",this),e(this.index,"index",this)}map(e){return new s(this._ifNode(e(this.object,"object",this)),this._ifNode(e(this.index,"index",this)))}clone(){return new s(this.object,this.index)}_toString(e){var t=this.object.toString(e);return i(this.object)&&(t="("+t+")"),t+this.index.toString(e)}toHTML(e){var t=this.object.toHTML(e);return i(this.object)&&(t='<span class="math-parenthesis math-round-parenthesis">(</span>'+t+'<span class="math-parenthesis math-round-parenthesis">)</span>'),t+this.index.toHTML(e)}_toTex(e){var t=this.object.toTex(e);return i(this.object)&&(t="\\left(' + object + '\\right)"),t+this.index.toTex(e)}toJSON(){return{mathjs:zA,object:this.object,index:this.index}}static fromJSON(e){return new s(e.object,e.index)}}return tS(s,"name",zA),s}),{isClass:!0,isNode:!0}),qA="IndexNode",HA=BD(qA,["Node","size"],(e=>{var{Node:t,size:r}=e;class n extends t{constructor(e,t){if(super(),this.dimensions=e,this.dotNotation=t||!1,!Array.isArray(e)||!e.every(SD))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties")}get type(){return qA}get isIndexNode(){return!0}_compile(e,t){var n=ZS(this.dimensions,(function(n,i){if(n.filter((e=>e.isSymbolNode&&"end"===e.name)).length>0){var s=Object.create(t);s.end=!0;var a=n._compile(e,s);return function(e,t,n){if(!QE(n)&&!XE(n)&&!ZE(n))throw new TypeError('Cannot resolve "end": context must be a Matrix, Array, or string but is '+FD(n));var s=r(n).valueOf(),o=Object.create(t);return o.end=s[i],a(e,o,n)}}return n._compile(e,t)})),i=$D(e,"index");return function(e,t,r){var s=ZS(n,(function(n){return n(e,t,r)}));return i(...s)}}forEach(e){for(var t=0;t<this.dimensions.length;t++)e(this.dimensions[t],"dimensions["+t+"]",this)}map(e){for(var t=[],r=0;r<this.dimensions.length;r++)t[r]=this._ifNode(e(this.dimensions[r],"dimensions["+r+"]",this));return new n(t,this.dotNotation)}clone(){return new n(this.dimensions.slice(0),this.dotNotation)}isObjectProperty(){return 1===this.dimensions.length&&bD(this.dimensions[0])&&"string"==typeof this.dimensions[0].value}getObjectProperty(){return this.isObjectProperty()?this.dimensions[0].value:null}_toString(e){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"}toJSON(){return{mathjs:qA,dimensions:this.dimensions,dotNotation:this.dotNotation}}static fromJSON(e){return new n(e.dimensions,e.dotNotation)}toHTML(e){for(var t=[],r=0;r<this.dimensions.length;r++)t[r]=this.dimensions[r].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+MS(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'}_toTex(e){var t=this.dimensions.map((function(t){return t.toTex(e)}));return this.dotNotation?"."+this.getObjectProperty():"_{"+t.join(",")+"}"}}return tS(n,"name",qA),n}),{isClass:!0,isNode:!0});var VA="AssignmentNode",GA=BD(VA,["subset","?matrix","Node"],(e=>{var{subset:t,matrix:r,Node:n}=e,i=$A({subset:t}),s=function(e){var{subset:t,matrix:r}=e;return function(e,n,i){try{if(Array.isArray(e))return r(e).subset(n,i).valueOf();if(e&&"function"==typeof e.subset)return e.subset(n,i);if("string"==typeof e)return t(e,n,i);if("object"==typeof e){if(!n.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return zD(e,n.getObjectProperty(),i),e}throw new TypeError("Cannot apply index: unsupported type of object")}catch(e){throw UA(e)}}}({subset:t,matrix:r});function a(e,t,r){t||(t="keep");var n=oA(e,t,r),i=oA(e.value,t,r);return"all"===t||null!==i&&i<=n}class o extends n{constructor(e,t,r){if(super(),this.object=e,this.index=r?t:null,this.value=r||t,!MD(e)&&!pD(e))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(MD(e)&&"end"===e.name)throw new Error('Cannot assign to symbol "end"');if(this.index&&!DD(this.index))throw new TypeError('IndexNode expected as "index"');if(!SD(this.value))throw new TypeError('Node expected as "value"')}get name(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}get type(){return VA}get isAssignmentNode(){return!0}_compile(e,t){var r=this.object._compile(e,t),n=this.index?this.index._compile(e,t):null,a=this.value._compile(e,t),o=this.object.name;if(this.index){if(this.index.isObjectProperty()){var l=this.index.getObjectProperty();return function(e,t,n){var i=r(e,t,n),s=a(e,t,n);return zD(i,l,s),s}}if(MD(this.object))return function(e,t,i){var l=r(e,t,i),u=a(e,t,i),c=n(e,t,l);return e.set(o,s(l,c,u)),u};var u=this.object.object._compile(e,t);if(this.object.index.isObjectProperty()){var c=this.object.index.getObjectProperty();return function(e,t,r){var i=u(e,t,r),o=$D(i,c),l=n(e,t,o),d=a(e,t,r);return zD(i,c,s(o,l,d)),d}}var d=this.object.index._compile(e,t);return function(e,t,r){var o=u(e,t,r),l=d(e,t,o),c=i(o,l),h=n(e,t,c),f=a(e,t,r);return s(o,l,s(c,h,f)),f}}if(!MD(this.object))throw new TypeError("SymbolNode expected as object");return function(e,t,r){var n=a(e,t,r);return e.set(o,n),n}}forEach(e){e(this.object,"object",this),this.index&&e(this.index,"index",this),e(this.value,"value",this)}map(e){var t=this._ifNode(e(this.object,"object",this)),r=this.index?this._ifNode(e(this.index,"index",this)):null,n=this._ifNode(e(this.value,"value",this));return new o(t,r,n)}clone(){return new o(this.object,this.index,this.value)}_toString(e){var t=this.object.toString(e),r=this.index?this.index.toString(e):"",n=this.value.toString(e);return a(this,e&&e.parenthesis,e&&e.implicit)&&(n="("+n+")"),t+r+" = "+n}toJSON(){return{mathjs:VA,object:this.object,index:this.index,value:this.value}}static fromJSON(e){return new o(e.object,e.index,e.value)}toHTML(e){var t=this.object.toHTML(e),r=this.index?this.index.toHTML(e):"",n=this.value.toHTML(e);return a(this,e&&e.parenthesis,e&&e.implicit)&&(n='<span class="math-paranthesis math-round-parenthesis">(</span>'+n+'<span class="math-paranthesis math-round-parenthesis">)</span>'),t+r+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+n}_toTex(e){var t=this.object.toTex(e),r=this.index?this.index.toTex(e):"",n=this.value.toTex(e);return a(this,e&&e.parenthesis,e&&e.implicit)&&(n="\\left(".concat(n,"\\right)")),t+r+":="+n}}return tS(o,"name",VA),o}),{isClass:!0,isNode:!0}),KA=BD("SymbolNode",["math","?Unit","Node"],(e=>{var{math:t,Unit:r,Node:n}=e;function i(e){return!!r&&r.isValuelessUnit(e)}class s extends n{constructor(e){if(super(),"string"!=typeof e)throw new TypeError('String expected for parameter "name"');this.name=e}get type(){return"SymbolNode"}get isSymbolNode(){return!0}_compile(e,t){var n=this.name;if(!0===t[n])return function(e,t,r){return $D(t,n)};if(n in e)return function(t,r,i){return t.has(n)?t.get(n):$D(e,n)};var a=i(n);return function(e,t,i){return e.has(n)?e.get(n):a?new r(null,n):s.onUndefinedSymbol(n)}}forEach(e){}map(e){return this.clone()}static onUndefinedSymbol(e){throw new Error("Undefined symbol "+e)}clone(){return new s(this.name)}_toString(e){return this.name}toHTML(e){var t=MS(this.name);return"true"===t||"false"===t?'<span class="math-symbol math-boolean">'+t+"</span>":"i"===t?'<span class="math-symbol math-imaginary-symbol">'+t+"</span>":"Infinity"===t?'<span class="math-symbol math-infinity-symbol">'+t+"</span>":"NaN"===t?'<span class="math-symbol math-nan-symbol">'+t+"</span>":"null"===t?'<span class="math-symbol math-null-symbol">'+t+"</span>":"undefined"===t?'<span class="math-symbol math-undefined-symbol">'+t+"</span>":'<span class="math-symbol">'+t+"</span>"}toJSON(){return{mathjs:"SymbolNode",name:this.name}}static fromJSON(e){return new s(e.name)}_toTex(e){var r=!1;void 0===t[this.name]&&i(this.name)&&(r=!0);var n=gA(this.name,r);return"\\"===n[0]?n:" "+n}}return s}),{isClass:!0,isNode:!0});function WA(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return"function"==typeof e.createSubScope?ZD(e.createSubScope(),...r):ZD(WD(),e,...r)}var YA="FunctionNode",JA=BD(YA,["math","Node","SymbolNode"],(e=>{var{math:t,Node:r,SymbolNode:n}=e,i=e=>NS(e,{truncate:78});function s(e,t,r){for(var n,i="",s=/\$(?:\{([a-z_][a-z_0-9]*)(?:\[([0-9]+)\])?\}|\$)/gi,a=0;null!==(n=s.exec(e));)if(i+=e.substring(a,n.index),a=n.index,"$$"===n[0])i+="$",a++;else{a+=n[0].length;var o=t[n[1]];if(!o)throw new ReferenceError("Template: Property "+n[1]+" does not exist.");if(void 0===n[2])switch(typeof o){case"string":i+=o;break;case"object":if(SD(o))i+=o.toTex(r);else{if(!Array.isArray(o))throw new TypeError("Template: "+n[1]+" has to be a Node, String or array of Nodes");i+=o.map((function(e,t){if(SD(e))return e.toTex(r);throw new TypeError("Template: "+n[1]+"["+t+"] is not a Node.")})).join(",")}break;default:throw new TypeError("Template: "+n[1]+" has to be a Node, String or array of Nodes")}else{if(!SD(o[n[2]]&&o[n[2]]))throw new TypeError("Template: "+n[1]+"["+n[2]+"] is not a Node.");i+=o[n[2]].toTex(r)}}return i+=e.slice(a)}class a extends r{constructor(e,t){if(super(),"string"==typeof e&&(e=new n(e)),!SD(e))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(t)||!t.every(SD))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=e,this.args=t||[]}get name(){return this.fn.name||""}get type(){return YA}get isFunctionNode(){return!0}_compile(e,t){var r=this.args.map((r=>r._compile(e,t)));if(!MD(this.fn)){if(pD(this.fn)&&DD(this.fn.index)&&this.fn.index.isObjectProperty()){var n=this.fn.object._compile(e,t),s=this.fn.index.getObjectProperty(),o=this.args;return function(t,i,a){var l=n(t,i,a),u=function(e,t){if(!qD(e,t))throw new Error('No access to method "'+t+'"');return e[t]}(l,s);if(null!=u&&u.rawArgs)return u(o,e,WA(t,i),t);var c=r.map((e=>e(t,i,a)));return u.apply(l,c)}}var l=this.fn.toString(),u=this.fn._compile(e,t),c=this.args;return function(t,n,s){var a=u(t,n,s);if("function"!=typeof a)throw new TypeError("Expression '".concat(l,"' did not evaluate to a function; value is:")+"\n  ".concat(i(a)));if(a.rawArgs)return a(c,e,WA(t,n),t);var o=r.map((e=>e(t,n,s)));return a.apply(a,o)}}var d=this.fn.name;if(t[d]){var h=this.args;return function(t,n,s){var a=$D(n,d);if("function"!=typeof a)throw new TypeError("Argument '".concat(d,"' was not a function; received: ").concat(i(a)));if(a.rawArgs)return a(h,e,WA(t,n),t);var o=r.map((e=>e(t,n,s)));return a.apply(a,o)}}var f=d in e?$D(e,d):void 0,p="function"==typeof f&&!0===f.rawArgs,m=t=>{var r;if(t.has(d))r=t.get(d);else{if(!(d in e))return a.onUndefinedFunction(d);r=$D(e,d)}if("function"==typeof r)return r;throw new TypeError("'".concat(d,"' is not a function; its value is:\n  ").concat(i(r)))};if(p){var g=this.args;return function(t,r,n){return m(t)(g,e,WA(t,r),t)}}switch(r.length){case 0:return function(e,t,r){return m(e)()};case 1:return function(e,t,n){return m(e)((0,r[0])(e,t,n))};case 2:return function(e,t,n){var i=m(e),s=r[0],a=r[1];return i(s(e,t,n),a(e,t,n))};default:return function(e,t,n){return m(e)(...r.map((r=>r(e,t,n))))}}}forEach(e){e(this.fn,"fn",this);for(var t=0;t<this.args.length;t++)e(this.args[t],"args["+t+"]",this)}map(e){for(var t=this._ifNode(e(this.fn,"fn",this)),r=[],n=0;n<this.args.length;n++)r[n]=this._ifNode(e(this.args[n],"args["+n+"]",this));return new a(t,r)}clone(){return new a(this.fn,this.args.slice(0))}toString(e){var t,r=this.fn.toString(e);return e&&"object"==typeof e.handler&&PD(e.handler,r)&&(t=e.handler[r](this,e)),void 0!==t?t:super.toString(e)}_toString(e){var t=this.args.map((function(t){return t.toString(e)}));return(xD(this.fn)?"("+this.fn.toString(e)+")":this.fn.toString(e))+"("+t.join(", ")+")"}toJSON(){return{mathjs:YA,fn:this.fn,args:this.args}}toHTML(e){var t=this.args.map((function(t){return t.toHTML(e)}));return'<span class="math-function">'+MS(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+t.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'}toTex(e){var t;return e&&"object"==typeof e.handler&&PD(e.handler,this.name)&&(t=e.handler[this.name](this,e)),void 0!==t?t:super.toTex(e)}_toTex(e){var r,n,i=this.args.map((function(t){return t.toTex(e)}));switch(fA[this.name]&&(r=fA[this.name]),!t[this.name]||"function"!=typeof t[this.name].toTex&&"object"!=typeof t[this.name].toTex&&"string"!=typeof t[this.name].toTex||(r=t[this.name].toTex),typeof r){case"function":n=r(this,e);break;case"string":n=s(r,this,e);break;case"object":switch(typeof r[i.length]){case"function":n=r[i.length](this,e);break;case"string":n=s(r[i.length],this,e)}}return void 0!==n?n:s("\\mathrm{${name}}\\left(${args}\\right)",this,e)}getIdentifier(){return this.type+":"+this.name}}return tS(a,"name",YA),tS(a,"onUndefinedFunction",(function(e){throw new Error("Undefined function "+e)})),tS(a,"fromJSON",(function(e){return new a(e.fn,e.args)})),a}),{isClass:!0,isNode:!0});function ZA(e){var t,r,n=e.length,i=e[0].length,s=[];for(r=0;r<i;r++){var a=[];for(t=0;t<n;t++)a.push(e[t][r]);s.push(a)}return s}function XA(e){for(var t=0;t<e.length;t++)if(eD(e[t]))return!0;return!1}function QA(e,t){QE(e)&&(e=e.valueOf());for(var r=0,n=e.length;r<n;r++){var i=e[r];Array.isArray(i)?QA(i,t):t(i)}}function eT(e,t,r){return e&&"function"==typeof e.map?e.map((function(e){return eT(e,t,r)})):t(e)}function tT(e,t,r){var n=Array.isArray(e)?PS(e):e.size();if(t<0||t>=n.length)throw new IS(t,n.length);return QE(e)?e.create(rT(e.valueOf(),t,r)):rT(e,t,r)}function rT(e,t,r){var n,i,s,a;if(t<=0){if(Array.isArray(e[0])){for(a=ZA(e),i=[],n=0;n<a.length;n++)i[n]=rT(a[n],t-1,r);return i}for(s=e[0],n=1;n<e.length;n++)s=r(s,e[n]);return s}for(i=[],n=0;n<e.length;n++)i[n]=rT(e[n],t-1,r);return i}function nT(e,t,r,n,i,s,a,o,l,u,c){var d,h,f,p,m=e._values,g=e._index,y=e._ptr;if(n)for(h=y[t],f=y[t+1],d=h;d<f;d++)r[p=g[d]]!==s?(r[p]=s,a.push(p),u?(n[p]=l?o(m[d],c):o(c,m[d]),i[p]=s):n[p]=m[d]):(n[p]=l?o(m[d],n[p]):o(n[p],m[d]),i[p]=s);else for(h=y[t],f=y[t+1],d=h;d<f;d++)r[p=g[d]]!==s?(r[p]=s,a.push(p)):i[p]=s}var iT="parse",sT=BD(iT,["typed","numeric","config","AccessorNode","ArrayNode","AssignmentNode","BlockNode","ConditionalNode","ConstantNode","FunctionAssignmentNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","RangeNode","RelationalNode","SymbolNode"],(e=>{var{typed:t,numeric:r,config:n,AccessorNode:i,ArrayNode:s,AssignmentNode:a,BlockNode:o,ConditionalNode:l,ConstantNode:u,FunctionAssignmentNode:c,FunctionNode:d,IndexNode:h,ObjectNode:f,OperatorNode:p,ParenthesisNode:m,RangeNode:g,RelationalNode:y,SymbolNode:v}=e,b=t(iT,{string:function(e){return R(e,{})},"Array | Matrix":function(e){return w(e,{})},"string, Object":function(e,t){return R(e,void 0!==t.nodes?t.nodes:{})},"Array | Matrix, Object":w});function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=void 0!==t.nodes?t.nodes:{};return eT(e,(function(e){if("string"!=typeof e)throw new TypeError("String expected");return R(e,r)}))}var x={NULL:0,DELIMITER:1,NUMBER:2,SYMBOL:3,UNKNOWN:4},E={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,"'":!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},D={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},S={true:!0,false:!1,null:null,undefined:void 0},A=["NaN","Infinity"];function T(e,t){return e.expression.substr(e.index,t)}function C(e){return T(e,1)}function N(e){e.index++}function k(e){return e.expression.charAt(e.index-1)}function M(e){return e.expression.charAt(e.index+1)}function O(e){for(e.tokenType=x.NULL,e.token="",e.comment="";;){if("#"===C(e))for(;"\n"!==C(e)&&""!==C(e);)e.comment+=C(e),N(e);if(!b.isWhitespace(C(e),e.nestingLevel))break;N(e)}if(""!==C(e)){if("\n"===C(e)&&!e.nestingLevel)return e.tokenType=x.DELIMITER,e.token=C(e),void N(e);var t=C(e),r=T(e,2),n=T(e,3);if(3===n.length&&E[n])return e.tokenType=x.DELIMITER,e.token=n,N(e),N(e),void N(e);if(2===r.length&&E[r])return e.tokenType=x.DELIMITER,e.token=r,N(e),void N(e);if(E[t])return e.tokenType=x.DELIMITER,e.token=t,void N(e);if(b.isDigitDot(t)){e.tokenType=x.NUMBER;var i=T(e,2);if("0b"===i||"0o"===i||"0x"===i){for(e.token+=C(e),N(e),e.token+=C(e),N(e);b.isHexDigit(C(e));)e.token+=C(e),N(e);if("."===C(e))for(e.token+=".",N(e);b.isHexDigit(C(e));)e.token+=C(e),N(e);else if("i"===C(e))for(e.token+="i",N(e);b.isDigit(C(e));)e.token+=C(e),N(e);return}if("."===C(e)){if(e.token+=C(e),N(e),!b.isDigit(C(e)))return void(e.tokenType=x.DELIMITER)}else{for(;b.isDigit(C(e));)e.token+=C(e),N(e);b.isDecimalMark(C(e),M(e))&&(e.token+=C(e),N(e))}for(;b.isDigit(C(e));)e.token+=C(e),N(e);if("E"===C(e)||"e"===C(e))if(b.isDigit(M(e))||"-"===M(e)||"+"===M(e)){if(e.token+=C(e),N(e),"+"!==C(e)&&"-"!==C(e)||(e.token+=C(e),N(e)),!b.isDigit(C(e)))throw ne(e,'Digit expected, got "'+C(e)+'"');for(;b.isDigit(C(e));)e.token+=C(e),N(e);if(b.isDecimalMark(C(e),M(e)))throw ne(e,'Digit expected, got "'+C(e)+'"')}else if("."===M(e))throw N(e),ne(e,'Digit expected, got "'+C(e)+'"')}else{if(!b.isAlpha(C(e),k(e),M(e))){for(e.tokenType=x.UNKNOWN;""!==C(e);)e.token+=C(e),N(e);throw ne(e,'Syntax error in part "'+e.token+'"')}for(;b.isAlpha(C(e),k(e),M(e))||b.isDigit(C(e));)e.token+=C(e),N(e);PD(D,e.token)?e.tokenType=x.DELIMITER:e.tokenType=x.SYMBOL}}else e.tokenType=x.DELIMITER}function F(e){do{O(e)}while("\n"===e.token)}function L(e){e.nestingLevel++}function _(e){e.nestingLevel--}function R(e,t){var r={extraNodes:{},expression:"",comment:"",index:0,token:"",tokenType:x.NULL,nestingLevel:0,conditionalLevel:null};zE(r,{expression:e,extraNodes:t}),O(r);var n=function(e){var t,r,n=[];""!==e.token&&"\n"!==e.token&&";"!==e.token&&(t=I(e),e.comment&&(t.comment=e.comment));for(;"\n"===e.token||";"===e.token;)0===n.length&&t&&(r=";"!==e.token,n.push({node:t,visible:r})),O(e),"\n"!==e.token&&";"!==e.token&&""!==e.token&&(t=I(e),e.comment&&(t.comment=e.comment),r=";"!==e.token,n.push({node:t,visible:r}));return n.length>0?new o(n):(t||(t=new u(void 0),e.comment&&(t.comment=e.comment)),t)}(r);if(""!==r.token)throw r.tokenType===x.DELIMITER?ie(r,"Unexpected operator "+r.token):ne(r,'Unexpected part "'+r.token+'"');return n}function I(e){var t,r,n,i,s=function(e){var t=function(e){var t=P(e);for(;"or"===e.token;)F(e),t=new p("or","or",[t,P(e)]);return t}(e);for(;"?"===e.token;){var r=e.conditionalLevel;e.conditionalLevel=e.nestingLevel,F(e);var n=t,i=I(e);if(":"!==e.token)throw ne(e,"False part of conditional expression expected");e.conditionalLevel=null,F(e);var s=I(e);t=new l(n,i,s),e.conditionalLevel=r}return t}(e);if("="===e.token){if(MD(s))return t=s.name,F(e),n=I(e),new a(new v(t),n);if(pD(s))return F(e),n=I(e),new a(s.object,s.index,n);if(ED(s)&&MD(s.fn)&&(i=!0,r=[],t=s.name,s.args.forEach((function(e,t){MD(e)?r[t]=e.name:i=!1})),i))return F(e),n=I(e),new c(t,r,n);throw ne(e,"Invalid left hand side of assignment operator =")}return s}function P(e){for(var t=B(e);"xor"===e.token;)F(e),t=new p("xor","xor",[t,B(e)]);return t}function B(e){for(var t=U(e);"and"===e.token;)F(e),t=new p("and","and",[t,U(e)]);return t}function U(e){for(var t=$(e);"|"===e.token;)F(e),t=new p("|","bitOr",[t,$(e)]);return t}function $(e){for(var t=z(e);"^|"===e.token;)F(e),t=new p("^|","bitXor",[t,z(e)]);return t}function z(e){for(var t=j(e);"&"===e.token;)F(e),t=new p("&","bitAnd",[t,j(e)]);return t}function j(e){for(var t=[q(e)],r=[],n={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};PD(n,e.token);){var i={name:e.token,fn:n[e.token]};r.push(i),F(e),t.push(q(e))}return 1===t.length?t[0]:2===t.length?new p(r[0].name,r[0].fn,t):new y(r.map((e=>e.fn)),t)}function q(e){var t,r,n,i;t=H(e);for(var s={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};PD(s,e.token);)n=s[r=e.token],F(e),i=[t,H(e)],t=new p(r,n,i);return t}function H(e){var t,r,n,i;t=V(e);for(var s={to:"to",in:"to"};PD(s,e.token);)n=s[r=e.token],F(e),"in"===r&&""===e.token?t=new p("*","multiply",[t,new v("in")],!0):(i=[t,V(e)],t=new p(r,n,i));return t}function V(e){var t,r=[];if(t=":"===e.token?new u(1):G(e),":"===e.token&&e.conditionalLevel!==e.nestingLevel){for(r.push(t);":"===e.token&&r.length<3;)F(e),")"===e.token||"]"===e.token||","===e.token||""===e.token?r.push(new v("end")):r.push(G(e));t=3===r.length?new g(r[0],r[2],r[1]):new g(r[0],r[1])}return t}function G(e){var t,r,n,i;t=K(e);for(var s={"+":"add","-":"subtract"};PD(s,e.token);){n=s[r=e.token],F(e);var a=K(e);i=a.isPercentage?[t,new p("*","multiply",[t,a])]:[t,a],t=new p(r,n,i)}return t}function K(e){var t,r,n,i;r=t=W(e);for(var s={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide"};PD(s,e.token);)i=s[n=e.token],F(e),r=W(e),t=new p(n,i,[t,r]);return t}function W(e){var t,r;for(r=t=Y(e);e.tokenType===x.SYMBOL||"in"===e.token&&bD(t)||!(e.tokenType!==x.NUMBER||bD(r)||TD(r)&&"!"!==r.op)||"("===e.token;)r=Y(e),t=new p("*","multiply",[t,r],!0);return t}function Y(e){for(var t=J(e),r=t,n=[];"/"===e.token&&wD(r);){if(n.push(zE({},e)),F(e),e.tokenType!==x.NUMBER){zE(e,n.pop());break}if(n.push(zE({},e)),F(e),e.tokenType!==x.SYMBOL&&"("!==e.token){n.pop(),zE(e,n.pop());break}zE(e,n.pop()),n.pop(),r=J(e),t=new p("/","divide",[t,r])}return t}function J(e){var t,r,n,i;t=Z(e);for(var s={"%":"mod",mod:"mod"};PD(s,e.token);)n=s[r=e.token],F(e),"%"===r&&e.tokenType===x.DELIMITER&&"("!==e.token?t=new p("/","divide",[t,new u(100)],!1,!0):(i=[t,Z(e)],t=new p(r,n,i));return t}function Z(e){var t,i,a,o={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return PD(o,e.token)?(a=o[e.token],t=e.token,F(e),i=[Z(e)],new p(t,a,i)):function(e){var t,i,a,o;t=function(e){var t,i,a;t=function(e){var t=[];if(e.tokenType===x.SYMBOL&&PD(e.extraNodes,e.token)){var i=e.extraNodes[e.token];if(O(e),"("===e.token){if(t=[],L(e),O(e),")"!==e.token)for(t.push(I(e));","===e.token;)O(e),t.push(I(e));if(")"!==e.token)throw ne(e,"Parenthesis ) expected");_(e),O(e)}return new i(t)}return function(e){var t;if(e.tokenType===x.SYMBOL||e.tokenType===x.DELIMITER&&e.token in D)return t=e.token,O(e),X(e,PD(S,t)?new u(S[t]):-1!==A.indexOf(t)?new u(r(t,"number")):new v(t));return function(e){var t;if('"'===e.token)return t=Q(e),X(e,new u(t));return function(e){var t;if("'"===e.token)return t=ee(e),X(e,new u(t));return function(e){var t,i,a,o;if("["===e.token){if(L(e),O(e),"]"!==e.token){var l=te(e);if(";"===e.token){for(a=1,i=[l];";"===e.token;)O(e),i[a]=te(e),a++;if("]"!==e.token)throw ne(e,"End of matrix ] expected");_(e),O(e),o=i[0].items.length;for(var c=1;c<a;c++)if(i[c].items.length!==o)throw ie(e,"Column dimensions mismatch ("+i[c].items.length+" !== "+o+")");t=new s(i)}else{if("]"!==e.token)throw ne(e,"End of matrix ] expected");_(e),O(e),t=l}}else _(e),O(e),t=new s([]);return X(e,t)}return function(e){if("{"===e.token){var t;L(e);var i={};do{if(O(e),"}"!==e.token){if('"'===e.token)t=Q(e);else if("'"===e.token)t=ee(e);else{if(!(e.tokenType===x.SYMBOL||e.tokenType===x.DELIMITER&&e.token in D))throw ne(e,"Symbol or string expected as object key");t=e.token,O(e)}if(":"!==e.token)throw ne(e,"Colon : expected after object key");O(e),i[t]=I(e)}}while(","===e.token);if("}"!==e.token)throw ne(e,"Comma , or bracket } expected after object value");_(e),O(e);var s=new f(i);return s=X(e,s)}return function(e){var t;if(e.tokenType===x.NUMBER)return t=e.token,O(e),new u(r(t,n.number));return function(e){var t;if("("===e.token){if(L(e),O(e),t=I(e),")"!==e.token)throw ne(e,"Parenthesis ) expected");return _(e),O(e),t=X(e,t=new m(t))}return function(e){throw""===e.token?ne(e,"Unexpected end of expression"):ne(e,"Value expected")}(e)}(e)}(e)}(e)}(e)}(e)}(e)}(e)}(e);var o={"!":"factorial","'":"ctranspose"};for(;PD(o,e.token);)a=o[i=e.token],O(e),t=X(e,t=new p(i,a,[t]));return t}(e),("^"===e.token||".^"===e.token)&&(a="^"===(i=e.token)?"pow":"dotPow",F(e),o=[t,Z(e)],t=new p(i,a,o));return t}(e)}function X(e,t,r){for(var n;!("("!==e.token&&"["!==e.token&&"."!==e.token||r&&-1===r.indexOf(e.token));)if(n=[],"("===e.token){if(!MD(t)&&!pD(t))return t;if(L(e),O(e),")"!==e.token)for(n.push(I(e));","===e.token;)O(e),n.push(I(e));if(")"!==e.token)throw ne(e,"Parenthesis ) expected");_(e),O(e),t=new d(t,n)}else if("["===e.token){if(L(e),O(e),"]"!==e.token)for(n.push(I(e));","===e.token;)O(e),n.push(I(e));if("]"!==e.token)throw ne(e,"Parenthesis ] expected");_(e),O(e),t=new i(t,new h(n))}else{if(O(e),e.tokenType!==x.SYMBOL)throw ne(e,"Property name expected after dot");n.push(new u(e.token)),O(e);t=new i(t,new h(n,!0))}return t}function Q(e){for(var t="";""!==C(e)&&'"'!==C(e);)"\\"===C(e)&&(t+=C(e),N(e)),t+=C(e),N(e);if(O(e),'"'!==e.token)throw ne(e,'End of string " expected');return O(e),JSON.parse('"'+t+'"')}function ee(e){for(var t="";""!==C(e)&&"'"!==C(e);)"\\"===C(e)&&(t+=C(e),N(e)),t+=C(e),N(e);if(O(e),"'"!==e.token)throw ne(e,"End of string ' expected");return O(e),JSON.parse('"'+t+'"')}function te(e){for(var t=[I(e)],r=1;","===e.token;)O(e),t[r]=I(e),r++;return new s(t)}function re(e){return e.index-e.token.length+1}function ne(e,t){var r=re(e),n=new SyntaxError(t+" (char "+r+")");return n.char=r,n}function ie(e,t){var r=re(e),n=new SyntaxError(t+" (char "+r+")");return n.char=r,n}return b.isAlpha=function(e,t,r){return b.isValidLatinOrGreek(e)||b.isValidMathSymbol(e,r)||b.isValidMathSymbol(t,e)},b.isValidLatinOrGreek=function(e){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(e)},b.isValidMathSymbol=function(e,t){return/^[\uD835]$/.test(e)&&/^[\uDC00-\uDFFF]$/.test(t)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(t)},b.isWhitespace=function(e,t){return" "===e||"\t"===e||"\n"===e&&t>0},b.isDecimalMark=function(e,t){return"."===e&&"/"!==t&&"*"!==t&&"^"!==t},b.isDigitDot=function(e){return e>="0"&&e<="9"||"."===e},b.isDigit=function(e){return e>="0"&&e<="9"},b.isHexDigit=function(e){return e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F"},t.addConversion({from:"string",to:"Node",convert:b}),b})),aT=BD("resolve",["typed","parse","ConstantNode","FunctionNode","OperatorNode","ParenthesisNode"],(e=>{var{typed:t,parse:r,ConstantNode:n,FunctionNode:i,OperatorNode:s,ParenthesisNode:a}=e;function o(e,t){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;if(!t)return e;if(MD(e)){if(l.has(e.name)){var u=Array.from(l).join(", ");throw new ReferenceError("recursive loop of variable definitions among {".concat(u,"}"))}var c=t.get(e.name);if(SD(c)){var d=new Set(l);return d.add(e.name),o(c,t,d)}return"number"==typeof c?r(String(c)):void 0!==c?new n(c):e}if(TD(e)){var h=e.args.map((function(e){return o(e,t,l)}));return new s(e.op,e.fn,h,e.implicit)}if(CD(e))return new a(o(e.content,t,l));if(ED(e)){var f=e.args.map((function(e){return o(e,t,l)}));return new i(e.name,f)}return e.map((e=>o(e,t,l)))}return t("resolve",{Node:o,"Node, Map | null | undefined":o,"Node, Object":(e,t)=>o(e,YD(t)),"Array | Matrix":t.referToSelf((e=>t=>t.map((t=>e(t))))),"Array | Matrix, null | undefined":t.referToSelf((e=>t=>t.map((t=>e(t))))),"Array, Object":t.referTo("Array,Map",(e=>(t,r)=>e(t,YD(r)))),"Matrix, Object":t.referTo("Matrix,Map",(e=>(t,r)=>e(t,YD(r)))),"Array | Matrix, Map":t.referToSelf((e=>(t,r)=>t.map((t=>e(t,r)))))})}));function oT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function lT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oT(Object(r),!0).forEach((function(t){tS(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oT(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var uT=BD("simplifyUtil",["FunctionNode","OperatorNode","SymbolNode"],(e=>{var{FunctionNode:t,OperatorNode:r,SymbolNode:n}=e,i=!0,s=!1,a="defaultF",o={add:{trivial:i,total:i,commutative:i,associative:i},unaryPlus:{trivial:i,total:i,commutative:i,associative:i},subtract:{trivial:s,total:i,commutative:s,associative:s},multiply:{trivial:i,total:i,commutative:i,associative:i},divide:{trivial:s,total:i,commutative:s,associative:s},paren:{trivial:i,total:i,commutative:i,associative:s},defaultF:{trivial:s,total:i,commutative:s,associative:s}};function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,n=a;if("string"==typeof e?n=e:TD(e)?n=e.fn.toString():ED(e)?n=e.name:CD(e)&&(n="paren"),PD(r,n)){var i=r[n];if(PD(i,t))return i[t];if(PD(o,n))return o[n][t]}if(PD(r,a)){var s=r[a];return PD(s,t)?s[t]:o[a][t]}if(PD(o,n)){var l=o[n];if(PD(l,t))return l[t]}return o[a][t]}function u(e){return l(e,"associative",arguments.length>1&&void 0!==arguments[1]?arguments[1]:o)}function c(e,t){var r,n=[];return u(e,t)?(r=e.op,function e(t){for(var i=0;i<t.args.length;i++){var s=t.args[i];TD(s)&&r===s.op?e(s):n.push(s)}}(e),n):e.args}function d(e){return TD(e)?function(t){try{return new r(e.op,e.fn,t,e.implicit)}catch(e){return console.error(e),[]}}:function(r){return new t(new n(e.name),r)}}return{createMakeNodeFunction:d,hasProperty:l,isCommutative:function(e){return l(e,"commutative",arguments.length>1&&void 0!==arguments[1]?arguments[1]:o)},isAssociative:u,mergeContext:function(e,t){var r=lT({},e);for(var n in t)PD(e,n)?r[n]=lT(lT({},t[n]),e[n]):r[n]=t[n];return r},flatten:function e(t,r){if(!t.args||0===t.args.length)return t;t.args=c(t,r);for(var n=0;n<t.args.length;n++)e(t.args[n],r)},allChildren:c,unflattenr:function e(t,r){if(t.args&&0!==t.args.length){for(var n=d(t),i=t.args.length,s=0;s<i;s++)e(t.args[s],r);if(i>2&&u(t,r)){for(var a=t.args.pop();t.args.length>0;)a=n([t.args.pop(),a]);t.args=a.args}}},unflattenl:function e(t,r){if(t.args&&0!==t.args.length){for(var n=d(t),i=t.args.length,s=0;s<i;s++)e(t.args[s],r);if(i>2&&u(t,r)){for(var a=t.args.shift();t.args.length>0;)a=n([a,t.args.shift()]);t.args=a.args}}},defaultContext:o,realContext:{divide:{total:s},log:{total:s}},positiveContext:{subtract:{total:s},abs:{trivial:i},log:{total:i}}}}));function cT(){throw new Error('No "bignumber" implementation available')}function dT(){throw new Error('No "fraction" implementation available')}function hT(){throw new Error('No "matrix" implementation available')}var fT=["typed","config","mathWithTransform","matrix","?fraction","?bignumber","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","SymbolNode"],pT=BD("simplifyConstant",fT,(e=>{var{typed:t,config:r,mathWithTransform:n,matrix:i,fraction:s,bignumber:a,AccessorNode:o,ArrayNode:l,ConstantNode:u,FunctionNode:c,IndexNode:d,ObjectNode:h,OperatorNode:f,SymbolNode:p}=e,{isCommutative:m,isAssociative:g,allChildren:y,createMakeNodeFunction:v}=uT({FunctionNode:c,OperatorNode:f,SymbolNode:p}),b=t("simplifyConstant",{Node:e=>D(N(e,{})),"Node, Object":function(e,t){return D(N(e,t))}});function w(e){return YE(e)?e.valueOf():e instanceof Array?e.map(w):QE(e)?i(w(e.valueOf())):e}function x(e,t,r){try{return n[e].apply(null,t)}catch(i){return t=t.map(w),A(n[e].apply(null,t),r)}}var E=t({Fraction:function(e){var t,r=e.s*e.n;t=r<0?new f("-","unaryMinus",[new u(-r)]):new u(r);if(1===e.d)return t;return new f("/","divide",[t,new u(e.d)])},number:function(e){return e<0?T(new u(-e)):new u(e)},BigNumber:function(e){return e<0?T(new u(-e)):new u(e)},Complex:function(e){throw new Error("Cannot convert Complex number to Node")},string:function(e){return new u(e)},Matrix:function(e){return new l(e.valueOf().map((e=>E(e))))}});function D(e){return SD(e)?e:E(e)}function S(e,t){if(t&&!1!==t.exactFractions&&isFinite(e)&&s){var r=s(e),n=t&&"number"==typeof t.fractionsLimit?t.fractionsLimit:1/0;if(r.valueOf()===e&&r.n<n&&r.d<n)return r}return e}var A=t({"string, Object":function(e,t){return"BigNumber"===r.number?(void 0===a&&cT(),a(e)):"Fraction"===r.number?(void 0===s&&dT(),s(e)):S(parseFloat(e),t)},"Fraction, Object":function(e,t){return e},"BigNumber, Object":function(e,t){return e},"number, Object":function(e,t){return S(e,t)},"Complex, Object":function(e,t){return 0!==e.im?e:S(e.re,t)},"Matrix, Object":function(e,t){return i(S(e.valueOf()))},"Array, Object":function(e,t){return e.map(S)}});function T(e){return new f("-","unaryMinus",[e])}function C(e,t,r,n){var i=t.shift(),s=t.reduce(((t,i)=>{if(!SD(i)){var s=t.pop();if(SD(s))return[s,i];try{return t.push(x(e,[s,i],n)),t}catch(e){t.push(s)}}t.push(D(t.pop()));var a=1===t.length?t[0]:r(t);return[r([a,D(i)])]}),[i]);return 1===s.length?s[0]:r([s[0],E(s[1])])}function N(e,t){switch(e.type){case"SymbolNode":return e;case"ConstantNode":switch(typeof e.value){case"number":return A(e.value,t);case"string":return e.value;default:if(!isNaN(e.value))return A(e.value,t)}return e;case"FunctionNode":if(n[e.name]&&n[e.name].rawArgs)return e;if(-1===["add","multiply"].indexOf(e.name)){var r=e.args.map((e=>N(e,t)));if(!r.some(SD))try{return x(e.name,r,t)}catch(e){}if("size"===e.name&&1===r.length&&mD(r[0])){for(var s=[],a=r[0];mD(a);)s.push(a.items.length),a=a.items[0];return i(s)}return new c(e.name,r.map(D))}case"OperatorNode":var f,p,w=e.fn.toString(),E=v(e);if(TD(e)&&e.isUnary())p=SD((f=[N(e.args[0],t)])[0])?E(f):x(w,f,t);else if(g(e,t.context))if(f=(f=y(e,t.context)).map((e=>N(e,t))),m(w,t.context)){for(var S=[],T=[],k=0;k<f.length;k++)SD(f[k])?T.push(f[k]):S.push(f[k]);S.length>1?(p=C(w,S,E,t),T.unshift(p),p=C(w,T,E,t)):p=C(w,f,E,t)}else p=C(w,f,E,t);else f=e.args.map((e=>N(e,t))),p=C(w,f,E,t);return p;case"ParenthesisNode":return N(e.content,t);case"AccessorNode":return function(e,t,r){if(!DD(t))return new o(D(e),D(t));if(mD(e)||QE(e)){for(var n=Array.from(t.dimensions);n.length>0;)if(bD(n[0])&&"string"!=typeof n[0].value){var s=A(n.shift().value,r);mD(e)?e=e.items[s-1]:(e=e.valueOf()[s-1])instanceof Array&&(e=i(e))}else{if(!(n.length>1&&bD(n[1])&&"string"!=typeof n[1].value))break;var a=A(n[1].value,r),c=[],h=mD(e)?e.items:e.valueOf();for(var f of h)if(mD(f))c.push(f.items[a-1]);else{if(!QE(e))break;c.push(f[a-1])}if(c.length!==h.length)break;e=mD(e)?new l(c):i(c),n.splice(1,1)}return n.length===t.dimensions.length?new o(D(e),t):n.length>0?(t=new d(n),new o(D(e),t)):e}if(AD(e)&&1===t.dimensions.length&&bD(t.dimensions[0])){var p=t.dimensions[0].value;return p in e.properties?e.properties[p]:new u}return new o(D(e),t)}(N(e.object,t),N(e.index,t),t);case"ArrayNode":var M=e.items.map((e=>N(e,t)));return M.some(SD)?new l(M.map(D)):i(M);case"IndexNode":return new d(e.dimensions.map((e=>b(e,t))));case"ObjectNode":var O={};for(var F in e.properties)O[F]=b(e.properties[F],t);return new h(O);default:throw new Error("Unimplemented node type in simplifyConstant: ".concat(e.type))}}return b})),mT="compile",gT=["typed","parse"],yT=BD(mT,gT,(e=>{var{typed:t,parse:r}=e;return t(mT,{string:function(e){return r(e).compile()},"Array | Matrix":function(e){return eT(e,(function(e){return r(e).compile()}))}})})),vT=["parse"],bT=BD("Help",vT,(e=>{var{parse:t}=e;function r(e){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");if(!e)throw new Error('Argument "doc" missing');this.doc=e}return r.prototype.type="Help",r.prototype.isHelp=!0,r.prototype.toString=function(){var e=this.doc||{},r="\n";if(e.name&&(r+="Name: "+e.name+"\n\n"),e.category&&(r+="Category: "+e.category+"\n\n"),e.description&&(r+="Description:\n    "+e.description+"\n\n"),e.syntax&&(r+="Syntax:\n    "+e.syntax.join("\n    ")+"\n\n"),e.examples){r+="Examples:\n";for(var n={},i=0;i<e.examples.length;i++){var s=e.examples[i];r+="    "+s+"\n";var a=void 0;try{a=t(s).compile().evaluate(n)}catch(e){a=e}void 0===a||oD(a)||(r+="        "+NS(a,{precision:14})+"\n")}r+="\n"}return e.mayThrow&&e.mayThrow.length&&(r+="Throws: "+e.mayThrow.join(", ")+"\n\n"),e.seealso&&e.seealso.length&&(r+="See also: "+e.seealso.join(", ")+"\n"),r},r.prototype.toJSON=function(){var e=_D(this.doc);return e.mathjs="Help",e},r.fromJSON=function(e){var t={};return Object.keys(e).filter((e=>"mathjs"!==e)).forEach((r=>{t[r]=e[r]})),new r(t)},r.prototype.valueOf=r.prototype.toString,r}),{isClass:!0}),wT="leafCount",xT=["parse","typed"],ET=BD(wT,xT,(e=>{var{parse:t,typed:r}=e;function n(e){var t=0;return e.forEach((e=>{t+=n(e)})),t||1}return r(wT,{Node:function(e){return n(e)}})})),DT="simplifyCore",ST=["typed","parse","equal","isZero","add","subtract","multiply","divide","pow","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","SymbolNode"],AT=BD(DT,ST,(e=>{var{typed:t,parse:r,equal:n,isZero:i,add:s,subtract:a,multiply:o,divide:l,pow:u,AccessorNode:c,ArrayNode:d,ConstantNode:h,FunctionNode:f,IndexNode:p,ObjectNode:m,OperatorNode:g,ParenthesisNode:y,SymbolNode:v}=e,b=new h(0),w=new h(1),x=new h(!0),E=new h(!1);function D(e){return TD(e)&&["and","not","or"].includes(e.op)}var{hasProperty:S,isCommutative:A}=uT({FunctionNode:f,OperatorNode:g,SymbolNode:v});function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t?t.context:void 0;if(S(e,"trivial",r)){if(ED(e)&&1===e.args.length)return T(e.args[0],t);var s=!1,a=0;if(e.forEach((e=>{1===++a&&(s=T(e,t))})),1===a)return s}var o=e;if(ED(o)){var l=function(e){var t="OperatorNode:"+e;for(var r of sA)if(t in r)return r[t].op;return null}(o.name);if(!l)return new f(T(o.fn),o.args.map((e=>T(e,t))));if(o.args.length>2&&S(o,"associative",r))for(;o.args.length>2;){var u=o.args.pop(),h=o.args.pop();o.args.push(new g(l,o.name,[u,h]))}o=new g(l,o.name,o.args)}if(TD(o)&&o.isUnary()){var y=T(o.args[0],t);if("~"===o.op&&TD(y)&&y.isUnary()&&"~"===y.op)return y.args[0];if("not"===o.op&&TD(y)&&y.isUnary()&&"not"===y.op&&D(y.args[0]))return y.args[0];var v=!0;if("-"===o.op&&TD(y)&&(y.isBinary()&&"subtract"===y.fn&&(o=new g("-","subtract",[y.args[1],y.args[0]]),v=!1),y.isUnary()&&"-"===y.op))return y.args[0];if(v)return new g(o.op,o.fn,[y])}if(TD(o)&&o.isBinary()){var C=T(o.args[0],t),N=T(o.args[1],t);if("+"===o.op){if(bD(C)&&i(C.value))return N;if(bD(N)&&i(N.value))return C;TD(N)&&N.isUnary()&&"-"===N.op&&(N=N.args[0],o=new g("-","subtract",[C,N]))}if("-"===o.op)return TD(N)&&N.isUnary()&&"-"===N.op?T(new g("+","add",[C,N.args[0]]),t):bD(C)&&i(C.value)?T(new g("-","unaryMinus",[N])):bD(N)&&i(N.value)?C:new g(o.op,o.fn,[C,N]);if("*"===o.op){if(bD(C)){if(i(C.value))return b;if(n(C.value,1))return N}if(bD(N)){if(i(N.value))return b;if(n(N.value,1))return C;if(A(o,r))return new g(o.op,o.fn,[N,C],o.implicit)}return new g(o.op,o.fn,[C,N],o.implicit)}if("/"===o.op)return bD(C)&&i(C.value)?b:bD(N)&&n(N.value,1)?C:new g(o.op,o.fn,[C,N]);if("^"===o.op&&bD(N)){if(i(N.value))return w;if(n(N.value,1))return C}if("and"===o.op){if(bD(C)){if(!C.value)return E;if(D(N))return N}if(bD(N)){if(!N.value)return E;if(D(C))return C}}if("or"===o.op){if(bD(C)){if(C.value)return x;if(D(N))return N}if(bD(N)){if(N.value)return x;if(D(C))return C}}return new g(o.op,o.fn,[C,N])}if(TD(o))return new g(o.op,o.fn,o.args.map((e=>T(e,t))));if(mD(o))return new d(o.items.map((e=>T(e,t))));if(pD(o))return new c(T(o.object,t),T(o.index,t));if(DD(o))return new p(o.dimensions.map((e=>T(e,t))));if(AD(o)){var k={};for(var M in o.properties)k[M]=T(o.properties[M],t);return new m(k)}return o}return t(DT,{Node:T,"Node,Object":T})})),TT="evaluate",CT=["typed","parse"],NT=BD(TT,CT,(e=>{var{typed:t,parse:r}=e;return t(TT,{string:function(e){var t=WD();return r(e).compile().evaluate(t)},"string, Map | Object":function(e,t){return r(e).compile().evaluate(t)},"Array | Matrix":function(e){var t=WD();return eT(e,(function(e){return r(e).compile().evaluate(t)}))},"Array | Matrix, Map | Object":function(e,t){return eT(e,(function(e){return r(e).compile().evaluate(t)}))}})})),kT={name:"e",category:"Constants",syntax:["e"],description:"Euler's number, the base of the natural logarithm. Approximately equal to 2.71828",examples:["e","e ^ 2","exp(2)","log(e)"],seealso:["exp"]},MT={name:"pi",category:"Constants",syntax:["pi"],description:"The number pi is a mathematical constant that is the ratio of a circle's circumference to its diameter, and is approximately equal to 3.14159",examples:["pi","sin(pi/2)"],seealso:["tau"]},OT={bignumber:{name:"bignumber",category:"Construction",syntax:["bignumber(x)"],description:"Create a big number from a number or string.",examples:["0.1 + 0.2","bignumber(0.1) + bignumber(0.2)",'bignumber("7.2")','bignumber("7.2e500")',"bignumber([0.1, 0.2, 0.3])"],seealso:["boolean","complex","fraction","index","matrix","string","unit"]},boolean:{name:"boolean",category:"Construction",syntax:["x","boolean(x)"],description:"Convert a string or number into a boolean.",examples:["boolean(0)","boolean(1)","boolean(3)",'boolean("true")','boolean("false")',"boolean([1, 0, 1, 1])"],seealso:["bignumber","complex","index","matrix","number","string","unit"]},complex:{name:"complex",category:"Construction",syntax:["complex()","complex(re, im)","complex(string)"],description:"Create a complex number.",examples:["complex()","complex(2, 3)",'complex("7 - 2i")'],seealso:["bignumber","boolean","index","matrix","number","string","unit"]},createUnit:{name:"createUnit",category:"Construction",syntax:["createUnit(definitions)","createUnit(name, definition)"],description:"Create a user-defined unit and register it with the Unit type.",examples:['createUnit("foo")','createUnit("knot", {definition: "0.514444444 m/s", aliases: ["knots", "kt", "kts"]})','createUnit("mph", "1 mile/hour")'],seealso:["unit","splitUnit"]},fraction:{name:"fraction",category:"Construction",syntax:["fraction(num)","fraction(matrix)","fraction(num,den)","fraction({n: num, d: den})"],description:"Create a fraction from a number or from integer numerator and denominator.",examples:["fraction(0.125)","fraction(1, 3) + fraction(2, 5)","fraction({n: 333, d: 53})","fraction([sqrt(9), sqrt(10), sqrt(11)])"],seealso:["bignumber","boolean","complex","index","matrix","string","unit"]},index:{name:"index",category:"Construction",syntax:["[start]","[start:end]","[start:step:end]","[start1, start 2, ...]","[start1:end1, start2:end2, ...]","[start1:step1:end1, start2:step2:end2, ...]"],description:"Create an index to get or replace a subset of a matrix",examples:["[1, 2, 3]","A = [1, 2, 3; 4, 5, 6]","A[1, :]","A[1, 2] = 50","A[1:2, 1:2] = ones(2, 2)"],seealso:["bignumber","boolean","complex","matrix,","number","range","string","unit"]},matrix:{name:"matrix",category:"Construction",syntax:["[]","[a1, b1, ...; a2, b2, ...]","matrix()",'matrix("dense")',"matrix([...])"],description:"Create a matrix.",examples:["[]","[1, 2, 3]","[1, 2, 3; 4, 5, 6]","matrix()","matrix([3, 4])",'matrix([3, 4; 5, 6], "sparse")','matrix([3, 4; 5, 6], "sparse", "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","sparse"]},number:{name:"number",category:"Construction",syntax:["x","number(x)","number(unit, valuelessUnit)"],description:"Create a number or convert a string or boolean into a number.",examples:["2","2e3","4.05","number(2)",'number("7.2")',"number(true)","number([true, false, true, true])",'number(unit("52cm"), "m")'],seealso:["bignumber","boolean","complex","fraction","index","matrix","string","unit"]},sparse:{name:"sparse",category:"Construction",syntax:["sparse()","sparse([a1, b1, ...; a1, b2, ...])",'sparse([a1, b1, ...; a1, b2, ...], "number")'],description:"Create a sparse matrix.",examples:["sparse()","sparse([3, 4; 5, 6])",'sparse([3, 0; 5, 0], "number")'],seealso:["bignumber","boolean","complex","index","number","string","unit","matrix"]},splitUnit:{name:"splitUnit",category:"Construction",syntax:["splitUnit(unit: Unit, parts: Unit[])"],description:"Split a unit in an array of units whose sum is equal to the original unit.",examples:['splitUnit(1 m, ["feet", "inch"])'],seealso:["unit","createUnit"]},string:{name:"string",category:"Construction",syntax:['"text"',"string(x)"],description:"Create a string or convert a value to a string",examples:['"Hello World!"',"string(4.2)","string(3 + 2i)"],seealso:["bignumber","boolean","complex","index","matrix","number","unit"]},unit:{name:"unit",category:"Construction",syntax:["value unit","unit(value, unit)","unit(string)"],description:"Create a unit.",examples:["5.5 mm","3 inch",'unit(7.1, "kilogram")','unit("23 deg")'],seealso:["bignumber","boolean","complex","index","matrix","number","string"]},e:kT,E:kT,false:{name:"false",category:"Constants",syntax:["false"],description:"Boolean value false",examples:["false"],seealso:["true"]},i:{name:"i",category:"Constants",syntax:["i"],description:"Imaginary unit, defined as i*i=-1. A complex number is described as a + b*i, where a is the real part, and b is the imaginary part.",examples:["i","i * i","sqrt(-1)"],seealso:[]},Infinity:{name:"Infinity",category:"Constants",syntax:["Infinity"],description:"Infinity, a number which is larger than the maximum number that can be handled by a floating point number.",examples:["Infinity","1 / 0"],seealso:[]},LN2:{name:"LN2",category:"Constants",syntax:["LN2"],description:"Returns the natural logarithm of 2, approximately equal to 0.693",examples:["LN2","log(2)"],seealso:[]},LN10:{name:"LN10",category:"Constants",syntax:["LN10"],description:"Returns the natural logarithm of 10, approximately equal to 2.302",examples:["LN10","log(10)"],seealso:[]},LOG2E:{name:"LOG2E",category:"Constants",syntax:["LOG2E"],description:"Returns the base-2 logarithm of E, approximately equal to 1.442",examples:["LOG2E","log(e, 2)"],seealso:[]},LOG10E:{name:"LOG10E",category:"Constants",syntax:["LOG10E"],description:"Returns the base-10 logarithm of E, approximately equal to 0.434",examples:["LOG10E","log(e, 10)"],seealso:[]},NaN:{name:"NaN",category:"Constants",syntax:["NaN"],description:"Not a number",examples:["NaN","0 / 0"],seealso:[]},null:{name:"null",category:"Constants",syntax:["null"],description:"Value null",examples:["null"],seealso:["true","false"]},pi:MT,PI:MT,phi:{name:"phi",category:"Constants",syntax:["phi"],description:"Phi is the golden ratio. Two quantities are in the golden ratio if their ratio is the same as the ratio of their sum to the larger of the two quantities. Phi is defined as `(1 + sqrt(5)) / 2` and is approximately 1.618034...",examples:["phi"],seealso:[]},SQRT1_2:{name:"SQRT1_2",category:"Constants",syntax:["SQRT1_2"],description:"Returns the square root of 1/2, approximately equal to 0.707",examples:["SQRT1_2","sqrt(1/2)"],seealso:[]},SQRT2:{name:"SQRT2",category:"Constants",syntax:["SQRT2"],description:"Returns the square root of 2, approximately equal to 1.414",examples:["SQRT2","sqrt(2)"],seealso:[]},tau:{name:"tau",category:"Constants",syntax:["tau"],description:"Tau is the ratio constant of a circle's circumference to radius, equal to 2 * pi, approximately 6.2832.",examples:["tau","2 * pi"],seealso:["pi"]},true:{name:"true",category:"Constants",syntax:["true"],description:"Boolean value true",examples:["true"],seealso:["false"]},version:{name:"version",category:"Constants",syntax:["version"],description:"A string with the version number of math.js",examples:["version"],seealso:[]},speedOfLight:{description:"Speed of light in vacuum",examples:["speedOfLight"]},gravitationConstant:{description:"Newtonian constant of gravitation",examples:["gravitationConstant"]},planckConstant:{description:"Planck constant",examples:["planckConstant"]},reducedPlanckConstant:{description:"Reduced Planck constant",examples:["reducedPlanckConstant"]},magneticConstant:{description:"Magnetic constant (vacuum permeability)",examples:["magneticConstant"]},electricConstant:{description:"Electric constant (vacuum permeability)",examples:["electricConstant"]},vacuumImpedance:{description:"Characteristic impedance of vacuum",examples:["vacuumImpedance"]},coulomb:{description:"Coulomb's constant",examples:["coulomb"]},elementaryCharge:{description:"Elementary charge",examples:["elementaryCharge"]},bohrMagneton:{description:"Borh magneton",examples:["bohrMagneton"]},conductanceQuantum:{description:"Conductance quantum",examples:["conductanceQuantum"]},inverseConductanceQuantum:{description:"Inverse conductance quantum",examples:["inverseConductanceQuantum"]},magneticFluxQuantum:{description:"Magnetic flux quantum",examples:["magneticFluxQuantum"]},nuclearMagneton:{description:"Nuclear magneton",examples:["nuclearMagneton"]},klitzing:{description:"Von Klitzing constant",examples:["klitzing"]},bohrRadius:{description:"Borh radius",examples:["bohrRadius"]},classicalElectronRadius:{description:"Classical electron radius",examples:["classicalElectronRadius"]},electronMass:{description:"Electron mass",examples:["electronMass"]},fermiCoupling:{description:"Fermi coupling constant",examples:["fermiCoupling"]},fineStructure:{description:"Fine-structure constant",examples:["fineStructure"]},hartreeEnergy:{description:"Hartree energy",examples:["hartreeEnergy"]},protonMass:{description:"Proton mass",examples:["protonMass"]},deuteronMass:{description:"Deuteron Mass",examples:["deuteronMass"]},neutronMass:{description:"Neutron mass",examples:["neutronMass"]},quantumOfCirculation:{description:"Quantum of circulation",examples:["quantumOfCirculation"]},rydberg:{description:"Rydberg constant",examples:["rydberg"]},thomsonCrossSection:{description:"Thomson cross section",examples:["thomsonCrossSection"]},weakMixingAngle:{description:"Weak mixing angle",examples:["weakMixingAngle"]},efimovFactor:{description:"Efimov factor",examples:["efimovFactor"]},atomicMass:{description:"Atomic mass constant",examples:["atomicMass"]},avogadro:{description:"Avogadro's number",examples:["avogadro"]},boltzmann:{description:"Boltzmann constant",examples:["boltzmann"]},faraday:{description:"Faraday constant",examples:["faraday"]},firstRadiation:{description:"First radiation constant",examples:["firstRadiation"]},loschmidt:{description:"Loschmidt constant at T=273.15 K and p=101.325 kPa",examples:["loschmidt"]},gasConstant:{description:"Gas constant",examples:["gasConstant"]},molarPlanckConstant:{description:"Molar Planck constant",examples:["molarPlanckConstant"]},molarVolume:{description:"Molar volume of an ideal gas at T=273.15 K and p=101.325 kPa",examples:["molarVolume"]},sackurTetrode:{description:"Sackur-Tetrode constant at T=1 K and p=101.325 kPa",examples:["sackurTetrode"]},secondRadiation:{description:"Second radiation constant",examples:["secondRadiation"]},stefanBoltzmann:{description:"Stefan-Boltzmann constant",examples:["stefanBoltzmann"]},wienDisplacement:{description:"Wien displacement law constant",examples:["wienDisplacement"]},molarMass:{description:"Molar mass constant",examples:["molarMass"]},molarMassC12:{description:"Molar mass constant of carbon-12",examples:["molarMassC12"]},gravity:{description:"Standard acceleration of gravity (standard acceleration of free-fall on Earth)",examples:["gravity"]},planckLength:{description:"Planck length",examples:["planckLength"]},planckMass:{description:"Planck mass",examples:["planckMass"]},planckTime:{description:"Planck time",examples:["planckTime"]},planckCharge:{description:"Planck charge",examples:["planckCharge"]},planckTemperature:{description:"Planck temperature",examples:["planckTemperature"]},derivative:{name:"derivative",category:"Algebra",syntax:["derivative(expr, variable)","derivative(expr, variable, {simplify: boolean})"],description:"Takes the derivative of an expression expressed in parser Nodes. The derivative will be taken over the supplied variable in the second parameter. If there are multiple variables in the expression, it will return a partial derivative.",examples:['derivative("2x^3", "x")','derivative("2x^3", "x", {simplify: false})','derivative("2x^2 + 3x + 4", "x")','derivative("sin(2x)", "x")','f = parse("x^2 + x")','x = parse("x")',"df = derivative(f, x)","df.evaluate({x: 3})"],seealso:["simplify","parse","evaluate"]},lsolve:{name:"lsolve",category:"Algebra",syntax:["x=lsolve(L, b)"],description:"Finds one solution of the linear system L * x = b where L is an [n x n] lower triangular matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lsolve(a, b)"],seealso:["lsolveAll","lup","lusolve","usolve","matrix","sparse"]},lsolveAll:{name:"lsolveAll",category:"Algebra",syntax:["x=lsolveAll(L, b)"],description:"Finds all solutions of the linear system L * x = b where L is an [n x n] lower triangular matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lsolve(a, b)"],seealso:["lsolve","lup","lusolve","usolve","matrix","sparse"]},lup:{name:"lup",category:"Algebra",syntax:["lup(m)"],description:"Calculate the Matrix LU decomposition with partial pivoting. Matrix A is decomposed in three matrices (L, U, P) where P * A = L * U",examples:["lup([[2, 1], [1, 4]])","lup(matrix([[2, 1], [1, 4]]))","lup(sparse([[2, 1], [1, 4]]))"],seealso:["lusolve","lsolve","usolve","matrix","sparse","slu","qr"]},lusolve:{name:"lusolve",category:"Algebra",syntax:["x=lusolve(A, b)","x=lusolve(lu, b)"],description:"Solves the linear system A * x = b where A is an [n x n] matrix and b is a [n] column vector.",examples:["a = [-2, 3; 2, 1]","b = [11, 9]","x = lusolve(a, b)"],seealso:["lup","slu","lsolve","usolve","matrix","sparse"]},leafCount:{name:"leafCount",category:"Algebra",syntax:["leafCount(expr)"],description:"Computes the number of leaves in the parse tree of the given expression",examples:['leafCount("e^(i*pi)-1")','leafCount(parse("{a: 22/7, b: 10^(1/2)}"))'],seealso:["simplify"]},polynomialRoot:{name:"polynomialRoot",category:"Algebra",syntax:["x=polynomialRoot(-6, 3)","x=polynomialRoot(4, -4, 1)","x=polynomialRoot(-8, 12, -6, 1)"],description:"Finds the roots of a univariate polynomial given by its coefficients starting from constant, linear, and so on, increasing in degree.",examples:["a = polynomialRoot(-6, 11, -6, 1)"],seealso:["cbrt","sqrt"]},resolve:{name:"resolve",category:"Algebra",syntax:["resolve(node, scope)"],description:"Recursively substitute variables in an expression tree.",examples:['resolve(parse("1 + x"), { x: 7 })','resolve(parse("size(text)"), { text: "Hello World" })','resolve(parse("x + y"), { x: parse("3z") })','resolve(parse("3x"), { x: parse("y+z"), z: parse("w^y") })'],seealso:["simplify","evaluate"],mayThrow:["ReferenceError"]},simplify:{name:"simplify",category:"Algebra",syntax:["simplify(expr)","simplify(expr, rules)"],description:"Simplify an expression tree.",examples:['simplify("3 + 2 / 4")','simplify("2x + x")','f = parse("x * (x + 2 + x)")',"simplified = simplify(f)","simplified.evaluate({x: 2})"],seealso:["simplifyCore","derivative","evaluate","parse","rationalize","resolve"]},simplifyConstant:{name:"simplifyConstant",category:"Algebra",syntax:["simplifyConstant(expr)","simplifyConstant(expr, options)"],description:"Replace constant subexpressions of node with their values.",examples:['simplifyConstant("(3-3)*x")','simplifyConstant(parse("z-cos(tau/8)"))'],seealso:["simplify","simplifyCore","evaluate"]},simplifyCore:{name:"simplifyCore",category:"Algebra",syntax:["simplifyCore(node)"],description:"Perform simple one-pass simplifications on an expression tree.",examples:['simplifyCore(parse("0*x"))','simplifyCore(parse("(x+0)*2"))'],seealso:["simplify","simplifyConstant","evaluate"]},symbolicEqual:{name:"symbolicEqual",category:"Algebra",syntax:["symbolicEqual(expr1, expr2)","symbolicEqual(expr1, expr2, options)"],description:"Returns true if the difference of the expressions simplifies to 0",examples:['symbolicEqual("x*y","y*x")','symbolicEqual("abs(x^2)", "x^2")','symbolicEqual("abs(x)", "x", {context: {abs: {trivial: true}}})'],seealso:["simplify","evaluate"]},rationalize:{name:"rationalize",category:"Algebra",syntax:["rationalize(expr)","rationalize(expr, scope)","rationalize(expr, scope, detailed)"],description:"Transform a rationalizable expression in a rational fraction. If rational fraction is one variable polynomial then converts the numerator and denominator in canonical form, with decreasing exponents, returning the coefficients of numerator.",examples:['rationalize("2x/y - y/(x+1)")','rationalize("2x/y - y/(x+1)", true)'],seealso:["simplify"]},slu:{name:"slu",category:"Algebra",syntax:["slu(A, order, threshold)"],description:"Calculate the Matrix LU decomposition with full pivoting. Matrix A is decomposed in two matrices (L, U) and two permutation vectors (pinv, q) where P * A * Q = L * U",examples:["slu(sparse([4.5, 0, 3.2, 0; 3.1, 2.9, 0, 0.9; 0, 1.7, 3, 0; 3.5, 0.4, 0, 1]), 1, 0.001)"],seealso:["lusolve","lsolve","usolve","matrix","sparse","lup","qr"]},usolve:{name:"usolve",category:"Algebra",syntax:["x=usolve(U, b)"],description:"Finds one solution of the linear system U * x = b where U is an [n x n] upper triangular matrix and b is a [n] column vector.",examples:["x=usolve(sparse([1, 1, 1, 1; 0, 1, 1, 1; 0, 0, 1, 1; 0, 0, 0, 1]), [1; 2; 3; 4])"],seealso:["usolveAll","lup","lusolve","lsolve","matrix","sparse"]},usolveAll:{name:"usolveAll",category:"Algebra",syntax:["x=usolve(U, b)"],description:"Finds all solutions of the linear system U * x = b where U is an [n x n] upper triangular matrix and b is a [n] column vector.",examples:["x=usolve(sparse([1, 1, 1, 1; 0, 1, 1, 1; 0, 0, 1, 1; 0, 0, 0, 1]), [1; 2; 3; 4])"],seealso:["usolve","lup","lusolve","lsolve","matrix","sparse"]},qr:{name:"qr",category:"Algebra",syntax:["qr(A)"],description:"Calculates the Matrix QR decomposition. Matrix `A` is decomposed in two matrices (`Q`, `R`) where `Q` is an orthogonal matrix and `R` is an upper triangular matrix.",examples:["qr([[1, -1,  4], [1,  4, -2], [1,  4,  2], [1,  -1, 0]])"],seealso:["lup","slu","matrix"]},abs:{name:"abs",category:"Arithmetic",syntax:["abs(x)"],description:"Compute the absolute value.",examples:["abs(3.5)","abs(-4.2)"],seealso:["sign"]},add:{name:"add",category:"Operators",syntax:["x + y","add(x, y)"],description:"Add two values.",examples:["a = 2.1 + 3.6","a - 3.6","3 + 2i","3 cm + 2 inch",'"2.3" + "4"'],seealso:["subtract"]},cbrt:{name:"cbrt",category:"Arithmetic",syntax:["cbrt(x)","cbrt(x, allRoots)"],description:"Compute the cubic root value. If x = y * y * y, then y is the cubic root of x. When `x` is a number or complex number, an optional second argument `allRoots` can be provided to return all three cubic roots. If not provided, the principal root is returned",examples:["cbrt(64)","cube(4)","cbrt(-8)","cbrt(2 + 3i)","cbrt(8i)","cbrt(8i, true)","cbrt(27 m^3)"],seealso:["square","sqrt","cube","multiply"]},ceil:{name:"ceil",category:"Arithmetic",syntax:["ceil(x)"],description:"Round a value towards plus infinity. If x is complex, both real and imaginary part are rounded towards plus infinity.",examples:["ceil(3.2)","ceil(3.8)","ceil(-4.2)"],seealso:["floor","fix","round"]},cube:{name:"cube",category:"Arithmetic",syntax:["cube(x)"],description:"Compute the cube of a value. The cube of x is x * x * x.",examples:["cube(2)","2^3","2 * 2 * 2"],seealso:["multiply","square","pow"]},divide:{name:"divide",category:"Operators",syntax:["x / y","divide(x, y)"],description:"Divide two values.",examples:["a = 2 / 3","a * 3","4.5 / 2","3 + 4 / 2","(3 + 4) / 2","18 km / 4.5"],seealso:["multiply"]},dotDivide:{name:"dotDivide",category:"Operators",syntax:["x ./ y","dotDivide(x, y)"],description:"Divide two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a ./ b"],seealso:["multiply","dotMultiply","divide"]},dotMultiply:{name:"dotMultiply",category:"Operators",syntax:["x .* y","dotMultiply(x, y)"],description:"Multiply two values element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","b = [2, 1, 1; 3, 2, 5]","a .* b"],seealso:["multiply","divide","dotDivide"]},dotPow:{name:"dotPow",category:"Operators",syntax:["x .^ y","dotPow(x, y)"],description:"Calculates the power of x to y element wise.",examples:["a = [1, 2, 3; 4, 5, 6]","a .^ 2"],seealso:["pow"]},exp:{name:"exp",category:"Arithmetic",syntax:["exp(x)"],description:"Calculate the exponent of a value.",examples:["exp(1.3)","e ^ 1.3","log(exp(1.3))","x = 2.4","(exp(i*x) == cos(x) + i*sin(x))   # Euler's formula"],seealso:["expm","expm1","pow","log"]},expm:{name:"expm",category:"Arithmetic",syntax:["exp(x)"],description:"Compute the matrix exponential, expm(A) = e^A. The matrix must be square. Not to be confused with exp(a), which performs element-wise exponentiation.",examples:["expm([[0,2],[0,0]])"],seealso:["exp"]},expm1:{name:"expm1",category:"Arithmetic",syntax:["expm1(x)"],description:"Calculate the value of subtracting 1 from the exponential value.",examples:["expm1(2)","pow(e, 2) - 1","log(expm1(2) + 1)"],seealso:["exp","pow","log"]},fix:{name:"fix",category:"Arithmetic",syntax:["fix(x)"],description:"Round a value towards zero. If x is complex, both real and imaginary part are rounded towards zero.",examples:["fix(3.2)","fix(3.8)","fix(-4.2)","fix(-4.8)"],seealso:["ceil","floor","round"]},floor:{name:"floor",category:"Arithmetic",syntax:["floor(x)"],description:"Round a value towards minus infinity.If x is complex, both real and imaginary part are rounded towards minus infinity.",examples:["floor(3.2)","floor(3.8)","floor(-4.2)"],seealso:["ceil","fix","round"]},gcd:{name:"gcd",category:"Arithmetic",syntax:["gcd(a, b)","gcd(a, b, c, ...)"],description:"Compute the greatest common divisor.",examples:["gcd(8, 12)","gcd(-4, 6)","gcd(25, 15, -10)"],seealso:["lcm","xgcd"]},hypot:{name:"hypot",category:"Arithmetic",syntax:["hypot(a, b, c, ...)","hypot([a, b, c, ...])"],description:"Calculate the hypotenusa of a list with values. ",examples:["hypot(3, 4)","sqrt(3^2 + 4^2)","hypot(-2)","hypot([3, 4, 5])"],seealso:["abs","norm"]},lcm:{name:"lcm",category:"Arithmetic",syntax:["lcm(x, y)"],description:"Compute the least common multiple.",examples:["lcm(4, 6)","lcm(6, 21)","lcm(6, 21, 5)"],seealso:["gcd"]},log:{name:"log",category:"Arithmetic",syntax:["log(x)","log(x, base)"],description:"Compute the logarithm of a value. If no base is provided, the natural logarithm of x is calculated. If base if provided, the logarithm is calculated for the specified base. log(x, base) is defined as log(x) / log(base).",examples:["log(3.5)","a = log(2.4)","exp(a)","10 ^ 4","log(10000, 10)","log(10000) / log(10)","b = log(1024, 2)","2 ^ b"],seealso:["exp","log1p","log2","log10"]},log2:{name:"log2",category:"Arithmetic",syntax:["log2(x)"],description:"Calculate the 2-base of a value. This is the same as calculating `log(x, 2)`.",examples:["log2(0.03125)","log2(16)","log2(16) / log2(2)","pow(2, 4)"],seealso:["exp","log1p","log","log10"]},log1p:{name:"log1p",category:"Arithmetic",syntax:["log1p(x)","log1p(x, base)"],description:"Calculate the logarithm of a `value+1`",examples:["log1p(2.5)","exp(log1p(1.4))","pow(10, 4)","log1p(9999, 10)","log1p(9999) / log(10)"],seealso:["exp","log","log2","log10"]},log10:{name:"log10",category:"Arithmetic",syntax:["log10(x)"],description:"Compute the 10-base logarithm of a value.",examples:["log10(0.00001)","log10(10000)","10 ^ 4","log(10000) / log(10)","log(10000, 10)"],seealso:["exp","log"]},mod:{name:"mod",category:"Operators",syntax:["x % y","x mod y","mod(x, y)"],description:"Calculates the modulus, the remainder of an integer division.",examples:["7 % 3","11 % 2","10 mod 4","isOdd(x) = x % 2","isOdd(2)","isOdd(3)"],seealso:["divide"]},multiply:{name:"multiply",category:"Operators",syntax:["x * y","multiply(x, y)"],description:"multiply two values.",examples:["a = 2.1 * 3.4","a / 3.4","2 * 3 + 4","2 * (3 + 4)","3 * 2.1 km"],seealso:["divide"]},norm:{name:"norm",category:"Arithmetic",syntax:["norm(x)","norm(x, p)"],description:"Calculate the norm of a number, vector or matrix.",examples:["abs(-3.5)","norm(-3.5)","norm(3 - 4i)","norm([1, 2, -3], Infinity)","norm([1, 2, -3], -Infinity)","norm([3, 4], 2)","norm([[1, 2], [3, 4]], 1)",'norm([[1, 2], [3, 4]], "inf")','norm([[1, 2], [3, 4]], "fro")']},nthRoot:{name:"nthRoot",category:"Arithmetic",syntax:["nthRoot(a)","nthRoot(a, root)"],description:'Calculate the nth root of a value. The principal nth root of a positive real number A, is the positive real solution of the equation "x^root = A".',examples:["4 ^ 3","nthRoot(64, 3)","nthRoot(9, 2)","sqrt(9)"],seealso:["nthRoots","pow","sqrt"]},nthRoots:{name:"nthRoots",category:"Arithmetic",syntax:["nthRoots(A)","nthRoots(A, root)"],description:'Calculate the nth roots of a value. An nth root of a positive real number A, is a positive real solution of the equation "x^root = A". This function returns an array of complex values.',examples:["nthRoots(1)","nthRoots(1, 3)"],seealso:["sqrt","pow","nthRoot"]},pow:{name:"pow",category:"Operators",syntax:["x ^ y","pow(x, y)"],description:"Calculates the power of x to y, x^y.",examples:["2^3","2*2*2","1 + e ^ (pi * i)","pow([[1, 2], [4, 3]], 2)","pow([[1, 2], [4, 3]], -1)"],seealso:["multiply","nthRoot","nthRoots","sqrt"]},round:{name:"round",category:"Arithmetic",syntax:["round(x)","round(x, n)"],description:"round a value towards the nearest integer.If x is complex, both real and imaginary part are rounded towards the nearest integer. When n is specified, the value is rounded to n decimals.",examples:["round(3.2)","round(3.8)","round(-4.2)","round(-4.8)","round(pi, 3)","round(123.45678, 2)"],seealso:["ceil","floor","fix"]},sign:{name:"sign",category:"Arithmetic",syntax:["sign(x)"],description:"Compute the sign of a value. The sign of a value x is 1 when x>1, -1 when x<0, and 0 when x=0.",examples:["sign(3.5)","sign(-4.2)","sign(0)"],seealso:["abs"]},sqrt:{name:"sqrt",category:"Arithmetic",syntax:["sqrt(x)"],description:"Compute the square root value. If x = y * y, then y is the square root of x.",examples:["sqrt(25)","5 * 5","sqrt(-1)"],seealso:["square","sqrtm","multiply","nthRoot","nthRoots","pow"]},sqrtm:{name:"sqrtm",category:"Arithmetic",syntax:["sqrtm(x)"],description:"Calculate the principal square root of a square matrix. The principal square root matrix `X` of another matrix `A` is such that `X * X = A`.",examples:["sqrtm([[33, 24], [48, 57]])"],seealso:["sqrt","abs","square","multiply"]},square:{name:"square",category:"Arithmetic",syntax:["square(x)"],description:"Compute the square of a value. The square of x is x * x.",examples:["square(3)","sqrt(9)","3^2","3 * 3"],seealso:["multiply","pow","sqrt","cube"]},subtract:{name:"subtract",category:"Operators",syntax:["x - y","subtract(x, y)"],description:"subtract two values.",examples:["a = 5.3 - 2","a + 2","2/3 - 1/6","2 * 3 - 3","2.1 km - 500m"],seealso:["add"]},unaryMinus:{name:"unaryMinus",category:"Operators",syntax:["-x","unaryMinus(x)"],description:"Inverse the sign of a value. Converts booleans and strings to numbers.",examples:["-4.5","-(-5.6)",'-"22"'],seealso:["add","subtract","unaryPlus"]},unaryPlus:{name:"unaryPlus",category:"Operators",syntax:["+x","unaryPlus(x)"],description:"Converts booleans and strings to numbers.",examples:["+true",'+"2"'],seealso:["add","subtract","unaryMinus"]},xgcd:{name:"xgcd",category:"Arithmetic",syntax:["xgcd(a, b)"],description:"Calculate the extended greatest common divisor for two values. The result is an array [d, x, y] with 3 entries, where d is the greatest common divisor, and d = x * a + y * b.",examples:["xgcd(8, 12)","gcd(8, 12)","xgcd(36163, 21199)"],seealso:["gcd","lcm"]},invmod:{name:"invmod",category:"Arithmetic",syntax:["invmod(a, b)"],description:"Calculate the (modular) multiplicative inverse of a modulo b. Solution to the equation ax ≣ 1 (mod b)",examples:["invmod(8, 12)","invmod(7, 13)","invmod(15151, 15122)"],seealso:["gcd","xgcd"]},bitAnd:{name:"bitAnd",category:"Bitwise",syntax:["x & y","bitAnd(x, y)"],description:"Bitwise AND operation. Performs the logical AND operation on each pair of the corresponding bits of the two given values by multiplying them. If both bits in the compared position are 1, the bit in the resulting binary representation is 1, otherwise, the result is 0",examples:["5 & 3","bitAnd(53, 131)","[1, 12, 31] & 42"],seealso:["bitNot","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitNot:{name:"bitNot",category:"Bitwise",syntax:["~x","bitNot(x)"],description:"Bitwise NOT operation. Performs a logical negation on each bit of the given value. Bits that are 0 become 1, and those that are 1 become 0.",examples:["~1","~2","bitNot([2, -3, 4])"],seealso:["bitAnd","bitOr","bitXor","leftShift","rightArithShift","rightLogShift"]},bitOr:{name:"bitOr",category:"Bitwise",syntax:["x | y","bitOr(x, y)"],description:"Bitwise OR operation. Performs the logical inclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if the first bit is 1 or the second bit is 1 or both bits are 1, otherwise, the result is 0.",examples:["5 | 3","bitOr([1, 2, 3], 4)"],seealso:["bitAnd","bitNot","bitXor","leftShift","rightArithShift","rightLogShift"]},bitXor:{name:"bitXor",category:"Bitwise",syntax:["bitXor(x, y)"],description:"Bitwise XOR operation, exclusive OR. Performs the logical exclusive OR operation on each pair of corresponding bits of the two given values. The result in each position is 1 if only the first bit is 1 or only the second bit is 1, but will be 0 if both are 0 or both are 1.",examples:["bitOr(1, 2)","bitXor([2, 3, 4], 4)"],seealso:["bitAnd","bitNot","bitOr","leftShift","rightArithShift","rightLogShift"]},leftShift:{name:"leftShift",category:"Bitwise",syntax:["x << y","leftShift(x, y)"],description:"Bitwise left logical shift of a value x by y number of bits.",examples:["4 << 1","8 >> 1"],seealso:["bitAnd","bitNot","bitOr","bitXor","rightArithShift","rightLogShift"]},rightArithShift:{name:"rightArithShift",category:"Bitwise",syntax:["x >> y","rightArithShift(x, y)"],description:"Bitwise right arithmetic shift of a value x by y number of bits.",examples:["8 >> 1","4 << 1","-12 >> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightLogShift"]},rightLogShift:{name:"rightLogShift",category:"Bitwise",syntax:["x >>> y","rightLogShift(x, y)"],description:"Bitwise right logical shift of a value x by y number of bits.",examples:["8 >>> 1","4 << 1","-12 >>> 2"],seealso:["bitAnd","bitNot","bitOr","bitXor","leftShift","rightArithShift"]},bellNumbers:{name:"bellNumbers",category:"Combinatorics",syntax:["bellNumbers(n)"],description:"The Bell Numbers count the number of partitions of a set. A partition is a pairwise disjoint subset of S whose union is S. `bellNumbers` only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["bellNumbers(3)","bellNumbers(8)"],seealso:["stirlingS2"]},catalan:{name:"catalan",category:"Combinatorics",syntax:["catalan(n)"],description:"The Catalan Numbers enumerate combinatorial structures of many different types. catalan only takes integer arguments. The following condition must be enforced: n >= 0.",examples:["catalan(3)","catalan(8)"],seealso:["bellNumbers"]},composition:{name:"composition",category:"Combinatorics",syntax:["composition(n, k)"],description:"The composition counts of n into k parts. composition only takes integer arguments. The following condition must be enforced: k <= n.",examples:["composition(5, 3)"],seealso:["combinations"]},stirlingS2:{name:"stirlingS2",category:"Combinatorics",syntax:["stirlingS2(n, k)"],description:"he Stirling numbers of the second kind, counts the number of ways to partition a set of n labelled objects into k nonempty unlabelled subsets. `stirlingS2` only takes integer arguments. The following condition must be enforced: k <= n. If n = k or k = 1, then s(n,k) = 1.",examples:["stirlingS2(5, 3)"],seealso:["bellNumbers"]},config:{name:"config",category:"Core",syntax:["config()","config(options)"],description:"Get configuration or change configuration.",examples:["config()","1/3 + 1/4",'config({number: "Fraction"})',"1/3 + 1/4"],seealso:[]},import:{name:"import",category:"Core",syntax:["import(functions)","import(functions, options)"],description:"Import functions or constants from an object.",examples:["import({myFn: f(x)=x^2, myConstant: 32 })","myFn(2)","myConstant"],seealso:[]},typed:{name:"typed",category:"Core",syntax:["typed(signatures)","typed(name, signatures)"],description:"Create a typed function.",examples:['double = typed({ "number": f(x)=x+x, "string": f(x)=concat(x,x) })',"double(2)",'double("hello")'],seealso:[]},arg:{name:"arg",category:"Complex",syntax:["arg(x)"],description:"Compute the argument of a complex value. If x = a+bi, the argument is computed as atan2(b, a).",examples:["arg(2 + 2i)","atan2(3, 2)","arg(2 + 3i)"],seealso:["re","im","conj","abs"]},conj:{name:"conj",category:"Complex",syntax:["conj(x)"],description:"Compute the complex conjugate of a complex value. If x = a+bi, the complex conjugate is a-bi.",examples:["conj(2 + 3i)","conj(2 - 3i)","conj(-5.2i)"],seealso:["re","im","abs","arg"]},re:{name:"re",category:"Complex",syntax:["re(x)"],description:"Get the real part of a complex number.",examples:["re(2 + 3i)","im(2 + 3i)","re(-5.2i)","re(2.4)"],seealso:["im","conj","abs","arg"]},im:{name:"im",category:"Complex",syntax:["im(x)"],description:"Get the imaginary part of a complex number.",examples:["im(2 + 3i)","re(2 + 3i)","im(-5.2i)","im(2.4)"],seealso:["re","conj","abs","arg"]},evaluate:{name:"evaluate",category:"Expression",syntax:["evaluate(expression)","evaluate(expression, scope)","evaluate([expr1, expr2, expr3, ...])","evaluate([expr1, expr2, expr3, ...], scope)"],description:"Evaluate an expression or an array with expressions.",examples:['evaluate("2 + 3")','evaluate("sqrt(16)")','evaluate("2 inch to cm")','evaluate("sin(x * pi)", { "x": 1/2 })','evaluate(["width=2", "height=4","width*height"])'],seealso:[]},help:{name:"help",category:"Expression",syntax:["help(object)","help(string)"],description:"Display documentation on a function or data type.",examples:["help(sqrt)",'help("complex")'],seealso:[]},distance:{name:"distance",category:"Geometry",syntax:["distance([x1, y1], [x2, y2])","distance([[x1, y1], [x2, y2]])"],description:"Calculates the Euclidean distance between two points.",examples:["distance([0,0], [4,4])","distance([[0,0], [4,4]])"],seealso:[]},intersect:{name:"intersect",category:"Geometry",syntax:["intersect(expr1, expr2, expr3, expr4)","intersect(expr1, expr2, expr3)"],description:"Computes the intersection point of lines and/or planes.",examples:["intersect([0, 0], [10, 10], [10, 0], [0, 10])","intersect([1, 0, 1],  [4, -2, 2], [1, 1, 1, 6])"],seealso:[]},and:{name:"and",category:"Logical",syntax:["x and y","and(x, y)"],description:"Logical and. Test whether two values are both defined with a nonzero/nonempty value.",examples:["true and false","true and true","2 and 4"],seealso:["not","or","xor"]},not:{name:"not",category:"Logical",syntax:["not x","not(x)"],description:"Logical not. Flips the boolean value of given argument.",examples:["not true","not false","not 2","not 0"],seealso:["and","or","xor"]},or:{name:"or",category:"Logical",syntax:["x or y","or(x, y)"],description:"Logical or. Test if at least one value is defined with a nonzero/nonempty value.",examples:["true or false","false or false","0 or 4"],seealso:["not","and","xor"]},xor:{name:"xor",category:"Logical",syntax:["x xor y","xor(x, y)"],description:"Logical exclusive or, xor. Test whether one and only one value is defined with a nonzero/nonempty value.",examples:["true xor false","false xor false","true xor true","0 xor 4"],seealso:["not","and","or"]},concat:{name:"concat",category:"Matrix",syntax:["concat(A, B, C, ...)","concat(A, B, C, ..., dim)"],description:"Concatenate matrices. By default, the matrices are concatenated by the last dimension. The dimension on which to concatenate can be provided as last argument.",examples:["A = [1, 2; 5, 6]","B = [3, 4; 7, 8]","concat(A, B)","concat(A, B, 1)","concat(A, B, 2)"],seealso:["det","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},count:{name:"count",category:"Matrix",syntax:["count(x)"],description:"Count the number of elements of a matrix, array or string.",examples:["a = [1, 2; 3, 4; 5, 6]","count(a)","size(a)",'count("hello world")'],seealso:["size"]},cross:{name:"cross",category:"Matrix",syntax:["cross(A, B)"],description:"Calculate the cross product for two vectors in three dimensional space.",examples:["cross([1, 1, 0],  [0, 1, 1])","cross([3, -3, 1], [4, 9, 2])","cross([2, 3, 4],  [5, 6, 7])"],seealso:["multiply","dot"]},column:{name:"column",category:"Matrix",syntax:["column(x, index)"],description:"Return a column from a matrix or array.",examples:["A = [[1, 2], [3, 4]]","column(A, 1)","column(A, 2)"],seealso:["row","matrixFromColumns"]},ctranspose:{name:"ctranspose",category:"Matrix",syntax:["x'","ctranspose(x)"],description:"Complex Conjugate and Transpose a matrix",examples:["a = [1, 2, 3; 4, 5, 6]","a'","ctranspose(a)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","zeros"]},det:{name:"det",category:"Matrix",syntax:["det(x)"],description:"Calculate the determinant of a matrix",examples:["det([1, 2; 3, 4])","det([-2, 2, 3; -1, 1, 3; 2, 0, -1])"],seealso:["concat","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},diag:{name:"diag",category:"Matrix",syntax:["diag(x)","diag(x, k)"],description:"Create a diagonal matrix or retrieve the diagonal of a matrix. When x is a vector, a matrix with the vector values on the diagonal will be returned. When x is a matrix, a vector with the diagonal values of the matrix is returned. When k is provided, the k-th diagonal will be filled in or retrieved, if k is positive, the values are placed on the super diagonal. When k is negative, the values are placed on the sub diagonal.",examples:["diag(1:3)","diag(1:3, 1)","a = [1, 2, 3; 4, 5, 6; 7, 8, 9]","diag(a)"],seealso:["concat","det","identity","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},diff:{name:"diff",category:"Matrix",syntax:["diff(arr)","diff(arr, dim)"],description:["Create a new matrix or array with the difference of the passed matrix or array.","Dim parameter is optional and used to indicant the dimension of the array/matrix to apply the difference","If no dimension parameter is passed it is assumed as dimension 0","Dimension is zero-based in javascript and one-based in the parser","Arrays must be 'rectangular' meaning arrays like [1, 2]","If something is passed as a matrix it will be returned as a matrix but other than that all matrices are converted to arrays"],examples:["A = [1, 2, 4, 7, 0]","diff(A)","diff(A, 1)","B = [[1, 2], [3, 4]]","diff(B)","diff(B, 1)","diff(B, 2)","diff(B, bignumber(2))","diff([[1, 2], matrix([3, 4])], 2)"],seealso:["subtract","partitionSelect"]},dot:{name:"dot",category:"Matrix",syntax:["dot(A, B)","A * B"],description:"Calculate the dot product of two vectors. The dot product of A = [a1, a2, a3, ..., an] and B = [b1, b2, b3, ..., bn] is defined as dot(A, B) = a1 * b1 + a2 * b2 + a3 * b3 + ... + an * bn",examples:["dot([2, 4, 1], [2, 2, 3])","[2, 4, 1] * [2, 2, 3]"],seealso:["multiply","cross"]},getMatrixDataType:{name:"getMatrixDataType",category:"Matrix",syntax:["getMatrixDataType(x)"],description:'Find the data type of all elements in a matrix or array, for example "number" if all items are a number and "Complex" if all values are complex numbers. If a matrix contains more than one data type, it will return "mixed".',examples:["getMatrixDataType([1, 2, 3])","getMatrixDataType([[5 cm], [2 inch]])",'getMatrixDataType([1, "text"])',"getMatrixDataType([1, bignumber(4)])"],seealso:["matrix","sparse","typeOf"]},identity:{name:"identity",category:"Matrix",syntax:["identity(n)","identity(m, n)","identity([m, n])"],description:"Returns the identity matrix with size m-by-n. The matrix has ones on the diagonal and zeros elsewhere.",examples:["identity(3)","identity(3, 5)","a = [1, 2, 3; 4, 5, 6]","identity(size(a))"],seealso:["concat","det","diag","inv","ones","range","size","squeeze","subset","trace","transpose","zeros"]},filter:{name:"filter",category:"Matrix",syntax:["filter(x, test)"],description:"Filter items in a matrix.",examples:["isPositive(x) = x > 0","filter([6, -2, -1, 4, 3], isPositive)","filter([6, -2, 0, 1, 0], x != 0)"],seealso:["sort","map","forEach"]},flatten:{name:"flatten",category:"Matrix",syntax:["flatten(x)"],description:"Flatten a multi dimensional matrix into a single dimensional matrix.",examples:["a = [1, 2, 3; 4, 5, 6]","size(a)","b = flatten(a)","size(b)"],seealso:["concat","resize","size","squeeze"]},forEach:{name:"forEach",category:"Matrix",syntax:["forEach(x, callback)"],description:"Iterates over all elements of a matrix/array, and executes the given callback function.",examples:["numberOfPets = {}","addPet(n) = numberOfPets[n] = (numberOfPets[n] ? numberOfPets[n]:0 ) + 1;",'forEach(["Dog","Cat","Cat"], addPet)',"numberOfPets"],seealso:["map","sort","filter"]},inv:{name:"inv",category:"Matrix",syntax:["inv(x)"],description:"Calculate the inverse of a matrix",examples:["inv([1, 2; 3, 4])","inv(4)","1 / 4"],seealso:["concat","det","diag","identity","ones","range","size","squeeze","subset","trace","transpose","zeros"]},pinv:{name:"pinv",category:"Matrix",syntax:["pinv(x)"],description:"Calculate the Moore–Penrose inverse of a matrix",examples:["pinv([1, 2; 3, 4])","pinv([[1, 0], [0, 1], [0, 1]])","pinv(4)"],seealso:["inv"]},eigs:{name:"eigs",category:"Matrix",syntax:["eigs(x)"],description:"Calculate the eigenvalues and eigenvectors of a real symmetric matrix",examples:["eigs([[5, 2.3], [2.3, 1]])"],seealso:["inv"]},kron:{name:"kron",category:"Matrix",syntax:["kron(x, y)"],description:"Calculates the kronecker product of 2 matrices or vectors.",examples:["kron([[1, 0], [0, 1]], [[1, 2], [3, 4]])","kron([1,1], [2,3,4])"],seealso:["multiply","dot","cross"]},matrixFromFunction:{name:"matrixFromFunction",category:"Matrix",syntax:["matrixFromFunction(size, fn)","matrixFromFunction(size, fn, format)","matrixFromFunction(size, fn, format, datatype)","matrixFromFunction(size, format, fn)","matrixFromFunction(size, format, datatype, fn)"],description:"Create a matrix by evaluating a generating function at each index.",examples:["f(I) = I[1] - I[2]","matrixFromFunction([3,3], f)","g(I) = I[1] - I[2] == 1 ? 4 : 0",'matrixFromFunction([100, 100], "sparse", g)',"matrixFromFunction([5], random)"],seealso:["matrix","matrixFromRows","matrixFromColumns","zeros"]},matrixFromRows:{name:"matrixFromRows",category:"Matrix",syntax:["matrixFromRows(...arr)","matrixFromRows(row1, row2)","matrixFromRows(row1, row2, row3)"],description:"Create a dense matrix from vectors as individual rows.",examples:["matrixFromRows([1, 2, 3], [[4],[5],[6]])"],seealso:["matrix","matrixFromColumns","matrixFromFunction","zeros"]},matrixFromColumns:{name:"matrixFromColumns",category:"Matrix",syntax:["matrixFromColumns(...arr)","matrixFromColumns(row1, row2)","matrixFromColumns(row1, row2, row3)"],description:"Create a dense matrix from vectors as individual columns.",examples:["matrixFromColumns([1, 2, 3], [[4],[5],[6]])"],seealso:["matrix","matrixFromRows","matrixFromFunction","zeros"]},map:{name:"map",category:"Matrix",syntax:["map(x, callback)"],description:"Create a new matrix or array with the results of the callback function executed on each entry of the matrix/array.",examples:["map([1, 2, 3], square)"],seealso:["filter","forEach"]},ones:{name:"ones",category:"Matrix",syntax:["ones(m)","ones(m, n)","ones(m, n, p, ...)","ones([m])","ones([m, n])","ones([m, n, p, ...])"],description:"Create a matrix containing ones.",examples:["ones(3)","ones(3, 5)","ones([2,3]) * 4.5","a = [1, 2, 3; 4, 5, 6]","ones(size(a))"],seealso:["concat","det","diag","identity","inv","range","size","squeeze","subset","trace","transpose","zeros"]},partitionSelect:{name:"partitionSelect",category:"Matrix",syntax:["partitionSelect(x, k)","partitionSelect(x, k, compare)"],description:"Partition-based selection of an array or 1D matrix. Will find the kth smallest value, and mutates the input array. Uses Quickselect.",examples:["partitionSelect([5, 10, 1], 2)",'partitionSelect(["C", "B", "A", "D"], 1, compareText)',"arr = [5, 2, 1]","partitionSelect(arr, 0) # returns 1, arr is now: [1, 2, 5]","arr","partitionSelect(arr, 1, 'desc') # returns 2, arr is now: [5, 2, 1]","arr"],seealso:["sort"]},range:{name:"range",category:"Type",syntax:["start:end","start:step:end","range(start, end)","range(start, end, step)","range(string)"],description:"Create a range. Lower bound of the range is included, upper bound is excluded.",examples:["1:5","3:-1:-3","range(3, 7)","range(0, 12, 2)",'range("4:10")',"range(1m, 1m, 3m)","a = [1, 2, 3, 4; 5, 6, 7, 8]","a[1:2, 1:2]"],seealso:["concat","det","diag","identity","inv","ones","size","squeeze","subset","trace","transpose","zeros"]},resize:{name:"resize",category:"Matrix",syntax:["resize(x, size)","resize(x, size, defaultValue)"],description:"Resize a matrix.",examples:["resize([1,2,3,4,5], [3])","resize([1,2,3], [5])","resize([1,2,3], [5], -1)","resize(2, [2, 3])",'resize("hello", [8], "!")'],seealso:["size","subset","squeeze","reshape"]},reshape:{name:"reshape",category:"Matrix",syntax:["reshape(x, sizes)"],description:"Reshape a multi dimensional array to fit the specified dimensions.",examples:["reshape([1, 2, 3, 4, 5, 6], [2, 3])","reshape([[1, 2], [3, 4]], [1, 4])","reshape([[1, 2], [3, 4]], [4])","reshape([1, 2, 3, 4], [-1, 2])"],seealso:["size","squeeze","resize"]},rotate:{name:"rotate",category:"Matrix",syntax:["rotate(w, theta)","rotate(w, theta, v)"],description:"Returns a 2-D rotation matrix (2x2) for a given angle (in radians). Returns a 2-D rotation matrix (3x3) of a given angle (in radians) around given axis.",examples:["rotate([1, 0], pi / 2)",'rotate(matrix([1, 0]), unit("35deg"))','rotate([1, 0, 0], unit("90deg"), [0, 0, 1])','rotate(matrix([1, 0, 0]), unit("90deg"), matrix([0, 0, 1]))'],seealso:["matrix","rotationMatrix"]},rotationMatrix:{name:"rotationMatrix",category:"Matrix",syntax:["rotationMatrix(theta)","rotationMatrix(theta, v)","rotationMatrix(theta, v, format)"],description:"Returns a 2-D rotation matrix (2x2) for a given angle (in radians). Returns a 2-D rotation matrix (3x3) of a given angle (in radians) around given axis.",examples:["rotationMatrix(pi / 2)",'rotationMatrix(unit("45deg"), [0, 0, 1])','rotationMatrix(1, matrix([0, 0, 1]), "sparse")'],seealso:["cos","sin"]},row:{name:"row",category:"Matrix",syntax:["row(x, index)"],description:"Return a row from a matrix or array.",examples:["A = [[1, 2], [3, 4]]","row(A, 1)","row(A, 2)"],seealso:["column","matrixFromRows"]},size:{name:"size",category:"Matrix",syntax:["size(x)"],description:"Calculate the size of a matrix.",examples:["size(2.3)",'size("hello world")',"a = [1, 2; 3, 4; 5, 6]","size(a)","size(1:6)"],seealso:["concat","count","det","diag","identity","inv","ones","range","squeeze","subset","trace","transpose","zeros"]},sort:{name:"sort",category:"Matrix",syntax:["sort(x)","sort(x, compare)"],description:'Sort the items in a matrix. Compare can be a string "asc", "desc", "natural", or a custom sort function.',examples:["sort([5, 10, 1])",'sort(["C", "B", "A", "D"], "natural")',"sortByLength(a, b) = size(a)[1] - size(b)[1]",'sort(["Langdon", "Tom", "Sara"], sortByLength)','sort(["10", "1", "2"], "natural")'],seealso:["map","filter","forEach"]},squeeze:{name:"squeeze",category:"Matrix",syntax:["squeeze(x)"],description:"Remove inner and outer singleton dimensions from a matrix.",examples:["a = zeros(3,2,1)","size(squeeze(a))","b = zeros(1,1,3)","size(squeeze(b))"],seealso:["concat","det","diag","identity","inv","ones","range","size","subset","trace","transpose","zeros"]},subset:{name:"subset",category:"Matrix",syntax:["value(index)","value(index) = replacement","subset(value, [index])","subset(value, [index], replacement)"],description:"Get or set a subset of the entries of a matrix or characters of a string. Indexes are one-based. There should be one index specification for each dimension of the target. Each specification can be a single index, a list of indices, or a range in colon notation `l:u`. In a range, both the lower bound l and upper bound u are included; and if a bound is omitted it defaults to the most extreme valid value. The cartesian product of the indices specified in each dimension determines the target of the operation.",examples:["d = [1, 2; 3, 4]","e = []","e[1, 1:2] = [5, 6]","e[2, :] = [7, 8]","f = d * e","f[2, 1]","f[:, 1]","f[[1,2], [1,3]] = [9, 10; 11, 12]","f"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","trace","transpose","zeros"]},trace:{name:"trace",category:"Matrix",syntax:["trace(A)"],description:"Calculate the trace of a matrix: the sum of the elements on the main diagonal of a square matrix.",examples:["A = [1, 2, 3; -1, 2, 3; 2, 0, 3]","trace(A)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","transpose","zeros"]},transpose:{name:"transpose",category:"Matrix",syntax:["x'","transpose(x)"],description:"Transpose a matrix",examples:["a = [1, 2, 3; 4, 5, 6]","a'","transpose(a)"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","zeros"]},zeros:{name:"zeros",category:"Matrix",syntax:["zeros(m)","zeros(m, n)","zeros(m, n, p, ...)","zeros([m])","zeros([m, n])","zeros([m, n, p, ...])"],description:"Create a matrix containing zeros.",examples:["zeros(3)","zeros(3, 5)","a = [1, 2, 3; 4, 5, 6]","zeros(size(a))"],seealso:["concat","det","diag","identity","inv","ones","range","size","squeeze","subset","trace","transpose"]},fft:{name:"fft",category:"Matrix",syntax:["fft(x)"],description:"Calculate N-dimensional fourier transform",examples:["fft([[1, 0], [1, 0]])"],seealso:["ifft"]},ifft:{name:"ifft",category:"Matrix",syntax:["ifft(x)"],description:"Calculate N-dimensional inverse fourier transform",examples:["ifft([[2, 2], [0, 0]])"],seealso:["fft"]},sylvester:{name:"sylvester",category:"Algebra",syntax:["sylvester(A,B,C)"],description:"Solves the real-valued Sylvester equation AX+XB=C for X",examples:["sylvester([[-1, -2], [1, 1]], [[-2, 1], [-1, 2]], [[-3, 2], [3, 0]])","A = [[-1, -2], [1, 1]]; B = [[2, -1], [1, -2]]; C = [[-3, 2], [3, 0]]","sylvester(A, B, C)"],seealso:["schur","lyap"]},schur:{name:"schur",category:"Algebra",syntax:["schur(A)"],description:"Performs a real Schur decomposition of the real matrix A = UTU'",examples:["schur([[1, 0], [-4, 3]])","A = [[1, 0], [-4, 3]]","schur(A)"],seealso:["lyap","sylvester"]},lyap:{name:"lyap",category:"Algebra",syntax:["lyap(A,Q)"],description:"Solves the Continuous-time Lyapunov equation AP+PA'+Q=0 for P",examples:["lyap([[-2, 0], [1, -4]], [[3, 1], [1, 3]])","A = [[-2, 0], [1, -4]]","Q = [[3, 1], [1, 3]]","lyap(A,Q)"],seealso:["schur","sylvester"]},solveODE:{name:"solveODE",category:"Numeric",syntax:["solveODE(func, tspan, y0)","solveODE(func, tspan, y0, options)"],description:"Numerical Integration of Ordinary Differential Equations.",examples:["f(t,y) = y","tspan = [0, 4]","solveODE(f, tspan, 1)","solveODE(f, tspan, [1, 2])",'solveODE(f, tspan, 1, { method:"RK23", maxStep:0.1 })'],seealso:["derivative","simplifyCore"]},combinations:{name:"combinations",category:"Probability",syntax:["combinations(n, k)"],description:"Compute the number of combinations of n items taken k at a time",examples:["combinations(7, 5)"],seealso:["combinationsWithRep","permutations","factorial"]},combinationsWithRep:{name:"combinationsWithRep",category:"Probability",syntax:["combinationsWithRep(n, k)"],description:"Compute the number of combinations of n items taken k at a time with replacements.",examples:["combinationsWithRep(7, 5)"],seealso:["combinations","permutations","factorial"]},factorial:{name:"factorial",category:"Probability",syntax:["n!","factorial(n)"],description:"Compute the factorial of a value",examples:["5!","5 * 4 * 3 * 2 * 1","3!"],seealso:["combinations","combinationsWithRep","permutations","gamma"]},gamma:{name:"gamma",category:"Probability",syntax:["gamma(n)"],description:"Compute the gamma function. For small values, the Lanczos approximation is used, and for large values the extended Stirling approximation.",examples:["gamma(4)","3!","gamma(1/2)","sqrt(pi)"],seealso:["factorial"]},kldivergence:{name:"kldivergence",category:"Probability",syntax:["kldivergence(x, y)"],description:"Calculate the Kullback-Leibler (KL) divergence  between two distributions.",examples:["kldivergence([0.7,0.5,0.4], [0.2,0.9,0.5])"],seealso:[]},lgamma:{name:"lgamma",category:"Probability",syntax:["lgamma(n)"],description:"Logarithm of the gamma function for real, positive numbers and complex numbers, using Lanczos approximation for numbers and Stirling series for complex numbers.",examples:["lgamma(4)","lgamma(1/2)","lgamma(i)","lgamma(complex(1.1, 2))"],seealso:["gamma"]},multinomial:{name:"multinomial",category:"Probability",syntax:["multinomial(A)"],description:"Multinomial Coefficients compute the number of ways of picking a1, a2, ..., ai unordered outcomes from `n` possibilities. multinomial takes one array of integers as an argument. The following condition must be enforced: every ai > 0.",examples:["multinomial([1, 2, 1])"],seealso:["combinations","factorial"]},permutations:{name:"permutations",category:"Probability",syntax:["permutations(n)","permutations(n, k)"],description:"Compute the number of permutations of n items taken k at a time",examples:["permutations(5)","permutations(5, 3)"],seealso:["combinations","combinationsWithRep","factorial"]},pickRandom:{name:"pickRandom",category:"Probability",syntax:["pickRandom(array)","pickRandom(array, number)","pickRandom(array, weights)","pickRandom(array, number, weights)","pickRandom(array, weights, number)"],description:"Pick a random entry from a given array.",examples:["pickRandom(0:10)","pickRandom([1, 3, 1, 6])","pickRandom([1, 3, 1, 6], 2)","pickRandom([1, 3, 1, 6], [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], 2, [2, 3, 2, 1])","pickRandom([1, 3, 1, 6], [2, 3, 2, 1], 2)"],seealso:["random","randomInt"]},random:{name:"random",category:"Probability",syntax:["random()","random(max)","random(min, max)","random(size)","random(size, max)","random(size, min, max)"],description:"Return a random number.",examples:["random()","random(10, 20)","random([2, 3])"],seealso:["pickRandom","randomInt"]},randomInt:{name:"randomInt",category:"Probability",syntax:["randomInt(max)","randomInt(min, max)","randomInt(size)","randomInt(size, max)","randomInt(size, min, max)"],description:"Return a random integer number",examples:["randomInt(10, 20)","randomInt([2, 3], 10)"],seealso:["pickRandom","random"]},compare:{name:"compare",category:"Relational",syntax:["compare(x, y)"],description:"Compare two values. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compare(2, 3)","compare(3, 2)","compare(2, 2)","compare(5cm, 40mm)","compare(2, [1, 2, 3])"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compareNatural","compareText"]},compareNatural:{name:"compareNatural",category:"Relational",syntax:["compareNatural(x, y)"],description:"Compare two values of any type in a deterministic, natural way. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:["compareNatural(2, 3)","compareNatural(3, 2)","compareNatural(2, 2)","compareNatural(5cm, 40mm)",'compareNatural("2", "10")',"compareNatural(2 + 3i, 2 + 4i)","compareNatural([1, 2, 4], [1, 2, 3])","compareNatural([1, 5], [1, 2, 3])","compareNatural([1, 2], [1, 2])","compareNatural({a: 2}, {a: 4})"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare","compareText"]},compareText:{name:"compareText",category:"Relational",syntax:["compareText(x, y)"],description:"Compare two strings lexically. Comparison is case sensitive. Returns 1 when x > y, -1 when x < y, and 0 when x == y.",examples:['compareText("B", "A")','compareText("A", "B")','compareText("A", "A")','compareText("2", "10")','compare("2", "10")',"compare(2, 10)",'compareNatural("2", "10")','compareText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural"]},deepEqual:{name:"deepEqual",category:"Relational",syntax:["deepEqual(x, y)"],description:"Check equality of two matrices element wise. Returns true if the size of both matrices is equal and when and each of the elements are equal.",examples:["deepEqual([1,3,4], [1,3,4])","deepEqual([1,3,4], [1,3])"],seealso:["equal","unequal","smaller","larger","smallerEq","largerEq","compare"]},equal:{name:"equal",category:"Relational",syntax:["x == y","equal(x, y)"],description:"Check equality of two values. Returns true if the values are equal, and false if not.",examples:["2+2 == 3","2+2 == 4","a = 3.2","b = 6-2.8","a == b","50cm == 0.5m"],seealso:["unequal","smaller","larger","smallerEq","largerEq","compare","deepEqual","equalText"]},equalText:{name:"equalText",category:"Relational",syntax:["equalText(x, y)"],description:"Check equality of two strings. Comparison is case sensitive. Returns true if the values are equal, and false if not.",examples:['equalText("Hello", "Hello")','equalText("a", "A")','equal("2e3", "2000")','equalText("2e3", "2000")','equalText("B", ["A", "B", "C"])'],seealso:["compare","compareNatural","compareText","equal"]},larger:{name:"larger",category:"Relational",syntax:["x > y","larger(x, y)"],description:"Check if value x is larger than y. Returns true if x is larger than y, and false if not.",examples:["2 > 3","5 > 2*2","a = 3.3","b = 6-2.8","(a > b)","(b < a)","5 cm > 2 inch"],seealso:["equal","unequal","smaller","smallerEq","largerEq","compare"]},largerEq:{name:"largerEq",category:"Relational",syntax:["x >= y","largerEq(x, y)"],description:"Check if value x is larger or equal to y. Returns true if x is larger or equal to y, and false if not.",examples:["2 >= 1+1","2 > 1+1","a = 3.2","b = 6-2.8","(a >= b)"],seealso:["equal","unequal","smallerEq","smaller","compare"]},smaller:{name:"smaller",category:"Relational",syntax:["x < y","smaller(x, y)"],description:"Check if value x is smaller than value y. Returns true if x is smaller than y, and false if not.",examples:["2 < 3","5 < 2*2","a = 3.3","b = 6-2.8","(a < b)","5 cm < 2 inch"],seealso:["equal","unequal","larger","smallerEq","largerEq","compare"]},smallerEq:{name:"smallerEq",category:"Relational",syntax:["x <= y","smallerEq(x, y)"],description:"Check if value x is smaller or equal to value y. Returns true if x is smaller than y, and false if not.",examples:["2 <= 1+1","2 < 1+1","a = 3.2","b = 6-2.8","(a <= b)"],seealso:["equal","unequal","larger","smaller","largerEq","compare"]},unequal:{name:"unequal",category:"Relational",syntax:["x != y","unequal(x, y)"],description:"Check unequality of two values. Returns true if the values are unequal, and false if they are equal.",examples:["2+2 != 3","2+2 != 4","a = 3.2","b = 6-2.8","a != b","50cm != 0.5m","5 cm != 2 inch"],seealso:["equal","smaller","larger","smallerEq","largerEq","compare","deepEqual"]},setCartesian:{name:"setCartesian",category:"Set",syntax:["setCartesian(set1, set2)"],description:"Create the cartesian product of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays and the values will be sorted in ascending order before the operation.",examples:["setCartesian([1, 2], [3, 4])"],seealso:["setUnion","setIntersect","setDifference","setPowerset"]},setDifference:{name:"setDifference",category:"Set",syntax:["setDifference(set1, set2)"],description:"Create the difference of two (multi)sets: every element of set1, that is not the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setDifference([1, 2, 3, 4], [3, 4, 5, 6])","setDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setSymDifference"]},setDistinct:{name:"setDistinct",category:"Set",syntax:["setDistinct(set)"],description:"Collect the distinct elements of a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setDistinct([1, 1, 1, 2, 2, 3])"],seealso:["setMultiplicity"]},setIntersect:{name:"setIntersect",category:"Set",syntax:["setIntersect(set1, set2)"],description:"Create the intersection of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIntersect([1, 2, 3, 4], [3, 4, 5, 6])","setIntersect([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setDifference"]},setIsSubset:{name:"setIsSubset",category:"Set",syntax:["setIsSubset(set1, set2)"],description:"Check whether a (multi)set is a subset of another (multi)set: every element of set1 is the element of set2. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setIsSubset([1, 2], [3, 4, 5, 6])","setIsSubset([3, 4], [3, 4, 5, 6])"],seealso:["setUnion","setIntersect","setDifference"]},setMultiplicity:{name:"setMultiplicity",category:"Set",syntax:["setMultiplicity(element, set)"],description:"Count the multiplicity of an element in a multiset. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setMultiplicity(1, [1, 2, 2, 4])","setMultiplicity(2, [1, 2, 2, 4])"],seealso:["setDistinct","setSize"]},setPowerset:{name:"setPowerset",category:"Set",syntax:["setPowerset(set)"],description:"Create the powerset of a (multi)set: the powerset contains very possible subsets of a (multi)set. A multi-dimension array will be converted to a single-dimension array before the operation.",examples:["setPowerset([1, 2, 3])"],seealso:["setCartesian"]},setSize:{name:"setSize",category:"Set",syntax:["setSize(set)","setSize(set, unique)"],description:'Count the number of elements of a (multi)set. When the second parameter "unique" is true, count only the unique values. A multi-dimension array will be converted to a single-dimension array before the operation.',examples:["setSize([1, 2, 2, 4])","setSize([1, 2, 2, 4], true)"],seealso:["setUnion","setIntersect","setDifference"]},setSymDifference:{name:"setSymDifference",category:"Set",syntax:["setSymDifference(set1, set2)"],description:"Create the symmetric difference of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setSymDifference([1, 2, 3, 4], [3, 4, 5, 6])","setSymDifference([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setUnion","setIntersect","setDifference"]},setUnion:{name:"setUnion",category:"Set",syntax:["setUnion(set1, set2)"],description:"Create the union of two (multi)sets. Multi-dimension arrays will be converted to single-dimension arrays before the operation.",examples:["setUnion([1, 2, 3, 4], [3, 4, 5, 6])","setUnion([[1, 2], [3, 4]], [[3, 4], [5, 6]])"],seealso:["setIntersect","setDifference"]},zpk2tf:{name:"zpk2tf",category:"Signal",syntax:["zpk2tf(z, p, k)"],description:"Compute the transfer function of a zero-pole-gain model.",examples:["zpk2tf([1, 2], [-1, -2], 1)","zpk2tf([1, 2], [-1, -2])","zpk2tf([1 - 3i, 2 + 2i], [-1, -2])"],seealso:[]},freqz:{name:"freqz",category:"Signal",syntax:["freqz(b, a)","freqz(b, a, w)"],description:"Calculates the frequency response of a filter given its numerator and denominator coefficients.",examples:["freqz([1, 2], [1, 2, 3])","freqz([1, 2], [1, 2, 3], [0, 1])","freqz([1, 2], [1, 2, 3], 512)"],seealso:[]},erf:{name:"erf",category:"Special",syntax:["erf(x)"],description:"Compute the erf function of a value using a rational Chebyshev approximations for different intervals of x",examples:["erf(0.2)","erf(-0.5)","erf(4)"],seealso:[]},cumsum:{name:"cumsum",category:"Statistics",syntax:["cumsum(a, b, c, ...)","cumsum(A)"],description:"Compute the cumulative sum of all values.",examples:["cumsum(2, 3, 4, 1)","cumsum([2, 3, 4, 1])","cumsum([1, 2; 3, 4])","cumsum([1, 2; 3, 4], 1)","cumsum([1, 2; 3, 4], 2)"],seealso:["max","mean","median","min","prod","std","sum","variance"]},mad:{name:"mad",category:"Statistics",syntax:["mad(a, b, c, ...)","mad(A)"],description:"Compute the median absolute deviation of a matrix or a list with values. The median absolute deviation is defined as the median of the absolute deviations from the median.",examples:["mad(10, 20, 30)","mad([1, 2, 3])"],seealso:["mean","median","std","abs"]},max:{name:"max",category:"Statistics",syntax:["max(a, b, c, ...)","max(A)","max(A, dimension)"],description:"Compute the maximum value of a list of values.",examples:["max(2, 3, 4, 1)","max([2, 3, 4, 1])","max([2, 5; 4, 3])","max([2, 5; 4, 3], 1)","max([2, 5; 4, 3], 2)","max(2.7, 7.1, -4.5, 2.0, 4.1)","min(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["mean","median","min","prod","std","sum","variance"]},mean:{name:"mean",category:"Statistics",syntax:["mean(a, b, c, ...)","mean(A)","mean(A, dimension)"],description:"Compute the arithmetic mean of a list of values.",examples:["mean(2, 3, 4, 1)","mean([2, 3, 4, 1])","mean([2, 5; 4, 3])","mean([2, 5; 4, 3], 1)","mean([2, 5; 4, 3], 2)","mean([1.0, 2.7, 3.2, 4.0])"],seealso:["max","median","min","prod","std","sum","variance"]},median:{name:"median",category:"Statistics",syntax:["median(a, b, c, ...)","median(A)"],description:"Compute the median of all values. The values are sorted and the middle value is returned. In case of an even number of values, the average of the two middle values is returned.",examples:["median(5, 2, 7)","median([3, -1, 5, 7])"],seealso:["max","mean","min","prod","std","sum","variance","quantileSeq"]},min:{name:"min",category:"Statistics",syntax:["min(a, b, c, ...)","min(A)","min(A, dimension)"],description:"Compute the minimum value of a list of values.",examples:["min(2, 3, 4, 1)","min([2, 3, 4, 1])","min([2, 5; 4, 3])","min([2, 5; 4, 3], 1)","min([2, 5; 4, 3], 2)","min(2.7, 7.1, -4.5, 2.0, 4.1)","max(2.7, 7.1, -4.5, 2.0, 4.1)"],seealso:["max","mean","median","prod","std","sum","variance"]},mode:{name:"mode",category:"Statistics",syntax:["mode(a, b, c, ...)","mode(A)","mode(A, a, b, B, c, ...)"],description:"Computes the mode of all values as an array. In case mode being more than one, multiple values are returned in an array.",examples:["mode(2, 1, 4, 3, 1)","mode([1, 2.7, 3.2, 4, 2.7])","mode(1, 4, 6, 1, 6)"],seealso:["max","mean","min","median","prod","std","sum","variance"]},prod:{name:"prod",category:"Statistics",syntax:["prod(a, b, c, ...)","prod(A)"],description:"Compute the product of all values.",examples:["prod(2, 3, 4)","prod([2, 3, 4])","prod([2, 5; 4, 3])"],seealso:["max","mean","min","median","min","std","sum","variance"]},quantileSeq:{name:"quantileSeq",category:"Statistics",syntax:["quantileSeq(A, prob[, sorted])","quantileSeq(A, [prob1, prob2, ...][, sorted])","quantileSeq(A, N[, sorted])"],description:"Compute the prob order quantile of a matrix or a list with values. The sequence is sorted and the middle value is returned. Supported types of sequence values are: Number, BigNumber, Unit Supported types of probablity are: Number, BigNumber. \n\nIn case of a (multi dimensional) array or matrix, the prob order quantile of all elements will be calculated.",examples:["quantileSeq([3, -1, 5, 7], 0.5)","quantileSeq([3, -1, 5, 7], [1/3, 2/3])","quantileSeq([3, -1, 5, 7], 2)","quantileSeq([-1, 3, 5, 7], 0.5, true)"],seealso:["mean","median","min","max","prod","std","sum","variance"]},std:{name:"std",category:"Statistics",syntax:["std(a, b, c, ...)","std(A)","std(A, dimension)","std(A, normalization)","std(A, dimension, normalization)"],description:'Compute the standard deviation of all values, defined as std(A) = sqrt(variance(A)). Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["std(2, 4, 6)","std([2, 4, 6, 8])",'std([2, 4, 6, 8], "uncorrected")','std([2, 4, 6, 8], "biased")',"std([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","prod","sum","variance"]},sum:{name:"sum",category:"Statistics",syntax:["sum(a, b, c, ...)","sum(A)","sum(A, dimension)"],description:"Compute the sum of all values.",examples:["sum(2, 3, 4, 1)","sum([2, 3, 4, 1])","sum([2, 5; 4, 3])"],seealso:["max","mean","median","min","prod","std","sum","variance"]},variance:{name:"variance",category:"Statistics",syntax:["variance(a, b, c, ...)","variance(A)","variance(A, dimension)","variance(A, normalization)","variance(A, dimension, normalization)"],description:'Compute the variance of all values. Optional parameter normalization can be "unbiased" (default), "uncorrected", or "biased".',examples:["variance(2, 4, 6)","variance([2, 4, 6, 8])",'variance([2, 4, 6, 8], "uncorrected")','variance([2, 4, 6, 8], "biased")',"variance([1, 2, 3; 4, 5, 6])"],seealso:["max","mean","min","median","min","prod","std","sum"]},acos:{name:"acos",category:"Trigonometry",syntax:["acos(x)"],description:"Compute the inverse cosine of a value in radians.",examples:["acos(0.5)","acos(cos(2.3))"],seealso:["cos","atan","asin"]},acosh:{name:"acosh",category:"Trigonometry",syntax:["acosh(x)"],description:"Calculate the hyperbolic arccos of a value, defined as `acosh(x) = ln(sqrt(x^2 - 1) + x)`.",examples:["acosh(1.5)"],seealso:["cosh","asinh","atanh"]},acot:{name:"acot",category:"Trigonometry",syntax:["acot(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acot(0.5)","acot(cot(0.5))","acot(2)"],seealso:["cot","atan"]},acoth:{name:"acoth",category:"Trigonometry",syntax:["acoth(x)"],description:"Calculate the hyperbolic arccotangent of a value, defined as `acoth(x) = (ln((x+1)/x) + ln(x/(x-1))) / 2`.",examples:["acoth(2)","acoth(0.5)"],seealso:["acsch","asech"]},acsc:{name:"acsc",category:"Trigonometry",syntax:["acsc(x)"],description:"Calculate the inverse cotangent of a value.",examples:["acsc(2)","acsc(csc(0.5))","acsc(0.5)"],seealso:["csc","asin","asec"]},acsch:{name:"acsch",category:"Trigonometry",syntax:["acsch(x)"],description:"Calculate the hyperbolic arccosecant of a value, defined as `acsch(x) = ln(1/x + sqrt(1/x^2 + 1))`.",examples:["acsch(0.5)"],seealso:["asech","acoth"]},asec:{name:"asec",category:"Trigonometry",syntax:["asec(x)"],description:"Calculate the inverse secant of a value.",examples:["asec(0.5)","asec(sec(0.5))","asec(2)"],seealso:["acos","acot","acsc"]},asech:{name:"asech",category:"Trigonometry",syntax:["asech(x)"],description:"Calculate the inverse secant of a value.",examples:["asech(0.5)"],seealso:["acsch","acoth"]},asin:{name:"asin",category:"Trigonometry",syntax:["asin(x)"],description:"Compute the inverse sine of a value in radians.",examples:["asin(0.5)","asin(sin(0.5))"],seealso:["sin","acos","atan"]},asinh:{name:"asinh",category:"Trigonometry",syntax:["asinh(x)"],description:"Calculate the hyperbolic arcsine of a value, defined as `asinh(x) = ln(x + sqrt(x^2 + 1))`.",examples:["asinh(0.5)"],seealso:["acosh","atanh"]},atan:{name:"atan",category:"Trigonometry",syntax:["atan(x)"],description:"Compute the inverse tangent of a value in radians.",examples:["atan(0.5)","atan(tan(0.5))"],seealso:["tan","acos","asin"]},atanh:{name:"atanh",category:"Trigonometry",syntax:["atanh(x)"],description:"Calculate the hyperbolic arctangent of a value, defined as `atanh(x) = ln((1 + x)/(1 - x)) / 2`.",examples:["atanh(0.5)"],seealso:["acosh","asinh"]},atan2:{name:"atan2",category:"Trigonometry",syntax:["atan2(y, x)"],description:"Computes the principal value of the arc tangent of y/x in radians.",examples:["atan2(2, 2) / pi","angle = 60 deg in rad","x = cos(angle)","y = sin(angle)","atan2(y, x)"],seealso:["sin","cos","tan"]},cos:{name:"cos",category:"Trigonometry",syntax:["cos(x)"],description:"Compute the cosine of x in radians.",examples:["cos(2)","cos(pi / 4) ^ 2","cos(180 deg)","cos(60 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["acos","sin","tan"]},cosh:{name:"cosh",category:"Trigonometry",syntax:["cosh(x)"],description:"Compute the hyperbolic cosine of x in radians.",examples:["cosh(0.5)"],seealso:["sinh","tanh","coth"]},cot:{name:"cot",category:"Trigonometry",syntax:["cot(x)"],description:"Compute the cotangent of x in radians. Defined as 1/tan(x)",examples:["cot(2)","1 / tan(2)"],seealso:["sec","csc","tan"]},coth:{name:"coth",category:"Trigonometry",syntax:["coth(x)"],description:"Compute the hyperbolic cotangent of x in radians.",examples:["coth(2)","1 / tanh(2)"],seealso:["sech","csch","tanh"]},csc:{name:"csc",category:"Trigonometry",syntax:["csc(x)"],description:"Compute the cosecant of x in radians. Defined as 1/sin(x)",examples:["csc(2)","1 / sin(2)"],seealso:["sec","cot","sin"]},csch:{name:"csch",category:"Trigonometry",syntax:["csch(x)"],description:"Compute the hyperbolic cosecant of x in radians. Defined as 1/sinh(x)",examples:["csch(2)","1 / sinh(2)"],seealso:["sech","coth","sinh"]},sec:{name:"sec",category:"Trigonometry",syntax:["sec(x)"],description:"Compute the secant of x in radians. Defined as 1/cos(x)",examples:["sec(2)","1 / cos(2)"],seealso:["cot","csc","cos"]},sech:{name:"sech",category:"Trigonometry",syntax:["sech(x)"],description:"Compute the hyperbolic secant of x in radians. Defined as 1/cosh(x)",examples:["sech(2)","1 / cosh(2)"],seealso:["coth","csch","cosh"]},sin:{name:"sin",category:"Trigonometry",syntax:["sin(x)"],description:"Compute the sine of x in radians.",examples:["sin(2)","sin(pi / 4) ^ 2","sin(90 deg)","sin(30 deg)","sin(0.2)^2 + cos(0.2)^2"],seealso:["asin","cos","tan"]},sinh:{name:"sinh",category:"Trigonometry",syntax:["sinh(x)"],description:"Compute the hyperbolic sine of x in radians.",examples:["sinh(0.5)"],seealso:["cosh","tanh"]},tan:{name:"tan",category:"Trigonometry",syntax:["tan(x)"],description:"Compute the tangent of x in radians.",examples:["tan(0.5)","sin(0.5) / cos(0.5)","tan(pi / 4)","tan(45 deg)"],seealso:["atan","sin","cos"]},tanh:{name:"tanh",category:"Trigonometry",syntax:["tanh(x)"],description:"Compute the hyperbolic tangent of x in radians.",examples:["tanh(0.5)","sinh(0.5) / cosh(0.5)"],seealso:["sinh","cosh"]},to:{name:"to",category:"Units",syntax:["x to unit","to(x, unit)"],description:"Change the unit of a value.",examples:["5 inch to cm","3.2kg to g","16 bytes in bits"],seealso:[]},clone:{name:"clone",category:"Utils",syntax:["clone(x)"],description:"Clone a variable. Creates a copy of primitive variables,and a deep copy of matrices",examples:["clone(3.5)","clone(2 - 4i)","clone(45 deg)","clone([1, 2; 3, 4])",'clone("hello world")'],seealso:[]},format:{name:"format",category:"Utils",syntax:["format(value)","format(value, precision)"],description:"Format a value of any type as string.",examples:["format(2.3)","format(3 - 4i)","format([])","format(pi, 3)"],seealso:["print"]},bin:{name:"bin",category:"Utils",syntax:["bin(value)"],description:"Format a number as binary",examples:["bin(2)"],seealso:["oct","hex"]},oct:{name:"oct",category:"Utils",syntax:["oct(value)"],description:"Format a number as octal",examples:["oct(56)"],seealso:["bin","hex"]},hex:{name:"hex",category:"Utils",syntax:["hex(value)"],description:"Format a number as hexadecimal",examples:["hex(240)"],seealso:["bin","oct"]},isNaN:{name:"isNaN",category:"Utils",syntax:["isNaN(x)"],description:"Test whether a value is NaN (not a number)",examples:["isNaN(2)","isNaN(0 / 0)","isNaN(NaN)","isNaN(Infinity)"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isInteger:{name:"isInteger",category:"Utils",syntax:["isInteger(x)"],description:"Test whether a value is an integer number.",examples:["isInteger(2)","isInteger(3.5)","isInteger([3, 0.5, -2])"],seealso:["isNegative","isNumeric","isPositive","isZero"]},isNegative:{name:"isNegative",category:"Utils",syntax:["isNegative(x)"],description:"Test whether a value is negative: smaller than zero.",examples:["isNegative(2)","isNegative(0)","isNegative(-4)","isNegative([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isPositive","isZero"]},isNumeric:{name:"isNumeric",category:"Utils",syntax:["isNumeric(x)"],description:"Test whether a value is a numeric value. Returns true when the input is a number, BigNumber, Fraction, or boolean.",examples:["isNumeric(2)",'isNumeric("2")','hasNumericValue("2")',"isNumeric(0)","isNumeric(bignumber(500))","isNumeric(fraction(0.125))","isNumeric(2 + 3i)",'isNumeric([2.3, "foo", false])'],seealso:["isInteger","isZero","isNegative","isPositive","isNaN","hasNumericValue"]},hasNumericValue:{name:"hasNumericValue",category:"Utils",syntax:["hasNumericValue(x)"],description:"Test whether a value is an numeric value. In case of a string, true is returned if the string contains a numeric value.",examples:["hasNumericValue(2)",'hasNumericValue("2")','isNumeric("2")',"hasNumericValue(0)","hasNumericValue(bignumber(500))","hasNumericValue(fraction(0.125))","hasNumericValue(2 + 3i)",'hasNumericValue([2.3, "foo", false])'],seealso:["isInteger","isZero","isNegative","isPositive","isNaN","isNumeric"]},isPositive:{name:"isPositive",category:"Utils",syntax:["isPositive(x)"],description:"Test whether a value is positive: larger than zero.",examples:["isPositive(2)","isPositive(0)","isPositive(-4)","isPositive([3, 0.5, -2])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isPrime:{name:"isPrime",category:"Utils",syntax:["isPrime(x)"],description:"Test whether a value is prime: has no divisors other than itself and one.",examples:["isPrime(3)","isPrime(-2)","isPrime([2, 17, 100])"],seealso:["isInteger","isNumeric","isNegative","isZero"]},isZero:{name:"isZero",category:"Utils",syntax:["isZero(x)"],description:"Test whether a value is zero.",examples:["isZero(2)","isZero(0)","isZero(-4)","isZero([3, 0, -2, 0])"],seealso:["isInteger","isNumeric","isNegative","isPositive"]},print:{name:"print",category:"Utils",syntax:["print(template, values)","print(template, values, precision)"],description:"Interpolate values into a string template.",examples:['print("Lucy is $age years old", {age: 5})','print("The value of pi is $pi", {pi: pi}, 3)','print("Hello, $user.name!", {user: {name: "John"}})','print("Values: $0, $1, $2", [6, 9, 4])'],seealso:["format"]},typeOf:{name:"typeOf",category:"Utils",syntax:["typeOf(x)"],description:"Get the type of a variable.",examples:["typeOf(3.5)","typeOf(2 - 4i)","typeOf(45 deg)",'typeOf("hello world")'],seealso:["getMatrixDataType"]},numeric:{name:"numeric",category:"Utils",syntax:["numeric(x)"],description:"Convert a numeric input to a specific numeric type: number, BigNumber, or Fraction.",examples:['numeric("4")','numeric("4", "number")','numeric("4", "BigNumber")','numeric("4", "Fraction")','numeric(4, "Fraction")','numeric(fraction(2, 5), "number")'],seealso:["number","fraction","bignumber","string","format"]}},FT="help",LT=BD(FT,["typed","mathWithTransform","Help"],(e=>{var{typed:t,mathWithTransform:r,Help:n}=e;return t(FT,{any:function(e){var t,i=e;if("string"!=typeof e)for(t in r)if(PD(r,t)&&e===r[t]){i=t;break}var s=$D(OT,i);if(!s){var a="function"==typeof i?i.name:i;throw new Error('No documentation found on "'+a+'"')}return new n(s)}})})),_T=BD("Parser",["evaluate"],(e=>{var{evaluate:t}=e;function r(){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");Object.defineProperty(this,"scope",{value:WD(),writable:!1})}return r.prototype.type="Parser",r.prototype.isParser=!0,r.prototype.evaluate=function(e){return t(e,this.scope)},r.prototype.get=function(e){if(this.scope.has(e))return this.scope.get(e)},r.prototype.getAll=function(){return function(e){if(e instanceof KD)return e.wrappedObject;var t={};for(var r of e.keys())zD(t,r,e.get(r));return t}(this.scope)},r.prototype.getAllAsMap=function(){return this.scope},r.prototype.set=function(e,t){return this.scope.set(e,t),t},r.prototype.remove=function(e){this.scope.delete(e)},r.prototype.clear=function(){this.scope.clear()},r}),{isClass:!0});function RT(e){return bD(e)||TD(e)&&e.isUnary()&&bD(e.args[0])}function IT(e){return!!bD(e)||(!(!ED(e)&&!TD(e)||!e.args.every(IT))||!(!CD(e)||!IT(e.content)))}var PT=BD("simplify",["config","typed","parse","add","subtract","multiply","divide","pow","isZero","equal","resolve","simplifyConstant","simplifyCore","?fraction","?bignumber","mathWithTransform","matrix","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","ParenthesisNode","SymbolNode"],(e=>{var{config:t,typed:r,parse:n,add:i,subtract:s,multiply:a,divide:o,pow:l,isZero:u,equal:c,resolve:d,simplifyConstant:h,simplifyCore:f,fraction:p,bignumber:m,mathWithTransform:g,matrix:y,AccessorNode:v,ArrayNode:b,ConstantNode:w,FunctionNode:x,IndexNode:E,ObjectNode:D,OperatorNode:S,ParenthesisNode:A,SymbolNode:T}=e,{hasProperty:C,isCommutative:N,isAssociative:k,mergeContext:M,flatten:O,unflattenr:F,unflattenl:L,createMakeNodeFunction:_,defaultContext:R,realContext:I,positiveContext:P}=uT({FunctionNode:x,OperatorNode:S,SymbolNode:T});r.addConversion({from:"Object",to:"Map",convert:YD});var B=r("simplify",{Node:H,"Node, Map":(e,t)=>H(e,!1,t),"Node, Map, Object":(e,t,r)=>H(e,!1,t,r),"Node, Array":H,"Node, Array, Map":H,"Node, Array, Map, Object":H});function U(e){return e.transform((function(e,t,r){return CD(e)?U(e.content):e}))}r.removeConversion({from:"Object",to:"Map",convert:YD}),B.defaultContext=R,B.realContext=I,B.positiveContext=P;var $={true:!0,false:!0,e:!0,i:!0,Infinity:!0,LN2:!0,LN10:!0,LOG2E:!0,LOG10E:!0,NaN:!0,phi:!0,pi:!0,SQRT1_2:!0,SQRT2:!0,tau:!0};function z(e,t){var r={};if(e.s){var i=e.s.split("->");if(2!==i.length)throw SyntaxError("Could not parse rule: "+e.s);r.l=i[0],r.r=i[1]}else r.l=e.l,r.r=e.r;for(var s of(r.l=U(n(r.l)),r.r=U(n(r.r)),["imposeContext","repeat","assuming"]))s in e&&(r[s]=e[s]);if(e.evaluate&&(r.evaluate=n(e.evaluate)),k(r.l,t)){var a,o=!N(r.l,t);o&&(a=q());var l=_(r.l),u=q();r.expanded={},r.expanded.l=l([r.l,u]),O(r.expanded.l,t),F(r.expanded.l,t),r.expanded.r=l([r.r,u]),o&&(r.expandedNC1={},r.expandedNC1.l=l([a,r.l]),r.expandedNC1.r=l([a,r.r]),r.expandedNC2={},r.expandedNC2.l=l([a,r.expanded.l]),r.expandedNC2.r=l([a,r.expanded.r]))}return r}B.rules=[f,{l:"log(e)",r:"1"},{s:"n-n1 -> n+-n1",assuming:{subtract:{total:!0}}},{s:"n-n -> 0",assuming:{subtract:{total:!1}}},{s:"-(cl*v) -> v * (-cl)",assuming:{multiply:{commutative:!0},subtract:{total:!0}}},{s:"-(cl*v) -> (-cl) * v",assuming:{multiply:{commutative:!1},subtract:{total:!0}}},{s:"-(v*cl) -> v * (-cl)",assuming:{multiply:{commutative:!1},subtract:{total:!0}}},{l:"-(n1/n2)",r:"-n1/n2"},{l:"-v",r:"v * (-1)"},{l:"(n1 + n2)*(-1)",r:"n1*(-1) + n2*(-1)",repeat:!0},{l:"n/n1^n2",r:"n*n1^-n2"},{l:"n/n1",r:"n*n1^-1"},{s:"(n1*n2)^n3 -> n1^n3 * n2^n3",assuming:{multiply:{commutative:!0}}},{s:"(n1*n2)^(-1) -> n2^(-1) * n1^(-1)",assuming:{multiply:{commutative:!1}}},{s:"(n ^ n1) ^ n2 -> n ^ (n1 * n2)",assuming:{divide:{total:!0}}},{l:" vd   * ( vd   * n1 + n2)",r:"vd^2       * n1 +  vd   * n2"},{s:" vd   * (vd^n4 * n1 + n2)   ->  vd^(1+n4)  * n1 +  vd   * n2",assuming:{divide:{total:!0}}},{s:"vd^n3 * ( vd   * n1 + n2)   ->  vd^(n3+1)  * n1 + vd^n3 * n2",assuming:{divide:{total:!0}}},{s:"vd^n3 * (vd^n4 * n1 + n2)   ->  vd^(n3+n4) * n1 + vd^n3 * n2",assuming:{divide:{total:!0}}},{l:"n*n",r:"n^2"},{s:"n * n^n1 -> n^(n1+1)",assuming:{divide:{total:!0}}},{s:"n^n1 * n^n2 -> n^(n1+n2)",assuming:{divide:{total:!0}}},h,{s:"n+n -> 2*n",assuming:{add:{total:!0}}},{l:"n+-n",r:"0"},{l:"vd*n + vd",r:"vd*(n+1)"},{l:"n3*n1 + n3*n2",r:"n3*(n1+n2)"},{l:"n3^(-n4)*n1 +   n3  * n2",r:"n3^(-n4)*(n1 + n3^(n4+1) *n2)"},{l:"n3^(-n4)*n1 + n3^n5 * n2",r:"n3^(-n4)*(n1 + n3^(n4+n5)*n2)"},{s:"n*vd + vd -> (n+1)*vd",assuming:{multiply:{commutative:!1}}},{s:"vd + n*vd -> (1+n)*vd",assuming:{multiply:{commutative:!1}}},{s:"n1*n3 + n2*n3 -> (n1+n2)*n3",assuming:{multiply:{commutative:!1}}},{s:"n^n1 * n -> n^(n1+1)",assuming:{divide:{total:!0},multiply:{commutative:!1}}},{s:"n1*n3^(-n4) + n2 * n3    -> (n1 + n2*n3^(n4 +  1))*n3^(-n4)",assuming:{multiply:{commutative:!1}}},{s:"n1*n3^(-n4) + n2 * n3^n5 -> (n1 + n2*n3^(n4 + n5))*n3^(-n4)",assuming:{multiply:{commutative:!1}}},{l:"n*cd + cd",r:"(n+1)*cd"},{s:"cd*n + cd -> cd*(n+1)",assuming:{multiply:{commutative:!1}}},{s:"cd + cd*n -> cd*(1+n)",assuming:{multiply:{commutative:!1}}},h,{s:"(-n)*n1 -> -(n*n1)",assuming:{subtract:{total:!0}}},{s:"n1*(-n) -> -(n1*n)",assuming:{subtract:{total:!0},multiply:{commutative:!1}}},{s:"ce+ve -> ve+ce",assuming:{add:{commutative:!0}},imposeContext:{add:{commutative:!1}}},{s:"vd*cd -> cd*vd",assuming:{multiply:{commutative:!0}},imposeContext:{multiply:{commutative:!1}}},{l:"n+-n1",r:"n-n1"},{l:"n+-(n1)",r:"n-(n1)"},{s:"n*(n1^-1) -> n/n1",assuming:{multiply:{commutative:!0}}},{s:"n*n1^-n2 -> n/n1^n2",assuming:{multiply:{commutative:!0}}},{s:"n^-1 -> 1/n",assuming:{multiply:{commutative:!0}}},{l:"n^1",r:"n"},{s:"n*(n1/n2) -> (n*n1)/n2",assuming:{multiply:{associative:!0}}},{s:"n-(n1+n2) -> n-n1-n2",assuming:{addition:{associative:!0,commutative:!0}}},{l:"1*n",r:"n",imposeContext:{multiply:{commutative:!0}}},{s:"n1/(n2/n3) -> (n1*n3)/n2",assuming:{multiply:{associative:!0}}},{l:"n1/(-n2)",r:"-n1/n2"}];var j=0;function q(){return new T("_p"+j++)}function H(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WD(),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.consoleDebug;t=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],s=void 0,a=typeof i;switch(a){case"string":i={s:i};case"object":s=z(i,t);break;case"function":s=i;break;default:throw TypeError("Unsupported type of rule: "+a)}r.push(s)}return r}(t||B.rules,n.context);for(var s=d(e,r),a={},o=(s=U(s)).toString({parenthesis:"all"});!a[o];){a[o]=!0,j=0;var l=o;i&&console.log("Working on: ",o);for(var u=0;u<t.length;u++){var c="";if("function"==typeof t[u]?(s=t[u](s,n),i&&(c=t[u].name)):(O(s,n.context),s=G(s,t[u],n.context),i&&(c="".concat(t[u].l.toString()," -> ").concat(t[u].r.toString()))),i){var h=s.toString({parenthesis:"all"});h!==l&&(console.log("Applying",c,"produced",h),l=h)}L(s,n.context)}o=s.toString({parenthesis:"all"})}return s}function V(e,t,r){var n=e;if(e)for(var i=0;i<e.length;++i){var s=G(e[i],t,r);s!==e[i]&&(n===e&&(n=e.slice()),n[i]=s)}return n}function G(e,t,r){if(t.assuming)for(var n in t.assuming)for(var i in t.assuming[n])if(C(n,i,r)!==t.assuming[n][i])return e;var s=M(t.imposeContext,r),a=e;if(a instanceof S||a instanceof x){var o=V(a.args,t,r);o!==a.args&&((a=a.clone()).args=o)}else if(a instanceof A){if(a.content){var l=G(a.content,t,r);l!==a.content&&(a=new A(l))}}else if(a instanceof b){var u=V(a.items,t,r);u!==a.items&&(a=new b(u))}else if(a instanceof v){var c=a.object;a.object&&(c=G(a.object,t,r));var d=a.index;a.index&&(d=G(a.index,t,r)),c===a.object&&d===a.index||(a=new v(c,d))}else if(a instanceof E){var h=V(a.dimensions,t,r);h!==a.dimensions&&(a=new E(h))}else if(a instanceof D){var f=!1,p={};for(var m in a.properties)p[m]=G(a.properties[m],t,r),p[m]!==a.properties[m]&&(f=!0);f&&(a=new D(p))}var g=t.r,y=Y(t.l,a,s)[0];if(!y&&t.expanded&&(g=t.expanded.r,y=Y(t.expanded.l,a,s)[0]),!y&&t.expandedNC1&&(g=t.expandedNC1.r,(y=Y(t.expandedNC1.l,a,s)[0])||(g=t.expandedNC2.r,y=Y(t.expandedNC2.l,a,s)[0])),y){var w=a.implicit;a=g.clone(),w&&"implicit"in g&&(a.implicit=!0),a=a.transform((function(e){return e.isSymbolNode&&PD(y.placeholders,e.name)?y.placeholders[e.name].clone():e}))}return t.repeat&&a!==e&&(a=G(a,t,r)),a}function K(e,t){var r={placeholders:{}};if(!e.placeholders&&!t.placeholders)return r;if(!e.placeholders)return t;if(!t.placeholders)return e;for(var n in e.placeholders)if(PD(e.placeholders,n)&&(r.placeholders[n]=e.placeholders[n],PD(t.placeholders,n)&&!J(e.placeholders[n],t.placeholders[n])))return null;for(var i in t.placeholders)PD(t.placeholders,i)&&(r.placeholders[i]=t.placeholders[i]);return r}function W(e,t){var r,n=[];if(0===e.length||0===t.length)return n;for(var i=0;i<e.length;i++)for(var s=0;s<t.length;s++)(r=K(e[i],t[s]))&&n.push(r);return n}function Y(e,t,r,n){var i=[{placeholders:{}}];if(e instanceof S&&t instanceof S||e instanceof x&&t instanceof x){if(e instanceof S){if(e.op!==t.op||e.fn!==t.fn)return[]}else if(e instanceof x&&e.name!==t.name)return[];if(!(1===t.args.length&&1===e.args.length||!k(t,r)&&t.args.length===e.args.length||n)){if(t.args.length>=2&&2===e.args.length){for(var s=function(e,t){var r,n,i=[],s=_(e);if(N(e,t))for(var a=0;a<e.args.length;a++)(n=e.args.slice(0)).splice(a,1),r=1===n.length?n[0]:s(n),i.push(s([e.args[a],r]));else for(var o=1;o<e.args.length;o++){var l=e.args[0];o>1&&(l=s(e.args.slice(0,o))),r=1===(n=e.args.slice(o)).length?n[0]:s(n),i.push(s([l,r]))}return i}(t,r),a=[],o=0;o<s.length;o++){var l=Y(e,s[o],r,!0);a=a.concat(l)}return a}if(e.args.length>2)throw Error("Unexpected non-binary associative function: "+e.toString());return[]}for(var u=[],d=0;d<e.args.length;d++){var h=Y(e.args[d],t.args[d],r);if(0===h.length)break;u.push(h)}if(u.length!==e.args.length){if(!N(t,r)||1===e.args.length)return[];if(e.args.length>2)throw new Error("permuting >2 commutative non-associative rule arguments not yet implemented");var f=Y(e.args[0],t.args[1],r);if(0===f.length)return[];var p=Y(e.args[1],t.args[0],r);if(0===p.length)return[];u=[f,p]}i=function(e){if(0===e.length)return e;for(var t=e.reduce(W),r=[],n={},i=0;i<t.length;i++){var s=JSON.stringify(t[i]);n[s]||(n[s]=!0,r.push(t[i]))}return r}(u)}else if(e instanceof T){if(0===e.name.length)throw new Error("Symbol in rule has 0 length...!?");if($[e.name]){if(e.name!==t.name)return[]}else switch(e.name[1]>="a"&&e.name[1]<="z"?e.name.substring(0,2):e.name[0]){case"n":case"_p":i[0].placeholders[e.name]=t;break;case"c":case"cl":if(!bD(t))return[];i[0].placeholders[e.name]=t;break;case"v":if(bD(t))return[];i[0].placeholders[e.name]=t;break;case"vl":if(!MD(t))return[];i[0].placeholders[e.name]=t;break;case"cd":if(!RT(t))return[];i[0].placeholders[e.name]=t;break;case"vd":if(RT(t))return[];i[0].placeholders[e.name]=t;break;case"ce":if(!IT(t))return[];i[0].placeholders[e.name]=t;break;case"ve":if(IT(t))return[];i[0].placeholders[e.name]=t;break;default:throw new Error("Invalid symbol in rule: "+e.name)}}else{if(!(e instanceof w))return[];if(!c(e.value,t.value))return[]}return i}function J(e,t){if(e instanceof w&&t instanceof w){if(!c(e.value,t.value))return!1}else if(e instanceof T&&t instanceof T){if(e.name!==t.name)return!1}else{if(!(e instanceof S&&t instanceof S||e instanceof x&&t instanceof x))return!1;if(e instanceof S){if(e.op!==t.op||e.fn!==t.fn)return!1}else if(e instanceof x&&e.name!==t.name)return!1;if(e.args.length!==t.args.length)return!1;for(var r=0;r<e.args.length;r++)if(!J(e.args[r],t.args[r]))return!1}return!0}return B})),BT="symbolicEqual",UT=BD(BT,["parse","simplify","typed","OperatorNode"],(e=>{var{parse:t,simplify:r,typed:n,OperatorNode:i}=e;function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=new i("-","subtract",[e,t]),a=r(s,{},n);return bD(a)&&!a.value}return n(BT,{"Node, Node":s,"Node, Node, Object":s})})),$T="derivative",zT=BD($T,["typed","config","parse","simplify","equal","isZero","numeric","ConstantNode","FunctionNode","OperatorNode","ParenthesisNode","SymbolNode"],(e=>{var{typed:t,config:r,parse:n,simplify:i,equal:s,isZero:a,numeric:o,ConstantNode:l,FunctionNode:u,OperatorNode:c,ParenthesisNode:d,SymbolNode:h}=e;function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{simplify:!0},n={};g(n,e,t.name);var s=y(e,n);return r.simplify?i(s):s}t.addConversion({from:"identifier",to:"SymbolNode",convert:n});var p=t($T,{"Node, SymbolNode":f,"Node, SymbolNode, Object":f});t.removeConversion({from:"identifier",to:"SymbolNode",convert:n}),p._simplify=!0,p.toTex=function(e){return m.apply(null,e.args)};var m=t("_derivTex",{"Node, SymbolNode":function(e,t){return bD(e)&&"string"===FD(e.value)?m(n(e.value).toString(),t.toString(),1):m(e.toTex(),t.toString(),1)},"Node, ConstantNode":function(e,t){if("string"===FD(t.value))return m(e,n(t.value));throw new Error("The second parameter to 'derivative' is a non-string constant")},"Node, SymbolNode, ConstantNode":function(e,t,r){return m(e.toString(),t.name,r.value)},"string, string, number":function(e,t,r){return(1===r?"{d\\over d"+t+"}":"{d^{"+r+"}\\over d"+t+"^{"+r+"}}")+"\\left[".concat(e,"\\right]")}}),g=t("constTag",{"Object, ConstantNode, string":function(e,t){return e[t]=!0,!0},"Object, SymbolNode, string":function(e,t,r){return t.name!==r&&(e[t]=!0,!0)},"Object, ParenthesisNode, string":function(e,t,r){return g(e,t.content,r)},"Object, FunctionAssignmentNode, string":function(e,t,r){return-1===t.params.indexOf(r)?(e[t]=!0,!0):g(e,t.expr,r)},"Object, FunctionNode | OperatorNode, string":function(e,t,r){if(t.args.length>0){for(var n=g(e,t.args[0],r),i=1;i<t.args.length;++i)n=g(e,t.args[i],r)&&n;if(n)return e[t]=!0,!0}return!1}}),y=t("_derivative",{"ConstantNode, Object":function(e){return v(0)},"SymbolNode, Object":function(e,t){return void 0!==t[e]?v(0):v(1)},"ParenthesisNode, Object":function(e,t){return new d(y(e.content,t))},"FunctionAssignmentNode, Object":function(e,t){return void 0!==t[e]?v(0):y(e.expr,t)},"FunctionNode, Object":function(e,t){if(1!==e.args.length&&function(e){if(("log"===e.name||"nthRoot"===e.name||"pow"===e.name)&&2===e.args.length)return;for(var t=0;t<e.args.length;++t)e.args[t]=v(0);throw e.compile().evaluate(),new Error("Expected TypeError, but none found")}(e),void 0!==t[e])return v(0);var r,n,i,s,a=e.args[0],o=!1,l=!1;switch(e.name){case"cbrt":o=!0,n=new c("*","multiply",[v(3),new c("^","pow",[a,new c("/","divide",[v(2),v(3)])])]);break;case"sqrt":case"nthRoot":if(1===e.args.length)o=!0,n=new c("*","multiply",[v(2),new u("sqrt",[a])]);else if(2===e.args.length)return t[r=new c("/","divide",[v(1),e.args[1]])]=t[e.args[1]],y(new c("^","pow",[a,r]),t);break;case"log10":r=v(10);case"log":if(r||1!==e.args.length){if(1===e.args.length&&r||2===e.args.length&&void 0!==t[e.args[1]])n=new c("*","multiply",[a.clone(),new u("log",[r||e.args[1]])]),o=!0;else if(2===e.args.length)return y(new c("/","divide",[new u("log",[a]),new u("log",[e.args[1]])]),t)}else n=a.clone(),o=!0;break;case"pow":return t[r]=t[e.args[1]],y(new c("^","pow",[a,e.args[1]]),t);case"exp":n=new u("exp",[a.clone()]);break;case"sin":n=new u("cos",[a.clone()]);break;case"cos":n=new c("-","unaryMinus",[new u("sin",[a.clone()])]);break;case"tan":n=new c("^","pow",[new u("sec",[a.clone()]),v(2)]);break;case"sec":n=new c("*","multiply",[e,new u("tan",[a.clone()])]);break;case"csc":l=!0,n=new c("*","multiply",[e,new u("cot",[a.clone()])]);break;case"cot":l=!0,n=new c("^","pow",[new u("csc",[a.clone()]),v(2)]);break;case"asin":o=!0,n=new u("sqrt",[new c("-","subtract",[v(1),new c("^","pow",[a.clone(),v(2)])])]);break;case"acos":o=!0,l=!0,n=new u("sqrt",[new c("-","subtract",[v(1),new c("^","pow",[a.clone(),v(2)])])]);break;case"atan":o=!0,n=new c("+","add",[new c("^","pow",[a.clone(),v(2)]),v(1)]);break;case"asec":o=!0,n=new c("*","multiply",[new u("abs",[a.clone()]),new u("sqrt",[new c("-","subtract",[new c("^","pow",[a.clone(),v(2)]),v(1)])])]);break;case"acsc":o=!0,l=!0,n=new c("*","multiply",[new u("abs",[a.clone()]),new u("sqrt",[new c("-","subtract",[new c("^","pow",[a.clone(),v(2)]),v(1)])])]);break;case"acot":o=!0,l=!0,n=new c("+","add",[new c("^","pow",[a.clone(),v(2)]),v(1)]);break;case"sinh":n=new u("cosh",[a.clone()]);break;case"cosh":n=new u("sinh",[a.clone()]);break;case"tanh":n=new c("^","pow",[new u("sech",[a.clone()]),v(2)]);break;case"sech":l=!0,n=new c("*","multiply",[e,new u("tanh",[a.clone()])]);break;case"csch":l=!0,n=new c("*","multiply",[e,new u("coth",[a.clone()])]);break;case"coth":l=!0,n=new c("^","pow",[new u("csch",[a.clone()]),v(2)]);break;case"asinh":o=!0,n=new u("sqrt",[new c("+","add",[new c("^","pow",[a.clone(),v(2)]),v(1)])]);break;case"acosh":o=!0,n=new u("sqrt",[new c("-","subtract",[new c("^","pow",[a.clone(),v(2)]),v(1)])]);break;case"atanh":o=!0,n=new c("-","subtract",[v(1),new c("^","pow",[a.clone(),v(2)])]);break;case"asech":o=!0,l=!0,n=new c("*","multiply",[a.clone(),new u("sqrt",[new c("-","subtract",[v(1),new c("^","pow",[a.clone(),v(2)])])])]);break;case"acsch":o=!0,l=!0,n=new c("*","multiply",[new u("abs",[a.clone()]),new u("sqrt",[new c("+","add",[new c("^","pow",[a.clone(),v(2)]),v(1)])])]);break;case"acoth":o=!0,l=!0,n=new c("-","subtract",[v(1),new c("^","pow",[a.clone(),v(2)])]);break;case"abs":n=new c("/","divide",[new u(new h("abs"),[a.clone()]),a.clone()]);break;default:throw new Error('Function "'+e.name+'" is not supported by derivative, or a wrong number of arguments is passed')}o?(i="/",s="divide"):(i="*",s="multiply");var d=y(a,t);return l&&(d=new c("-","unaryMinus",[d])),new c(i,s,[d,n])},"OperatorNode, Object":function(e,t){if(void 0!==t[e])return v(0);if("+"===e.op)return new c(e.op,e.fn,e.args.map((function(e){return y(e,t)})));if("-"===e.op){if(e.isUnary())return new c(e.op,e.fn,[y(e.args[0],t)]);if(e.isBinary())return new c(e.op,e.fn,[y(e.args[0],t),y(e.args[1],t)])}if("*"===e.op){var r=e.args.filter((function(e){return void 0!==t[e]}));if(r.length>0){var n=e.args.filter((function(e){return void 0===t[e]})),i=1===n.length?n[0]:new c("*","multiply",n),o=r.concat(y(i,t));return new c("*","multiply",o)}return new c("+","add",e.args.map((function(r){return new c("*","multiply",e.args.map((function(e){return e===r?y(e,t):e.clone()})))})))}if("/"===e.op&&e.isBinary()){var l=e.args[0],d=e.args[1];return void 0!==t[d]?new c("/","divide",[y(l,t),d]):void 0!==t[l]?new c("*","multiply",[new c("-","unaryMinus",[l]),new c("/","divide",[y(d,t),new c("^","pow",[d.clone(),v(2)])])]):new c("/","divide",[new c("-","subtract",[new c("*","multiply",[y(l,t),d.clone()]),new c("*","multiply",[l.clone(),y(d,t)])]),new c("^","pow",[d.clone(),v(2)])])}if("^"===e.op&&e.isBinary()){var h=e.args[0],f=e.args[1];if(void 0!==t[h])return bD(h)&&(a(h.value)||s(h.value,1))?v(0):new c("*","multiply",[e,new c("*","multiply",[new u("log",[h.clone()]),y(f.clone(),t)])]);if(void 0!==t[f]){if(bD(f)){if(a(f.value))return v(0);if(s(f.value,1))return y(h,t)}var p=new c("^","pow",[h.clone(),new c("-","subtract",[f,v(1)])]);return new c("*","multiply",[f.clone(),new c("*","multiply",[y(h,t),p])])}return new c("*","multiply",[new c("^","pow",[h.clone(),f.clone()]),new c("+","add",[new c("*","multiply",[y(h,t),new c("/","divide",[f.clone(),h.clone()])]),new c("*","multiply",[y(f,t),new u("log",[h.clone()])])])])}throw new Error('Operator "'+e.op+'" is not supported by derivative, or a wrong number of arguments is passed')}});function v(e,t){return new l(o(e,t||r.number))}return p})),jT="parser",qT=BD(jT,["typed","Parser"],(e=>{var{typed:t,Parser:r}=e;return t(jT,{"":function(){return new r}})})),HT="rationalize",VT=BD(HT,["config","typed","equal","isZero","add","subtract","multiply","divide","pow","parse","simplifyConstant","simplifyCore","simplify","?bignumber","?fraction","mathWithTransform","matrix","AccessorNode","ArrayNode","ConstantNode","FunctionNode","IndexNode","ObjectNode","OperatorNode","SymbolNode","ParenthesisNode"],(e=>{var{config:t,typed:r,equal:n,isZero:i,add:s,subtract:a,multiply:o,divide:l,pow:u,parse:c,simplifyConstant:d,simplifyCore:h,simplify:f,fraction:p,bignumber:m,mathWithTransform:g,matrix:y,AccessorNode:v,ArrayNode:b,ConstantNode:w,FunctionNode:x,IndexNode:E,ObjectNode:D,OperatorNode:S,SymbolNode:A,ParenthesisNode:T}=e;function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(){var e=[h,{l:"n+n",r:"2*n"},{l:"n+-n",r:"0"},d,{l:"n*(n1^-1)",r:"n/n1"},{l:"n*n1^-n2",r:"n/n1^n2"},{l:"n1^-1",r:"1/n1"},{l:"n*(n1/n2)",r:"(n*n1)/n2"},{l:"1*n",r:"n"}],t=[{l:"(-n1)/(-n2)",r:"n1/n2"},{l:"(-n1)*(-n2)",r:"n1*n2"},{l:"n1--n2",r:"n1+n2"},{l:"n1-n2",r:"n1+(-n2)"},{l:"(n1+n2)*n3",r:"(n1*n3 + n2*n3)"},{l:"n1*(n2+n3)",r:"(n1*n2+n1*n3)"},{l:"c1*n + c2*n",r:"(c1+c2)*n"},{l:"c1*n + n",r:"(c1+1)*n"},{l:"c1*n - c2*n",r:"(c1-c2)*n"},{l:"c1*n - n",r:"(c1-1)*n"},{l:"v/c",r:"(1/c)*v"},{l:"v/-c",r:"-(1/c)*v"},{l:"-v*-c",r:"c*v"},{l:"-v*c",r:"-c*v"},{l:"v*-c",r:"-c*v"},{l:"v*c",r:"c*v"},{l:"-(-n1*n2)",r:"(n1*n2)"},{l:"-(n1*n2)",r:"(-n1*n2)"},{l:"-(-n1+n2)",r:"(n1-n2)"},{l:"-(n1+n2)",r:"(-n1-n2)"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"},{l:"-(-n1/n2)",r:"(n1/n2)"},{l:"-(n1/n2)",r:"(-n1/n2)"}],r=[{l:"(n1/n2 + n3/n4)",r:"((n1*n4 + n3*n2)/(n2*n4))"},{l:"(n1/n2 + n3)",r:"((n1 + n3*n2)/n2)"},{l:"(n1 + n2/n3)",r:"((n1*n3 + n2)/n3)"}],n=[{l:"(n1/(n2/n3))",r:"((n1*n3)/n2)"},{l:"(n1/n2/n3)",r:"(n1/(n2*n3))"}],i={};return i.firstRules=e.concat(t,n),i.distrDivRules=r,i.sucDivRules=n,i.firstRulesAgain=e.concat(t),i.finalRules=[h,{l:"n*-n",r:"-n^2"},{l:"n*n",r:"n^2"},d,{l:"n*-n^n1",r:"-n^(n1+1)"},{l:"n*n^n1",r:"n^(n1+1)"},{l:"n^n1*-n^n2",r:"-n^(n1+n2)"},{l:"n^n1*n^n2",r:"n^(n1+n2)"},{l:"n^n1*-n",r:"-n^(n1+1)"},{l:"n^n1*n",r:"n^(n1+1)"},{l:"n^n1/-n",r:"-n^(n1-1)"},{l:"n^n1/n",r:"n^(n1-1)"},{l:"n/-n^n1",r:"-n^(1-n1)"},{l:"n/n^n1",r:"n^(1-n1)"},{l:"n^n1/-n^n2",r:"n^(n1-n2)"},{l:"n^n1/n^n2",r:"n^(n1-n2)"},{l:"n1+(-n2*n3)",r:"n1-n2*n3"},{l:"v*(-c)",r:"-c*v"},{l:"n1+-n2",r:"n1-n2"},{l:"v*c",r:"c*v"},{l:"(n1^n2)^n3",r:"(n1^(n2*n3))"}],i}(),i=function(e,t,r,n){var i=[],s=f(e,n,t,{exactFractions:!1}),a="+-*"+((r=!!r)?"/":"");l(s);var o={};return o.expression=s,o.variables=i,o;function l(e){var t=e.type;if("FunctionNode"===t)throw new Error("There is an unsolved function call");if("OperatorNode"===t)if("^"===e.op){if("ConstantNode"!==e.args[1].type||!rS(parseFloat(e.args[1].value)))throw new Error("There is a non-integer exponent");l(e.args[0])}else{if(-1===a.indexOf(e.op))throw new Error("Operator "+e.op+" invalid in polynomial expression");for(var r=0;r<e.args.length;r++)l(e.args[r])}else if("SymbolNode"===t){var n=e.name;-1===i.indexOf(n)&&i.push(n)}else if("ParenthesisNode"===t)l(e.content);else if("ConstantNode"!==t)throw new Error("type "+t+" is not allowed in polynomial expression")}}(e,t,!0,n.firstRules),s=i.variables.length,a={exactFractions:!1},o={exactFractions:!0};if(e=i.expression,s>=1){var l,u;e=N(e);var c,p=!0,m=!1;for(e=f(e,n.firstRules,{},a);u=p?n.distrDivRules:n.sucDivRules,p=!p,(c=(e=f(e,u,{},o)).toString())!==l;)m=!0,l=c;m&&(e=f(e,n.firstRulesAgain,{},a)),e=f(e,n.finalRules,{},a)}var g=[],y={};return"OperatorNode"===e.type&&e.isBinary()&&"/"===e.op?(1===s&&(e.args[0]=k(e.args[0],g),e.args[1]=k(e.args[1])),r&&(y.numerator=e.args[0],y.denominator=e.args[1])):(1===s&&(e=k(e,g)),r&&(y.numerator=e,y.denominator=null)),r?(y.coefficients=g,y.variables=i.variables,y.expression=e,y):e}return r(HT,{Node:C,"Node, boolean":(e,t)=>C(e,{},t),"Node, Object":C,"Node, Object, boolean":C});function N(e,t,r){var n=e.type,i=arguments.length>1;if("OperatorNode"===n&&e.isBinary()){var s,a=!1;if("^"===e.op&&("ParenthesisNode"!==e.args[0].type&&"OperatorNode"!==e.args[0].type||"ConstantNode"!==e.args[1].type||(a=(s=parseFloat(e.args[1].value))>=2&&rS(s))),a){if(s>2){var o=e.args[0],l=new S("^","pow",[e.args[0].cloneDeep(),new w(s-1)]);e=new S("*","multiply",[o,l])}else e=new S("*","multiply",[e.args[0],e.args[0].cloneDeep()]);i&&("content"===r?t.content=e:t.args[r]=e)}}if("ParenthesisNode"===n)N(e.content,e,"content");else if("ConstantNode"!==n&&"SymbolNode"!==n)for(var u=0;u<e.args.length;u++)N(e.args[u],e,u);if(!i)return e}function k(e,t){void 0===t&&(t=[]),t[0]=0;var r={cte:1,oper:"+",fire:""},n=0,i="";!function e(r,s,a){var o=r.type;if("FunctionNode"===o)throw new Error("There is an unsolved function call");if("OperatorNode"===o){if(-1==="+-*^".indexOf(r.op))throw new Error("Operator "+r.op+" invalid");if(null!==s){if(("unaryMinus"===r.fn||"pow"===r.fn)&&"add"!==s.fn&&"subtract"!==s.fn&&"multiply"!==s.fn)throw new Error("Invalid "+r.op+" placing");if(("subtract"===r.fn||"add"===r.fn||"multiply"===r.fn)&&"add"!==s.fn&&"subtract"!==s.fn)throw new Error("Invalid "+r.op+" placing");if(("subtract"===r.fn||"add"===r.fn||"unaryMinus"===r.fn)&&0!==a.noFil)throw new Error("Invalid "+r.op+" placing")}"^"!==r.op&&"*"!==r.op||(a.fire=r.op);for(var l=0;l<r.args.length;l++)"unaryMinus"===r.fn&&(a.oper="-"),"+"!==r.op&&"subtract"!==r.fn||(a.fire="",a.cte=1,a.oper=0===l?"+":r.op),a.noFil=l,e(r.args[l],r,a)}else if("SymbolNode"===o){if(r.name!==i&&""!==i)throw new Error("There is more than one variable");if(i=r.name,null===s)return void(t[1]=1);if("^"===s.op&&0!==a.noFil)throw new Error("In power the variable should be the first parameter");if("*"===s.op&&1!==a.noFil)throw new Error("In multiply the variable should be the second parameter");""!==a.fire&&"*"!==a.fire||(n<1&&(t[1]=0),t[1]+=a.cte*("+"===a.oper?1:-1),n=Math.max(1,n))}else{if("ConstantNode"!==o)throw new Error("Type "+o+" is not allowed");var u=parseFloat(r.value);if(null===s)return void(t[0]=u);if("^"===s.op){if(1!==a.noFil)throw new Error("Constant cannot be powered");if(!rS(u)||u<=0)throw new Error("Non-integer exponent is not allowed");for(var c=n+1;c<u;c++)t[c]=0;return u>n&&(t[u]=0),t[u]+=a.cte*("+"===a.oper?1:-1),void(n=Math.max(u,n))}a.cte=u,""===a.fire&&(t[0]+=a.cte*("+"===a.oper?1:-1))}}(e,null,r);for(var s,a=!0,o=n=t.length-1;o>=0;o--)if(0!==t[o]){var l=new w(a?t[o]:Math.abs(t[o])),u=t[o]<0?"-":"+";if(o>0){var c=new A(i);if(o>1){var d=new w(o);c=new S("^","pow",[c,d])}l=-1===t[o]&&a?new S("-","unaryMinus",[c]):1===Math.abs(t[o])?c:new S("*","multiply",[l,c])}s=a?l:"+"===u?new S("+","add",[s,l]):new S("-","subtract",[s,l]),a=!1}return a?new w(0):s}})),GT=r(4814);function KT(e,t,r,n,i){if(GT.isTypedFunction(e)){var s=[t,r,n],a=GT.resolve(e,s);if(a)return d(a.implementation,s);var o=[t,r],l=GT.resolve(e,o);if(l)return d(l.implementation,o);var u=[t],c=GT.resolve(e,u);return c?d(c.implementation,u):d(e,s)}return e(t,r,n);function d(s,a){try{return s.apply(s,a)}catch(s){var o;if(s instanceof TypeError&&"wrongType"===(null===(o=s.data)||void 0===o?void 0:o.category)){var l=[];throw l.push("value: ".concat(FD(t))),a.length>=2&&l.push("index: ".concat(FD(r))),a.length>=3&&l.push("array: ".concat(FD(n))),new TypeError("Function ".concat(i," cannot apply callback arguments ")+"".concat(e.name,"(").concat(l.join(", "),") at index ").concat(JSON.stringify(r)))}throw new TypeError("Function ".concat(i," cannot apply callback arguments ")+"to function ".concat(e.name,": ").concat(s.message))}}}function WT(e,t,r){var n=e.filter((function(e){return MD(e)&&!(e.name in t)&&!r.has(e.name)}))[0];if(!n)throw new Error('No undefined variable found in inline expression "'+e+'"');var i=n.name,s=WA(r),a=e.compile();return function(e){return s.set(i,e),a.evaluate(s)}}var YT=BD("filter",["typed"],(e=>{var{typed:t}=e;function r(e,t,r){var i,s;return e[0]&&(i=e[0].compile().evaluate(r)),e[1]&&(s=MD(e[1])||xD(e[1])?e[1].compile().evaluate(r):WT(e[1],t,r)),n(i,s)}r.rawArgs=!0;var n=t("filter",{"Array, function":JT,"Matrix, function":function(e,t){return e.create(JT(e.toArray(),t))},"Array, RegExp":eA,"Matrix, RegExp":function(e,t){return e.create(eA(e.toArray(),t))}});return r}),{isTransformFunction:!0});function JT(e,t){return QS(e,(function(e,r,n){return KT(t,e,[r+1],n,"filter")}))}var ZT=BD("forEach",["typed"],(e=>{var{typed:t}=e;function r(e,t,r){var i,s;return e[0]&&(i=e[0].compile().evaluate(r)),e[1]&&(s=MD(e[1])||xD(e[1])?e[1].compile().evaluate(r):WT(e[1],t,r)),n(i,s)}r.rawArgs=!0;var n=t("forEach",{"Array | Matrix, function":function(e,t){!function r(n,i){if(!Array.isArray(n))return KT(t,n,i,e,"forEach");XS(n,(function(e,t){r(e,i.concat(t+1))}))}(e.valueOf(),[])}});return r}),{isTransformFunction:!0}),XT=BD("map",["typed"],(e=>{var{typed:t}=e;function r(e,t,r){var i,s;return e[0]&&(i=e[0].compile().evaluate(r)),e[1]&&(s=MD(e[1])||xD(e[1])?e[1].compile().evaluate(r):WT(e[1],t,r)),n(i,s)}r.rawArgs=!0;var n=t("map",{"Array, function":function(e,t){return QT(e,t,e)},"Matrix, function":function(e,t){return e.create(QT(e.valueOf(),t,e))}});return r}),{isTransformFunction:!0});function QT(e,t,r){return function e(n,i){return Array.isArray(n)?ZS(n,(function(t,r){return e(t,i.concat(r+1))})):KT(t,n,i,r,"map")}(e,[])}var eC="apply",tC=BD(eC,["typed","isInteger"],(e=>{var{typed:t,isInteger:r}=e;return t(eC,{"Array | Matrix, number | BigNumber, function":function(e,t,n){if(!r(t))throw new TypeError("Integer number expected for dimension");var i=Array.isArray(e)?PS(e):e.size();if(t<0||t>=i.length)throw new IS(t,i.length);return QE(e)?e.create(rC(e.valueOf(),t,n)):rC(e,t,n)}})}));function rC(e,t,r){var n,i,s;if(t<=0){if(Array.isArray(e[0])){for(s=function(e){var t,r,n=e.length,i=e[0].length,s=[];for(r=0;r<i;r++){var a=[];for(t=0;t<n;t++)a.push(e[t][r]);s.push(a)}return s}(e),i=[],n=0;n<s.length;n++)i[n]=rC(s[n],t-1,r);return i}return r(e)}for(i=[],n=0;n<e.length;n++)i[n]=rC(e[n],t-1,r);return i}var nC=BD("apply",["typed","isInteger"],(e=>{var{typed:t,isInteger:r}=e,n=tC({typed:t,isInteger:r});return t("apply",{"...any":function(e){var t=e[1];GE(t)?e[1]=t-1:KE(t)&&(e[1]=t.minus(1));try{return n.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),iC="subset",sC=BD(iC,["typed","matrix"],(e=>{var{typed:t,matrix:r}=e;return t(iC,{"Array, Index":function(e,t){var n=r(e).subset(t);return t.isScalar()?n:n.valueOf()},"Matrix, Index":function(e,t){return e.subset(t)},"Object, Index":lC,"string, Index":aC,"Array, Index, any":function(e,t,n){return r(_D(e)).subset(t,n,void 0).valueOf()},"Array, Index, any, any":function(e,t,n,i){return r(_D(e)).subset(t,n,i).valueOf()},"Matrix, Index, any":function(e,t,r){return e.clone().subset(t,r)},"Matrix, Index, any, any":function(e,t,r,n){return e.clone().subset(t,r,n)},"string, Index, string":oC,"string, Index, string, string":oC,"Object, Index, any":uC})}));function aC(e,t){if(!iD(t))throw new TypeError("Index expected");if(1!==t.size().length)throw new RS(t.size().length,1);var r=e.length;$S(t.min()[0],r),$S(t.max()[0],r);var n=t.dimension(0),i="";return n.forEach((function(t){i+=e.charAt(t)})),i}function oC(e,t,r,n){if(!t||!0!==t.isIndex)throw new TypeError("Index expected");if(1!==t.size().length)throw new RS(t.size().length,1);if(void 0!==n){if("string"!=typeof n||1!==n.length)throw new TypeError("Single character expected as defaultValue")}else n=" ";var i=t.dimension(0);if(i.size()[0]!==r.length)throw new RS(i.size()[0],r.length);var s=e.length;$S(t.min()[0]),$S(t.max()[0]);for(var a=[],o=0;o<s;o++)a[o]=e.charAt(o);if(i.forEach((function(e,t){a[e]=r.charAt(t[0])})),a.length>s)for(var l=s-1,u=a.length;l<u;l++)a[l]||(a[l]=n);return a.join("")}function lC(e,t){if(1!==t.size().length)throw new RS(t.size(),1);var r=t.dimension(0);if("string"!=typeof r)throw new TypeError("String expected as index to retrieve an object property");return $D(e,r)}function uC(e,t,r){if(1!==t.size().length)throw new RS(t.size(),1);var n=t.dimension(0);if("string"!=typeof n)throw new TypeError("String expected as index to retrieve an object property");var i=_D(e);return zD(i,n,r),i}var cC=BD("subset",["typed","matrix"],(e=>{var{typed:t,matrix:r}=e,n=sC({typed:t,matrix:r});return t("subset",{"...any":function(e){try{return n.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),dC="concat",hC=BD(dC,["typed","matrix","isInteger"],(e=>{var{typed:t,matrix:r,isInteger:n}=e;return t(dC,{"...Array | Matrix | number | BigNumber":function(e){var t,i,s=e.length,a=-1,o=!1,l=[];for(t=0;t<s;t++){var u=e[t];if(QE(u)&&(o=!0),GE(u)||KE(u)){if(t!==s-1)throw new Error("Dimension must be specified as last argument");if(i=a,a=u.valueOf(),!n(a))throw new TypeError("Integer number expected for dimension");if(a<0||t>0&&a>i)throw new IS(a,i+1)}else{var c=_D(u).valueOf(),d=PS(c);if(l[t]=c,i=a,a=d.length-1,t>0&&a!==i)throw new RS(i+1,a+1)}}if(0===l.length)throw new SyntaxError("At least one matrix expected");for(var h=l.shift();l.length;)h=fC(h,l.shift(),a,0);return o?r(h):h},"...string":function(e){return e.join("")}})}));function fC(e,t,r,n){if(n<r){if(e.length!==t.length)throw new RS(e.length,t.length);for(var i=[],s=0;s<e.length;s++)i[s]=fC(e[s],t[s],r,n+1);return i}return e.concat(t)}var pC=BD("concat",["typed","matrix","isInteger"],(e=>{var{typed:t,matrix:r,isInteger:n}=e,i=hC({typed:t,matrix:r,isInteger:n});return t("concat",{"...any":function(e){var t=e.length-1,r=e[t];GE(r)?e[t]=r-1:KE(r)&&(e[t]=r.minus(1));try{return i.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0});function mC(e,t,r){var n;return-1!==String(e).indexOf("Unexpected type")?(n=arguments.length>2?" (type: "+FD(r)+", value: "+JSON.stringify(r)+")":" (type: "+e.data.actual+")",new TypeError("Cannot calculate "+t+", unexpected type of argument"+n)):-1!==String(e).indexOf("complex numbers")?(n=arguments.length>2?" (type: "+FD(r)+", value: "+JSON.stringify(r)+")":"",new TypeError("Cannot calculate "+t+", no ordering relation is defined for complex numbers"+n)):e}var gC=BD("max",["typed","config","numeric","larger"],(e=>{var{typed:t,config:r,numeric:n,larger:i}=e;return t("max",{"Array | Matrix":a,"Array | Matrix, number | BigNumber":function(e,t){return tT(e,t.valueOf(),s)},"...":function(e){if(XA(e))throw new TypeError("Scalar values expected in function max");return a(e)}});function s(e,t){try{return i(e,t)?e:t}catch(e){throw mC(e,"max",t)}}function a(e){var t;if(QA(e,(function(e){try{isNaN(e)&&"number"==typeof e?t=NaN:(void 0===t||i(e,t))&&(t=e)}catch(t){throw mC(t,"max",e)}})),void 0===t)throw new Error("Cannot calculate max of an empty array");return"string"==typeof t&&(t=n(t,r.number)),t}}));function yC(e){if(2===e.length&&eD(e[0])){var t=(e=e.slice())[1];GE(t)?e[1]=t-1:KE(t)&&(e[1]=t.minus(1))}return e}var vC,bC,wC=BD("max",["typed","config","numeric","larger"],(e=>{var{typed:t,config:r,numeric:n,larger:i}=e,s=gC({typed:t,config:r,numeric:n,larger:i});return t("max",{"...any":function(e){e=yC(e);try{return s.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),xC=BD("sum",["typed","config","add","numeric"],(e=>{var{typed:t,config:r,add:n,numeric:i}=e;return t("sum",{"Array | Matrix":s,"Array | Matrix, number | BigNumber":function(e,t){try{return tT(e,t,n)}catch(e){throw mC(e,"sum")}},"...":function(e){if(XA(e))throw new TypeError("Scalar values expected in function sum");return s(e)}});function s(e){var t;return QA(e,(function(e){try{t=void 0===t?e:n(t,e)}catch(t){throw mC(t,"sum",e)}})),void 0===t&&(t=i(0,r.number)),"string"==typeof t&&(t=i(t,r.number)),t}})),EC=BD("sum",["typed","config","add","numeric"],(e=>{var{typed:t,config:r,add:n,numeric:i}=e,s=xC({typed:t,config:r,add:n,numeric:i});return t("sum",{"...any":function(e){e=yC(e);try{return s.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),DC=BD("min",["typed","config","numeric","smaller"],(e=>{var{typed:t,config:r,numeric:n,smaller:i}=e;return t("min",{"Array | Matrix":a,"Array | Matrix, number | BigNumber":function(e,t){return tT(e,t.valueOf(),s)},"...":function(e){if(XA(e))throw new TypeError("Scalar values expected in function min");return a(e)}});function s(e,t){try{return i(e,t)?e:t}catch(e){throw mC(e,"min",t)}}function a(e){var t;if(QA(e,(function(e){try{isNaN(e)&&"number"==typeof e?t=NaN:(void 0===t||i(e,t))&&(t=e)}catch(t){throw mC(t,"min",e)}})),void 0===t)throw new Error("Cannot calculate min of an empty array");return"string"==typeof t&&(t=n(t,r.number)),t}})),SC=BD("min",["typed","config","numeric","smaller"],(e=>{var{typed:t,config:r,numeric:n,smaller:i}=e,s=DC({typed:t,config:r,numeric:n,smaller:i});return t("min",{"...any":function(e){e=yC(e);try{return s.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),AC="cumsum",TC=BD(AC,["typed","add","unaryPlus"],(e=>{var{typed:t,add:r,unaryPlus:n}=e;return t(AC,{Array:i,Matrix:function(e){return e.create(i(e.valueOf()))},"Array, number | BigNumber":a,"Matrix, number | BigNumber":function(e,t){return e.create(a(e.valueOf(),t))},"...":function(e){if(XA(e))throw new TypeError("All values expected to be scalar in function cumsum");return i(e)}});function i(e){try{return s(e)}catch(e){throw mC(e,AC)}}function s(e){if(0===e.length)return[];for(var t=[n(e[0])],i=1;i<e.length;++i)t.push(r(t[i-1],e[i]));return t}function a(e,t){var r=PS(e);if(t<0||t>=r.length)throw new IS(t,r.length);try{return o(e,t)}catch(e){throw mC(e,AC)}}function o(e,t){var r,n,i;if(t<=0){var a=e[0][0];if(Array.isArray(a)){for(i=ZA(e),n=[],r=0;r<i.length;r++)n[r]=o(i[r],t-1);return n}return s(e)}for(n=[],r=0;r<e.length;r++)n[r]=o(e[r],t-1);return n}})),CC="cumsum",NC=BD(CC,["typed","add","unaryPlus"],(e=>{var{typed:t,add:r,unaryPlus:n}=e,i=TC({typed:t,add:r,unaryPlus:n});return t(CC,{"...any":function(e){if(2===e.length&&eD(e[0])){var t=e[1];GE(t)?e[1]=t-1:KE(t)&&(e[1]=t.minus(1))}try{return i.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),kC="diff",MC=BD(kC,["typed","matrix","subtract","number"],(e=>{var{typed:t,matrix:r,subtract:n,number:i}=e;return t(kC,{"Array | Matrix":function(e){return QE(e)?r(a(e.toArray())):a(e)},"Array | Matrix, number":function(e,t){if(!rS(t))throw new RangeError("Dimension must be a whole number");return QE(e)?r(s(e.toArray(),t)):s(e,t)},"Array, BigNumber":t.referTo("Array,number",(e=>(t,r)=>e(t,i(r)))),"Matrix, BigNumber":t.referTo("Matrix,number",(e=>(t,r)=>e(t,i(r))))});function s(e,t){if(QE(e)&&(e=e.toArray()),!Array.isArray(e))throw RangeError("Array/Matrix does not have that many dimensions");if(t>0){var r=[];return e.forEach((e=>{r.push(s(e,t-1))})),r}if(0===t)return a(e);throw RangeError("Cannot have negative dimension")}function a(e){for(var t=[],r=e.length,n=1;n<r;n++)t.push(o(e[n-1],e[n]));return t}function o(e,t){QE(e)&&(e=e.toArray()),QE(t)&&(t=t.toArray());var r=Array.isArray(e),i=Array.isArray(t);if(r&&i)return function(e,t){if(e.length!==t.length)throw RangeError("Not all sub-arrays have the same length");for(var r=[],n=e.length,i=0;i<n;i++)r.push(o(e[i],t[i]));return r}(e,t);if(!r&&!i)return n(t,e);throw TypeError("Cannot calculate difference between 1 array and 1 non-array")}})),OC="diff",FC=BD(OC,["typed","matrix","subtract","number","bignumber"],(e=>{var{typed:t,matrix:r,subtract:n,number:i,bignumber:s}=e,a=MC({typed:t,matrix:r,subtract:n,number:i,bignumber:s});return t(OC,{"...any":function(e){e=yC(e);try{return a.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),LC=BD("index",["Index"],(e=>{var{Index:t}=e;return function(){for(var e=[],r=0,n=arguments.length;r<n;r++){var i=arguments[r];if(nD(i))i.start--,i.end-=i.step>0?0:2;else if(i&&!0===i.isSet)i=i.map((function(e){return e-1}));else if(XE(i)||QE(i))i=i.map((function(e){return e-1}));else if(GE(i))i--;else if(KE(i))i=i.toNumber()-1;else if("string"!=typeof i)throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");e[r]=i}var s=new t;return t.apply(s,e),s}}),{isTransformFunction:!0}),_C="range",RC=BD(_C,["typed","config","?matrix","?bignumber","smaller","smallerEq","larger","largerEq","add","isPositive"],(e=>{var{typed:t,config:r,matrix:n,bignumber:i,smaller:s,smallerEq:a,larger:o,largerEq:l,add:u,isPositive:c}=e;return t(_C,{string:h,"string, boolean":h,"number, number":function(e,t){return d(f(e,t,1,!1))},"number, number, number":function(e,t,r){return d(f(e,t,r,!1))},"number, number, boolean":function(e,t,r){return d(f(e,t,1,r))},"number, number, number, boolean":function(e,t,r,n){return d(f(e,t,r,n))},"BigNumber, BigNumber":function(e,t){return d(f(e,t,new(0,e.constructor)(1),!1))},"BigNumber, BigNumber, BigNumber":function(e,t,r){return d(f(e,t,r,!1))},"BigNumber, BigNumber, boolean":function(e,t,r){return d(f(e,t,new(0,e.constructor)(1),r))},"BigNumber, BigNumber, BigNumber, boolean":function(e,t,r,n){return d(f(e,t,r,n))},"Unit, Unit, Unit":function(e,t,r){return d(f(e,t,r,!1))},"Unit, Unit, Unit, boolean":function(e,t,r,n){return d(f(e,t,r,n))}});function d(e){return"Matrix"===r.matrix?n?n(e):hT():e}function h(e,t){var n=function(e){var t=e.split(":"),r=t.map((function(e){return Number(e)}));if(r.some((function(e){return isNaN(e)})))return null;switch(r.length){case 2:return{start:r[0],end:r[1],step:1};case 3:return{start:r[0],end:r[2],step:r[1]};default:return null}}(e);if(!n)throw new SyntaxError('String "'+e+'" is no valid range');return"BigNumber"===r.number?(void 0===i&&cT(),d(f(i(n.start),i(n.end),i(n.step)))):d(f(n.start,n.end,n.step,t))}function f(e,t,r,n){for(var i=[],d=c(r)?n?a:s:n?l:o,h=e;d(h,t);)i.push(h),h=u(h,r);return i}})),IC=BD("range",["typed","config","?matrix","?bignumber","smaller","smallerEq","larger","largerEq","add","isPositive"],(e=>{var{typed:t,config:r,matrix:n,bignumber:i,smaller:s,smallerEq:a,larger:o,largerEq:l,add:u,isPositive:c}=e,d=RC({typed:t,config:r,matrix:n,bignumber:i,smaller:s,smallerEq:a,larger:o,largerEq:l,add:u,isPositive:c});return t("range",{"...any":function(e){return"boolean"!=typeof e[e.length-1]&&e.push(!0),d.apply(null,e)}})}),{isTransformFunction:!0}),PC=BD("row",["typed","Index","matrix","range"],(e=>{var{typed:t,Index:r,matrix:n,range:i}=e;return t("row",{"Matrix, number":s,"Array, number":function(e,t){return s(n(_D(e)),t).valueOf()}});function s(e,t){if(2!==e.size().length)throw new Error("Only two dimensional matrix is supported");$S(t,e.size()[0]);var s=i(0,e.size()[1]),a=new r(t,s),o=e.subset(a);return QE(o)?o:n([[o]])}})),BC=BD("row",["typed","Index","matrix","range"],(e=>{var{typed:t,Index:r,matrix:n,range:i}=e,s=PC({typed:t,Index:r,matrix:n,range:i});return t("row",{"...any":function(e){var t=e.length-1,r=e[t];GE(r)&&(e[t]=r-1);try{return s.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),UC="column",$C=BD(UC,["typed","Index","matrix","range"],(e=>{var{typed:t,Index:r,matrix:n,range:i}=e;return t(UC,{"Matrix, number":s,"Array, number":function(e,t){return s(n(_D(e)),t).valueOf()}});function s(e,t){if(2!==e.size().length)throw new Error("Only two dimensional matrix is supported");$S(t,e.size()[1]);var s=i(0,e.size()[0]),a=new r(s,t),o=e.subset(a);return QE(o)?o:n([[o]])}})),zC=BD("column",["typed","Index","matrix","range"],(e=>{var{typed:t,Index:r,matrix:n,range:i}=e,s=$C({typed:t,Index:r,matrix:n,range:i});return t("column",{"...any":function(e){var t=e.length-1,r=e[t];GE(r)&&(e[t]=r-1);try{return s.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),jC="mean",qC=BD(jC,["typed","add","divide"],(e=>{var{typed:t,add:r,divide:n}=e;return t(jC,{"Array | Matrix":i,"Array | Matrix, number | BigNumber":function(e,t){try{var i=tT(e,t,r),s=Array.isArray(e)?PS(e):e.size();return n(i,s[t])}catch(e){throw mC(e,"mean")}},"...":function(e){if(XA(e))throw new TypeError("Scalar values expected in function mean");return i(e)}});function i(e){var t,i=0;if(QA(e,(function(e){try{t=void 0===t?e:r(t,e),i++}catch(t){throw mC(t,"mean",e)}})),0===i)throw new Error("Cannot calculate the mean of an empty array");return n(t,i)}})),HC=BD("mean",["typed","add","divide"],(e=>{var{typed:t,add:r,divide:n}=e,i=qC({typed:t,add:r,divide:n});return t("mean",{"...any":function(e){e=yC(e);try{return i.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),VC="unbiased",GC="variance",KC=BD(GC,["typed","add","subtract","multiply","divide","apply","isNaN"],(e=>{var{typed:t,add:r,subtract:n,multiply:i,divide:s,apply:a,isNaN:o}=e;return t(GC,{"Array | Matrix":function(e){return l(e,VC)},"Array | Matrix, string":l,"Array | Matrix, number | BigNumber":function(e,t){return u(e,t,VC)},"Array | Matrix, number | BigNumber, string":u,"...":function(e){return l(e,VC)}});function l(e,t){var a,l=0;if(0===e.length)throw new SyntaxError("Function variance requires one or more parameters (0 provided)");if(QA(e,(function(e){try{a=void 0===a?e:r(a,e),l++}catch(t){throw mC(t,"variance",e)}})),0===l)throw new Error("Cannot calculate variance of an empty array");var u=s(a,l);if(a=void 0,QA(e,(function(e){var t=n(e,u);a=void 0===a?i(t,t):r(a,i(t,t))})),o(a))return a;switch(t){case"uncorrected":return s(a,l);case"biased":return s(a,l+1);case"unbiased":var c=KE(a)?a.mul(0):0;return 1===l?c:s(a,l-1);default:throw new Error('Unknown normalization "'+t+'". Choose "unbiased" (default), "uncorrected", or "biased".')}}function u(e,t,r){try{if(0===e.length)throw new SyntaxError("Function variance requires one or more parameters (0 provided)");return a(e,t,(e=>l(e,r)))}catch(e){throw mC(e,"variance")}}})),WC="variance",YC=BD(WC,["typed","add","subtract","multiply","divide","apply","isNaN"],(e=>{var{typed:t,add:r,subtract:n,multiply:i,divide:s,apply:a,isNaN:o}=e,l=KC({typed:t,add:r,subtract:n,multiply:i,divide:s,apply:a,isNaN:o});return t(WC,{"...any":function(e){e=yC(e);try{return l.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),JC=BD("std",["typed","map","sqrt","variance"],(e=>{var{typed:t,map:r,sqrt:n,variance:i}=e;return t("std",{"Array | Matrix":s,"Array | Matrix, string":s,"Array | Matrix, number | BigNumber":s,"Array | Matrix, number | BigNumber, string":s,"...":function(e){return s(e)}});function s(e,t){if(0===e.length)throw new SyntaxError("Function std requires one or more parameters (0 provided)");try{var s=i.apply(null,arguments);return eD(s)?r(s,n):n(s)}catch(e){throw e instanceof TypeError&&-1!==e.message.indexOf(" variance")?new TypeError(e.message.replace(" variance"," std")):e}}})),ZC=BD("std",["typed","map","sqrt","variance"],(e=>{var{typed:t,map:r,sqrt:n,variance:i}=e,s=JC({typed:t,map:r,sqrt:n,variance:i});return t("std",{"...any":function(e){e=yC(e);try{return s.apply(null,e)}catch(e){throw UA(e)}}})}),{isTransformFunction:!0}),XC=9e15,QC=1e9,eN="0123456789abcdef",tN="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rN="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",nN={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-XC,maxE:XC,crypto:!1},iN=!0,sN="[DecimalError] ",aN=sN+"Invalid argument: ",oN=sN+"Precision limit exceeded",lN=sN+"crypto unavailable",uN="[object Decimal]",cN=Math.floor,dN=Math.pow,hN=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,fN=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,pN=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,mN=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,gN=1e7,yN=7,vN=tN.length-1,bN=rN.length-1,wN={toStringTag:uN};function xN(e){var t,r,n,i=e.length-1,s="",a=e[0];if(i>0){for(s+=a,t=1;t<i;t++)n=e[t]+"",(r=yN-n.length)&&(s+=FN(r)),s+=n;a=e[t],(r=yN-(n=a+"").length)&&(s+=FN(r))}else if(0===a)return"0";for(;a%10==0;)a/=10;return s+a}function EN(e,t,r){if(e!==~~e||e<t||e>r)throw Error(aN+e)}function DN(e,t,r,n){var i,s,a,o;for(s=e[0];s>=10;s/=10)--t;return--t<0?(t+=yN,i=0):(i=Math.ceil((t+1)/yN),t%=yN),s=dN(10,yN-t),o=e[i]%s|0,null==n?t<3?(0==t?o=o/100|0:1==t&&(o=o/10|0),a=r<4&&99999==o||r>3&&49999==o||5e4==o||0==o):a=(r<4&&o+1==s||r>3&&o+1==s/2)&&(e[i+1]/s/100|0)==dN(10,t-2)-1||(o==s/2||0==o)&&0==(e[i+1]/s/100|0):t<4?(0==t?o=o/1e3|0:1==t?o=o/100|0:2==t&&(o=o/10|0),a=(n||r<4)&&9999==o||!n&&r>3&&4999==o):a=((n||r<4)&&o+1==s||!n&&r>3&&o+1==s/2)&&(e[i+1]/s/1e3|0)==dN(10,t-3)-1,a}function SN(e,t,r){for(var n,i,s=[0],a=0,o=e.length;a<o;){for(i=s.length;i--;)s[i]*=t;for(s[0]+=eN.indexOf(e.charAt(a++)),n=0;n<s.length;n++)s[n]>r-1&&(void 0===s[n+1]&&(s[n+1]=0),s[n+1]+=s[n]/r|0,s[n]%=r)}return s.reverse()}wN.absoluteValue=wN.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),TN(e)},wN.ceil=function(){return TN(new this.constructor(this),this.e+1,2)},wN.clampedTo=wN.clamp=function(e,t){var r=this,n=r.constructor;if(e=new n(e),t=new n(t),!e.s||!t.s)return new n(NaN);if(e.gt(t))throw Error(aN+t);return r.cmp(e)<0?e:r.cmp(t)>0?t:new n(r)},wN.comparedTo=wN.cmp=function(e){var t,r,n,i,s=this,a=s.d,o=(e=new s.constructor(e)).d,l=s.s,u=e.s;if(!a||!o)return l&&u?l!==u?l:a===o?0:!a^l<0?1:-1:NaN;if(!a[0]||!o[0])return a[0]?l:o[0]?-u:0;if(l!==u)return l;if(s.e!==e.e)return s.e>e.e^l<0?1:-1;for(t=0,r=(n=a.length)<(i=o.length)?n:i;t<r;++t)if(a[t]!==o[t])return a[t]>o[t]^l<0?1:-1;return n===i?0:n>i^l<0?1:-1},wN.cosine=wN.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+yN,n.rounding=1,r=function(e,t){var r,n,i;if(t.isZero())return t;n=t.d.length,n<32?i=(1/jN(4,r=Math.ceil(n/3))).toString():(r=16,i="2.3283064365386962890625e-10");e.precision+=r,t=zN(e,1,t.times(i),new e(1));for(var s=r;s--;){var a=t.times(t);t=a.times(a).minus(a).times(8).plus(1)}return e.precision-=r,t}(n,qN(n,r)),n.precision=e,n.rounding=t,TN(2==bC||3==bC?r.neg():r,e,t,!0)):new n(1):new n(NaN)},wN.cubeRoot=wN.cbrt=function(){var e,t,r,n,i,s,a,o,l,u,c=this,d=c.constructor;if(!c.isFinite()||c.isZero())return new d(c);for(iN=!1,(s=c.s*dN(c.s*c,1/3))&&Math.abs(s)!=1/0?n=new d(s.toString()):(r=xN(c.d),(s=((e=c.e)-r.length+1)%3)&&(r+=1==s||-2==s?"0":"00"),s=dN(r,1/3),e=cN((e+1)/3)-(e%3==(e<0?-1:2)),(n=new d(r=s==1/0?"5e"+e:(r=s.toExponential()).slice(0,r.indexOf("e")+1)+e)).s=c.s),a=(e=d.precision)+3;;)if(u=(l=(o=n).times(o).times(o)).plus(c),n=AN(u.plus(c).times(o),u.plus(l),a+2,1),xN(o.d).slice(0,a)===(r=xN(n.d)).slice(0,a)){if("9999"!=(r=r.slice(a-3,a+1))&&(i||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(TN(n,e+1,1),t=!n.times(n).times(n).eq(c));break}if(!i&&(TN(o,e+1,0),o.times(o).times(o).eq(c))){n=o;break}a+=4,i=1}return iN=!0,TN(n,e,d.rounding,t)},wN.decimalPlaces=wN.dp=function(){var e,t=this.d,r=NaN;if(t){if(r=((e=t.length-1)-cN(this.e/yN))*yN,e=t[e])for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r},wN.dividedBy=wN.div=function(e){return AN(this,new this.constructor(e))},wN.dividedToIntegerBy=wN.divToInt=function(e){var t=this.constructor;return TN(AN(this,new t(e),0,1,1),t.precision,t.rounding)},wN.equals=wN.eq=function(e){return 0===this.cmp(e)},wN.floor=function(){return TN(new this.constructor(this),this.e+1,3)},wN.greaterThan=wN.gt=function(e){return this.cmp(e)>0},wN.greaterThanOrEqualTo=wN.gte=function(e){var t=this.cmp(e);return 1==t||0===t},wN.hyperbolicCosine=wN.cosh=function(){var e,t,r,n,i,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;r=a.precision,n=a.rounding,a.precision=r+Math.max(s.e,s.sd())+4,a.rounding=1,(i=s.d.length)<32?t=(1/jN(4,e=Math.ceil(i/3))).toString():(e=16,t="2.3283064365386962890625e-10"),s=zN(a,1,s.times(t),new a(1),!0);for(var l,u=e,c=new a(8);u--;)l=s.times(s),s=o.minus(l.times(c.minus(l.times(c))));return TN(s,a.precision=r,a.rounding=n,!0)},wN.hyperbolicSine=wN.sinh=function(){var e,t,r,n,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(t=s.precision,r=s.rounding,s.precision=t+Math.max(i.e,i.sd())+4,s.rounding=1,(n=i.d.length)<3)i=zN(s,2,i,i,!0);else{e=(e=1.4*Math.sqrt(n))>16?16:0|e,i=zN(s,2,i=i.times(1/jN(5,e)),i,!0);for(var a,o=new s(5),l=new s(16),u=new s(20);e--;)a=i.times(i),i=i.times(o.plus(a.times(l.times(a).plus(u))))}return s.precision=t,s.rounding=r,TN(i,t,r,!0)},wN.hyperbolicTangent=wN.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,AN(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)},wN.inverseCosine=wN.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),i=r.precision,s=r.rounding;return-1!==n?0===n?t.isNeg()?MN(r,i,s):new r(0):new r(NaN):t.isZero()?MN(r,i+4,s).times(.5):(r.precision=i+6,r.rounding=1,t=t.asin(),e=MN(r,i+4,s).times(.5),r.precision=i,r.rounding=s,e.minus(t))},wN.inverseHyperbolicCosine=wN.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,iN=!1,r=r.times(r).minus(1).sqrt().plus(r),iN=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)},wN.inverseHyperbolicSine=wN.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,iN=!1,r=r.times(r).plus(1).sqrt().plus(r),iN=!0,n.precision=e,n.rounding=t,r.ln())},wN.inverseHyperbolicTangent=wN.atanh=function(){var e,t,r,n,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=s.precision,t=s.rounding,n=i.sd(),Math.max(n,e)<2*-i.e-1?TN(new s(i),e,t,!0):(s.precision=r=n-i.e,i=AN(i.plus(1),new s(1).minus(i),r+e,1),s.precision=e+4,s.rounding=1,i=i.ln(),s.precision=e,s.rounding=t,i.times(.5))):new s(NaN)},wN.inverseSine=wN.asin=function(){var e,t,r,n,i=this,s=i.constructor;return i.isZero()?new s(i):(t=i.abs().cmp(1),r=s.precision,n=s.rounding,-1!==t?0===t?((e=MN(s,r+4,n).times(.5)).s=i.s,e):new s(NaN):(s.precision=r+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=r,s.rounding=n,i.times(2)))},wN.inverseTangent=wN.atan=function(){var e,t,r,n,i,s,a,o,l,u=this,c=u.constructor,d=c.precision,h=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&d+4<=bN)return(a=MN(c,d+4,h).times(.25)).s=u.s,a}else{if(!u.s)return new c(NaN);if(d+4<=bN)return(a=MN(c,d+4,h).times(.5)).s=u.s,a}for(c.precision=o=d+10,c.rounding=1,e=r=Math.min(28,o/yN+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(iN=!1,t=Math.ceil(o/yN),n=1,l=u.times(u),a=new c(u),i=u;-1!==e;)if(i=i.times(l),s=a.minus(i.div(n+=2)),i=i.times(l),void 0!==(a=s.plus(i.div(n+=2))).d[t])for(e=t;a.d[e]===s.d[e]&&e--;);return r&&(a=a.times(2<<r-1)),iN=!0,TN(a,c.precision=d,c.rounding=h,!0)},wN.isFinite=function(){return!!this.d},wN.isInteger=wN.isInt=function(){return!!this.d&&cN(this.e/yN)>this.d.length-2},wN.isNaN=function(){return!this.s},wN.isNegative=wN.isNeg=function(){return this.s<0},wN.isPositive=wN.isPos=function(){return this.s>0},wN.isZero=function(){return!!this.d&&0===this.d[0]},wN.lessThan=wN.lt=function(e){return this.cmp(e)<0},wN.lessThanOrEqualTo=wN.lte=function(e){return this.cmp(e)<1},wN.logarithm=wN.log=function(e){var t,r,n,i,s,a,o,l,u=this,c=u.constructor,d=c.precision,h=c.rounding;if(null==e)e=new c(10),t=!0;else{if(r=(e=new c(e)).d,e.s<0||!r||!r[0]||e.eq(1))return new c(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new c(r&&!r[0]?-1/0:1!=u.s?NaN:r?0:1/0);if(t)if(r.length>1)s=!0;else{for(i=r[0];i%10==0;)i/=10;s=1!==i}if(iN=!1,a=PN(u,o=d+5),n=t?kN(c,o+10):PN(e,o),DN((l=AN(a,n,o,1)).d,i=d,h))do{if(a=PN(u,o+=10),n=t?kN(c,o+10):PN(e,o),l=AN(a,n,o,1),!s){+xN(l.d).slice(i+1,i+15)+1==1e14&&(l=TN(l,d+1,0));break}}while(DN(l.d,i+=10,h));return iN=!0,TN(l,d,h)},wN.minus=wN.sub=function(e){var t,r,n,i,s,a,o,l,u,c,d,h,f=this,p=f.constructor;if(e=new p(e),!f.d||!e.d)return f.s&&e.s?f.d?e.s=-e.s:e=new p(e.d||f.s!==e.s?f:NaN):e=new p(NaN),e;if(f.s!=e.s)return e.s=-e.s,f.plus(e);if(u=f.d,h=e.d,o=p.precision,l=p.rounding,!u[0]||!h[0]){if(h[0])e.s=-e.s;else{if(!u[0])return new p(3===l?-0:0);e=new p(f)}return iN?TN(e,o,l):e}if(r=cN(e.e/yN),c=cN(f.e/yN),u=u.slice(),s=c-r){for((d=s<0)?(t=u,s=-s,a=h.length):(t=h,r=c,a=u.length),s>(n=Math.max(Math.ceil(o/yN),a)+2)&&(s=n,t.length=1),t.reverse(),n=s;n--;)t.push(0);t.reverse()}else{for((d=(n=u.length)<(a=h.length))&&(a=n),n=0;n<a;n++)if(u[n]!=h[n]){d=u[n]<h[n];break}s=0}for(d&&(t=u,u=h,h=t,e.s=-e.s),a=u.length,n=h.length-a;n>0;--n)u[a++]=0;for(n=h.length;n>s;){if(u[--n]<h[n]){for(i=n;i&&0===u[--i];)u[i]=gN-1;--u[i],u[n]+=gN}u[n]-=h[n]}for(;0===u[--a];)u.pop();for(;0===u[0];u.shift())--r;return u[0]?(e.d=u,e.e=NN(u,r),iN?TN(e,o,l):e):new p(3===l?-0:0)},wN.modulo=wN.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?TN(new n(r),n.precision,n.rounding):(iN=!1,9==n.modulo?(t=AN(r,e.abs(),0,3,1)).s*=e.s:t=AN(r,e,0,n.modulo,1),t=t.times(e),iN=!0,r.minus(t))},wN.naturalExponential=wN.exp=function(){return IN(this)},wN.naturalLogarithm=wN.ln=function(){return PN(this)},wN.negated=wN.neg=function(){var e=new this.constructor(this);return e.s=-e.s,TN(e)},wN.plus=wN.add=function(e){var t,r,n,i,s,a,o,l,u,c,d=this,h=d.constructor;if(e=new h(e),!d.d||!e.d)return d.s&&e.s?d.d||(e=new h(e.d||d.s===e.s?d:NaN)):e=new h(NaN),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(u=d.d,c=e.d,o=h.precision,l=h.rounding,!u[0]||!c[0])return c[0]||(e=new h(d)),iN?TN(e,o,l):e;if(s=cN(d.e/yN),n=cN(e.e/yN),u=u.slice(),i=s-n){for(i<0?(r=u,i=-i,a=c.length):(r=c,n=s,a=u.length),i>(a=(s=Math.ceil(o/yN))>a?s+1:a+1)&&(i=a,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for((a=u.length)-(i=c.length)<0&&(i=a,r=c,c=u,u=r),t=0;i;)t=(u[--i]=u[i]+c[i]+t)/gN|0,u[i]%=gN;for(t&&(u.unshift(t),++n),a=u.length;0==u[--a];)u.pop();return e.d=u,e.e=NN(u,n),iN?TN(e,o,l):e},wN.precision=wN.sd=function(e){var t,r=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(aN+e);return r.d?(t=ON(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t},wN.round=function(){var e=this,t=e.constructor;return TN(new t(e),e.e+1,t.rounding)},wN.sine=wN.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+yN,n.rounding=1,r=function(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:zN(e,2,t,t);r=(r=1.4*Math.sqrt(n))>16?16:0|r,t=t.times(1/jN(5,r)),t=zN(e,2,t,t);for(var i,s=new e(5),a=new e(16),o=new e(20);r--;)i=t.times(t),t=t.times(s.plus(i.times(a.times(i).minus(o))));return t}(n,qN(n,r)),n.precision=e,n.rounding=t,TN(bC>2?r.neg():r,e,t,!0)):new n(NaN)},wN.squareRoot=wN.sqrt=function(){var e,t,r,n,i,s,a=this,o=a.d,l=a.e,u=a.s,c=a.constructor;if(1!==u||!o||!o[0])return new c(!u||u<0&&(!o||o[0])?NaN:o?a:1/0);for(iN=!1,0==(u=Math.sqrt(+a))||u==1/0?(((t=xN(o)).length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=cN((l+1)/2)-(l<0||l%2),n=new c(t=u==1/0?"5e"+l:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+l)):n=new c(u.toString()),r=(l=c.precision)+3;;)if(n=(s=n).plus(AN(a,s,r+2,1)).times(.5),xN(s.d).slice(0,r)===(t=xN(n.d)).slice(0,r)){if("9999"!=(t=t.slice(r-3,r+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(TN(n,l+1,1),e=!n.times(n).eq(a));break}if(!i&&(TN(s,l+1,0),s.times(s).eq(a))){n=s;break}r+=4,i=1}return iN=!0,TN(n,l,c.rounding,e)},wN.tangent=wN.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,(r=r.sin()).s=1,r=AN(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,TN(2==bC||4==bC?r.neg():r,e,t,!0)):new n(NaN)},wN.times=wN.mul=function(e){var t,r,n,i,s,a,o,l,u,c=this,d=c.constructor,h=c.d,f=(e=new d(e)).d;if(e.s*=c.s,!(h&&h[0]&&f&&f[0]))return new d(!e.s||h&&!h[0]&&!f||f&&!f[0]&&!h?NaN:h&&f?0*e.s:e.s/0);for(r=cN(c.e/yN)+cN(e.e/yN),(l=h.length)<(u=f.length)&&(s=h,h=f,f=s,a=l,l=u,u=a),s=[],n=a=l+u;n--;)s.push(0);for(n=u;--n>=0;){for(t=0,i=l+n;i>n;)o=s[i]+f[n]*h[i-n-1]+t,s[i--]=o%gN|0,t=o/gN|0;s[i]=(s[i]+t)%gN|0}for(;!s[--a];)s.pop();return t?++r:s.shift(),e.d=s,e.e=NN(s,r),iN?TN(e,d.precision,d.rounding):e},wN.toBinary=function(e,t){return HN(this,2,e,t)},wN.toDecimalPlaces=wN.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),void 0===e?r:(EN(e,0,QC),void 0===t?t=n.rounding:EN(t,0,8),TN(r,e+r.e+1,t))},wN.toExponential=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=CN(n,!0):(EN(e,0,QC),void 0===t?t=i.rounding:EN(t,0,8),r=CN(n=TN(new i(n),e+1,t),!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r},wN.toFixed=function(e,t){var r,n,i=this,s=i.constructor;return void 0===e?r=CN(i):(EN(e,0,QC),void 0===t?t=s.rounding:EN(t,0,8),r=CN(n=TN(new s(i),e+i.e+1,t),!1,e+n.e+1)),i.isNeg()&&!i.isZero()?"-"+r:r},wN.toFraction=function(e){var t,r,n,i,s,a,o,l,u,c,d,h,f=this,p=f.d,m=f.constructor;if(!p)return new m(f);if(u=r=new m(1),n=l=new m(0),a=(s=(t=new m(n)).e=ON(p)-f.e-1)%yN,t.d[0]=dN(10,a<0?yN+a:a),null==e)e=s>0?t:u;else{if(!(o=new m(e)).isInt()||o.lt(u))throw Error(aN+o);e=o.gt(t)?s>0?t:u:o}for(iN=!1,o=new m(xN(p)),c=m.precision,m.precision=s=p.length*yN*2;d=AN(o,t,0,1,1),1!=(i=r.plus(d.times(n))).cmp(e);)r=n,n=i,i=u,u=l.plus(d.times(i)),l=i,i=t,t=o.minus(d.times(i)),o=i;return i=AN(e.minus(r),n,0,1,1),l=l.plus(i.times(u)),r=r.plus(i.times(n)),l.s=u.s=f.s,h=AN(u,n,s,1).minus(f).abs().cmp(AN(l,r,s,1).minus(f).abs())<1?[u,n]:[l,r],m.precision=c,iN=!0,h},wN.toHexadecimal=wN.toHex=function(e,t){return HN(this,16,e,t)},wN.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),null==e){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),void 0===t?t=n.rounding:EN(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(iN=!1,r=AN(r,e,0,t,1).times(e),iN=!0,TN(r)):(e.s=r.s,r=e),r},wN.toNumber=function(){return+this},wN.toOctal=function(e,t){return HN(this,8,e,t)},wN.toPower=wN.pow=function(e){var t,r,n,i,s,a,o=this,l=o.constructor,u=+(e=new l(e));if(!(o.d&&e.d&&o.d[0]&&e.d[0]))return new l(dN(+o,u));if((o=new l(o)).eq(1))return o;if(n=l.precision,s=l.rounding,e.eq(1))return TN(o,n,s);if((t=cN(e.e/yN))>=e.d.length-1&&(r=u<0?-u:u)<=9007199254740991)return i=LN(l,o,r,n),e.s<0?new l(1).div(i):TN(i,n,s);if((a=o.s)<0){if(t<e.d.length-1)return new l(NaN);if(0==(1&e.d[t])&&(a=1),0==o.e&&1==o.d[0]&&1==o.d.length)return o.s=a,o}return(t=0!=(r=dN(+o,u))&&isFinite(r)?new l(r+"").e:cN(u*(Math.log("0."+xN(o.d))/Math.LN10+o.e+1)))>l.maxE+1||t<l.minE-1?new l(t>0?a/0:0):(iN=!1,l.rounding=o.s=1,r=Math.min(12,(t+"").length),(i=IN(e.times(PN(o,n+r)),n)).d&&DN((i=TN(i,n+5,1)).d,n,s)&&(t=n+10,+xN((i=TN(IN(e.times(PN(o,t+r)),t),t+5,1)).d).slice(n+1,n+15)+1==1e14&&(i=TN(i,n+1,0))),i.s=a,iN=!0,l.rounding=s,TN(i,n,s))},wN.toPrecision=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=CN(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(EN(e,1,QC),void 0===t?t=i.rounding:EN(t,0,8),r=CN(n=TN(new i(n),e,t),e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r},wN.toSignificantDigits=wN.toSD=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(EN(e,1,QC),void 0===t?t=r.rounding:EN(t,0,8)),TN(new r(this),e,t)},wN.toString=function(){var e=this,t=e.constructor,r=CN(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r},wN.truncated=wN.trunc=function(){return TN(new this.constructor(this),this.e+1,1)},wN.valueOf=wN.toJSON=function(){var e=this,t=e.constructor,r=CN(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};var AN=function(){function e(e,t,r){var n,i=0,s=e.length;for(e=e.slice();s--;)n=e[s]*t+i,e[s]=n%r|0,i=n/r|0;return i&&e.unshift(i),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(n,i,s,a,o,l){var u,c,d,h,f,p,m,g,y,v,b,w,x,E,D,S,A,T,C,N,k=n.constructor,M=n.s==i.s?1:-1,O=n.d,F=i.d;if(!(O&&O[0]&&F&&F[0]))return new k(n.s&&i.s&&(O?!F||O[0]!=F[0]:F)?O&&0==O[0]||!F?0*M:M/0:NaN);for(l?(f=1,c=n.e-i.e):(l=gN,f=yN,c=cN(n.e/f)-cN(i.e/f)),C=F.length,A=O.length,v=(y=new k(M)).d=[],d=0;F[d]==(O[d]||0);d++);if(F[d]>(O[d]||0)&&c--,null==s?(E=s=k.precision,a=k.rounding):E=o?s+(n.e-i.e)+1:s,E<0)v.push(1),p=!0;else{if(E=E/f+2|0,d=0,1==C){for(h=0,F=F[0],E++;(d<A||h)&&E--;d++)D=h*l+(O[d]||0),v[d]=D/F|0,h=D%F|0;p=h||d<A}else{for((h=l/(F[0]+1)|0)>1&&(F=e(F,h,l),O=e(O,h,l),C=F.length,A=O.length),S=C,w=(b=O.slice(0,C)).length;w<C;)b[w++]=0;(N=F.slice()).unshift(0),T=F[0],F[1]>=l/2&&++T;do{h=0,(u=t(F,b,C,w))<0?(x=b[0],C!=w&&(x=x*l+(b[1]||0)),(h=x/T|0)>1?(h>=l&&(h=l-1),1==(u=t(m=e(F,h,l),b,g=m.length,w=b.length))&&(h--,r(m,C<g?N:F,g,l))):(0==h&&(u=h=1),m=F.slice()),(g=m.length)<w&&m.unshift(0),r(b,m,w,l),-1==u&&(u=t(F,b,C,w=b.length))<1&&(h++,r(b,C<w?N:F,w,l)),w=b.length):0===u&&(h++,b=[0]),v[d++]=h,u&&b[0]?b[w++]=O[S]||0:(b=[O[S]],w=1)}while((S++<A||void 0!==b[0])&&E--);p=void 0!==b[0]}v[0]||v.shift()}if(1==f)y.e=c,vC=p;else{for(d=1,h=v[0];h>=10;h/=10)d++;y.e=d+c*f-1,TN(y,o?s+y.e+1:s,a,p)}return y}}();function TN(e,t,r,n){var i,s,a,o,l,u,c,d,h,f=e.constructor;e:if(null!=t){if(!(d=e.d))return e;for(i=1,o=d[0];o>=10;o/=10)i++;if((s=t-i)<0)s+=yN,a=t,l=(c=d[h=0])/dN(10,i-a-1)%10|0;else if((h=Math.ceil((s+1)/yN))>=(o=d.length)){if(!n)break e;for(;o++<=h;)d.push(0);c=l=0,i=1,a=(s%=yN)-yN+1}else{for(c=o=d[h],i=1;o>=10;o/=10)i++;l=(a=(s%=yN)-yN+i)<0?0:c/dN(10,i-a-1)%10|0}if(n=n||t<0||void 0!==d[h+1]||(a<0?c:c%dN(10,i-a-1)),u=r<4?(l||n)&&(0==r||r==(e.s<0?3:2)):l>5||5==l&&(4==r||n||6==r&&(s>0?a>0?c/dN(10,i-a):0:d[h-1])%10&1||r==(e.s<0?8:7)),t<1||!d[0])return d.length=0,u?(t-=e.e+1,d[0]=dN(10,(yN-t%yN)%yN),e.e=-t||0):d[0]=e.e=0,e;if(0==s?(d.length=h,o=1,h--):(d.length=h+1,o=dN(10,yN-s),d[h]=a>0?(c/dN(10,i-a)%dN(10,a)|0)*o:0),u)for(;;){if(0==h){for(s=1,a=d[0];a>=10;a/=10)s++;for(a=d[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(e.e++,d[0]==gN&&(d[0]=1));break}if(d[h]+=o,d[h]!=gN)break;d[h--]=0,o=1}for(s=d.length;0===d[--s];)d.pop()}return iN&&(e.e>f.maxE?(e.d=null,e.e=NaN):e.e<f.minE&&(e.e=0,e.d=[0])),e}function CN(e,t,r){if(!e.isFinite())return BN(e);var n,i=e.e,s=xN(e.d),a=s.length;return t?(r&&(n=r-a)>0?s=s.charAt(0)+"."+s.slice(1)+FN(n):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):i<0?(s="0."+FN(-i-1)+s,r&&(n=r-a)>0&&(s+=FN(n))):i>=a?(s+=FN(i+1-a),r&&(n=r-i-1)>0&&(s=s+"."+FN(n))):((n=i+1)<a&&(s=s.slice(0,n)+"."+s.slice(n)),r&&(n=r-a)>0&&(i+1===a&&(s+="."),s+=FN(n))),s}function NN(e,t){var r=e[0];for(t*=yN;r>=10;r/=10)t++;return t}function kN(e,t,r){if(t>vN)throw iN=!0,r&&(e.precision=r),Error(oN);return TN(new e(tN),t,1,!0)}function MN(e,t,r){if(t>bN)throw Error(oN);return TN(new e(rN),t,r,!0)}function ON(e){var t=e.length-1,r=t*yN+1;if(t=e[t]){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function FN(e){for(var t="";e--;)t+="0";return t}function LN(e,t,r,n){var i,s=new e(1),a=Math.ceil(n/yN+4);for(iN=!1;;){if(r%2&&VN((s=s.times(t)).d,a)&&(i=!0),0===(r=cN(r/2))){r=s.d.length-1,i&&0===s.d[r]&&++s.d[r];break}VN((t=t.times(t)).d,a)}return iN=!0,s}function _N(e){return 1&e.d[e.d.length-1]}function RN(e,t,r){for(var n,i=new e(t[0]),s=0;++s<t.length;){if(!(n=new e(t[s])).s){i=n;break}i[r](n)&&(i=n)}return i}function IN(e,t){var r,n,i,s,a,o,l,u=0,c=0,d=0,h=e.constructor,f=h.rounding,p=h.precision;if(!e.d||!e.d[0]||e.e>17)return new h(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(iN=!1,l=p):l=t,o=new h(.03125);e.e>-2;)e=e.times(o),d+=5;for(l+=n=Math.log(dN(2,d))/Math.LN10*2+5|0,r=s=a=new h(1),h.precision=l;;){if(s=TN(s.times(e),l,1),r=r.times(++c),xN((o=a.plus(AN(s,r,l,1))).d).slice(0,l)===xN(a.d).slice(0,l)){for(i=d;i--;)a=TN(a.times(a),l,1);if(null!=t)return h.precision=p,a;if(!(u<3&&DN(a.d,l-n,f,u)))return TN(a,h.precision=p,f,iN=!0);h.precision=l+=10,r=s=o=new h(1),c=0,u++}a=o}}function PN(e,t){var r,n,i,s,a,o,l,u,c,d,h,f=1,p=e,m=p.d,g=p.constructor,y=g.rounding,v=g.precision;if(p.s<0||!m||!m[0]||!p.e&&1==m[0]&&1==m.length)return new g(m&&!m[0]?-1/0:1!=p.s?NaN:m?0:p);if(null==t?(iN=!1,c=v):c=t,g.precision=c+=10,n=(r=xN(m)).charAt(0),!(Math.abs(s=p.e)<15e14))return u=kN(g,c+2,v).times(s+""),p=PN(new g(n+"."+r.slice(1)),c-10).plus(u),g.precision=v,null==t?TN(p,v,y,iN=!0):p;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=xN((p=p.times(e)).d)).charAt(0),f++;for(s=p.e,n>1?(p=new g("0."+r),s++):p=new g(n+"."+r.slice(1)),d=p,l=a=p=AN(p.minus(1),p.plus(1),c,1),h=TN(p.times(p),c,1),i=3;;){if(a=TN(a.times(h),c,1),xN((u=l.plus(AN(a,new g(i),c,1))).d).slice(0,c)===xN(l.d).slice(0,c)){if(l=l.times(2),0!==s&&(l=l.plus(kN(g,c+2,v).times(s+""))),l=AN(l,new g(f),c,1),null!=t)return g.precision=v,l;if(!DN(l.d,c-10,y,o))return TN(l,g.precision=v,y,iN=!0);g.precision=c+=10,u=a=p=AN(d.minus(1),d.plus(1),c,1),h=TN(p.times(p),c,1),i=o=1}l=u,i+=2}}function BN(e){return String(e.s*e.s/0)}function UN(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;48===t.charCodeAt(n);n++);for(i=t.length;48===t.charCodeAt(i-1);--i);if(t=t.slice(n,i)){if(i-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%yN,r<0&&(n+=yN),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=yN;n<i;)e.d.push(+t.slice(n,n+=yN));t=t.slice(n),n=yN-t.length}else n-=i;for(;n--;)t+="0";e.d.push(+t),iN&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function $N(e,t){var r,n,i,s,a,o,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),mN.test(t))return UN(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(fN.test(t))r=16,t=t.toLowerCase();else if(hN.test(t))r=2;else{if(!pN.test(t))throw Error(aN+t);r=8}for((s=t.search(/p/i))>0?(l=+t.slice(s+1),t=t.substring(2,s)):t=t.slice(2),a=(s=t.indexOf("."))>=0,n=e.constructor,a&&(s=(o=(t=t.replace(".","")).length)-s,i=LN(n,new n(r),s,2*s)),s=c=(u=SN(t,r,gN)).length-1;0===u[s];--s)u.pop();return s<0?new n(0*e.s):(e.e=NN(u,c),e.d=u,iN=!1,a&&(e=AN(e,i,4*o)),l&&(e=e.times(Math.abs(l)<54?dN(2,l):Fk.pow(2,l))),iN=!0,e)}function zN(e,t,r,n,i){var s,a,o,l,u=e.precision,c=Math.ceil(u/yN);for(iN=!1,l=r.times(r),o=new e(n);;){if(a=AN(o.times(l),new e(t++*t++),u,1),o=i?n.plus(a):n.minus(a),n=AN(a.times(l),new e(t++*t++),u,1),void 0!==(a=o.plus(n)).d[c]){for(s=c;a.d[s]===o.d[s]&&s--;);if(-1==s)break}s=o,o=n,n=a,a=s}return iN=!0,a.d.length=c+1,a}function jN(e,t){for(var r=e;--t;)r*=e;return r}function qN(e,t){var r,n=t.s<0,i=MN(e,e.precision,1),s=i.times(.5);if((t=t.abs()).lte(s))return bC=n?4:1,t;if((r=t.divToInt(i)).isZero())bC=n?3:2;else{if((t=t.minus(r.times(i))).lte(s))return bC=_N(r)?n?2:3:n?4:1,t;bC=_N(r)?n?1:4:n?3:2}return t.minus(i).abs()}function HN(e,t,r,n){var i,s,a,o,l,u,c,d,h,f=e.constructor,p=void 0!==r;if(p?(EN(r,1,QC),void 0===n?n=f.rounding:EN(n,0,8)):(r=f.precision,n=f.rounding),e.isFinite()){for(p?(i=2,16==t?r=4*r-3:8==t&&(r=3*r-2)):i=t,(a=(c=CN(e)).indexOf("."))>=0&&(c=c.replace(".",""),(h=new f(1)).e=c.length-a,h.d=SN(CN(h),10,i),h.e=h.d.length),s=l=(d=SN(c,10,i)).length;0==d[--l];)d.pop();if(d[0]){if(a<0?s--:((e=new f(e)).d=d,e.e=s,d=(e=AN(e,h,r,n,0,i)).d,s=e.e,u=vC),a=d[r],o=i/2,u=u||void 0!==d[r+1],u=n<4?(void 0!==a||u)&&(0===n||n===(e.s<0?3:2)):a>o||a===o&&(4===n||u||6===n&&1&d[r-1]||n===(e.s<0?8:7)),d.length=r,u)for(;++d[--r]>i-1;)d[r]=0,r||(++s,d.unshift(1));for(l=d.length;!d[l-1];--l);for(a=0,c="";a<l;a++)c+=eN.charAt(d[a]);if(p){if(l>1)if(16==t||8==t){for(a=16==t?4:3,--l;l%a;l++)c+="0";for(l=(d=SN(c,i,t)).length;!d[l-1];--l);for(a=1,c="1.";a<l;a++)c+=eN.charAt(d[a])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}else c=p?"0p+0":"0";c=(16==t?"0x":2==t?"0b":8==t?"0o":"")+c}else c=BN(e);return e.s<0?"-"+c:c}function VN(e,t){if(e.length>t)return e.length=t,!0}function GN(e){return new this(e).abs()}function KN(e){return new this(e).acos()}function WN(e){return new this(e).acosh()}function YN(e,t){return new this(e).plus(t)}function JN(e){return new this(e).asin()}function ZN(e){return new this(e).asinh()}function XN(e){return new this(e).atan()}function QN(e){return new this(e).atanh()}function ek(e,t){e=new this(e),t=new this(t);var r,n=this.precision,i=this.rounding,s=n+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(r=t.s<0?MN(this,n,i):new this(0)).s=e.s:!e.d||t.isZero()?(r=MN(this,s,1).times(.5)).s=e.s:t.s<0?(this.precision=s,this.rounding=1,r=this.atan(AN(e,t,s,1)),t=MN(this,s,1),this.precision=n,this.rounding=i,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(AN(e,t,s,1)):(r=MN(this,s,1).times(t.s>0?.25:.75)).s=e.s:r=new this(NaN),r}function tk(e){return new this(e).cbrt()}function rk(e){return TN(e=new this(e),e.e+1,2)}function nk(e,t,r){return new this(e).clamp(t,r)}function ik(e){if(!e||"object"!=typeof e)throw Error(sN+"Object expected");var t,r,n,i=!0===e.defaults,s=["precision",1,QC,"rounding",0,8,"toExpNeg",-XC,0,"toExpPos",0,XC,"maxE",0,XC,"minE",-XC,0,"modulo",0,9];for(t=0;t<s.length;t+=3)if(r=s[t],i&&(this[r]=nN[r]),void 0!==(n=e[r])){if(!(cN(n)===n&&n>=s[t+1]&&n<=s[t+2]))throw Error(aN+r+": "+n);this[r]=n}if(r="crypto",i&&(this[r]=nN[r]),void 0!==(n=e[r])){if(!0!==n&&!1!==n&&0!==n&&1!==n)throw Error(aN+r+": "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(lN);this[r]=!0}else this[r]=!1}return this}function sk(e){return new this(e).cos()}function ak(e){return new this(e).cosh()}function ok(e,t){return new this(e).div(t)}function lk(e){return new this(e).exp()}function uk(e){return TN(e=new this(e),e.e+1,3)}function ck(){var e,t,r=new this(0);for(iN=!1,e=0;e<arguments.length;)if((t=new this(arguments[e++])).d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return iN=!0,new this(1/0);r=t}return iN=!0,r.sqrt()}function dk(e){return e instanceof Fk||e&&e.toStringTag===uN||!1}function hk(e){return new this(e).ln()}function fk(e,t){return new this(e).log(t)}function pk(e){return new this(e).log(2)}function mk(e){return new this(e).log(10)}function gk(){return RN(this,arguments,"lt")}function yk(){return RN(this,arguments,"gt")}function vk(e,t){return new this(e).mod(t)}function bk(e,t){return new this(e).mul(t)}function wk(e,t){return new this(e).pow(t)}function xk(e){var t,r,n,i,s=0,a=new this(1),o=[];if(void 0===e?e=this.precision:EN(e,1,QC),n=Math.ceil(e/yN),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));s<n;)(i=t[s])>=429e7?t[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=i%1e7;else{if(!crypto.randomBytes)throw Error(lN);for(t=crypto.randomBytes(n*=4);s<n;)(i=t[s]+(t[s+1]<<8)+(t[s+2]<<16)+((127&t[s+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,s):(o.push(i%1e7),s+=4);s=n/4}else for(;s<n;)o[s++]=1e7*Math.random()|0;for(n=o[--s],e%=yN,n&&e&&(i=dN(10,yN-e),o[s]=(n/i|0)*i);0===o[s];s--)o.pop();if(s<0)r=0,o=[0];else{for(r=-1;0===o[0];r-=yN)o.shift();for(n=1,i=o[0];i>=10;i/=10)n++;n<yN&&(r-=yN-n)}return a.e=r,a.d=o,a}function Ek(e){return TN(e=new this(e),e.e+1,this.rounding)}function Dk(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function Sk(e){return new this(e).sin()}function Ak(e){return new this(e).sinh()}function Tk(e){return new this(e).sqrt()}function Ck(e,t){return new this(e).sub(t)}function Nk(){var e=0,t=arguments,r=new this(t[e]);for(iN=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return iN=!0,TN(r,this.precision,this.rounding)}function kk(e){return new this(e).tan()}function Mk(e){return new this(e).tanh()}function Ok(e){return TN(e=new this(e),e.e+1,1)}wN[Symbol.for("nodejs.util.inspect.custom")]=wN.toString,wN[Symbol.toStringTag]="Decimal";var Fk=wN.constructor=function e(t){var r,n,i;function s(e){var t,r,n,i=this;if(!(i instanceof s))return new s(e);if(i.constructor=s,dk(e))return i.s=e.s,void(iN?!e.d||e.e>s.maxE?(i.e=NaN,i.d=null):e.e<s.minE?(i.e=0,i.d=[0]):(i.e=e.e,i.d=e.d.slice()):(i.e=e.e,i.d=e.d?e.d.slice():e.d));if("number"===(n=typeof e)){if(0===e)return i.s=1/e<0?-1:1,i.e=0,void(i.d=[0]);if(e<0?(e=-e,i.s=-1):i.s=1,e===~~e&&e<1e7){for(t=0,r=e;r>=10;r/=10)t++;return void(iN?t>s.maxE?(i.e=NaN,i.d=null):t<s.minE?(i.e=0,i.d=[0]):(i.e=t,i.d=[e]):(i.e=t,i.d=[e]))}return 0*e!=0?(e||(i.s=NaN),i.e=NaN,void(i.d=null)):UN(i,e.toString())}if("string"!==n)throw Error(aN+e);return 45===(r=e.charCodeAt(0))?(e=e.slice(1),i.s=-1):(43===r&&(e=e.slice(1)),i.s=1),mN.test(e)?UN(i,e):$N(i,e)}if(s.prototype=wN,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=ik,s.clone=e,s.isDecimal=dk,s.abs=GN,s.acos=KN,s.acosh=WN,s.add=YN,s.asin=JN,s.asinh=ZN,s.atan=XN,s.atanh=QN,s.atan2=ek,s.cbrt=tk,s.ceil=rk,s.clamp=nk,s.cos=sk,s.cosh=ak,s.div=ok,s.exp=lk,s.floor=uk,s.hypot=ck,s.ln=hk,s.log=fk,s.log10=mk,s.log2=pk,s.max=gk,s.min=yk,s.mod=vk,s.mul=bk,s.pow=wk,s.random=xk,s.round=Ek,s.sign=Dk,s.sin=Sk,s.sinh=Ak,s.sqrt=Tk,s.sub=Ck,s.sum=Nk,s.tan=kk,s.tanh=Mk,s.trunc=Ok,void 0===t&&(t={}),t&&!0!==t.defaults)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<i.length;)t.hasOwnProperty(n=i[r++])||(t[n]=this[n]);return s.config(t),s}(nN);tN=new Fk(tN),rN=new Fk(rN);const Lk=Fk;var _k=BD("BigNumber",["?on","config"],(e=>{var{on:t,config:r}=e,n=Lk.clone({precision:r.precision,modulo:Lk.EUCLID});return n.prototype=Object.create(n.prototype),n.prototype.type="BigNumber",n.prototype.isBigNumber=!0,n.prototype.toJSON=function(){return{mathjs:"BigNumber",value:this.toString()}},n.fromJSON=function(e){return new n(e.value)},t&&t("config",(function(e,t){e.precision!==t.precision&&n.config({precision:e.precision})})),n}),{isClass:!0}),Rk=r(1977),Ik=BD("Complex",[],(()=>(Object.defineProperty(Rk,"name",{value:"Complex"}),Rk.prototype.constructor=Rk,Rk.prototype.type="Complex",Rk.prototype.isComplex=!0,Rk.prototype.toJSON=function(){return{mathjs:"Complex",re:this.re,im:this.im}},Rk.prototype.toPolar=function(){return{r:this.abs(),phi:this.arg()}},Rk.prototype.format=function(e){var t=this.im,r=this.re,n=cS(this.re,e),i=cS(this.im,e),s=GE(e)?e:e?e.precision:null;if(null!==s){var a=Math.pow(10,-s);Math.abs(r/t)<a&&(r=0),Math.abs(t/r)<a&&(t=0)}return 0===t?n:0===r?1===t?"i":-1===t?"-i":i+"i":t<0?-1===t?n+" - i":n+" - "+i.substring(1)+"i":1===t?n+" + i":n+" + "+i+"i"},Rk.fromPolar=function(e){switch(arguments.length){case 1:var t=arguments[0];if("object"==typeof t)return Rk(t);throw new TypeError("Input has to be an object with r and phi keys.");case 2:var r=arguments[0],n=arguments[1];if(GE(r)){if(JE(n)&&n.hasBase("ANGLE")&&(n=n.toNumber("rad")),GE(n))return new Rk({r,phi:n});throw new TypeError("Phi is not a number nor an angle unit.")}throw new TypeError("Radius r is not a number.");default:throw new SyntaxError("Wrong number of arguments in function fromPolar")}},Rk.prototype.valueOf=Rk.prototype.toString,Rk.fromJSON=function(e){return new Rk(e)},Rk.compare=function(e,t){return e.re>t.re?1:e.re<t.re?-1:e.im>t.im?1:e.im<t.im?-1:0},Rk)),{isClass:!0});function Pk(e){var t=0,r=1,n=Object.create(null),i=Object.create(null),s=0,a=function(e){var a=i[e];if(a&&(delete n[a],delete i[e],--t,r===a)){if(!t)return s=0,void(r=1);for(;!hasOwnProperty.call(n,++r);)continue}};return e=Math.abs(e),{hit:function(o){var l=i[o],u=++s;if(n[u]=o,i[o]=u,!l){if(++t<=e)return;return o=n[r],a(o),o}if(delete n[l],r===l)for(;!hasOwnProperty.call(n,++r);)continue},delete:a,clear:function(){t=s=0,r=1,n=Object.create(null),i=Object.create(null)}}}function Bk(e){var{hasher:t,limit:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=null==r?Number.POSITIVE_INFINITY:r,t=null==t?JSON.stringify:t,function n(){"object"!=typeof n.cache&&(n.cache={values:new Map,lru:Pk(r||Number.POSITIVE_INFINITY)});for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var a=t(i);if(n.cache.values.has(a))return n.cache.lru.hit(a),n.cache.values.get(a);var o=e.apply(e,i);return n.cache.values.set(a,o),n.cache.values.delete(n.cache.lru.hit(a)),o}}function Uk(e){return Object.keys(e.signatures||{}).reduce((function(e,t){var r=(t.match(/,/g)||[]).length+1;return Math.max(e,r)}),-1)}var $k=Bk((function(e){return new e(1).exp()}),{hasher:Hk}),zk=Bk((function(e){return new e(1).plus(new e(5).sqrt()).div(2)}),{hasher:Hk}),jk=Bk((function(e){return e.acos(-1)}),{hasher:Hk}),qk=Bk((function(e){return jk(e).times(2)}),{hasher:Hk});function Hk(e){return e[0].precision}var Vk=Math.PI,Gk=2*Math.PI,Kk=Math.E,Wk=BD("true",[],(()=>!0)),Yk=BD("false",[],(()=>!1)),Jk=BD("null",[],(()=>null)),Zk=dM("Infinity",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r(1/0):1/0})),Xk=dM("NaN",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r(NaN):NaN})),Qk=dM("pi",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?jk(r):Vk})),eM=dM("tau",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?qk(r):Gk})),tM=dM("e",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?$k(r):Kk})),rM=dM("phi",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?zk(r):1.618033988749895})),nM=dM("LN2",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r(2).ln():Math.LN2})),iM=dM("LN10",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r(10).ln():Math.LN10})),sM=dM("LOG2E",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r(1).div(new r(2).ln()):Math.LOG2E})),aM=dM("LOG10E",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r(1).div(new r(10).ln()):Math.LOG10E})),oM=dM("SQRT1_2",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r("0.5").sqrt():Math.SQRT1_2})),lM=dM("SQRT2",["config","?BigNumber"],(e=>{var{config:t,BigNumber:r}=e;return"BigNumber"===t.number?new r(2).sqrt():Math.SQRT2})),uM=dM("i",["Complex"],(e=>{var{Complex:t}=e;return t.I})),cM=BD("version",[],(()=>"11.9.1"));function dM(e,t,r){return BD(e,t,r,{recreateOnConfigChange:!0})}var hM=lO("speedOfLight","299792458","m s^-1"),fM=lO("gravitationConstant","6.67430e-11","m^3 kg^-1 s^-2"),pM=lO("planckConstant","6.62607015e-34","J s"),mM=lO("reducedPlanckConstant","1.0545718176461565e-34","J s"),gM=lO("magneticConstant","1.25663706212e-6","N A^-2"),yM=lO("electricConstant","8.8541878128e-12","F m^-1"),vM=lO("vacuumImpedance","376.730313667","ohm"),bM=lO("coulomb","8.987551792261171e9","N m^2 C^-2"),wM=lO("elementaryCharge","1.602176634e-19","C"),xM=lO("bohrMagneton","9.2740100783e-24","J T^-1"),EM=lO("conductanceQuantum","7.748091729863649e-5","S"),DM=lO("inverseConductanceQuantum","12906.403729652257","ohm"),SM=lO("magneticFluxQuantum","2.0678338484619295e-15","Wb"),AM=lO("nuclearMagneton","5.0507837461e-27","J T^-1"),TM=lO("klitzing","25812.807459304513","ohm"),CM=lO("bohrRadius","5.29177210903e-11","m"),NM=lO("classicalElectronRadius","2.8179403262e-15","m"),kM=lO("electronMass","9.1093837015e-31","kg"),MM=lO("fermiCoupling","1.1663787e-5","GeV^-2"),OM=uO("fineStructure",.0072973525693),FM=lO("hartreeEnergy","4.3597447222071e-18","J"),LM=lO("protonMass","1.67262192369e-27","kg"),_M=lO("deuteronMass","3.3435830926e-27","kg"),RM=lO("neutronMass","1.6749271613e-27","kg"),IM=lO("quantumOfCirculation","3.6369475516e-4","m^2 s^-1"),PM=lO("rydberg","10973731.568160","m^-1"),BM=lO("thomsonCrossSection","6.6524587321e-29","m^2"),UM=uO("weakMixingAngle",.2229),$M=uO("efimovFactor",22.7),zM=lO("atomicMass","1.66053906660e-27","kg"),jM=lO("avogadro","6.02214076e23","mol^-1"),qM=lO("boltzmann","1.380649e-23","J K^-1"),HM=lO("faraday","96485.33212331001","C mol^-1"),VM=lO("firstRadiation","3.7417718521927573e-16","W m^2"),GM=lO("loschmidt","2.686780111798444e25","m^-3"),KM=lO("gasConstant","8.31446261815324","J K^-1 mol^-1"),WM=lO("molarPlanckConstant","3.990312712893431e-10","J s mol^-1"),YM=lO("molarVolume","0.022413969545014137","m^3 mol^-1"),JM=uO("sackurTetrode",-1.16487052358),ZM=lO("secondRadiation","0.014387768775039337","m K"),XM=lO("stefanBoltzmann","5.67037441918443e-8","W m^-2 K^-4"),QM=lO("wienDisplacement","2.897771955e-3","m K"),eO=lO("molarMass","0.99999999965e-3","kg mol^-1"),tO=lO("molarMassC12","11.9999999958e-3","kg mol^-1"),rO=lO("gravity","9.80665","m s^-2"),nO=lO("planckLength","1.616255e-35","m"),iO=lO("planckMass","2.176435e-8","kg"),sO=lO("planckTime","5.391245e-44","s"),aO=lO("planckCharge","1.87554603778e-18","C"),oO=lO("planckTemperature","1.416785e+32","K");function lO(e,t,r){return BD(e,["config","Unit","BigNumber"],(e=>{var{config:n,Unit:i,BigNumber:s}=e,a=new i("BigNumber"===n.number?new s(t):parseFloat(t),r);return a.fixPrefix=!0,a}))}function uO(e,t){return BD(e,["config","BigNumber"],(e=>{var{config:r,BigNumber:n}=e;return"BigNumber"===r.number?new n(t):t}))}var cO=r(5628),dO=BD("Fraction",[],(()=>(Object.defineProperty(cO,"name",{value:"Fraction"}),cO.prototype.constructor=cO,cO.prototype.type="Fraction",cO.prototype.isFraction=!0,cO.prototype.toJSON=function(){return{mathjs:"Fraction",n:this.s*this.n,d:this.d}},cO.fromJSON=function(e){return new cO(e)},cO)),{isClass:!0}),hO=BD("Matrix",[],(()=>{function e(){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator")}return e.prototype.type="Matrix",e.prototype.isMatrix=!0,e.prototype.storage=function(){throw new Error("Cannot invoke storage on a Matrix interface")},e.prototype.datatype=function(){throw new Error("Cannot invoke datatype on a Matrix interface")},e.prototype.create=function(e,t){throw new Error("Cannot invoke create on a Matrix interface")},e.prototype.subset=function(e,t,r){throw new Error("Cannot invoke subset on a Matrix interface")},e.prototype.get=function(e){throw new Error("Cannot invoke get on a Matrix interface")},e.prototype.set=function(e,t,r){throw new Error("Cannot invoke set on a Matrix interface")},e.prototype.resize=function(e,t){throw new Error("Cannot invoke resize on a Matrix interface")},e.prototype.reshape=function(e,t){throw new Error("Cannot invoke reshape on a Matrix interface")},e.prototype.clone=function(){throw new Error("Cannot invoke clone on a Matrix interface")},e.prototype.size=function(){throw new Error("Cannot invoke size on a Matrix interface")},e.prototype.map=function(e,t){throw new Error("Cannot invoke map on a Matrix interface")},e.prototype.forEach=function(e){throw new Error("Cannot invoke forEach on a Matrix interface")},e.prototype[Symbol.iterator]=function(){throw new Error("Cannot iterate a Matrix interface")},e.prototype.toArray=function(){throw new Error("Cannot invoke toArray on a Matrix interface")},e.prototype.valueOf=function(){throw new Error("Cannot invoke valueOf on a Matrix interface")},e.prototype.format=function(e){throw new Error("Cannot invoke format on a Matrix interface")},e.prototype.toString=function(){throw new Error("Cannot invoke toString on a Matrix interface")},e}),{isClass:!0}),fO=BD("Range",[],(()=>{function e(t,r,n){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator");var i=null!=t,s=null!=r,a=null!=n;if(i)if(KE(t))t=t.toNumber();else if("number"!=typeof t)throw new TypeError("Parameter start must be a number");if(s)if(KE(r))r=r.toNumber();else if("number"!=typeof r)throw new TypeError("Parameter end must be a number");if(a)if(KE(n))n=n.toNumber();else if("number"!=typeof n)throw new TypeError("Parameter step must be a number");this.start=i?parseFloat(t):0,this.end=s?parseFloat(r):0,this.step=a?parseFloat(n):1}return e.prototype.type="Range",e.prototype.isRange=!0,e.parse=function(t){if("string"!=typeof t)return null;var r=t.split(":").map((function(e){return parseFloat(e)}));if(r.some((function(e){return isNaN(e)})))return null;switch(r.length){case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[2],r[1]);default:return null}},e.prototype.clone=function(){return new e(this.start,this.end,this.step)},e.prototype.size=function(){var e=0,t=this.start,r=this.step,n=this.end-t;return nS(r)===nS(n)?e=Math.ceil(n/r):0===n&&(e=0),isNaN(e)&&(e=0),[e]},e.prototype.min=function(){var e=this.size()[0];return e>0?this.step>0?this.start:this.start+(e-1)*this.step:void 0},e.prototype.max=function(){var e=this.size()[0];return e>0?this.step>0?this.start+(e-1)*this.step:this.start:void 0},e.prototype.forEach=function(e){var t=this.start,r=this.step,n=this.end,i=0;if(r>0)for(;t<n;)e(t,[i],this),t+=r,i++;else if(r<0)for(;t>n;)e(t,[i],this),t+=r,i++},e.prototype.map=function(e){var t=[];return this.forEach((function(r,n,i){t[n[0]]=e(r,n,i)})),t},e.prototype.toArray=function(){var e=[];return this.forEach((function(t,r){e[r[0]]=t})),e},e.prototype.valueOf=function(){return this.toArray()},e.prototype.format=function(e){var t=cS(this.start,e);return 1!==this.step&&(t+=":"+cS(this.step,e)),t+=":"+cS(this.end,e)},e.prototype.toString=function(){return this.format()},e.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},e.fromJSON=function(t){return new e(t.start,t.end,t.step)},e}),{isClass:!0}),pO=BD("ResultSet",[],(()=>{function e(t){if(!(this instanceof e))throw new SyntaxError("Constructor must be called with the new operator");this.entries=t||[]}return e.prototype.type="ResultSet",e.prototype.isResultSet=!0,e.prototype.valueOf=function(){return this.entries},e.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},e.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},e.fromJSON=function(t){return new e(t.entries)},e}),{isClass:!0}),mO=BD("DenseMatrix",["Matrix"],(e=>{var{Matrix:t}=e;function r(e,t){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");if(t&&!ZE(t))throw new Error("Invalid datatype: "+t);if(QE(e))"DenseMatrix"===e.type?(this._data=_D(e._data),this._size=_D(e._size),this._datatype=t||e._datatype):(this._data=e.toArray(),this._size=e.size(),this._datatype=t||e._datatype);else if(e&&XE(e.data)&&XE(e.size))this._data=e.data,this._size=e.size,US(this._data,this._size),this._datatype=t||e.datatype;else if(XE(e))this._data=o(e),this._size=PS(this._data),US(this._data,this._size),this._datatype=t;else{if(e)throw new TypeError("Unsupported type of data ("+FD(e)+")");this._data=[],this._size=[0],this._datatype=t}}function n(e,t,r,i){var s=i===r-1,a=t.dimension(i);return s?a.map((function(t){return $S(t,e.length),e[t]})).valueOf():a.map((function(s){return $S(s,e.length),n(e[s],t,r,i+1)})).valueOf()}function i(e,t,r,n,s){var a=s===n-1,o=t.dimension(s);a?o.forEach((function(t,n){$S(t),e[t]=r[n[0]]})):o.forEach((function(a,o){$S(a),i(e[a],t,r[o[0]],n,s+1)}))}function s(e,t,r){if(0===t.length){for(var n=e._data;XE(n);)n=n[0];return n}return e._size=t.slice(0),e._data=zS(e._data,e._size,r),e}function a(e,t,r){for(var n=e._size.slice(0),i=!1;n.length<t.length;)n.push(0),i=!0;for(var a=0,o=t.length;a<o;a++)t[a]>n[a]&&(n[a]=t[a],i=!0);i&&s(e,n,r)}function o(e){for(var t=0,r=e.length;t<r;t++){var n=e[t];XE(n)?e[t]=o(n):n&&!0===n.isMatrix&&(e[t]=o(n.valueOf()))}return e}return r.prototype=new t,r.prototype.createDenseMatrix=function(e,t){return new r(e,t)},Object.defineProperty(r,"name",{value:"DenseMatrix"}),r.prototype.constructor=r,r.prototype.type="DenseMatrix",r.prototype.isDenseMatrix=!0,r.prototype.getDataType=function(){return iA(this._data,FD)},r.prototype.storage=function(){return"dense"},r.prototype.datatype=function(){return this._datatype},r.prototype.create=function(e,t){return new r(e,t)},r.prototype.subset=function(e,t,s){switch(arguments.length){case 1:return function(e,t){if(!iD(t))throw new TypeError("Invalid index");var i=t.isScalar();if(i)return e.get(t.min());var s=t.size();if(s.length!==e._size.length)throw new RS(s.length,e._size.length);for(var a=t.min(),o=t.max(),l=0,u=e._size.length;l<u;l++)$S(a[l],e._size[l]),$S(o[l],e._size[l]);return new r(n(e._data,t,s.length,0),e._datatype)}(this,e);case 2:case 3:return function(e,t,r,n){if(!t||!0!==t.isIndex)throw new TypeError("Invalid index");var s,o=t.size(),l=t.isScalar();QE(r)?(s=r.size(),r=r.valueOf()):s=PS(r);if(l){if(0!==s.length)throw new TypeError("Scalar expected");e.set(t.min(),r,n)}else{if(o.length<e._size.length)throw new RS(o.length,e._size.length,"<");if(s.length<o.length){for(var u=0,c=0;1===o[u]&&1===s[u];)u++;for(;1===o[u];)c++,u++;r=WS(r,o.length,c,s)}if(!ID(o,s))throw new RS(o,s,">");var d=t.max().map((function(e){return e+1}));a(e,d,n);var h=o.length,f=0;i(e._data,t,r,h,f)}return e}(this,e,t,s);default:throw new SyntaxError("Wrong number of arguments")}},r.prototype.get=function(e){if(!XE(e))throw new TypeError("Array expected");if(e.length!==this._size.length)throw new RS(e.length,this._size.length);for(var t=0;t<e.length;t++)$S(e[t],this._size[t]);for(var r=this._data,n=0,i=e.length;n<i;n++){var s=e[n];$S(s,r.length),r=r[s]}return r},r.prototype.set=function(e,t,r){if(!XE(e))throw new TypeError("Array expected");if(e.length<this._size.length)throw new RS(e.length,this._size.length,"<");var n,i,s,o=e.map((function(e){return e+1}));a(this,o,r);var l=this._data;for(n=0,i=e.length-1;n<i;n++)$S(s=e[n],l.length),l=l[s];return $S(s=e[e.length-1],l.length),l[s]=t,this},r.prototype.resize=function(e,t,r){if(!eD(e))throw new TypeError("Array or Matrix expected");var n=e.valueOf().map((e=>Array.isArray(e)&&1===e.length?e[0]:e));return s(r?this.clone():this,n,t)},r.prototype.reshape=function(e,t){var r=t?this.clone():this;r._data=qS(r._data,e);var n=r._size.reduce(((e,t)=>e*t));return r._size=HS(e,n),r},r.prototype.clone=function(){return new r({data:_D(this._data),size:_D(this._size),datatype:this._datatype})},r.prototype.size=function(){return this._size.slice(0)},r.prototype.map=function(e){var t=this,n=Uk(e),i=function r(i,s){return XE(i)?i.map((function(e,t){return r(e,s.concat(t))})):1===n?e(i):2===n?e(i,s):e(i,s,t)}(this._data,[]);return new r(i,void 0!==this._datatype?iA(i,FD):void 0)},r.prototype.forEach=function(e){var t=this;!function r(n,i){XE(n)?n.forEach((function(e,t){r(e,i.concat(t))})):e(n,i,t)}(this._data,[])},r.prototype[Symbol.iterator]=function*(){yield*function*e(t,r){if(XE(t))for(var n=0;n<t.length;n++)yield*e(t[n],r.concat(n));else yield{value:t,index:r}}(this._data,[])},r.prototype.rows=function(){var e=[];if(2!==this.size().length)throw new TypeError("Rows can only be returned for a 2D matrix.");var t=this._data;for(var n of t)e.push(new r([n],this._datatype));return e},r.prototype.columns=function(){var e=this,t=[],n=this.size();if(2!==n.length)throw new TypeError("Rows can only be returned for a 2D matrix.");for(var i=this._data,s=function(n){var s=i.map((e=>[e[n]]));t.push(new r(s,e._datatype))},a=0;a<n[1];a++)s(a);return t},r.prototype.toArray=function(){return _D(this._data)},r.prototype.valueOf=function(){return this._data},r.prototype.format=function(e){return NS(this._data,e)},r.prototype.toString=function(){return NS(this._data)},r.prototype.toJSON=function(){return{mathjs:"DenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},r.prototype.diagonal=function(e){if(e){if(KE(e)&&(e=e.toNumber()),!GE(e)||!rS(e))throw new TypeError("The parameter k must be an integer number")}else e=0;for(var t=e>0?e:0,n=e<0?-e:0,i=this._size[0],s=this._size[1],a=Math.min(i-n,s-t),o=[],l=0;l<a;l++)o[l]=this._data[l+n][l+t];return new r({data:o,size:[a],datatype:this._datatype})},r.diagonal=function(e,t,n,i){if(!XE(e))throw new TypeError("Array expected, size parameter");if(2!==e.length)throw new Error("Only two dimensions matrix are supported");if(e=e.map((function(e){if(KE(e)&&(e=e.toNumber()),!GE(e)||!rS(e)||e<1)throw new Error("Size values must be positive integers");return e})),n){if(KE(n)&&(n=n.toNumber()),!GE(n)||!rS(n))throw new TypeError("The parameter k must be an integer number")}else n=0;var s,a=n>0?n:0,o=n<0?-n:0,l=e[0],u=e[1],c=Math.min(l-o,u-a);if(XE(t)){if(t.length!==c)throw new Error("Invalid value array length");s=function(e){return t[e]}}else if(QE(t)){var d=t.size();if(1!==d.length||d[0]!==c)throw new Error("Invalid matrix length");s=function(e){return t.get([e])}}else s=function(){return t};i||(i=KE(s(0))?s(0).mul(0):0);var h=[];if(e.length>0){h=zS(h,e,i);for(var f=0;f<c;f++)h[f+o][f+a]=s(f)}return new r({data:h,size:[l,u]})},r.fromJSON=function(e){return new r(e)},r.prototype.swapRows=function(e,t){if(!(GE(e)&&rS(e)&&GE(t)&&rS(t)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return $S(e,this._size[0]),$S(t,this._size[0]),r._swapRows(e,t,this._data),this},r._swapRows=function(e,t,r){var n=r[e];r[e]=r[t],r[t]=n},r}),{isClass:!0}),gO=BD("replacer",[],(()=>function(e,t){return"number"!=typeof t||isFinite(t)&&!isNaN(t)?t:{mathjs:"number",value:String(t)}})),yO=function(){return yO=GT.create,GT},vO=BD("typed",["?BigNumber","?Complex","?DenseMatrix","?Fraction"],(function(e){var{BigNumber:t,Complex:r,DenseMatrix:n,Fraction:i}=e,s=yO();return s.clear(),s.addTypes([{name:"number",test:GE},{name:"Complex",test:WE},{name:"BigNumber",test:KE},{name:"Fraction",test:YE},{name:"Unit",test:JE},{name:"identifier",test:e=>ZE&&/^(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD887][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF39\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD888[\uDC00-\uDFAF])*$/.test(e)},{name:"string",test:ZE},{name:"Chain",test:OD},{name:"Array",test:XE},{name:"Matrix",test:QE},{name:"DenseMatrix",test:tD},{name:"SparseMatrix",test:rD},{name:"Range",test:nD},{name:"Index",test:iD},{name:"boolean",test:sD},{name:"ResultSet",test:aD},{name:"Help",test:oD},{name:"function",test:lD},{name:"Date",test:uD},{name:"RegExp",test:cD},{name:"null",test:hD},{name:"undefined",test:fD},{name:"AccessorNode",test:pD},{name:"ArrayNode",test:mD},{name:"AssignmentNode",test:gD},{name:"BlockNode",test:yD},{name:"ConditionalNode",test:vD},{name:"ConstantNode",test:bD},{name:"FunctionNode",test:ED},{name:"FunctionAssignmentNode",test:xD},{name:"IndexNode",test:DD},{name:"Node",test:SD},{name:"ObjectNode",test:AD},{name:"OperatorNode",test:TD},{name:"ParenthesisNode",test:CD},{name:"RangeNode",test:ND},{name:"RelationalNode",test:kD},{name:"SymbolNode",test:MD},{name:"Map",test:JD},{name:"Object",test:dD}]),s.addConversions([{from:"number",to:"BigNumber",convert:function(e){if(t||bO(e),e.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+e+"). Use function bignumber(x) to convert to BigNumber.");return new t(e)}},{from:"number",to:"Complex",convert:function(e){return r||wO(e),new r(e,0)}},{from:"BigNumber",to:"Complex",convert:function(e){return r||wO(e),new r(e.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(e){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(e){return r||wO(e),new r(e.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(e){i||xO(e);var t=new i(e);if(t.valueOf()!==e)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+e+"). Use function fraction(x) to convert to Fraction.");return t}},{from:"string",to:"number",convert:function(e){var t=Number(e);if(isNaN(t))throw new Error('Cannot convert "'+e+'" to a number');return t}},{from:"string",to:"BigNumber",convert:function(e){t||bO(e);try{return new t(e)}catch(t){throw new Error('Cannot convert "'+e+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(e){i||xO(e);try{return new i(e)}catch(t){throw new Error('Cannot convert "'+e+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(e){r||wO(e);try{return new r(e)}catch(t){throw new Error('Cannot convert "'+e+'" to Complex')}}},{from:"boolean",to:"number",convert:function(e){return+e}},{from:"boolean",to:"BigNumber",convert:function(e){return t||bO(e),new t(+e)}},{from:"boolean",to:"Fraction",convert:function(e){return i||xO(e),new i(+e)}},{from:"boolean",to:"string",convert:function(e){return String(e)}},{from:"Array",to:"Matrix",convert:function(e){return n||function(){throw new Error("Cannot convert array into a Matrix: no class 'DenseMatrix' provided")}(),new n(e)}},{from:"Matrix",to:"Array",convert:function(e){return e.valueOf()}}]),s.onMismatch=(e,t,r)=>{var n=s.createError(e,t,r);if(["wrongType","mismatch"].includes(n.data.category)&&1===t.length&&eD(t[0])&&r.some((e=>!e.params.includes(",")))){var i=new TypeError("Function '".concat(e,"' doesn't apply to matrices. To call it ")+"elementwise on a matrix 'M', try 'map(M, ".concat(e,")'."));throw i.data=n.data,i}throw n},s.onMismatch=(e,t,r)=>{var n=s.createError(e,t,r);if(["wrongType","mismatch"].includes(n.data.category)&&1===t.length&&eD(t[0])&&r.some((e=>!e.params.includes(",")))){var i=new TypeError("Function '".concat(e,"' doesn't apply to matrices. To call it ")+"elementwise on a matrix 'M', try 'map(M, ".concat(e,")'."));throw i.data=n.data,i}throw n},s}));function bO(e){throw new Error("Cannot convert value ".concat(e," into a BigNumber: no class 'BigNumber' provided"))}function wO(e){throw new Error("Cannot convert value ".concat(e," into a Complex number: no class 'Complex' provided"))}function xO(e){throw new Error("Cannot convert value ".concat(e," into a Fraction, no class 'Fraction' provided."))}var EO="number",DO="number, number";function SO(e){return Math.abs(e)}function AO(e,t){return e+t}function TO(e,t){return e*t}function CO(e){return-e}function NO(e){return e}function kO(e){return oS(e)}function MO(e){return e*e*e}function OO(e){return Math.exp(e)}function FO(e){return lS(e)}function LO(e,t){if(!rS(e)||!rS(t))throw new Error("Parameters in function gcd must be integer numbers");for(var r;0!==t;)r=e%t,e=t,t=r;return e<0?-e:e}function _O(e,t){if(!rS(e)||!rS(t))throw new Error("Parameters in function lcm must be integer numbers");if(0===e||0===t)return 0;for(var r,n=e*t;0!==t;)t=e%(r=t),e=r;return Math.abs(n/e)}function RO(e){return sS(e)}function IO(e){return iS(e)}function PO(e,t){if(t>0)return e-t*Math.floor(e/t);if(0===t)return e;throw new Error("Cannot calculate mod for a negative divisor")}function BO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=t<0;if(r&&(t=-t),0===t)throw new Error("Root must be non-zero");if(e<0&&Math.abs(t)%2!=1)throw new Error("Root must be odd when a is negative.");if(0===e)return r?1/0:0;if(!isFinite(e))return r?0:e;var n=Math.pow(Math.abs(e),1/t);return n=e<0?-n:n,r?1/n:n}function UO(e){return nS(e)}function $O(e){return e*e}function zO(e,t){var r,n,i,s=0,a=1,o=1,l=0;if(!rS(e)||!rS(t))throw new Error("Parameters in function xgcd must be integer numbers");for(;t;)i=e-(n=Math.floor(e/t))*t,r=s,s=a-n*s,a=r,r=o,o=l-n*o,l=r,e=t,t=i;return e<0?[-e,-a,-l]:[e,e?a:0,l]}function jO(e,t){return e*e<1&&t===1/0||e*e>1&&t===-1/0?0:Math.pow(e,t)}function qO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!rS(t)||t<0||t>15)throw new Error("Number of decimals in function round must be an integer from 0 to 15 inclusive");return parseFloat(hS(e,t))}SO.signature=EO,AO.signature=DO,TO.signature=DO,CO.signature=EO,NO.signature=EO,kO.signature=EO,MO.signature=EO,OO.signature=EO,FO.signature=EO,LO.signature=DO,_O.signature=DO,RO.signature=EO,IO.signature=EO,PO.signature=DO,UO.signature=EO,$O.signature=EO,zO.signature=DO,jO.signature=DO;var HO="unaryPlus",VO=BD(HO,["typed","config","BigNumber"],(e=>{var{typed:t,config:r,BigNumber:n}=e;return t(HO,{number:NO,Complex:function(e){return e},BigNumber:function(e){return e},Fraction:function(e){return e},Unit:function(e){return e.clone()},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0))),"boolean | string":function(e){return"BigNumber"===r.number?new n(+e):+e}})})),GO=BD("abs",["typed"],(e=>{var{typed:t}=e;return t("abs",{number:SO,"Complex | BigNumber | Fraction | Unit":e=>e.abs(),"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0)))})})),KO="acos",WO=BD(KO,["typed","config","Complex"],(e=>{var{typed:t,config:r,Complex:n}=e;return t(KO,{number:function(e){return e>=-1&&e<=1||r.predictable?Math.acos(e):new n(e,0).acos()},Complex:function(e){return e.acos()},BigNumber:function(e){return e.acos()}})})),YO="number";function JO(e){return vS(e)}function ZO(e){return Math.atan(1/e)}function XO(e){return isFinite(e)?(Math.log((e+1)/e)+Math.log(e/(e-1)))/2:0}function QO(e){return Math.asin(1/e)}function eF(e){var t=1/e;return Math.log(t+Math.sqrt(t*t+1))}function tF(e){return Math.acos(1/e)}function rF(e){var t=1/e,r=Math.sqrt(t*t-1);return Math.log(r+t)}function nF(e){return bS(e)}function iF(e){return wS(e)}function sF(e){return 1/Math.tan(e)}function aF(e){var t=Math.exp(2*e);return(t+1)/(t-1)}function oF(e){return 1/Math.sin(e)}function lF(e){return 0===e?Number.POSITIVE_INFINITY:Math.abs(2/(Math.exp(e)-Math.exp(-e)))*nS(e)}function uF(e){return 1/Math.cos(e)}function cF(e){return 2/(Math.exp(e)+Math.exp(-e))}function dF(e){return ES(e)}JO.signature=YO,ZO.signature=YO,XO.signature=YO,QO.signature=YO,eF.signature=YO,tF.signature=YO,rF.signature=YO,nF.signature=YO,iF.signature=YO,sF.signature=YO,aF.signature=YO,oF.signature=YO,lF.signature=YO,uF.signature=YO,cF.signature=YO,dF.signature=YO;var hF="acot",fF=BD(hF,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t(hF,{number:ZO,Complex:function(e){return e.acot()},BigNumber:function(e){return new r(1).div(e).atan()}})})),pF="acsc",mF=BD(pF,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:r,Complex:n,BigNumber:i}=e;return t(pF,{number:function(e){return e<=-1||e>=1||r.predictable?QO(e):new n(e,0).acsc()},Complex:function(e){return e.acsc()},BigNumber:function(e){return new i(1).div(e).asin()}})})),gF="addScalar",yF=BD(gF,["typed"],(e=>{var{typed:t}=e;return t(gF,{"number, number":AO,"Complex, Complex":function(e,t){return e.add(t)},"BigNumber, BigNumber":function(e,t){return e.plus(t)},"Fraction, Fraction":function(e,t){return e.add(t)},"Unit, Unit":t.referToSelf((e=>(r,n)=>{if(null===r.value||void 0===r.value)throw new Error("Parameter x contains a unit with undefined value");if(null===n.value||void 0===n.value)throw new Error("Parameter y contains a unit with undefined value");if(!r.equalBase(n))throw new Error("Units do not match");var i=r.clone();return i.value=t.find(e,[i.valueType(),n.valueType()])(i.value,n.value),i.fixPrefix=!1,i}))})})),vF=BD("arg",["typed"],(e=>{var{typed:t}=e;return t("arg",{number:function(e){return Math.atan2(0,e)},BigNumber:function(e){return e.constructor.atan2(0,e)},Complex:function(e){return e.arg()},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),bF="asech",wF=BD(bF,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:r,Complex:n,BigNumber:i}=e;return t(bF,{number:function(e){if(e<=1&&e>=-1||r.predictable){var t=1/e;if(t>0||r.predictable)return rF(e);var i=Math.sqrt(t*t-1);return new n(Math.log(i-t),Math.PI)}return new n(e,0).asech()},Complex:function(e){return e.asech()},BigNumber:function(e){return new i(1).div(e).acosh()}})})),xF=BD("asinh",["typed"],(e=>{var{typed:t}=e;return t("asinh",{number:nF,Complex:function(e){return e.asinh()},BigNumber:function(e){return e.asinh()}})})),EF=BD("atan",["typed"],(e=>{var{typed:t}=e;return t("atan",{number:function(e){return Math.atan(e)},Complex:function(e){return e.atan()},BigNumber:function(e){return e.atan()}})})),DF="atanh",SF=BD(DF,["typed","config","Complex"],(e=>{var{typed:t,config:r,Complex:n}=e;return t(DF,{number:function(e){return e<=1&&e>=-1||r.predictable?iF(e):new n(e,0).atanh()},Complex:function(e){return e.atanh()},BigNumber:function(e){return e.atanh()}})})),AF=BD("bignumber",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t("bignumber",{"":function(){return new r(0)},number:function(e){return new r(e+"")},string:function(e){var t=e.match(/(0[box][0-9a-fA-F]*)i([0-9]*)/);if(t){var n=t[2],i=r(t[1]),s=new r(2).pow(Number(n));if(i.gt(s.sub(1)))throw new SyntaxError('String "'.concat(e,'" is out of range'));var a=new r(2).pow(Number(n)-1);return i.gte(a)?i.sub(s):i}return new r(e)},BigNumber:function(e){return e},Unit:t.referToSelf((e=>t=>{var r=t.clone();return r.value=e(t.value),r})),Fraction:function(e){return new r(e.n).div(e.d).times(e.s)},null:function(e){return new r(0)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})}));function TF(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitAnd");var r=e.constructor;if(e.isNaN()||t.isNaN())return new r(NaN);if(e.isZero()||t.eq(-1)||e.eq(t))return e;if(t.isZero()||e.eq(-1))return t;if(!e.isFinite()||!t.isFinite()){if(!e.isFinite()&&!t.isFinite())return e.isNegative()===t.isNegative()?e:new r(0);if(!e.isFinite())return t.isNegative()?e:e.isNegative()?new r(0):t;if(!t.isFinite())return e.isNegative()?t:t.isNegative()?new r(0):e}return kF(e,t,(function(e,t){return e&t}))}function CF(e){if(e.isFinite()&&!e.isInteger())throw new Error("Integer expected in function bitNot");var t=e.constructor,r=t.precision;t.config({precision:1e9});var n=e.plus(new t(1));return n.s=-n.s||null,t.config({precision:r}),n}function NF(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitOr");var r=e.constructor;if(e.isNaN()||t.isNaN())return new r(NaN);var n=new r(-1);return e.isZero()||t.eq(n)||e.eq(t)?t:t.isZero()||e.eq(n)?e:e.isFinite()&&t.isFinite()?kF(e,t,(function(e,t){return e|t})):!e.isFinite()&&!e.isNegative()&&t.isNegative()||e.isNegative()&&!t.isNegative()&&!t.isFinite()?n:e.isNegative()&&t.isNegative()?e.isFinite()?e:t:e.isFinite()?t:e}function kF(e,t,r){var n,i,s,a,o,l=e.constructor,u=+(e.s<0),c=+(t.s<0);if(u){n=MF(CF(e));for(var d=0;d<n.length;++d)n[d]^=1}else n=MF(e);if(c){i=MF(CF(t));for(var h=0;h<i.length;++h)i[h]^=1}else i=MF(t);n.length<=i.length?(s=n,a=i,o=u):(s=i,a=n,o=c);var f=s.length,p=a.length,m=1^r(u,c),g=new l(1^m),y=new l(1),v=new l(2),b=l.precision;for(l.config({precision:1e9});f>0;)r(s[--f],a[--p])===m&&(g=g.plus(y)),y=y.times(v);for(;p>0;)r(o,a[--p])===m&&(g=g.plus(y)),y=y.times(v);return l.config({precision:b}),0===m&&(g.s=-g.s),g}function MF(e){for(var t=e.d,r=t[0]+"",n=1;n<t.length;++n){for(var i=t[n]+"",s=7-i.length;s--;)i="0"+i;r+=i}for(var a=r.length;"0"===r.charAt(a);)a--;var o=e.e,l=r.slice(0,a+1||1),u=l.length;if(o>0)if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o));for(var c=[0],d=0;d<l.length;){for(var h=c.length;h--;)c[h]*=10;c[0]+=parseInt(l.charAt(d++));for(var f=0;f<c.length;++f)c[f]>1&&(null!==c[f+1]&&void 0!==c[f+1]||(c[f+1]=0),c[f+1]+=c[f]>>1,c[f]&=1)}return c.reverse()}function OF(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function bitXor");var r=e.constructor;if(e.isNaN()||t.isNaN())return new r(NaN);if(e.isZero())return t;if(t.isZero())return e;if(e.eq(t))return new r(0);var n=new r(-1);return e.eq(n)?CF(t):t.eq(n)?CF(e):e.isFinite()&&t.isFinite()?kF(e,t,(function(e,t){return e^t})):e.isFinite()||t.isFinite()?new r(e.isNegative()===t.isNegative()?1/0:-1/0):n}function FF(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function leftShift");var r=e.constructor;return e.isNaN()||t.isNaN()||t.isNegative()&&!t.isZero()?new r(NaN):e.isZero()||t.isZero()?e:e.isFinite()||t.isFinite()?t.lt(55)?e.times(Math.pow(2,t.toNumber())+""):e.times(new r(2).pow(t)):new r(NaN)}function LF(e,t){if(e.isFinite()&&!e.isInteger()||t.isFinite()&&!t.isInteger())throw new Error("Integers expected in function rightArithShift");var r=e.constructor;return e.isNaN()||t.isNaN()||t.isNegative()&&!t.isZero()?new r(NaN):e.isZero()||t.isZero()?e:t.isFinite()?t.lt(55)?e.div(Math.pow(2,t.toNumber())+"").floor():e.div(new r(2).pow(t)).floor():e.isNegative()?new r(-1):e.isFinite()?new r(0):new r(NaN)}var _F="number, number";function RF(e,t){if(!rS(e)||!rS(t))throw new Error("Integers expected in function bitAnd");return e&t}function IF(e){if(!rS(e))throw new Error("Integer expected in function bitNot");return~e}function PF(e,t){if(!rS(e)||!rS(t))throw new Error("Integers expected in function bitOr");return e|t}function BF(e,t){if(!rS(e)||!rS(t))throw new Error("Integers expected in function bitXor");return e^t}function UF(e,t){if(!rS(e)||!rS(t))throw new Error("Integers expected in function leftShift");return e<<t}function $F(e,t){if(!rS(e)||!rS(t))throw new Error("Integers expected in function rightArithShift");return e>>t}function zF(e,t){if(!rS(e)||!rS(t))throw new Error("Integers expected in function rightLogShift");return e>>>t}RF.signature=_F,IF.signature="number",PF.signature=_F,BF.signature=_F,UF.signature=_F,$F.signature=_F,zF.signature=_F;var jF="bitNot",qF=BD(jF,["typed"],(e=>{var{typed:t}=e;return t(jF,{number:IF,BigNumber:CF,"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),HF="boolean",VF=BD(HF,["typed"],(e=>{var{typed:t}=e;return t(HF,{"":function(){return!1},boolean:function(e){return e},number:function(e){return!!e},null:function(e){return!1},BigNumber:function(e){return!e.isZero()},string:function(e){var t=e.toLowerCase();if("true"===t)return!0;if("false"===t)return!1;var r=Number(e);if(""!==e&&!isNaN(r))return!!r;throw new Error('Cannot convert "'+e+'" to a boolean')},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),GF="clone",KF=BD(GF,["typed"],(e=>{var{typed:t}=e;return t(GF,{any:_D})}));function WF(e,t){if(t<e)return 1;if(t===e)return t;var r=t+e>>1;return WF(e,r)*WF(r+1,t)}function YF(e,t){if(!rS(e)||e<0)throw new TypeError("Positive integer value expected in function combinations");if(!rS(t)||t<0)throw new TypeError("Positive integer value expected in function combinations");if(t>e)throw new TypeError("k must be less than or equal to n");for(var r=e-t,n=1,i=2,s=t<r?t:r,a=t<r?r+1:t+1;a<=e;++a)for(n*=a;i<=s&&n%i==0;)n/=i,++i;return i<=s&&(n/=WF(i,s)),n}YF.signature="number, number";var JF="combinations",ZF=BD(JF,["typed"],(e=>{var{typed:t}=e;return t(JF,{"number, number":YF,"BigNumber, BigNumber":function(e,t){var r,n,i=e.constructor,s=e.minus(t),a=new i(1);if(!XF(e)||!XF(t))throw new TypeError("Positive integer value expected in function combinations");if(t.gt(e))throw new TypeError("k must be less than n in function combinations");if(r=a,t.lt(s))for(n=a;n.lte(s);n=n.plus(a))r=r.times(t.plus(n)).dividedBy(n);else for(n=a;n.lte(t);n=n.plus(a))r=r.times(s.plus(n)).dividedBy(n);return r}})}));function XF(e){return e.isInteger()&&e.gte(0)}var QF=BD("complex",["typed","Complex"],(e=>{var{typed:t,Complex:r}=e;return t("complex",{"":function(){return r.ZERO},number:function(e){return new r(e,0)},"number, number":function(e,t){return new r(e,t)},"BigNumber, BigNumber":function(e,t){return new r(e.toNumber(),t.toNumber())},Fraction:function(e){return new r(e.valueOf(),0)},Complex:function(e){return e.clone()},string:function(e){return r(e)},null:function(e){return r(0)},Object:function(e){if("re"in e&&"im"in e)return new r(e.re,e.im);if("r"in e&&"phi"in e||"abs"in e&&"arg"in e)return new r(e);throw new Error("Expected object with properties (re and im) or (r and phi) or (abs and arg)")},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),eL="conj",tL=BD(eL,["typed"],(e=>{var{typed:t}=e;return t(eL,{"number | BigNumber | Fraction":e=>e,Complex:e=>e.conjugate(),"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),rL="cosh",nL=BD(rL,["typed"],(e=>{var{typed:t}=e;return t(rL,{number:xS,"Complex | BigNumber":e=>e.cosh()})})),iL="coth",sL=BD(iL,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t(iL,{number:aF,Complex:e=>e.coth(),BigNumber:e=>new r(1).div(e.tanh())})})),aL=BD("trigUnit",["typed"],(e=>{var{typed:t}=e;return{Unit:t.referToSelf((e=>r=>{if(!r.hasBase(r.constructor.BASE_UNITS.ANGLE))throw new TypeError("Unit in function cot is no angle");return t.find(e,r.valueType())(r.value)}))}})),oL=BD("csc",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t("csc",{number:oF,Complex:e=>e.csc(),BigNumber:e=>new r(1).div(e.sin())},aL({typed:t}))})),lL="cube",uL=BD(lL,["typed"],(e=>{var{typed:t}=e;return t(lL,{number:MO,Complex:function(e){return e.mul(e).mul(e)},BigNumber:function(e){return e.times(e).times(e)},Fraction:function(e){return e.pow(3)},Unit:function(e){return e.pow(3)}})}));function cL(e,t,r){if(null==r)return e.eq(t);if(e.eq(t))return!0;if(e.isNaN()||t.isNaN())return!1;if(e.isFinite()&&t.isFinite()){var n=e.minus(t).abs();if(n.isZero())return!0;var i=e.constructor.max(e.abs(),t.abs());return n.lte(i.times(r))}return!1}var dL=BD("compareUnits",["typed"],(e=>{var{typed:t}=e;return{"Unit, Unit":t.referToSelf((e=>(r,n)=>{if(!r.equalBase(n))throw new Error("Cannot compare units with different base");return t.find(e,[r.valueType(),n.valueType()])(r.value,n.value)}))}})),hL="equalScalar",fL=BD(hL,["typed","config"],(e=>{var{typed:t,config:r}=e,n=dL({typed:t});return t(hL,{"boolean, boolean":function(e,t){return e===t},"number, number":function(e,t){return yS(e,t,r.epsilon)},"BigNumber, BigNumber":function(e,t){return e.eq(t)||cL(e,t,r.epsilon)},"Fraction, Fraction":function(e,t){return e.equals(t)},"Complex, Complex":function(e,t){return function(e,t,r){return yS(e.re,t.re,r)&&yS(e.im,t.im,r)}(e,t,r.epsilon)}},n)})),pL=(BD(hL,["typed","config"],(e=>{var{typed:t,config:r}=e;return t(hL,{"number, number":function(e,t){return yS(e,t,r.epsilon)}})})),BD("erf",["typed"],(e=>{var{typed:t}=e;return t("name",{number:function(e){var t=Math.abs(e);return t>=bL?nS(e):t<=mL?nS(e)*function(e){var t,r=e*e,n=yL[0][4]*r,i=r;for(t=0;t<3;t+=1)n=(n+yL[0][t])*r,i=(i+vL[0][t])*r;return e*(n+yL[0][3])/(i+vL[0][3])}(t):t<=4?nS(e)*(1-function(e){var t,r=yL[1][8]*e,n=e;for(t=0;t<7;t+=1)r=(r+yL[1][t])*e,n=(n+vL[1][t])*e;var i=(r+yL[1][7])/(n+vL[1][7]),s=parseInt(16*e)/16,a=(e-s)*(e+s);return Math.exp(-s*s)*Math.exp(-a)*i}(t)):nS(e)*(1-function(e){var t,r=1/(e*e),n=yL[2][5]*r,i=r;for(t=0;t<4;t+=1)n=(n+yL[2][t])*r,i=(i+vL[2][t])*r;var s=r*(n+yL[2][4])/(i+vL[2][4]);s=(gL-s)/e,r=parseInt(16*e)/16;var a=(e-r)*(e+r);return Math.exp(-r*r)*Math.exp(-a)*s}(t))},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})}))),mL=.46875,gL=.5641895835477563,yL=[[3.1611237438705655,113.86415415105016,377.485237685302,3209.3775891384694,.18577770618460315],[.5641884969886701,8.883149794388377,66.11919063714163,298.6351381974001,881.952221241769,1712.0476126340707,2051.0783778260716,1230.3393547979972,2.1531153547440383e-8],[.30532663496123236,.36034489994980445,.12578172611122926,.016083785148742275,.0006587491615298378,.016315387137302097]],vL=[[23.601290952344122,244.02463793444417,1282.6165260773723,2844.236833439171],[15.744926110709835,117.6939508913125,537.1811018620099,1621.3895745666903,3290.7992357334597,4362.619090143247,3439.3676741437216,1230.3393548037495],[2.568520192289822,1.8729528499234604,.5279051029514285,.06051834131244132,.0023352049762686918]],bL=Math.pow(2,53),wL=BD("exp",["typed"],(e=>{var{typed:t}=e;return t("exp",{number:OO,Complex:function(e){return e.exp()},BigNumber:function(e){return e.exp()}})})),xL="expm1",EL=BD(xL,["typed","Complex"],(e=>{var{typed:t,Complex:r}=e;return t(xL,{number:FO,Complex:function(e){var t=Math.exp(e.re);return new r(t*Math.cos(e.im)-1,t*Math.sin(e.im))},BigNumber:function(e){return e.exp().minus(1)}})})),DL=BD("filter",["typed"],(e=>{var{typed:t}=e;return t("filter",{"Array, function":SL,"Matrix, function":function(e,t){return e.create(SL(e.toArray(),t))},"Array, RegExp":eA,"Matrix, RegExp":function(e,t){return e.create(eA(e.toArray(),t))}})}));function SL(e,t){return QS(e,(function(e,r,n){return KT(t,e,[r],n,"filter")}))}var AL="forEach",TL=BD(AL,["typed"],(e=>{var{typed:t}=e;return t(AL,{"Array, function":CL,"Matrix, function":function(e,t){e.forEach(t)}})}));function CL(e,t){!function r(n,i){if(!Array.isArray(n))return KT(t,n,i,e,"forEach");XS(n,(function(e,t){r(e,i.concat(t))}))}(e,[])}var NL="format",kL=BD(NL,["typed"],(e=>{var{typed:t}=e;return t(NL,{any:NS,"any, Object | function | number":NS})})),ML="getMatrixDataType",OL=BD(ML,["typed"],(e=>{var{typed:t}=e;return t(ML,{Array:function(e){return iA(e,FD)},Matrix:function(e){return e.getDataType()}})})),FL=BD("hex",["typed","format"],(e=>{var{typed:t,format:r}=e;return t("hex",{"number | BigNumber":function(e){return r(e,{notation:"hex"})},"number | BigNumber, number":function(e,t){return r(e,{notation:"hex",wordSize:t})}})})),LL=BD("im",["typed"],(e=>{var{typed:t}=e;return t("im",{number:()=>0,"BigNumber | Fraction":e=>e.mul(0),Complex:e=>e.im,"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),_L="isInteger",RL=BD(_L,["typed"],(e=>{var{typed:t}=e;return t(_L,{number:rS,BigNumber:function(e){return e.isInt()},Fraction:function(e){return 1===e.d&&isFinite(e.n)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),IL="number";function PL(e){return e<0}function BL(e){return e>0}function UL(e){return 0===e}function $L(e){return Number.isNaN(e)}PL.signature=IL,BL.signature=IL,UL.signature=IL,$L.signature=IL;var zL="isNegative",jL=BD(zL,["typed"],(e=>{var{typed:t}=e;return t(zL,{number:PL,BigNumber:function(e){return e.isNeg()&&!e.isZero()&&!e.isNaN()},Fraction:function(e){return e.s<0},Unit:t.referToSelf((e=>r=>t.find(e,r.valueType())(r.value))),"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),qL="isPositive",HL=BD(qL,["typed"],(e=>{var{typed:t}=e;return t(qL,{number:BL,BigNumber:function(e){return!e.isNeg()&&!e.isZero()&&!e.isNaN()},Fraction:function(e){return e.s>0&&e.n>0},Unit:t.referToSelf((e=>r=>t.find(e,r.valueType())(r.value))),"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),VL="isZero",GL=BD(VL,["typed"],(e=>{var{typed:t}=e;return t(VL,{number:UL,BigNumber:function(e){return e.isZero()},Complex:function(e){return 0===e.re&&0===e.im},Fraction:function(e){return 1===e.d&&0===e.n},Unit:t.referToSelf((e=>r=>t.find(e,r.valueType())(r.value))),"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})}));function KL(e){var t;if(rS(e))return e<=0?isFinite(e)?1/0:NaN:e>171?1/0:WF(1,e-1);if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*KL(1-e));if(e>=171.35)return 1/0;if(e>85){var r=e*e,n=r*e,i=n*e,s=i*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*r)-139/(51840*n)-571/(2488320*i)+163879/(209018880*s)+5246819/(75246796800*s*e))}--e,t=YL[0];for(var a=1;a<YL.length;++a)t+=YL[a]/(e+a);var o=e+WL+.5;return Math.sqrt(2*Math.PI)*Math.pow(o,e+.5)*Math.exp(-o)*t}KL.signature="number";var WL=4.7421875,YL=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22],JL=.9189385332046728,ZL=[1.000000000190015,76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];function XL(e){if(e<0)return NaN;if(0===e)return 1/0;if(!isFinite(e))return e;if(e<.5)return Math.log(Math.PI/Math.sin(Math.PI*e))-XL(1-e);for(var t=(e-=1)+5+.5,r=ZL[0],n=6;n>=1;n--)r+=ZL[n]/(e+n);return JL+(e+.5)*Math.log(t)-t+Math.log(r)}XL.signature="number";var QL="lgamma",e_=BD(QL,["Complex","typed"],(e=>{var{Complex:t,typed:r}=e,n=7,i=[-.029550653594771242,.00641025641025641,-.0019175269175269176,.0008417508417508417,-.0005952380952380953,.0007936507936507937,-.002777777777777778,.08333333333333333];return r(QL,{number:XL,Complex:function e(r){if(r.isNaN())return new t(NaN,NaN);if(0===r.im)return new t(XL(r.re),0);if(r.re>=n||Math.abs(r.im)>=7)return s(r);if(r.re<=.1){var i=(u=6.283185307179586,c=r.im,((u>0||!(u<0)&&1/u==1/0)^(c>0||!(c<0)&&1/c==1/0)?-u:u)*Math.floor(.5*r.re+.25)),o=r.mul(Math.PI).sin().log(),l=e(new t(1-r.re,-r.im));return new t(1.1447298858494002,i).sub(o).sub(l)}return r.im>=0?a(r):a(r.conjugate()).conjugate();var u,c},BigNumber:function(){throw new Error("mathjs doesn't yet provide an implementation of the algorithm lgamma for BigNumber")}});function s(e){for(var r=e.sub(.5).mul(e.log()).sub(e).add(JL),n=new t(1,0).div(e),s=n.div(e),a=i[0],o=i[1],l=2*s.re,u=s.re*s.re+s.im*s.im,c=2;c<8;c++){var d=o;o=-u*a+i[c],a=l*a+d}var h=n.mul(s.mul(a).add(o));return r.add(h)}function a(e){var r=0,i=0,a=e;for(e=e.add(1);e.re<=n;){var o=(a=a.mul(e)).im<0?1:0;0!==o&&0===i&&r++,i=o,e=e.add(1)}return s(e).sub(a.log()).sub(new t(0,2*r*Math.PI*1))}})),t_="log10",r_=BD(t_,["typed","config","Complex"],(e=>{var{typed:t,config:r,Complex:n}=e;return t(t_,{number:function(e){return e>=0||r.predictable?RO(e):new n(e,0).log().div(Math.LN10)},Complex:function(e){return new n(e).log().div(Math.LN10)},BigNumber:function(e){return!e.isNegative()||r.predictable?e.log():new n(e.toNumber(),0).log().div(Math.LN10)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),n_="log2",i_=BD(n_,["typed","config","Complex"],(e=>{var{typed:t,config:r,Complex:n}=e;return t(n_,{number:function(e){return e>=0||r.predictable?IO(e):i(new n(e,0))},Complex:i,BigNumber:function(e){return!e.isNegative()||r.predictable?e.log(2):i(new n(e.toNumber(),0))},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))});function i(e){var t=Math.sqrt(e.re*e.re+e.im*e.im);return new n(Math.log2?Math.log2(t):Math.log(t)/Math.LN2,Math.atan2(e.im,e.re)/Math.LN2)}})),s_=BD("map",["typed"],(e=>{var{typed:t}=e;return t("map",{"Array, function":a_,"Matrix, function":function(e,t){return e.map(t)}})}));function a_(e,t){return function r(n,i){return Array.isArray(n)?n.map((function(e,t){return r(e,i.concat(t))})):KT(t,n,i,e,"map")}(e,[])}var o_=BD("multiplyScalar",["typed"],(e=>{var{typed:t}=e;return t("multiplyScalar",{"number, number":TO,"Complex, Complex":function(e,t){return e.mul(t)},"BigNumber, BigNumber":function(e,t){return e.times(t)},"Fraction, Fraction":function(e,t){return e.mul(t)},"number | Fraction | BigNumber | Complex, Unit":(e,t)=>t.multiply(e),"Unit, number | Fraction | BigNumber | Complex | Unit":(e,t)=>e.multiply(t)})})),l_="number, number";function u_(e){return!e}function c_(e,t){return!(!e&&!t)}function d_(e,t){return!!e!=!!t}function h_(e,t){return!(!e||!t)}u_.signature="number",c_.signature=l_,d_.signature=l_,h_.signature=l_;var f_=BD("not",["typed"],(e=>{var{typed:t}=e;return t("not",{"null | undefined":()=>!0,number:u_,Complex:function(e){return 0===e.re&&0===e.im},BigNumber:function(e){return e.isZero()||e.isNaN()},Unit:t.referToSelf((e=>r=>t.find(e,r.valueType())(r.value))),"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})}));var p_=BD("number",["typed"],(e=>{var{typed:t}=e,r=t("number",{"":function(){return 0},number:function(e){return e},string:function(e){if("NaN"===e)return NaN;var t,r,n=(r=(t=e).match(/(0[box])([0-9a-fA-F]*)\.([0-9a-fA-F]*)/))?{input:t,radix:{"0b":2,"0o":8,"0x":16}[r[1]],integerPart:r[2],fractionalPart:r[3]}:null;if(n)return function(e){for(var t=parseInt(e.integerPart,e.radix),r=0,n=0;n<e.fractionalPart.length;n++)r+=parseInt(e.fractionalPart[n],e.radix)/Math.pow(e.radix,n+1);var i=t+r;if(isNaN(i))throw new SyntaxError('String "'+e.input+'" is no valid number');return i}(n);var i=0,s=e.match(/(0[box][0-9a-fA-F]*)i([0-9]*)/);s&&(i=Number(s[2]),e=s[1]);var a=Number(e);if(isNaN(a))throw new SyntaxError('String "'+e+'" is no valid number');if(s){if(a>2**i-1)throw new SyntaxError('String "'.concat(e,'" is out of range'));a>=2**(i-1)&&(a-=2**i)}return a},BigNumber:function(e){return e.toNumber()},Fraction:function(e){return e.valueOf()},Unit:t.referToSelf((e=>t=>{var r=t.clone();return r.value=e(t.value),r})),null:function(e){return 0},"Unit, string | Unit":function(e,t){return e.toNumber(t)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))});return r.fromJSON=function(e){return parseFloat(e.value)},r})),m_=BD("oct",["typed","format"],(e=>{var{typed:t,format:r}=e;return t("oct",{"number | BigNumber":function(e){return r(e,{notation:"oct"})},"number | BigNumber, number":function(e,t){return r(e,{notation:"oct",wordSize:t})}})})),g_=r(6377),y_=g_(Date.now());function v_(e){var t,r;return t=null===(r=e)?y_:g_(String(r)),function(){return t()}}var b_="pickRandom",w_=BD(b_,["typed","config","?on"],(e=>{var{typed:t,config:r,on:n}=e,i=v_(r.randomSeed);return n&&n("config",(function(e,t){e.randomSeed!==t.randomSeed&&(i=v_(e.randomSeed))})),t(b_,{"Array | Matrix":function(e){return s(e,{})},"Array | Matrix, Object":function(e,t){return s(e,t)},"Array | Matrix, number":function(e,t){return s(e,{number:t})},"Array | Matrix, Array | Matrix":function(e,t){return s(e,{weights:t})},"Array | Matrix, Array | Matrix, number":function(e,t,r){return s(e,{number:r,weights:t})},"Array | Matrix, number, Array | Matrix":function(e,t,r){return s(e,{number:t,weights:r})}});function s(e,t){var{number:r,weights:n,elementWise:s=!0}=t,a=void 0===r;a&&(r=1);var o=QE(e)?e.create:QE(n)?n.create:null;e=e.valueOf(),n&&(n=n.valueOf()),!0===s&&(e=JS(e),n=JS(n));var l=0;if(void 0!==n){if(n.length!==e.length)throw new Error("Weights must have the same length as possibles");for(var u=0,c=n.length;u<c;u++){if(!GE(n[u])||n[u]<0)throw new Error("Weights must be an array of positive numbers");l+=n[u]}}for(var d,h=e.length,f=[];f.length<r;){if(void 0===n)d=e[Math.floor(i()*h)];else for(var p=i()*l,m=0,g=e.length;m<g;m++)if((p-=n[m])<0){d=e[m];break}f.push(d)}return a?f[0]:o?o(f):f}})),x_="print",E_=BD(x_,["typed"],(e=>{var{typed:t}=e;return t(x_,{"string, Object | Array":D_,"string, Object | Array, number | Object":D_})}));function D_(e,t,r){return e.replace(/\$([\w.]+)/g,(function(e,n){for(var i=n.split("."),s=t[i.shift()];i.length&&void 0!==s;){var a=i.shift();s=a?s[a]:s+"."}return void 0!==s?ZE(s)?s:NS(s,r):e}))}function S_(e,t){var r=[];if((e=e.slice(0)).length>1)for(var n=0,i=e.shift();n<i;n++)r.push(S_(e,t));else for(var s=0,a=e.shift();s<a;s++)r.push(t());return r}var A_="random",T_=BD(A_,["typed","config","?on"],(e=>{var{typed:t,config:r,on:n}=e,i=v_(r.randomSeed);return n&&n("config",(function(e,t){e.randomSeed!==t.randomSeed&&(i=v_(e.randomSeed))})),t(A_,{"":()=>a(0,1),number:e=>a(0,e),"number, number":(e,t)=>a(e,t),"Array | Matrix":e=>s(e,0,1),"Array | Matrix, number":(e,t)=>s(e,0,t),"Array | Matrix, number, number":(e,t,r)=>s(e,t,r)});function s(e,t,r){var n=S_(e.valueOf(),(()=>a(t,r)));return QE(e)?e.create(n):n}function a(e,t){return e+i()*(t-e)}})),C_=BD("re",["typed"],(e=>{var{typed:t}=e;return t("re",{"number | BigNumber | Fraction":e=>e,Complex:e=>e.re,"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),N_=BD("sec",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t("sec",{number:uF,Complex:e=>e.sec(),BigNumber:e=>new r(1).div(e.cos())},aL({typed:t}))})),k_="sign",M_=BD(k_,["typed","BigNumber","Fraction","complex"],(e=>{var{typed:t,BigNumber:r,complex:n,Fraction:i}=e;return t(k_,{number:UO,Complex:function(e){return 0===e.im?n(UO(e.re)):e.sign()},BigNumber:function(e){return new r(e.cmp(0))},Fraction:function(e){return new i(e.s,1)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0))),Unit:t.referToSelf((e=>r=>{if(!r._isDerived()&&0!==r.units[0].unit.offset)throw new TypeError("sign is ambiguous for units with offset");return t.find(e,r.valueType())(r.value)}))})})),O_=BD("sin",["typed"],(e=>{var{typed:t}=e,r=aL({typed:t});return t("sin",{number:Math.sin,"Complex | BigNumber":e=>e.sin()},r)})),F_=BD("SparseMatrix",["typed","equalScalar","Matrix"],(e=>{var{typed:t,equalScalar:r,Matrix:n}=e;function i(e,t){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(t&&!ZE(t))throw new Error("Invalid datatype: "+t);if(QE(e))!function(e,t,r){"SparseMatrix"===t.type?(e._values=t._values?_D(t._values):void 0,e._index=_D(t._index),e._ptr=_D(t._ptr),e._size=_D(t._size),e._datatype=r||t._datatype):s(e,t.valueOf(),r||t._datatype)}(this,e,t);else if(e&&XE(e.index)&&XE(e.ptr)&&XE(e.size))this._values=e.values,this._index=e.index,this._ptr=e.ptr,this._size=e.size,this._datatype=t||e.datatype;else if(XE(e))s(this,e,t);else{if(e)throw new TypeError("Unsupported type of data ("+FD(e)+")");this._values=[],this._index=[],this._ptr=[0],this._size=[0,0],this._datatype=t}}function s(e,n,i){e._values=[],e._index=[],e._ptr=[],e._datatype=i;var s=n.length,a=0,o=r,l=0;if(ZE(i)&&(o=t.find(r,[i,i])||r,l=t.convert(0,i)),s>0){var u=0;do{e._ptr.push(e._index.length);for(var c=0;c<s;c++){var d=n[c];if(XE(d)){if(0===u&&a<d.length&&(a=d.length),u<d.length){var h=d[u];o(h,l)||(e._values.push(h),e._index.push(c))}}else 0===u&&a<1&&(a=1),o(d,l)||(e._values.push(d),e._index.push(c))}u++}while(u<a)}e._ptr.push(e._index.length),e._size=[s,a]}function a(e,t,r,n){if(r-t==0)return r;for(var i=t;i<r;i++)if(n[i]===e)return i;return t}function o(e,t,r,n,i,s,a){i.splice(e,0,n),s.splice(e,0,t);for(var o=r+1;o<a.length;o++)a[o]++}function l(e,n,i,s){var a=s||0,o=r,l=0;ZE(e._datatype)&&(o=t.find(r,[e._datatype,e._datatype])||r,l=t.convert(0,e._datatype),a=t.convert(a,e._datatype));var u,c,d,h=!o(a,l),f=e._size[0],p=e._size[1];if(i>p){for(c=p;c<i;c++)if(e._ptr[c]=e._values.length,h)for(u=0;u<f;u++)e._values.push(a),e._index.push(u);e._ptr[i]=e._values.length}else i<p&&(e._ptr.splice(i+1,p-i),e._values.splice(e._ptr[i],e._values.length),e._index.splice(e._ptr[i],e._index.length));if(p=i,n>f){if(h){var m=0;for(c=0;c<p;c++){e._ptr[c]=e._ptr[c]+m,d=e._ptr[c+1]+m;var g=0;for(u=f;u<n;u++,g++)e._values.splice(d+g,0,a),e._index.splice(d+g,0,u),m++}e._ptr[p]=e._values.length}}else if(n<f){var y=0;for(c=0;c<p;c++){e._ptr[c]=e._ptr[c]-y;var v=e._ptr[c],b=e._ptr[c+1]-y;for(d=v;d<b;d++)(u=e._index[d])>n-1&&(e._values.splice(d,1),e._index.splice(d,1),y++)}e._ptr[c]=e._values.length}return e._size[0]=n,e._size[1]=i,e}function u(e,t,r,n,i){var s,a,o=n[0],l=n[1],u=[];for(s=0;s<o;s++)for(u[s]=[],a=0;a<l;a++)u[s][a]=0;for(a=0;a<l;a++)for(var c=r[a],d=r[a+1],h=c;h<d;h++)u[s=t[h]][a]=e?i?_D(e[h]):e[h]:1;return u}return i.prototype=new n,i.prototype.createSparseMatrix=function(e,t){return new i(e,t)},Object.defineProperty(i,"name",{value:"SparseMatrix"}),i.prototype.constructor=i,i.prototype.type="SparseMatrix",i.prototype.isSparseMatrix=!0,i.prototype.getDataType=function(){return iA(this._values,FD)},i.prototype.storage=function(){return"sparse"},i.prototype.datatype=function(){return this._datatype},i.prototype.create=function(e,t){return new i(e,t)},i.prototype.density=function(){var e=this._size[0],t=this._size[1];return 0!==e&&0!==t?this._index.length/(e*t):0},i.prototype.subset=function(e,t,r){if(!this._values)throw new Error("Cannot invoke subset on a Pattern only matrix");switch(arguments.length){case 1:return function(e,t){if(!iD(t))throw new TypeError("Invalid index");if(t.isScalar())return e.get(t.min());var r,n,s,a,o=t.size();if(o.length!==e._size.length)throw new RS(o.length,e._size.length);var l=t.min(),u=t.max();for(r=0,n=e._size.length;r<n;r++)$S(l[r],e._size[r]),$S(u[r],e._size[r]);var c=e._values,d=e._index,h=e._ptr,f=t.dimension(0),p=t.dimension(1),m=[],g=[];f.forEach((function(e,t){g[e]=t[0],m[e]=!0}));var y=c?[]:void 0,v=[],b=[];return p.forEach((function(e){for(b.push(v.length),s=h[e],a=h[e+1];s<a;s++)r=d[s],!0===m[r]&&(v.push(g[r]),y&&y.push(c[s]))})),b.push(v.length),new i({values:y,index:v,ptr:b,size:o,datatype:e._datatype})}(this,e);case 2:case 3:return function(e,t,r,n){if(!t||!0!==t.isIndex)throw new TypeError("Invalid index");var i,s=t.size(),a=t.isScalar();QE(r)?(i=r.size(),r=r.toArray()):i=PS(r);if(a){if(0!==i.length)throw new TypeError("Scalar expected");e.set(t.min(),r,n)}else{if(1!==s.length&&2!==s.length)throw new RS(s.length,e._size.length,"<");if(i.length<s.length){for(var o=0,l=0;1===s[o]&&1===i[o];)o++;for(;1===s[o];)l++,o++;r=WS(r,s.length,l,i)}if(!ID(s,i))throw new RS(s,i,">");if(1===s.length){t.dimension(0).forEach((function(t,i){$S(t),e.set([t,0],r[i[0]],n)}))}else{var u=t.dimension(0),c=t.dimension(1);u.forEach((function(t,i){$S(t),c.forEach((function(s,a){$S(s),e.set([t,s],r[i[0]][a[0]],n)}))}))}}return e}(this,e,t,r);default:throw new SyntaxError("Wrong number of arguments")}},i.prototype.get=function(e){if(!XE(e))throw new TypeError("Array expected");if(e.length!==this._size.length)throw new RS(e.length,this._size.length);if(!this._values)throw new Error("Cannot invoke get on a Pattern only matrix");var t=e[0],r=e[1];$S(t,this._size[0]),$S(r,this._size[1]);var n=a(t,this._ptr[r],this._ptr[r+1],this._index);return n<this._ptr[r+1]&&this._index[n]===t?this._values[n]:0},i.prototype.set=function(e,n,i){if(!XE(e))throw new TypeError("Array expected");if(e.length!==this._size.length)throw new RS(e.length,this._size.length);if(!this._values)throw new Error("Cannot invoke set on a Pattern only matrix");var s=e[0],u=e[1],c=this._size[0],d=this._size[1],h=r,f=0;ZE(this._datatype)&&(h=t.find(r,[this._datatype,this._datatype])||r,f=t.convert(0,this._datatype)),(s>c-1||u>d-1)&&(l(this,Math.max(s+1,c),Math.max(u+1,d),i),c=this._size[0],d=this._size[1]),$S(s,c),$S(u,d);var p=a(s,this._ptr[u],this._ptr[u+1],this._index);return p<this._ptr[u+1]&&this._index[p]===s?h(n,f)?function(e,t,r,n,i){r.splice(e,1),n.splice(e,1);for(var s=t+1;s<i.length;s++)i[s]--}(p,u,this._values,this._index,this._ptr):this._values[p]=n:h(n,f)||o(p,s,u,n,this._values,this._index,this._ptr),this},i.prototype.resize=function(e,t,r){if(!eD(e))throw new TypeError("Array or Matrix expected");var n=e.valueOf().map((e=>Array.isArray(e)&&1===e.length?e[0]:e));if(2!==n.length)throw new Error("Only two dimensions matrix are supported");return n.forEach((function(e){if(!GE(e)||!rS(e)||e<0)throw new TypeError("Invalid size, must contain positive integers (size: "+NS(n)+")")})),l(r?this.clone():this,n[0],n[1],t)},i.prototype.reshape=function(e,t){if(!XE(e))throw new TypeError("Array expected");if(2!==e.length)throw new Error("Sparse matrices can only be reshaped in two dimensions");e.forEach((function(t){if(!GE(t)||!rS(t)||t<=-2||0===t)throw new TypeError("Invalid size, must contain positive integers or -1 (size: "+NS(e)+")")}));var r=this._size[0]*this._size[1];if(r!==(e=HS(e,r))[0]*e[1])throw new Error("Reshaping sparse matrix will result in the wrong number of elements");var n=t?this.clone():this;if(this._size[0]===e[0]&&this._size[1]===e[1])return n;for(var i=[],s=0;s<n._ptr.length;s++)for(var l=0;l<n._ptr[s+1]-n._ptr[s];l++)i.push(s);for(var u=n._values.slice(),c=n._index.slice(),d=0;d<n._index.length;d++){var h=c[d],f=i[d],p=h*n._size[1]+f;i[d]=p%e[1],c[d]=Math.floor(p/e[1])}n._values.length=0,n._index.length=0,n._ptr.length=e[1]+1,n._size=e.slice();for(var m=0;m<n._ptr.length;m++)n._ptr[m]=0;for(var g=0;g<u.length;g++){var y=c[g],v=i[g],b=u[g];o(a(y,n._ptr[v],n._ptr[v+1],n._index),y,v,b,n._values,n._index,n._ptr)}return n},i.prototype.clone=function(){return new i({values:this._values?_D(this._values):void 0,index:_D(this._index),ptr:_D(this._ptr),size:_D(this._size),datatype:this._datatype})},i.prototype.size=function(){return this._size.slice(0)},i.prototype.map=function(e,n){if(!this._values)throw new Error("Cannot invoke map on a Pattern only matrix");var s=this,a=this._size[0],o=this._size[1],l=Uk(e);return function(e,n,s,a,o,l,u){var c=[],d=[],h=[],f=r,p=0;ZE(e._datatype)&&(f=t.find(r,[e._datatype,e._datatype])||r,p=t.convert(0,e._datatype));for(var m=function(e,t,r){e=l(e,t,r),f(e,p)||(c.push(e),d.push(t))},g=a;g<=o;g++){h.push(c.length);var y=e._ptr[g],v=e._ptr[g+1];if(u)for(var b=y;b<v;b++){var w=e._index[b];w>=n&&w<=s&&m(e._values[b],w-n,g-a)}else{for(var x={},E=y;E<v;E++){x[e._index[E]]=e._values[E]}for(var D=n;D<=s;D++){m(D in x?x[D]:0,D-n,g-a)}}}return h.push(c.length),new i({values:c,index:d,ptr:h,size:[s-n+1,o-a+1]})}(this,0,a-1,0,o-1,(function(t,r,n){return 1===l?e(t):2===l?e(t,[r,n]):e(t,[r,n],s)}),n)},i.prototype.forEach=function(e,t){if(!this._values)throw new Error("Cannot invoke forEach on a Pattern only matrix");for(var r=this._size[0],n=this._size[1],i=0;i<n;i++){var s=this._ptr[i],a=this._ptr[i+1];if(t)for(var o=s;o<a;o++){var l=this._index[o];e(this._values[o],[l,i],this)}else{for(var u={},c=s;c<a;c++){u[this._index[c]]=this._values[c]}for(var d=0;d<r;d++){e(d in u?u[d]:0,[d,i],this)}}}},i.prototype[Symbol.iterator]=function*(){if(!this._values)throw new Error("Cannot iterate a Pattern only matrix");for(var e=this._size[1],t=0;t<e;t++)for(var r=this._ptr[t],n=this._ptr[t+1],i=r;i<n;i++){var s=this._index[i];yield{value:this._values[i],index:[s,t]}}},i.prototype.toArray=function(){return u(this._values,this._index,this._ptr,this._size,!0)},i.prototype.valueOf=function(){return u(this._values,this._index,this._ptr,this._size,!1)},i.prototype.format=function(e){for(var t=this._size[0],r=this._size[1],n=this.density(),i="Sparse Matrix ["+NS(t,e)+" x "+NS(r,e)+"] density: "+NS(n,e)+"\n",s=0;s<r;s++)for(var a=this._ptr[s],o=this._ptr[s+1],l=a;l<o;l++){i+="\n    ("+NS(this._index[l],e)+", "+NS(s,e)+") ==> "+(this._values?NS(this._values[l],e):"X")}return i},i.prototype.toString=function(){return NS(this.toArray())},i.prototype.toJSON=function(){return{mathjs:"SparseMatrix",values:this._values,index:this._index,ptr:this._ptr,size:this._size,datatype:this._datatype}},i.prototype.diagonal=function(e){if(e){if(KE(e)&&(e=e.toNumber()),!GE(e)||!rS(e))throw new TypeError("The parameter k must be an integer number")}else e=0;var t=e>0?e:0,r=e<0?-e:0,n=this._size[0],s=this._size[1],a=Math.min(n-r,s-t),o=[],l=[],u=[];u[0]=0;for(var c=t;c<s&&o.length<a;c++)for(var d=this._ptr[c],h=this._ptr[c+1],f=d;f<h;f++){var p=this._index[f];if(p===c-t+r){o.push(this._values[f]),l[o.length-1]=p-r;break}}return u.push(o.length),new i({values:o,index:l,ptr:u,size:[a,1]})},i.fromJSON=function(e){return new i(e)},i.diagonal=function(e,n,s,a,o){if(!XE(e))throw new TypeError("Array expected, size parameter");if(2!==e.length)throw new Error("Only two dimensions matrix are supported");if(e=e.map((function(e){if(KE(e)&&(e=e.toNumber()),!GE(e)||!rS(e)||e<1)throw new Error("Size values must be positive integers");return e})),s){if(KE(s)&&(s=s.toNumber()),!GE(s)||!rS(s))throw new TypeError("The parameter k must be an integer number")}else s=0;var l=r,u=0;ZE(o)&&(l=t.find(r,[o,o])||r,u=t.convert(0,o));var c,d=s>0?s:0,h=s<0?-s:0,f=e[0],p=e[1],m=Math.min(f-h,p-d);if(XE(n)){if(n.length!==m)throw new Error("Invalid value array length");c=function(e){return n[e]}}else if(QE(n)){var g=n.size();if(1!==g.length||g[0]!==m)throw new Error("Invalid matrix length");c=function(e){return n.get([e])}}else c=function(){return n};for(var y=[],v=[],b=[],w=0;w<p;w++){b.push(y.length);var x=w-d;if(x>=0&&x<m){var E=c(x);l(E,u)||(v.push(x+h),y.push(E))}}return b.push(y.length),new i({values:y,index:v,ptr:b,size:[f,p]})},i.prototype.swapRows=function(e,t){if(!(GE(e)&&rS(e)&&GE(t)&&rS(t)))throw new Error("Row index must be positive integers");if(2!==this._size.length)throw new Error("Only two dimensional matrix is supported");return $S(e,this._size[0]),$S(t,this._size[0]),i._swapRows(e,t,this._size[1],this._values,this._index,this._ptr),this},i._forEachRow=function(e,t,r,n,i){for(var s=n[e],a=n[e+1],o=s;o<a;o++)i(r[o],t[o])},i._swapRows=function(e,t,r,n,i,s){for(var o=0;o<r;o++){var l=s[o],u=s[o+1],c=a(e,l,u,i),d=a(t,l,u,i);if(c<u&&d<u&&i[c]===e&&i[d]===t){if(n){var h=n[c];n[c]=n[d],n[d]=h}}else if(c<u&&i[c]===e&&(d>=u||i[d]!==t)){var f=n?n[c]:void 0;i.splice(d,0,t),n&&n.splice(d,0,f),i.splice(d<=c?c+1:c,1),n&&n.splice(d<=c?c+1:c,1)}else if(d<u&&i[d]===t&&(c>=u||i[c]!==e)){var p=n?n[d]:void 0;i.splice(c,0,e),n&&n.splice(c,0,p),i.splice(c<=d?d+1:d,1),n&&n.splice(c<=d?d+1:d,1)}}},i}),{isClass:!0}),L_="splitUnit",__=BD(L_,["typed"],(e=>{var{typed:t}=e;return t(L_,{"Unit, Array":function(e,t){return e.splitUnit(t)}})})),R_="square",I_=BD(R_,["typed"],(e=>{var{typed:t}=e;return t(R_,{number:$O,Complex:function(e){return e.mul(e)},BigNumber:function(e){return e.times(e)},Fraction:function(e){return e.mul(e)},Unit:function(e){return e.pow(2)}})})),P_="string",B_=BD(P_,["typed"],(e=>{var{typed:t}=e;return t(P_,{"":function(){return""},number:cS,null:function(e){return"null"},boolean:function(e){return e+""},string:function(e){return e},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e))),any:function(e){return String(e)}})})),U_=BD("tan",["typed"],(e=>{var{typed:t}=e,r=aL({typed:t});return t("tan",{number:Math.tan,"Complex | BigNumber":e=>e.tan()},r)})),$_="typeOf",z_=BD($_,["typed"],(e=>{var{typed:t}=e;return t($_,{any:FD})})),j_="acosh",q_=BD(j_,["typed","config","Complex"],(e=>{var{typed:t,config:r,Complex:n}=e;return t(j_,{number:function(e){return e>=1||r.predictable?JO(e):e<=-1?new n(Math.log(Math.sqrt(e*e-1)-e),Math.PI):new n(e,0).acosh()},Complex:function(e){return e.acosh()},BigNumber:function(e){return e.acosh()}})})),H_="acsch",V_=BD(H_,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t(H_,{number:eF,Complex:function(e){return e.acsch()},BigNumber:function(e){return new r(1).div(e).asinh()}})})),G_="asec",K_=BD(G_,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:r,Complex:n,BigNumber:i}=e;return t(G_,{number:function(e){return e<=-1||e>=1||r.predictable?tF(e):new n(e,0).asec()},Complex:function(e){return e.asec()},BigNumber:function(e){return new i(1).div(e).acos()}})})),W_=BD("bin",["typed","format"],(e=>{var{typed:t,format:r}=e;return t("bin",{"number | BigNumber":function(e){return r(e,{notation:"bin"})},"number | BigNumber, number":function(e,t){return r(e,{notation:"bin",wordSize:t})}})})),Y_="combinationsWithRep",J_=BD(Y_,["typed"],(e=>{var{typed:t}=e;return t(Y_,{"number, number":function(e,t){if(!rS(e)||e<0)throw new TypeError("Positive integer value expected in function combinationsWithRep");if(!rS(t)||t<0)throw new TypeError("Positive integer value expected in function combinationsWithRep");if(e<1)throw new TypeError("k must be less than or equal to n + k - 1");return t<e-1?WF(e,e+t-1)/WF(1,t):WF(t+1,e+t-1)/WF(1,e-1)},"BigNumber, BigNumber":function(e,t){var r,n,i=new(0,e.constructor)(1),s=e.minus(i);if(!Z_(e)||!Z_(t))throw new TypeError("Positive integer value expected in function combinationsWithRep");if(e.lt(i))throw new TypeError("k must be less than or equal to n + k - 1 in function combinationsWithRep");if(r=i,t.lt(s))for(n=i;n.lte(s);n=n.plus(i))r=r.times(t.plus(n)).dividedBy(n);else for(n=i;n.lte(t);n=n.plus(i))r=r.times(s.plus(n)).dividedBy(n);return r}})}));function Z_(e){return e.isInteger()&&e.gte(0)}var X_=BD("cos",["typed"],(e=>{var{typed:t}=e,r=aL({typed:t});return t("cos",{number:Math.cos,"Complex | BigNumber":e=>e.cos()},r)})),Q_="csch",eR=BD(Q_,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t(Q_,{number:lF,Complex:e=>e.csch(),BigNumber:e=>new r(1).div(e.sinh())})})),tR="isNaN",rR=BD(tR,["typed"],(e=>{var{typed:t}=e;return t(tR,{number:$L,BigNumber:function(e){return e.isNaN()},Fraction:function(e){return!1},Complex:function(e){return e.isNaN()},Unit:function(e){return Number.isNaN(e.value)},"Array | Matrix":function(e){return eT(e,Number.isNaN)}})})),nR="isPrime",iR=BD(nR,["typed"],(e=>{var{typed:t}=e;return t(nR,{number:function(e){if(0*e!=0)return!1;if(e<=3)return e>1;if(e%2==0||e%3==0)return!1;for(var t=5;t*t<=e;t+=6)if(e%t==0||e%(t+2)==0)return!1;return!0},BigNumber:function(e){if(0*e.toNumber()!=0)return!1;if(e.lte(3))return e.gt(1);if(e.mod(2).eq(0)||e.mod(3).eq(0))return!1;if(e.lt(Math.pow(2,32))){for(var t=e.toNumber(),r=5;r*r<=t;r+=6)if(t%r==0||t%(r+2)==0)return!1;return!0}function n(e,t,r){for(var n=1;!t.eq(0);)t.mod(2).eq(0)?(t=t.div(2),e=e.mul(e).mod(r)):(t=t.sub(1),n=e.mul(n).mod(r));return n}for(var i=e.constructor.clone({precision:2*e.toFixed(0).length}),s=0,a=(e=new i(e)).sub(1);a.mod(2).eq(0);)a=a.div(2),s+=1;var o=null;if(e.lt("3317044064679887385961981"))o=[2,3,5,7,11,13,17,19,23,29,31,37,41].filter((t=>t<e));else{var l=Math.min(e.toNumber()-2,Math.floor(2*Math.pow(e.toFixed(0).length*Math.log(10),2)));o=[];for(var u=2;u<=l;u+=1)o.push(l)}for(var c=0;c<o.length;c+=1){var d=o[c],h=n(e.sub(e).add(d),a,e);if(!h.eq(1))for(var f=0,p=h;!p.eq(e.sub(1));f+=1,p=p.mul(p).mod(e))if(f===s-1)return!1}return!0},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),sR="randomInt",aR=BD(sR,["typed","config","?on"],(e=>{var{typed:t,config:r,on:n}=e,i=v_(r.randomSeed);return n&&n("config",(function(e,t){e.randomSeed!==t.randomSeed&&(i=v_(e.randomSeed))})),t(sR,{"":()=>a(0,1),number:e=>a(0,e),"number, number":(e,t)=>a(e,t),"Array | Matrix":e=>s(e,0,1),"Array | Matrix, number":(e,t)=>s(e,0,t),"Array | Matrix, number, number":(e,t,r)=>s(e,t,r)});function s(e,t,r){var n=S_(e.valueOf(),(()=>a(t,r)));return QE(e)?e.create(n):n}function a(e,t){return Math.floor(e+i()*(t-e))}})),oR="sech",lR=BD(oR,["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t(oR,{number:cF,Complex:e=>e.sech(),BigNumber:e=>new r(1).div(e.cosh())})})),uR="sinh",cR=BD(uR,["typed"],(e=>{var{typed:t}=e;return t(uR,{number:dF,"Complex | BigNumber":e=>e.sinh()})})),dR="sparse",hR=BD(dR,["typed","SparseMatrix"],(e=>{var{typed:t,SparseMatrix:r}=e;return t(dR,{"":function(){return new r([])},string:function(e){return new r([],e)},"Array | Matrix":function(e){return new r(e)},"Array | Matrix, string":function(e,t){return new r(e,t)}})})),fR=BD("sqrt",["config","typed","Complex"],(e=>{var{config:t,typed:r,Complex:n}=e;return r("sqrt",{number:i,Complex:function(e){return e.sqrt()},BigNumber:function(e){return!e.isNegative()||t.predictable?e.sqrt():i(e.toNumber())},Unit:function(e){return e.pow(.5)}});function i(e){return isNaN(e)?NaN:e>=0||t.predictable?Math.sqrt(e):new n(e,0).sqrt()}})),pR=BD("tanh",["typed"],(e=>{var{typed:t}=e;return t("tanh",{number:DS,"Complex | BigNumber":e=>e.tanh()})})),mR="unaryMinus",gR=BD(mR,["typed"],(e=>{var{typed:t}=e;return t(mR,{number:CO,"Complex | BigNumber | Fraction":e=>e.neg(),Unit:t.referToSelf((e=>r=>{var n=r.clone();return n.value=t.find(e,n.valueType())(r.value),n})),"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0)))})})),yR="acoth",vR=BD(yR,["typed","config","Complex","BigNumber"],(e=>{var{typed:t,config:r,Complex:n,BigNumber:i}=e;return t(yR,{number:function(e){return e>=1||e<=-1||r.predictable?XO(e):new n(e,0).acoth()},Complex:function(e){return e.acoth()},BigNumber:function(e){return new i(1).div(e).atanh()}})})),bR=BD("cot",["typed","BigNumber"],(e=>{var{typed:t,BigNumber:r}=e;return t("cot",{number:sF,Complex:e=>e.cot(),BigNumber:e=>new r(1).div(e.tan())},aL({typed:t}))})),wR=BD("fraction",["typed","Fraction"],(e=>{var{typed:t,Fraction:r}=e;return t("fraction",{number:function(e){if(!isFinite(e)||isNaN(e))throw new Error(e+" cannot be represented as a fraction");return new r(e)},string:function(e){return new r(e)},"number, number":function(e,t){return new r(e,t)},null:function(e){return new r(0)},BigNumber:function(e){return new r(e.toString())},Fraction:function(e){return e},Unit:t.referToSelf((e=>t=>{var r=t.clone();return r.value=e(t.value),r})),Object:function(e){return new r(e)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),xR="isNumeric",ER=BD(xR,["typed"],(e=>{var{typed:t}=e;return t(xR,{"number | BigNumber | Fraction | boolean":()=>!0,"Complex | Unit | string | null | undefined | Node":()=>!1,"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),DR="matrix",SR=BD(DR,["typed","Matrix","DenseMatrix","SparseMatrix"],(e=>{var{typed:t,Matrix:r,DenseMatrix:n,SparseMatrix:i}=e;return t(DR,{"":function(){return s([])},string:function(e){return s([],e)},"string, string":function(e,t){return s([],e,t)},Array:function(e){return s(e)},Matrix:function(e){return s(e,e.storage())},"Array | Matrix, string":s,"Array | Matrix, string, string":s});function s(e,t,r){if("dense"===t||"default"===t||void 0===t)return new n(e,r);if("sparse"===t)return new i(e,r);throw new TypeError("Unknown matrix type "+JSON.stringify(t)+".")}})),AR="matrixFromFunction",TR=BD(AR,["typed","matrix","isZero"],(e=>{var{typed:t,matrix:r,isZero:n}=e;return t(AR,{"Array | Matrix, function, string, string":function(e,t,r,n){return i(e,t,r,n)},"Array | Matrix, function, string":function(e,t,r){return i(e,t,r)},"Matrix, function":function(e,t){return i(e,t,"dense")},"Array, function":function(e,t){return i(e,t,"dense").toArray()},"Array | Matrix, string, function":function(e,t,r){return i(e,r,t)},"Array | Matrix, string, string, function":function(e,t,r,n){return i(e,n,t,r)}});function i(e,t,i,s){var a;return(a=void 0!==s?r(i,s):r(i)).resize(e),a.forEach((function(e,r){var i=t(r);n(i)||a.set(r,i)})),a}})),CR="mode",NR=BD(CR,["typed","isNaN","isNumeric"],(e=>{var{typed:t,isNaN:r,isNumeric:n}=e;return t(CR,{"Array | Matrix":i,"...":function(e){return i(e)}});function i(e){if(0===(e=JS(e.valueOf())).length)throw new Error("Cannot calculate mode of an empty array");for(var t={},i=[],s=0,a=0;a<e.length;a++){var o=e[a];if(n(o)&&r(o))throw new Error("Cannot calculate mode of an array containing NaN values");o in t||(t[o]=0),t[o]++,t[o]===s?i.push(o):t[o]>s&&(s=t[o],i=[o])}return i}})),kR=BD("numeric",["number","?bignumber","?fraction"],(e=>{var{number:t,bignumber:r,fraction:n}=e,i={string:!0,number:!0,BigNumber:!0,Fraction:!0},s={number:e=>t(e),BigNumber:r?e=>r(e):cT,Fraction:n?e=>n(e):dT};return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"number";if(void 0!==(arguments.length>2?arguments[2]:void 0))throw new SyntaxError("numeric() takes one or two arguments");var r=FD(e);if(!(r in i))throw new TypeError("Cannot convert "+e+' of type "'+r+'"; valid input types are '+Object.keys(i).join(", "));if(!(t in s))throw new TypeError("Cannot convert "+e+' to type "'+t+'"; valid output types are '+Object.keys(s).join(", "));return t===r?e:s[t](e)}})),MR="prod",OR=BD(MR,["typed","config","multiplyScalar","numeric"],(e=>{var{typed:t,config:r,multiplyScalar:n,numeric:i}=e;return t(MR,{"Array | Matrix":s,"Array | Matrix, number | BigNumber":function(e,t){throw new Error("prod(A, dim) is not yet supported")},"...":function(e){return s(e)}});function s(e){var t;if(QA(e,(function(e){try{t=void 0===t?e:n(t,e)}catch(t){throw mC(t,"prod",e)}})),"string"==typeof t&&(t=i(t,r.number)),void 0===t)throw new Error("Cannot calculate prod of an empty array");return t}})),FR="reshape",LR=BD(FR,["typed","isInteger","matrix"],(e=>{var{typed:t,isInteger:r}=e;return t(FR,{"Matrix, Array":function(e,t){return e.reshape(t,!0)},"Array, Array":function(e,t){return t.forEach((function(e){if(!r(e))throw new TypeError("Invalid size for dimension: "+e)})),qS(e,t)}})})),_R="size",RR=BD(_R,["typed","config","?matrix"],(e=>{var{typed:t,config:r,matrix:n}=e;return t(_R,{Matrix:function(e){return e.create(e.size())},Array:PS,string:function(e){return"Array"===r.matrix?[e.length]:n([e.length])},"number | Complex | BigNumber | Unit | boolean | null":function(e){return"Array"===r.matrix?[]:n?n([]):hT()}})})),IR="squeeze",PR=BD(IR,["typed","matrix"],(e=>{var{typed:t,matrix:r}=e;return t(IR,{Array:function(e){return GS(_D(e))},Matrix:function(e){var t=GS(e.toArray());return Array.isArray(t)?r(t):t},any:function(e){return _D(e)}})})),BR="transpose",UR=BD(BR,["typed","matrix"],(e=>{var{typed:t,matrix:r}=e;return t(BR,{Array:e=>n(r(e)).valueOf(),Matrix:n,any:_D});function n(e){var t,r=e.size();switch(r.length){case 1:t=e.clone();break;case 2:var n=r[0],i=r[1];if(0===i)throw new RangeError("Cannot transpose a 2D matrix with no columns (size: "+NS(r)+")");switch(e.storage()){case"dense":t=function(e,t,r){for(var n,i=e._data,s=[],a=0;a<r;a++){n=s[a]=[];for(var o=0;o<t;o++)n[o]=_D(i[o][a])}return e.createDenseMatrix({data:s,size:[r,t],datatype:e._datatype})}(e,n,i);break;case"sparse":t=function(e,t,r){for(var n,i,s,a=e._values,o=e._index,l=e._ptr,u=a?[]:void 0,c=[],d=[],h=[],f=0;f<t;f++)h[f]=0;for(n=0,i=o.length;n<i;n++)h[o[n]]++;for(var p=0,m=0;m<t;m++)d.push(p),p+=h[m],h[m]=d[m];for(d.push(p),s=0;s<r;s++)for(var g=l[s],y=l[s+1],v=g;v<y;v++){var b=h[o[v]]++;c[b]=s,a&&(u[b]=_D(a[v]))}return e.createSparseMatrix({values:u,index:c,ptr:d,size:[r,t],datatype:e._datatype})}(e,n,i)}break;default:throw new RangeError("Matrix must be a vector or two dimensional (size: "+NS(r)+")")}return t}})),$R="xgcd",zR=BD($R,["typed","config","matrix","BigNumber"],(e=>{var{typed:t,config:r,matrix:n,BigNumber:i}=e;return t($R,{"number, number":function(e,t){var i=zO(e,t);return"Array"===r.matrix?i:n(i)},"BigNumber, BigNumber":function(e,t){var s,a,o,l,u=new i(0),c=new i(1),d=u,h=c,f=c,p=u;if(!e.isInt()||!t.isInt())throw new Error("Parameters in function xgcd must be integer numbers");for(;!t.isZero();)a=e.div(t).floor(),o=e.mod(t),s=d,d=h.minus(a.times(d)),h=s,s=f,f=p.minus(a.times(f)),p=s,e=t,t=o;l=e.lt(u)?[e.neg(),h.neg(),p.neg()]:[e,e.isZero()?0:h,p];return"Array"===r.matrix?l:n(l)}})})),jR="zeros",qR=BD(jR,["typed","config","matrix","BigNumber"],(e=>{var{typed:t,config:r,matrix:n,BigNumber:i}=e;return t(jR,{"":function(){return"Array"===r.matrix?s([]):s([],"default")},"...number | BigNumber | string":function(e){if("string"==typeof e[e.length-1]){var t=e.pop();return s(e,t)}return"Array"===r.matrix?s(e):s(e,"default")},Array:s,Matrix:function(e){var t=e.storage();return s(e.valueOf(),t)},"Array | Matrix, string":function(e,t){return s(e.valueOf(),t)}});function s(e,t){var r=function(e){var t=!1;return e.forEach((function(e,r,n){KE(e)&&(t=!0,n[r]=e.toNumber())})),t}(e),s=r?new i(0):0;if(function(e){e.forEach((function(e){if("number"!=typeof e||!rS(e)||e<0)throw new Error("Parameters in function zeros must be positive integers")}))}(e),t){var a=n(t);return e.length>0?a.resize(e,s):a}var o=[];return e.length>0?zS(o,e,s):o}})),HR="asin",VR=BD(HR,["typed","config","Complex"],(e=>{var{typed:t,config:r,Complex:n}=e;return t(HR,{number:function(e){return e>=-1&&e<=1||r.predictable?Math.asin(e):new n(e,0).asin()},Complex:function(e){return e.asin()},BigNumber:function(e){return e.asin()}})})),GR="cbrt",KR=BD(GR,["config","typed","isNegative","unaryMinus","matrix","Complex","BigNumber","Fraction"],(e=>{var{config:t,typed:r,isNegative:n,unaryMinus:i,matrix:s,Complex:a,BigNumber:o,Fraction:l}=e;return r(GR,{number:kO,Complex:u,"Complex, boolean":u,BigNumber:function(e){return e.cbrt()},Unit:function(e){if(e.value&&WE(e.value)){var t=e.clone();return t.value=1,(t=t.pow(1/3)).value=u(e.value),t}var r,s=n(e.value);s&&(e.value=i(e.value)),r=KE(e.value)?new o(1).div(3):YE(e.value)?new l(1,3):1/3;var a=e.pow(r);return s&&(a.value=i(a.value)),a}});function u(e,r){var n=e.arg()/3,i=e.abs(),o=new a(kO(i),0).mul(new a(0,n).exp());if(r){var l=[o,new a(kO(i),0).mul(new a(0,n+2*Math.PI/3).exp()),new a(kO(i),0).mul(new a(0,n-2*Math.PI/3).exp())];return"Array"===t.matrix?l:s(l)}return o}})),WR="count",YR=BD(WR,["typed","size","prod"],(e=>{var{typed:t,size:r,prod:n}=e;return t(WR,{string:function(e){return e.length},"Matrix | Array":function(e){return n(r(e))}})})),JR="ctranspose",ZR=BD(JR,["typed","transpose","conj"],(e=>{var{typed:t,transpose:r,conj:n}=e;return t(JR,{any:function(e){return n(r(e))}})})),XR="diag",QR=BD(XR,["typed","matrix","DenseMatrix","SparseMatrix"],(e=>{var{typed:t,matrix:r,DenseMatrix:n,SparseMatrix:i}=e;return t(XR,{Array:function(e){return s(e,0,PS(e),null)},"Array, number":function(e,t){return s(e,t,PS(e),null)},"Array, BigNumber":function(e,t){return s(e,t.toNumber(),PS(e),null)},"Array, string":function(e,t){return s(e,0,PS(e),t)},"Array, number, string":function(e,t,r){return s(e,t,PS(e),r)},"Array, BigNumber, string":function(e,t,r){return s(e,t.toNumber(),PS(e),r)},Matrix:function(e){return s(e,0,e.size(),e.storage())},"Matrix, number":function(e,t){return s(e,t,e.size(),e.storage())},"Matrix, BigNumber":function(e,t){return s(e,t.toNumber(),e.size(),e.storage())},"Matrix, string":function(e,t){return s(e,0,e.size(),t)},"Matrix, number, string":function(e,t,r){return s(e,t,e.size(),r)},"Matrix, BigNumber, string":function(e,t,r){return s(e,t.toNumber(),e.size(),r)}});function s(e,t,s,a){if(!rS(t))throw new TypeError("Second parameter in function diag must be an integer");var o=t>0?t:0,l=t<0?-t:0;switch(s.length){case 1:return function(e,t,r,s,a,o){var l=[s+a,s+o];if(r&&"sparse"!==r&&"dense"!==r)throw new TypeError("Unknown matrix type ".concat(r,'"'));var u="sparse"===r?i.diagonal(l,e,t):n.diagonal(l,e,t);return null!==r?u:u.valueOf()}(e,t,a,s[0],l,o);case 2:return function(e,t,n,i,s,a){if(QE(e)){var o=e.diagonal(t);return null!==n?n!==o.storage()?r(o,n):o:o.valueOf()}for(var l=Math.min(i[0]-s,i[1]-a),u=[],c=0;c<l;c++)u[c]=e[c+s][c+a];return null!==n?r(u):u}(e,t,a,s,l,o)}throw new RangeError("Matrix for function diag must be 2 dimensional")}})),eI="divideScalar",tI=BD(eI,["typed","numeric"],(e=>{var{typed:t,numeric:r}=e;return t(eI,{"number, number":function(e,t){return e/t},"Complex, Complex":function(e,t){return e.div(t)},"BigNumber, BigNumber":function(e,t){return e.div(t)},"Fraction, Fraction":function(e,t){return e.div(t)},"Unit, number | Complex | Fraction | BigNumber | Unit":(e,t)=>e.divide(t),"number | Fraction | Complex | BigNumber, Unit":(e,t)=>t.divideInto(e)})})),rI=BD("matAlgo02xDS0",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return function(e,n,i,s){var a=e._data,o=e._size,l=e._datatype,u=n._values,c=n._index,d=n._ptr,h=n._size,f=n._datatype;if(o.length!==h.length)throw new RS(o.length,h.length);if(o[0]!==h[0]||o[1]!==h[1])throw new RangeError("Dimension mismatch. Matrix A ("+o+") must match Matrix B ("+h+")");if(!u)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var p,m=o[0],g=o[1],y=r,v=0,b=i;"string"==typeof l&&l===f&&(p=l,y=t.find(r,[p,p]),v=t.convert(0,p),b=t.find(i,[p,p]));for(var w=[],x=[],E=[],D=0;D<g;D++){E[D]=x.length;for(var S=d[D],A=d[D+1],T=S;T<A;T++){var C=c[T],N=s?b(u[T],a[C][D]):b(a[C][D],u[T]);y(N,v)||(x.push(C),w.push(N))}}return E[g]=x.length,n.createSparseMatrix({values:w,index:x,ptr:E,size:[m,g],datatype:p})}})),nI=BD("matAlgo03xDSf",["typed"],(e=>{var{typed:t}=e;return function(e,r,n,i){var s=e._data,a=e._size,o=e._datatype,l=r._values,u=r._index,c=r._ptr,d=r._size,h=r._datatype;if(a.length!==d.length)throw new RS(a.length,d.length);if(a[0]!==d[0]||a[1]!==d[1])throw new RangeError("Dimension mismatch. Matrix A ("+a+") must match Matrix B ("+d+")");if(!l)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var f,p=a[0],m=a[1],g=0,y=n;"string"==typeof o&&o===h&&(f=o,g=t.convert(0,f),y=t.find(n,[f,f]));for(var v=[],b=0;b<p;b++)v[b]=[];for(var w=[],x=[],E=0;E<m;E++){for(var D=E+1,S=c[E],A=c[E+1],T=S;T<A;T++){var C=u[T];w[C]=i?y(l[T],s[C][E]):y(s[C][E],l[T]),x[C]=D}for(var N=0;N<p;N++)x[N]===D?v[N][E]=w[N]:v[N][E]=i?y(g,s[N][E]):y(s[N][E],g)}return e.createDenseMatrix({data:v,size:[p,m],datatype:f})}})),iI=BD("matAlgo07xSSf",["typed","DenseMatrix"],(e=>{var{typed:t,DenseMatrix:r}=e;return function(e,i,s){var a=e._size,o=e._datatype,l=i._size,u=i._datatype;if(a.length!==l.length)throw new RS(a.length,l.length);if(a[0]!==l[0]||a[1]!==l[1])throw new RangeError("Dimension mismatch. Matrix A ("+a+") must match Matrix B ("+l+")");var c,d,h,f=a[0],p=a[1],m=0,g=s;"string"==typeof o&&o===u&&(c=o,m=t.convert(0,c),g=t.find(s,[c,c]));var y=[];for(d=0;d<f;d++)y[d]=[];var v=[],b=[],w=[],x=[];for(h=0;h<p;h++){var E=h+1;for(n(e,h,w,v,E),n(i,h,x,b,E),d=0;d<f;d++){var D=w[d]===E?v[d]:m,S=x[d]===E?b[d]:m;y[d][h]=g(D,S)}}return new r({data:y,size:[f,p],datatype:c})};function n(e,t,r,n,i){for(var s=e._values,a=e._index,o=e._ptr,l=o[t],u=o[t+1];l<u;l++){var c=a[l];r[c]=i,n[c]=s[l]}}})),sI=BD("matAlgo11xS0s",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return function(e,n,i,s){var a=e._values,o=e._index,l=e._ptr,u=e._size,c=e._datatype;if(!a)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var d,h=u[0],f=u[1],p=r,m=0,g=i;"string"==typeof c&&(d=c,p=t.find(r,[d,d]),m=t.convert(0,d),n=t.convert(n,d),g=t.find(i,[d,d]));for(var y=[],v=[],b=[],w=0;w<f;w++){b[w]=v.length;for(var x=l[w],E=l[w+1],D=x;D<E;D++){var S=o[D],A=s?g(n,a[D]):g(a[D],n);p(A,m)||(v.push(S),y.push(A))}}return b[f]=v.length,e.createSparseMatrix({values:y,index:v,ptr:b,size:[h,f],datatype:d})}})),aI=BD("matAlgo12xSfs",["typed","DenseMatrix"],(e=>{var{typed:t,DenseMatrix:r}=e;return function(e,n,i,s){var a=e._values,o=e._index,l=e._ptr,u=e._size,c=e._datatype;if(!a)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var d,h=u[0],f=u[1],p=i;"string"==typeof c&&(d=c,n=t.convert(n,d),p=t.find(i,[d,d]));for(var m=[],g=[],y=[],v=0;v<f;v++){for(var b=v+1,w=l[v],x=l[v+1],E=w;E<x;E++){var D=o[E];g[D]=a[E],y[D]=b}for(var S=0;S<h;S++)0===v&&(m[S]=[]),y[S]===b?m[S][v]=s?p(n,g[S]):p(g[S],n):m[S][v]=s?p(n,0):p(0,n)}return new r({data:m,size:[h,f],datatype:d})}})),oI=BD("matAlgo13xDD",["typed"],(e=>{var{typed:t}=e;return function(e,n,i){var s,a=e._data,o=e._size,l=e._datatype,u=n._data,c=n._size,d=n._datatype,h=[];if(o.length!==c.length)throw new RS(o.length,c.length);for(var f=0;f<o.length;f++){if(o[f]!==c[f])throw new RangeError("Dimension mismatch. Matrix A ("+o+") must match Matrix B ("+c+")");h[f]=o[f]}var p=i;"string"==typeof l&&l===d&&(s=l,p=t.find(i,[s,s]));var m=h.length>0?r(p,0,h,h[0],a,u):[];return e.createDenseMatrix({data:m,size:h,datatype:s})};function r(e,t,n,i,s,a){var o=[];if(t===n.length-1)for(var l=0;l<i;l++)o[l]=e(s[l],a[l]);else for(var u=0;u<i;u++)o[u]=r(e,t+1,n,n[t+1],s[u],a[u]);return o}})),lI=BD("matAlgo14xDs",["typed"],(e=>{var{typed:t}=e;return function(e,n,i,s){var a,o=e._data,l=e._size,u=e._datatype,c=i;"string"==typeof u&&(a=u,n=t.convert(n,a),c=t.find(i,[a,a]));var d=l.length>0?r(c,0,l,l[0],o,n,s):[];return e.createDenseMatrix({data:d,size:_D(l),datatype:a})};function r(e,t,n,i,s,a,o){var l=[];if(t===n.length-1)for(var u=0;u<i;u++)l[u]=o?e(a,s[u]):e(s[u],a);else for(var c=0;c<i;c++)l[c]=r(e,t+1,n,n[t+1],s[c],a,o);return l}})),uI=BD("broadcast",["concat"],(e=>{var{concat:t}=e;return function(e,t){var s=Math.max(e._size.length,t._size.length);if(e._size.length===t._size.length&&e._size.every(((e,r)=>e===t._size[r])))return[e,t];for(var a=r(e._size,s,0),o=r(t._size,s,0),l=[],u=0;u<s;u++)l[u]=Math.max(a[u],o[u]);for(var c=0;c<s;c++)i(a,l,c),i(o,l,c);var d=e.clone(),h=t.clone();d._size.length<s?d.reshape(r(d._size,s,1)):h._size.length<s&&h.reshape(r(h._size,s,1));for(var f=0;f<s;f++)d._size[f]<l[f]&&(d=n(d,l[f],f)),h._size[f]<l[f]&&(h=n(h,l[f],f));return[d,h]};function r(e,t,r){return[...Array(t-e.length).fill(r),...e]}function n(e,r,n){return t(...Array(r).fill(e),n)}function i(e,t,r){if(e[r]<t[r]&e[r]>1)throw new Error("shape missmatch: missmatch is found in arg with shape (".concat(e,") not possible to broadcast dimension ").concat(r," with size ").concat(e[r]," to size ").concat(t[r]))}})),cI=BD("matrixAlgorithmSuite",["typed","matrix","concat"],(e=>{var{typed:t,matrix:r,concat:n}=e,i=oI({typed:t}),s=lI({typed:t}),a=uI({concat:n});return function(e){var n,o=e.elop,l=e.SD||e.DS;o?(n={"DenseMatrix, DenseMatrix":(e,t)=>i(...a(e,t),o),"Array, Array":(e,t)=>i(...a(r(e),r(t)),o).valueOf(),"Array, DenseMatrix":(e,t)=>i(...a(r(e),t),o),"DenseMatrix, Array":(e,t)=>i(...a(e,r(t)),o)},e.SS&&(n["SparseMatrix, SparseMatrix"]=(t,r)=>e.SS(...a(t,r),o,!1)),e.DS&&(n["DenseMatrix, SparseMatrix"]=(t,r)=>e.DS(...a(t,r),o,!1),n["Array, SparseMatrix"]=(t,n)=>e.DS(...a(r(t),n),o,!1)),l&&(n["SparseMatrix, DenseMatrix"]=(e,t)=>l(...a(t,e),o,!0),n["SparseMatrix, Array"]=(e,t)=>l(...a(r(t),e),o,!0))):(n={"DenseMatrix, DenseMatrix":t.referToSelf((e=>(t,r)=>i(...a(t,r),e))),"Array, Array":t.referToSelf((e=>(t,n)=>i(...a(r(t),r(n)),e).valueOf())),"Array, DenseMatrix":t.referToSelf((e=>(t,n)=>i(...a(r(t),n),e))),"DenseMatrix, Array":t.referToSelf((e=>(t,n)=>i(...a(t,r(n)),e)))},e.SS&&(n["SparseMatrix, SparseMatrix"]=t.referToSelf((t=>(r,n)=>e.SS(...a(r,n),t,!1)))),e.DS&&(n["DenseMatrix, SparseMatrix"]=t.referToSelf((t=>(r,n)=>e.DS(...a(r,n),t,!1))),n["Array, SparseMatrix"]=t.referToSelf((t=>(n,i)=>e.DS(...a(r(n),i),t,!1)))),l&&(n["SparseMatrix, DenseMatrix"]=t.referToSelf((e=>(t,r)=>l(...a(r,t),e,!0))),n["SparseMatrix, Array"]=t.referToSelf((e=>(t,n)=>l(...a(r(n),t),e,!0)))));var u=e.scalar||"any";(e.Ds||e.Ss)&&(o?(n["DenseMatrix,"+u]=(e,t)=>s(e,t,o,!1),n[u+", DenseMatrix"]=(e,t)=>s(t,e,o,!0),n["Array,"+u]=(e,t)=>s(r(e),t,o,!1).valueOf(),n[u+", Array"]=(e,t)=>s(r(t),e,o,!0).valueOf()):(n["DenseMatrix,"+u]=t.referToSelf((e=>(t,r)=>s(t,r,e,!1))),n[u+", DenseMatrix"]=t.referToSelf((e=>(t,r)=>s(r,t,e,!0))),n["Array,"+u]=t.referToSelf((e=>(t,n)=>s(r(t),n,e,!1).valueOf())),n[u+", Array"]=t.referToSelf((e=>(t,n)=>s(r(n),t,e,!0).valueOf()))));var c=void 0!==e.sS?e.sS:e.Ss;return o?(e.Ss&&(n["SparseMatrix,"+u]=(t,r)=>e.Ss(t,r,o,!1)),c&&(n[u+", SparseMatrix"]=(e,t)=>c(t,e,o,!0))):(e.Ss&&(n["SparseMatrix,"+u]=t.referToSelf((t=>(r,n)=>e.Ss(r,n,t,!1)))),c&&(n[u+", SparseMatrix"]=t.referToSelf((e=>(t,r)=>c(r,t,e,!0))))),o&&o.signatures&&RD(n,o.signatures),n}})),dI="dotDivide",hI=BD(dI,["typed","matrix","equalScalar","divideScalar","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,divideScalar:i,DenseMatrix:s,concat:a}=e,o=rI({typed:t,equalScalar:n}),l=nI({typed:t}),u=iI({typed:t,DenseMatrix:s}),c=sI({typed:t,equalScalar:n}),d=aI({typed:t,DenseMatrix:s}),h=cI({typed:t,matrix:r,concat:a});return t(dI,h({elop:i,SS:u,DS:l,SD:o,Ss:c,sS:d}))})),fI="equal",pI=BD(fI,["typed","matrix","equalScalar","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,DenseMatrix:i,concat:s}=e,a=nI({typed:t}),o=iI({typed:t,DenseMatrix:i}),l=aI({typed:t,DenseMatrix:i}),u=cI({typed:t,matrix:r,concat:s});return t(fI,mI({typed:t,equalScalar:n}),u({elop:n,SS:o,DS:a,Ss:l}))})),mI=BD(fI,["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return t(fI,{"any, any":function(e,t){return null===e?null===t:null===t?null===e:void 0===e?void 0===t:void 0===t?void 0===e:r(e,t)}})})),gI="flatten",yI=BD(gI,["typed","matrix"],(e=>{var{typed:t,matrix:r}=e;return t(gI,{Array:function(e){return JS(e)},Matrix:function(e){var t=JS(e.toArray());return r(t)}})})),vI=BD("matAlgo01xDSid",["typed"],(e=>{var{typed:t}=e;return function(e,r,n,i){var s=e._data,a=e._size,o=e._datatype,l=r._values,u=r._index,c=r._ptr,d=r._size,h=r._datatype;if(a.length!==d.length)throw new RS(a.length,d.length);if(a[0]!==d[0]||a[1]!==d[1])throw new RangeError("Dimension mismatch. Matrix A ("+a+") must match Matrix B ("+d+")");if(!l)throw new Error("Cannot perform operation on Dense Matrix and Pattern Sparse Matrix");var f,p,m=a[0],g=a[1],y="string"==typeof o&&o===h?o:void 0,v=y?t.find(n,[y,y]):n,b=[];for(f=0;f<m;f++)b[f]=[];var w=[],x=[];for(p=0;p<g;p++){for(var E=p+1,D=c[p],S=c[p+1],A=D;A<S;A++)w[f=u[A]]=i?v(l[A],s[f][p]):v(s[f][p],l[A]),x[f]=E;for(f=0;f<m;f++)x[f]===E?b[f][p]=w[f]:b[f][p]=s[f][p]}return e.createDenseMatrix({data:b,size:[m,g],datatype:y})}})),bI=BD("matAlgo04xSidSid",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return function(e,n,i){var s=e._values,a=e._index,o=e._ptr,l=e._size,u=e._datatype,c=n._values,d=n._index,h=n._ptr,f=n._size,p=n._datatype;if(l.length!==f.length)throw new RS(l.length,f.length);if(l[0]!==f[0]||l[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+l+") must match Matrix B ("+f+")");var m,g=l[0],y=l[1],v=r,b=0,w=i;"string"==typeof u&&u===p&&(m=u,v=t.find(r,[m,m]),b=t.convert(0,m),w=t.find(i,[m,m]));var x,E,D,S,A,T=s&&c?[]:void 0,C=[],N=[],k=s&&c?[]:void 0,M=s&&c?[]:void 0,O=[],F=[];for(E=0;E<y;E++){N[E]=C.length;var L=E+1;for(S=o[E],A=o[E+1],D=S;D<A;D++)x=a[D],C.push(x),O[x]=L,k&&(k[x]=s[D]);for(S=h[E],A=h[E+1],D=S;D<A;D++)if(O[x=d[D]]===L){if(k){var _=w(k[x],c[D]);v(_,b)?O[x]=null:k[x]=_}}else C.push(x),F[x]=L,M&&(M[x]=c[D]);if(k&&M)for(D=N[E];D<C.length;)O[x=C[D]]===L?(T[D]=k[x],D++):F[x]===L?(T[D]=M[x],D++):C.splice(D,1)}return N[y]=C.length,e.createSparseMatrix({values:T,index:C,ptr:N,size:[g,y],datatype:m})}})),wI=BD("matAlgo10xSids",["typed","DenseMatrix"],(e=>{var{typed:t,DenseMatrix:r}=e;return function(e,n,i,s){var a=e._values,o=e._index,l=e._ptr,u=e._size,c=e._datatype;if(!a)throw new Error("Cannot perform operation on Pattern Sparse Matrix and Scalar value");var d,h=u[0],f=u[1],p=i;"string"==typeof c&&(d=c,n=t.convert(n,d),p=t.find(i,[d,d]));for(var m=[],g=[],y=[],v=0;v<f;v++){for(var b=v+1,w=l[v],x=l[v+1],E=w;E<x;E++){var D=o[E];g[D]=a[E],y[D]=b}for(var S=0;S<h;S++)0===v&&(m[S]=[]),y[S]===b?m[S][v]=s?p(n,g[S]):p(g[S],n):m[S][v]=n}return new r({data:m,size:[h,f],datatype:d})}}));function xI(e,t,r,n){if(!(this instanceof xI))throw new SyntaxError("Constructor must be called with the new operator");this.fn=e,this.count=t,this.min=r,this.max=n,this.message="Wrong number of arguments in function "+e+" ("+t+" provided, "+r+(null!=n?"-"+n:"")+" expected)",this.stack=(new Error).stack}xI.prototype=new Error,xI.prototype.constructor=Error,xI.prototype.name="ArgumentsError",xI.prototype.isArgumentsError=!0;var EI=["typed","matrix","equalScalar","BigNumber","DenseMatrix","concat"],DI="number | BigNumber | Fraction | Matrix | Array",SI="".concat(DI,", ").concat(DI,", ...").concat(DI);function AI(e){return!e.some((e=>Array.isArray(e)))}var TI=BD("gcd",EI,(e=>{var{typed:t,matrix:r,equalScalar:n,BigNumber:i,DenseMatrix:s,concat:a}=e,o=vI({typed:t}),l=bI({typed:t,equalScalar:n}),u=wI({typed:t,DenseMatrix:s});return t("gcd",{"number, number":LO,"BigNumber, BigNumber":function(e,t){if(!e.isInt()||!t.isInt())throw new Error("Parameters in function gcd must be integer numbers");var r=new i(0);for(;!t.isZero();){var n=e.mod(t);e=t,t=n}return e.lt(r)?e.neg():e},"Fraction, Fraction":(e,t)=>e.gcd(t)},cI({typed:t,matrix:r,concat:a})({SS:l,DS:o,Ss:u}),{[SI]:t.referToSelf((e=>(t,r,n)=>{for(var i=e(t,r),s=0;s<n.length;s++)i=e(i,n[s]);return i})),Array:t.referToSelf((e=>t=>{if(1===t.length&&Array.isArray(t[0])&&AI(t[0]))return e(...t[0]);if(AI(t))return e(...t);throw new xI("gcd() supports only 1d matrices!")})),Matrix:t.referToSelf((e=>t=>e(t.toArray())))})})),CI="hasNumericValue",NI=BD(CI,["typed","isNumeric"],(e=>{var{typed:t,isNumeric:r}=e;return t(CI,{boolean:()=>!0,string:function(e){return e.trim().length>0&&!isNaN(Number(e))},any:function(e){return r(e)}})})),kI="identity",MI=BD(kI,["typed","config","matrix","BigNumber","DenseMatrix","SparseMatrix"],(e=>{var{typed:t,config:r,matrix:n,BigNumber:i,DenseMatrix:s,SparseMatrix:a}=e;return t(kI,{"":function(){return"Matrix"===r.matrix?n([]):[]},string:function(e){return n(e)},"number | BigNumber":function(e){return l(e,e,"Matrix"===r.matrix?"dense":void 0)},"number | BigNumber, string":function(e,t){return l(e,e,t)},"number | BigNumber, number | BigNumber":function(e,t){return l(e,t,"Matrix"===r.matrix?"dense":void 0)},"number | BigNumber, number | BigNumber, string":function(e,t,r){return l(e,t,r)},Array:function(e){return o(e)},"Array, string":function(e,t){return o(e,t)},Matrix:function(e){return o(e.valueOf(),e.storage())},"Matrix, string":function(e,t){return o(e.valueOf(),t)}});function o(e,t){switch(e.length){case 0:return t?n(t):[];case 1:return l(e[0],e[0],t);case 2:return l(e[0],e[1],t);default:throw new Error("Vector containing two values expected")}}function l(e,t,r){var n=KE(e)||KE(t)?i:null;if(KE(e)&&(e=e.toNumber()),KE(t)&&(t=t.toNumber()),!rS(e)||e<1)throw new Error("Parameters in function identity must be positive integers");if(!rS(t)||t<1)throw new Error("Parameters in function identity must be positive integers");var o=n?new i(1):1,l=n?new n(0):0,u=[e,t];if(r){if("sparse"===r)return a.diagonal(u,o,0,l);if("dense"===r)return s.diagonal(u,o,0,l);throw new TypeError('Unknown matrix type "'.concat(r,'"'))}for(var c=zS([],u,l),d=e<t?e:t,h=0;h<d;h++)c[h][h]=o;return c}})),OI="kron",FI=BD(OI,["typed","matrix","multiplyScalar"],(e=>{var{typed:t,matrix:r,multiplyScalar:n}=e;return t(OI,{"Matrix, Matrix":function(e,t){return r(i(e.toArray(),t.toArray()))},"Matrix, Array":function(e,t){return r(i(e.toArray(),t))},"Array, Matrix":function(e,t){return r(i(e,t.toArray()))},"Array, Array":i});function i(e,t){if(1===PS(e).length&&(e=[e]),1===PS(t).length&&(t=[t]),PS(e).length>2||PS(t).length>2)throw new RangeError("Vectors with dimensions greater then 2 are not supported expected (Size x = "+JSON.stringify(e.length)+", y = "+JSON.stringify(t.length)+")");var r=[],i=[];return e.map((function(e){return t.map((function(t){return i=[],r.push(i),e.map((function(e){return t.map((function(t){return i.push(n(e,t))}))}))}))}))&&r}})),LI="largerEq",_I=BD(LI,["typed","config","matrix","DenseMatrix","concat"],(e=>{var{typed:t,config:r,matrix:n,DenseMatrix:i,concat:s}=e,a=nI({typed:t}),o=iI({typed:t,DenseMatrix:i}),l=aI({typed:t,DenseMatrix:i}),u=cI({typed:t,matrix:n,concat:s}),c=dL({typed:t});return t(LI,RI({typed:t,config:r}),{"boolean, boolean":(e,t)=>e>=t,"BigNumber, BigNumber":function(e,t){return e.gte(t)||cL(e,t,r.epsilon)},"Fraction, Fraction":(e,t)=>-1!==e.compare(t),"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")}},c,u({SS:o,DS:a,Ss:l}))})),RI=BD(LI,["typed","config"],(e=>{var{typed:t,config:r}=e;return t(LI,{"number, number":function(e,t){return e>=t||yS(e,t,r.epsilon)}})})),II=BD("matAlgo08xS0Sid",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return function(e,n,i){var s=e._values,a=e._index,o=e._ptr,l=e._size,u=e._datatype,c=n._values,d=n._index,h=n._ptr,f=n._size,p=n._datatype;if(l.length!==f.length)throw new RS(l.length,f.length);if(l[0]!==f[0]||l[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+l+") must match Matrix B ("+f+")");if(!s||!c)throw new Error("Cannot perform operation on Pattern Sparse Matrices");var m,g=l[0],y=l[1],v=r,b=0,w=i;"string"==typeof u&&u===p&&(m=u,v=t.find(r,[m,m]),b=t.convert(0,m),w=t.find(i,[m,m]));for(var x,E,D,S,A=[],T=[],C=[],N=[],k=[],M=0;M<y;M++){C[M]=T.length;var O=M+1;for(E=o[M],D=o[M+1],x=E;x<D;x++)k[S=a[x]]=O,N[S]=s[x],T.push(S);for(E=h[M],D=h[M+1],x=E;x<D;x++)k[S=d[x]]===O&&(N[S]=w(N[S],c[x]));for(x=C[M];x<T.length;){var F=N[S=T[x]];v(F,b)?T.splice(x,1):(A.push(F),x++)}}return C[y]=T.length,e.createSparseMatrix({values:A,index:T,ptr:C,size:[g,y],datatype:m})}})),PI=BD("useMatrixForArrayScalar",["typed","matrix"],(e=>{var{typed:t,matrix:r}=e;return{"Array, number":t.referTo("DenseMatrix, number",(e=>(t,n)=>e(r(t),n).valueOf())),"Array, BigNumber":t.referTo("DenseMatrix, BigNumber",(e=>(t,n)=>e(r(t),n).valueOf())),"number, Array":t.referTo("number, DenseMatrix",(e=>(t,n)=>e(t,r(n)).valueOf())),"BigNumber, Array":t.referTo("BigNumber, DenseMatrix",(e=>(t,n)=>e(t,r(n)).valueOf()))}})),BI="leftShift",UI=BD(BI,["typed","matrix","equalScalar","zeros","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,zeros:i,DenseMatrix:s,concat:a}=e,o=vI({typed:t}),l=rI({typed:t,equalScalar:n}),u=II({typed:t,equalScalar:n}),c=wI({typed:t,DenseMatrix:s}),d=sI({typed:t,equalScalar:n}),h=lI({typed:t}),f=cI({typed:t,matrix:r,concat:a}),p=PI({typed:t,matrix:r});return t(BI,{"number, number":UF,"BigNumber, BigNumber":FF,"SparseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>n(r,0)?t.clone():d(t,r,e,!1))),"DenseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>n(r,0)?t.clone():h(t,r,e,!1))),"number | BigNumber, SparseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):c(r,t,e,!0))),"number | BigNumber, DenseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):h(r,t,e,!0)))},p,f({SS:u,DS:o,SD:l}))})),$I="matrixFromColumns",zI=BD($I,["typed","matrix","flatten","size"],(e=>{var{typed:t,matrix:r,flatten:n,size:i}=e;return t($I,{"...Array":function(e){return s(e)},"...Matrix":function(e){return r(s(e.map((e=>e.toArray()))))}});function s(e){if(0===e.length)throw new TypeError("At least one column is needed to construct a matrix.");for(var t=a(e[0]),r=[],i=0;i<t;i++)r[i]=[];for(var s of e){var o=a(s);if(o!==t)throw new TypeError("The vectors had different length: "+(0|t)+" ≠ "+(0|o));for(var l=n(s),u=0;u<t;u++)r[u].push(l[u])}return r}function a(e){var t=i(e);if(1===t.length)return t[0];if(2===t.length){if(1===t[0])return t[1];if(1===t[1])return t[0];throw new TypeError("At least one of the arguments is not a vector.")}throw new TypeError("Only one- or two-dimensional vectors are supported.")}})),jI=BD("matAlgo05xSfSf",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return function(e,n,i){var s=e._values,a=e._index,o=e._ptr,l=e._size,u=e._datatype,c=n._values,d=n._index,h=n._ptr,f=n._size,p=n._datatype;if(l.length!==f.length)throw new RS(l.length,f.length);if(l[0]!==f[0]||l[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+l+") must match Matrix B ("+f+")");var m,g=l[0],y=l[1],v=r,b=0,w=i;"string"==typeof u&&u===p&&(m=u,v=t.find(r,[m,m]),b=t.convert(0,m),w=t.find(i,[m,m]));var x,E,D,S,A=s&&c?[]:void 0,T=[],C=[],N=A?[]:void 0,k=A?[]:void 0,M=[],O=[];for(E=0;E<y;E++){C[E]=T.length;var F=E+1;for(D=o[E],S=o[E+1];D<S;D++)x=a[D],T.push(x),M[x]=F,N&&(N[x]=s[D]);for(D=h[E],S=h[E+1];D<S;D++)M[x=d[D]]!==F&&T.push(x),O[x]=F,k&&(k[x]=c[D]);if(A)for(D=C[E];D<T.length;){var L=M[x=T[D]],_=O[x];if(L===F||_===F){var R=w(L===F?N[x]:b,_===F?k[x]:b);v(R,b)?T.splice(D,1):(A.push(R),D++)}}}return C[y]=T.length,e.createSparseMatrix({values:A,index:T,ptr:C,size:[g,y],datatype:m})}})),qI=BD("mod",["typed","matrix","equalScalar","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,DenseMatrix:i,concat:s}=e,a=rI({typed:t,equalScalar:n}),o=nI({typed:t}),l=jI({typed:t,equalScalar:n}),u=sI({typed:t,equalScalar:n}),c=aI({typed:t,DenseMatrix:i});return t("mod",{"number, number":PO,"BigNumber, BigNumber":function(e,t){if(t.isNeg())throw new Error("Cannot calculate mod for a negative divisor");return t.isZero()?e:e.mod(t)},"Fraction, Fraction":function(e,t){if(t.compare(0)<0)throw new Error("Cannot calculate mod for a negative divisor");return e.compare(0)>=0?e.mod(t):e.mod(t).add(t).mod(t)}},cI({typed:t,matrix:r,concat:s})({SS:l,DS:o,SD:a,Ss:u,sS:c}))})),HI=BD("matAlgo06xS0S0",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return function(e,n,i){var s=e._values,a=e._size,o=e._datatype,l=n._values,u=n._size,c=n._datatype;if(a.length!==u.length)throw new RS(a.length,u.length);if(a[0]!==u[0]||a[1]!==u[1])throw new RangeError("Dimension mismatch. Matrix A ("+a+") must match Matrix B ("+u+")");var d,h=a[0],f=a[1],p=r,m=0,g=i;"string"==typeof o&&o===c&&(d=o,p=t.find(r,[d,d]),m=t.convert(0,d),g=t.find(i,[d,d]));for(var y=s&&l?[]:void 0,v=[],b=[],w=y?[]:void 0,x=[],E=[],D=0;D<f;D++){b[D]=v.length;var S=D+1;if(nT(e,D,x,w,E,S,v,g),nT(n,D,x,w,E,S,v,g),w)for(var A=b[D];A<v.length;){var T=v[A];if(E[T]===S){var C=w[T];p(C,m)?v.splice(A,1):(y.push(C),A++)}else v.splice(A,1)}else for(var N=b[D];N<v.length;){E[v[N]]!==S?v.splice(N,1):N++}}return b[f]=v.length,e.createSparseMatrix({values:y,index:v,ptr:b,size:[h,f],datatype:d})}})),VI="nthRoot",GI=BD(VI,["typed","matrix","equalScalar","BigNumber","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,BigNumber:i,concat:s}=e,a=vI({typed:t}),o=rI({typed:t,equalScalar:n}),l=HI({typed:t,equalScalar:n}),u=sI({typed:t,equalScalar:n}),c=cI({typed:t,matrix:r,concat:s});function d(){throw new Error("Complex number not supported in function nthRoot. Use nthRoots instead.")}return t(VI,{number:BO,"number, number":BO,BigNumber:e=>h(e,new i(2)),"BigNumber, BigNumber":h,Complex:d,"Complex, number":d,Array:t.referTo("DenseMatrix,number",(e=>t=>e(r(t),2).valueOf())),DenseMatrix:t.referTo("DenseMatrix,number",(e=>t=>e(t,2))),SparseMatrix:t.referTo("SparseMatrix,number",(e=>t=>e(t,2))),"SparseMatrix, SparseMatrix":t.referToSelf((e=>(t,r)=>{if(1===r.density())return l(t,r,e);throw new Error("Root must be non-zero")})),"DenseMatrix, SparseMatrix":t.referToSelf((e=>(t,r)=>{if(1===r.density())return a(t,r,e,!1);throw new Error("Root must be non-zero")})),"Array, SparseMatrix":t.referTo("DenseMatrix,SparseMatrix",(e=>(t,n)=>e(r(t),n))),"number | BigNumber, SparseMatrix":t.referToSelf((e=>(t,r)=>{if(1===r.density())return u(r,t,e,!0);throw new Error("Root must be non-zero")}))},c({scalar:"number | BigNumber",SD:o,Ss:u,sS:!1}));function h(e,t){var r=i.precision,n=i.clone({precision:r+2}),s=new i(0),a=new n(1),o=t.isNegative();if(o&&(t=t.neg()),t.isZero())throw new Error("Root must be non-zero");if(e.isNegative()&&!t.abs().mod(2).equals(1))throw new Error("Root must be odd when a is negative.");if(e.isZero())return o?new n(1/0):0;if(!e.isFinite())return o?s:e;var l=e.abs().pow(a.div(t));return l=e.isNeg()?l.neg():l,new i((o?a.div(l):l).toPrecision(r))}})),KI=BD("ones",["typed","config","matrix","BigNumber"],(e=>{var{typed:t,config:r,matrix:n,BigNumber:i}=e;return t("ones",{"":function(){return"Array"===r.matrix?s([]):s([],"default")},"...number | BigNumber | string":function(e){if("string"==typeof e[e.length-1]){var t=e.pop();return s(e,t)}return"Array"===r.matrix?s(e):s(e,"default")},Array:s,Matrix:function(e){var t=e.storage();return s(e.valueOf(),t)},"Array | Matrix, string":function(e,t){return s(e.valueOf(),t)}});function s(e,t){var r=function(e){var t=!1;return e.forEach((function(e,r,n){KE(e)&&(t=!0,n[r]=e.toNumber())})),t}(e),s=r?new i(1):1;if(function(e){e.forEach((function(e){if("number"!=typeof e||!rS(e)||e<0)throw new Error("Parameters in function ones must be positive integers")}))}(e),t){var a=n(t);return e.length>0?a.resize(e,s):a}var o=[];return e.length>0?zS(o,e,s):o}})),WI=BD("resize",["config","matrix"],(e=>{var{config:t,matrix:r}=e;return function(e,n,i){if(2!==arguments.length&&3!==arguments.length)throw new xI("resize",arguments.length,2,3);if(QE(n)&&(n=n.valueOf()),KE(n[0])&&(n=n.map((function(e){return KE(e)?e.toNumber():e}))),QE(e))return e.resize(n,i,!0);if("string"==typeof e)return function(e,t,r){if(void 0!==r){if("string"!=typeof r||1!==r.length)throw new TypeError("Single character expected as defaultValue")}else r=" ";if(1!==t.length)throw new RS(t.length,1);var n=t[0];if("number"!=typeof n||!rS(n))throw new TypeError("Invalid size, must contain positive integers (size: "+NS(t)+")");if(e.length>n)return e.substring(0,n);if(e.length<n){for(var i=e,s=0,a=n-e.length;s<a;s++)i+=r;return i}return e}(e,n,i);var s=!Array.isArray(e)&&"Array"!==t.matrix;if(0===n.length){for(;Array.isArray(e);)e=e[0];return _D(e)}Array.isArray(e)||(e=[e]);var a=zS(e=_D(e),n,i);return s?r(a):a}})),YI="rightArithShift",JI=BD(YI,["typed","matrix","equalScalar","zeros","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,zeros:i,DenseMatrix:s,concat:a}=e,o=vI({typed:t}),l=rI({typed:t,equalScalar:n}),u=II({typed:t,equalScalar:n}),c=wI({typed:t,DenseMatrix:s}),d=sI({typed:t,equalScalar:n}),h=lI({typed:t}),f=cI({typed:t,matrix:r,concat:a}),p=PI({typed:t,matrix:r});return t(YI,{"number, number":$F,"BigNumber, BigNumber":LF,"SparseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>n(r,0)?t.clone():d(t,r,e,!1))),"DenseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>n(r,0)?t.clone():h(t,r,e,!1))),"number | BigNumber, SparseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):c(r,t,e,!0))),"number | BigNumber, DenseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):h(r,t,e,!0)))},p,f({SS:u,DS:o,SD:l}))})),ZI="Number of decimals in function round must be an integer",XI="round",QI=BD(XI,["typed","matrix","equalScalar","zeros","BigNumber","DenseMatrix"],(e=>{var{typed:t,matrix:r,equalScalar:n,zeros:i,BigNumber:s,DenseMatrix:a}=e,o=sI({typed:t,equalScalar:n}),l=aI({typed:t,DenseMatrix:a}),u=lI({typed:t});return t(XI,{number:qO,"number, number":qO,"number, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(ZI);return new s(e).toDecimalPlaces(t.toNumber())},Complex:function(e){return e.round()},"Complex, number":function(e,t){if(t%1)throw new TypeError(ZI);return e.round(t)},"Complex, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(ZI);var r=t.toNumber();return e.round(r)},BigNumber:function(e){return e.toDecimalPlaces(0)},"BigNumber, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(ZI);return e.toDecimalPlaces(t.toNumber())},Fraction:function(e){return e.round()},"Fraction, number":function(e,t){if(t%1)throw new TypeError(ZI);return e.round(t)},"Fraction, BigNumber":function(e,t){if(!t.isInteger())throw new TypeError(ZI);return e.round(t.toNumber())},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0))),"SparseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>o(t,r,e,!1))),"DenseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>u(t,r,e,!1))),"Array, number | BigNumber":t.referToSelf((e=>(t,n)=>u(r(t),n,e,!1).valueOf())),"number | Complex | BigNumber | Fraction, SparseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):l(r,t,e,!0))),"number | Complex | BigNumber | Fraction, DenseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):u(r,t,e,!0))),"number | Complex | BigNumber | Fraction, Array":t.referToSelf((e=>(t,n)=>u(r(n),t,e,!0).valueOf()))})})),eP="smaller",tP=BD(eP,["typed","config","matrix","DenseMatrix","concat"],(e=>{var{typed:t,config:r,matrix:n,DenseMatrix:i,concat:s}=e,a=nI({typed:t}),o=iI({typed:t,DenseMatrix:i}),l=aI({typed:t,DenseMatrix:i}),u=cI({typed:t,matrix:n,concat:s}),c=dL({typed:t});return t(eP,rP({typed:t,config:r}),{"boolean, boolean":(e,t)=>e<t,"BigNumber, BigNumber":function(e,t){return e.lt(t)&&!cL(e,t,r.epsilon)},"Fraction, Fraction":(e,t)=>-1===e.compare(t),"Complex, Complex":function(e,t){throw new TypeError("No ordering relation is defined for complex numbers")}},c,u({SS:o,DS:a,Ss:l}))})),rP=BD(eP,["typed","config"],(e=>{var{typed:t,config:r}=e;return t(eP,{"number, number":function(e,t){return e<t&&!yS(e,t,r.epsilon)}})})),nP=BD("to",["typed","matrix","concat"],(e=>{var{typed:t,matrix:r,concat:n}=e;return t("to",{"Unit, Unit | string":(e,t)=>e.to(t)},cI({typed:t,matrix:r,concat:n})({Ds:!0}))})),iP="unequal",sP=BD(iP,["typed","config","equalScalar","matrix","DenseMatrix","concat"],(e=>{var{typed:t,config:r,equalScalar:n,matrix:i,DenseMatrix:s,concat:a}=e,o=nI({typed:t}),l=iI({typed:t,DenseMatrix:s}),u=aI({typed:t,DenseMatrix:s}),c=cI({typed:t,matrix:i,concat:a});return t(iP,aP({typed:t,equalScalar:n}),c({elop:function(e,t){return!n(e,t)},SS:l,DS:o,Ss:u}))})),aP=BD(iP,["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return t(iP,{"any, any":function(e,t){return null===e?null!==t:null===t?null!==e:void 0===e?void 0!==t:void 0===t?void 0!==e:!r(e,t)}})})),oP=BD("xor",["typed","matrix","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,DenseMatrix:n,concat:i}=e,s=nI({typed:t}),a=iI({typed:t,DenseMatrix:n}),o=aI({typed:t,DenseMatrix:n}),l=cI({typed:t,matrix:r,concat:i});return t("xor",{"number, number":d_,"Complex, Complex":function(e,t){return(0!==e.re||0!==e.im)!=(0!==t.re||0!==t.im)},"BigNumber, BigNumber":function(e,t){return(!e.isZero()&&!e.isNaN())!=(!t.isZero()&&!t.isNaN())},"Unit, Unit":t.referToSelf((e=>(t,r)=>e(t.value||0,r.value||0)))},l({SS:a,DS:s,Ss:o}))})),lP=BD("add",["typed","matrix","addScalar","equalScalar","DenseMatrix","SparseMatrix","concat"],(e=>{var{typed:t,matrix:r,addScalar:n,equalScalar:i,DenseMatrix:s,SparseMatrix:a,concat:o}=e,l=vI({typed:t}),u=bI({typed:t,equalScalar:i}),c=wI({typed:t,DenseMatrix:s}),d=cI({typed:t,matrix:r,concat:o});return t("add",{"any, any":n,"any, any, ...any":t.referToSelf((e=>(t,r,n)=>{for(var i=e(t,r),s=0;s<n.length;s++)i=e(i,n[s]);return i}))},d({elop:n,DS:l,SS:u,Ss:c}))})),uP="bitAnd",cP=BD(uP,["typed","matrix","equalScalar","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,concat:i}=e,s=rI({typed:t,equalScalar:n}),a=HI({typed:t,equalScalar:n}),o=sI({typed:t,equalScalar:n}),l=cI({typed:t,matrix:r,concat:i});return t(uP,{"number, number":RF,"BigNumber, BigNumber":TF},l({SS:a,DS:s,Ss:o}))})),dP="bitXor",hP=BD(dP,["typed","matrix","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,DenseMatrix:n,concat:i}=e,s=nI({typed:t}),a=iI({typed:t,DenseMatrix:n}),o=aI({typed:t,DenseMatrix:n}),l=cI({typed:t,matrix:r,concat:i});return t(dP,{"number, number":BF,"BigNumber, BigNumber":OF},l({SS:a,DS:s,Ss:o}))})),fP="catalan",pP=BD(fP,["typed","addScalar","divideScalar","multiplyScalar","combinations","isNegative","isInteger"],(e=>{var{typed:t,addScalar:r,divideScalar:n,multiplyScalar:i,combinations:s,isNegative:a,isInteger:o}=e;return t(fP,{"number | BigNumber":function(e){if(!o(e)||a(e))throw new TypeError("Non-negative integer value expected in function catalan");return n(s(i(e,2),e),r(e,1))}})})),mP="compare",gP=BD(mP,["typed","config","matrix","equalScalar","BigNumber","Fraction","DenseMatrix","concat"],(e=>{var{typed:t,config:r,equalScalar:n,matrix:i,BigNumber:s,Fraction:a,DenseMatrix:o,concat:l}=e,u=nI({typed:t}),c=jI({typed:t,equalScalar:n}),d=aI({typed:t,DenseMatrix:o}),h=cI({typed:t,matrix:i,concat:l}),f=dL({typed:t});return t(mP,yP({typed:t,config:r}),{"boolean, boolean":function(e,t){return e===t?0:e>t?1:-1},"BigNumber, BigNumber":function(e,t){return cL(e,t,r.epsilon)?new s(0):new s(e.cmp(t))},"Fraction, Fraction":function(e,t){return new a(e.compare(t))},"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")}},f,h({SS:c,DS:u,Ss:d}))})),yP=BD(mP,["typed","config"],(e=>{var{typed:t,config:r}=e;return t(mP,{"number, number":function(e,t){return yS(e,t,r.epsilon)?0:e>t?1:-1}})})),vP="compareText",bP=["typed","matrix","concat"];FS.signature="any, any";var wP=BD(vP,bP,(e=>{var{typed:t,matrix:r,concat:n}=e,i=cI({typed:t,matrix:r,concat:n});return t(vP,FS,i({elop:FS,Ds:!0}))})),xP="deepEqual",EP=BD(xP,["typed","equal"],(e=>{var{typed:t,equal:r}=e;return t(xP,{"any, any":function(e,t){return n(e.valueOf(),t.valueOf())}});function n(e,t){if(Array.isArray(e)){if(Array.isArray(t)){var i=e.length;if(i!==t.length)return!1;for(var s=0;s<i;s++)if(!n(e[s],t[s]))return!1;return!0}return!1}return!Array.isArray(t)&&r(e,t)}})),DP=BD("dot",["typed","addScalar","multiplyScalar","conj","size"],(e=>{var{typed:t,addScalar:r,multiplyScalar:n,conj:i,size:s}=e;return t("dot",{"Array | DenseMatrix, Array | DenseMatrix":function(e,s){var l=a(e,s),u=QE(e)?e._data:e,c=QE(e)?e._datatype:void 0,d=QE(s)?s._data:s,h=QE(s)?s._datatype:void 0,f=2===o(e).length,p=2===o(s).length,m=r,g=n;if(c&&h&&c===h&&"string"==typeof c){var y=c;m=t.find(r,[y,y]),g=t.find(n,[y,y])}if(!f&&!p){for(var v=g(i(u[0]),d[0]),b=1;b<l;b++)v=m(v,g(i(u[b]),d[b]));return v}if(!f&&p){for(var w=g(i(u[0]),d[0][0]),x=1;x<l;x++)w=m(w,g(i(u[x]),d[x][0]));return w}if(f&&!p){for(var E=g(i(u[0][0]),d[0]),D=1;D<l;D++)E=m(E,g(i(u[D][0]),d[D]));return E}if(f&&p){for(var S=g(i(u[0][0]),d[0][0]),A=1;A<l;A++)S=m(S,g(i(u[A][0]),d[A][0]));return S}},"SparseMatrix, SparseMatrix":function(e,t){a(e,t);var i=e._index,s=e._values,o=t._index,l=t._values,u=0,c=r,d=n,h=0,f=0;for(;h<i.length&&f<o.length;){var p=i[h],m=o[f];p<m?h++:p>m?f++:p===m&&(u=c(u,d(s[h],l[f])),h++,f++)}return u}});function a(e,t){var r,n,i=o(e),s=o(t);if(1===i.length)r=i[0];else{if(2!==i.length||1!==i[1])throw new RangeError("Expected a column vector, instead got a matrix of size ("+i.join(", ")+")");r=i[0]}if(1===s.length)n=s[0];else{if(2!==s.length||1!==s[1])throw new RangeError("Expected a column vector, instead got a matrix of size ("+s.join(", ")+")");n=s[0]}if(r!==n)throw new RangeError("Vectors must have equal length ("+r+" != "+n+")");if(0===r)throw new RangeError("Cannot calculate the dot product of empty vectors");return r}function o(e){return QE(e)?e.size():s(e)}})),SP="equalText",AP=BD(SP,["typed","compareText","isZero"],(e=>{var{typed:t,compareText:r,isZero:n}=e;return t(SP,{"any, any":function(e,t){return n(r(e,t))}})})),TP="floor",CP=["typed","config","round","matrix","equalScalar","zeros","DenseMatrix"],NP=BD(TP,["typed","config","round"],(e=>{var{typed:t,config:r,round:n}=e;return t(TP,{number:function(e){return yS(e,n(e),r.epsilon)?n(e):Math.floor(e)},"number, number":function(e,t){if(yS(e,n(e,t),r.epsilon))return n(e,t);var[i,s]="".concat(e,"e").split("e"),a=Math.floor(Number("".concat(i,"e").concat(Number(s)+t)));return[i,s]="".concat(a,"e").split("e"),Number("".concat(i,"e").concat(Number(s)-t))}})})),kP=BD(TP,CP,(e=>{var{typed:t,config:r,round:n,matrix:i,equalScalar:s,zeros:a,DenseMatrix:o}=e,l=sI({typed:t,equalScalar:s}),u=aI({typed:t,DenseMatrix:o}),c=lI({typed:t}),d=NP({typed:t,config:r,round:n});return t("floor",{number:d.signatures.number,"number,number":d.signatures["number,number"],Complex:function(e){return e.floor()},"Complex, number":function(e,t){return e.floor(t)},"Complex, BigNumber":function(e,t){return e.floor(t.toNumber())},BigNumber:function(e){return cL(e,n(e),r.epsilon)?n(e):e.floor()},"BigNumber, BigNumber":function(e,t){return cL(e,n(e,t),r.epsilon)?n(e,t):e.toDecimalPlaces(t.toNumber(),Lk.ROUND_FLOOR)},Fraction:function(e){return e.floor()},"Fraction, number":function(e,t){return e.floor(t)},"Fraction, BigNumber":function(e,t){return e.floor(t.toNumber())},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0))),"Array, number | BigNumber":t.referToSelf((e=>(t,r)=>eT(t,(t=>e(t,r)),!0))),"SparseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>l(t,r,e,!1))),"DenseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>c(t,r,e,!1))),"number | Complex | Fraction | BigNumber, Array":t.referToSelf((e=>(t,r)=>c(i(r),t,e,!0).valueOf())),"number | Complex | Fraction | BigNumber, Matrix":t.referToSelf((e=>(t,r)=>s(t,0)?a(r.size(),r.storage()):"dense"===r.storage()?c(r,t,e,!0):u(r,t,e,!0)))})})),MP="hypot",OP=BD(MP,["typed","abs","addScalar","divideScalar","multiplyScalar","sqrt","smaller","isPositive"],(e=>{var{typed:t,abs:r,addScalar:n,divideScalar:i,multiplyScalar:s,sqrt:a,smaller:o,isPositive:l}=e;return t(MP,{"... number | BigNumber":u,Array:u,Matrix:e=>u(JS(e.toArray()))});function u(e){for(var t=0,u=0,c=0;c<e.length;c++){if(WE(e[c]))throw new TypeError("Unexpected type of argument to hypot");var d=r(e[c]);o(u,d)?(t=s(t,s(i(u,d),i(u,d))),t=n(t,1),u=d):t=n(t,l(d)?s(i(d,u),i(d,u)):d)}return s(u,a(t))}})),FP=BD("ImmutableDenseMatrix",["smaller","DenseMatrix"],(e=>{var{smaller:t,DenseMatrix:r}=e;function n(e,t){if(!(this instanceof n))throw new SyntaxError("Constructor must be called with the new operator");if(t&&!ZE(t))throw new Error("Invalid datatype: "+t);if(QE(e)||XE(e)){var i=new r(e,t);this._data=i._data,this._size=i._size,this._datatype=i._datatype,this._min=null,this._max=null}else if(e&&XE(e.data)&&XE(e.size))this._data=e.data,this._size=e.size,this._datatype=e.datatype,this._min=void 0!==e.min?e.min:null,this._max=void 0!==e.max?e.max:null;else{if(e)throw new TypeError("Unsupported type of data ("+FD(e)+")");this._data=[],this._size=[0],this._datatype=t,this._min=null,this._max=null}}return n.prototype=new r,n.prototype.type="ImmutableDenseMatrix",n.prototype.isImmutableDenseMatrix=!0,n.prototype.subset=function(e){switch(arguments.length){case 1:var t=r.prototype.subset.call(this,e);return QE(t)?new n({data:t._data,size:t._size,datatype:t._datatype}):t;case 2:case 3:throw new Error("Cannot invoke set subset on an Immutable Matrix instance");default:throw new SyntaxError("Wrong number of arguments")}},n.prototype.set=function(){throw new Error("Cannot invoke set on an Immutable Matrix instance")},n.prototype.resize=function(){throw new Error("Cannot invoke resize on an Immutable Matrix instance")},n.prototype.reshape=function(){throw new Error("Cannot invoke reshape on an Immutable Matrix instance")},n.prototype.clone=function(){return new n({data:_D(this._data),size:_D(this._size),datatype:this._datatype})},n.prototype.toJSON=function(){return{mathjs:"ImmutableDenseMatrix",data:this._data,size:this._size,datatype:this._datatype}},n.fromJSON=function(e){return new n(e)},n.prototype.swapRows=function(){throw new Error("Cannot invoke swapRows on an Immutable Matrix instance")},n.prototype.min=function(){if(null===this._min){var e=null;this.forEach((function(r){(null===e||t(r,e))&&(e=r)})),this._min=null!==e?e:void 0}return this._min},n.prototype.max=function(){if(null===this._max){var e=null;this.forEach((function(r){(null===e||t(e,r))&&(e=r)})),this._max=null!==e?e:void 0}return this._max},n}),{isClass:!0}),LP=BD("Index",["ImmutableDenseMatrix"],(e=>{var{ImmutableDenseMatrix:t}=e;function r(e){if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");this._dimensions=[],this._isScalar=!0;for(var t=0,i=arguments.length;t<i;t++){var s=arguments[t];if(nD(s))this._dimensions.push(s),this._isScalar=!1;else if(Array.isArray(s)||QE(s)){var a=n(s.valueOf());this._dimensions.push(a);var o=a.size();1===o.length&&1===o[0]||(this._isScalar=!1)}else if("number"==typeof s)this._dimensions.push(n([s]));else{if("string"!=typeof s)throw new TypeError("Dimension must be an Array, Matrix, number, string, or Range");this._dimensions.push(s)}}}function n(e){for(var r=0,n=e.length;r<n;r++)if("number"!=typeof e[r]||!rS(e[r]))throw new TypeError("Index parameters must be positive integer numbers");return new t(e)}return r.prototype.type="Index",r.prototype.isIndex=!0,r.prototype.clone=function(){var e=new r;return e._dimensions=_D(this._dimensions),e._isScalar=this._isScalar,e},r.create=function(e){var t=new r;return r.apply(t,e),t},r.prototype.size=function(){for(var e=[],t=0,r=this._dimensions.length;t<r;t++){var n=this._dimensions[t];e[t]="string"==typeof n?1:n.size()[0]}return e},r.prototype.max=function(){for(var e=[],t=0,r=this._dimensions.length;t<r;t++){var n=this._dimensions[t];e[t]="string"==typeof n?n:n.max()}return e},r.prototype.min=function(){for(var e=[],t=0,r=this._dimensions.length;t<r;t++){var n=this._dimensions[t];e[t]="string"==typeof n?n:n.min()}return e},r.prototype.forEach=function(e){for(var t=0,r=this._dimensions.length;t<r;t++)e(this._dimensions[t],t,this)},r.prototype.dimension=function(e){return this._dimensions[e]||null},r.prototype.isObjectProperty=function(){return 1===this._dimensions.length&&"string"==typeof this._dimensions[0]},r.prototype.getObjectProperty=function(){return this.isObjectProperty()?this._dimensions[0]:null},r.prototype.isScalar=function(){return this._isScalar},r.prototype.toArray=function(){for(var e=[],t=0,r=this._dimensions.length;t<r;t++){var n=this._dimensions[t];e.push("string"==typeof n?n:n.toArray())}return e},r.prototype.valueOf=r.prototype.toArray,r.prototype.toString=function(){for(var e=[],t=0,r=this._dimensions.length;t<r;t++){var n=this._dimensions[t];"string"==typeof n?e.push(JSON.stringify(n)):e.push(n.toString())}return"["+e.join(", ")+"]"},r.prototype.toJSON=function(){return{mathjs:"Index",dimensions:this._dimensions}},r.fromJSON=function(e){return r.create(e.dimensions)},r}),{isClass:!0}),_P="invmod",RP=BD(_P,["typed","config","BigNumber","xgcd","equal","smaller","mod","add","isInteger"],(e=>{var{typed:t,config:r,BigNumber:n,xgcd:i,equal:s,smaller:a,mod:o,add:l,isInteger:u}=e;return t(_P,{"number, number":c,"BigNumber, BigNumber":c});function c(e,t){if(!u(e)||!u(t))throw new Error("Parameters in function invmod must be integer numbers");if(e=o(e,t),s(t,0))throw new Error("Divisor must be non zero");var r=i(e,t);r=r.valueOf();var[c,d]=r;return s(c,n(1))?(d=o(d,t),a(d,n(0))&&(d=l(d,t)),d):NaN}})),IP="larger",PP=BD(IP,["typed","config","matrix","DenseMatrix","concat"],(e=>{var{typed:t,config:r,matrix:n,DenseMatrix:i,concat:s}=e,a=nI({typed:t}),o=iI({typed:t,DenseMatrix:i}),l=aI({typed:t,DenseMatrix:i}),u=cI({typed:t,matrix:n,concat:s}),c=dL({typed:t});return t(IP,BP({typed:t,config:r}),{"boolean, boolean":(e,t)=>e>t,"BigNumber, BigNumber":function(e,t){return e.gt(t)&&!cL(e,t,r.epsilon)},"Fraction, Fraction":(e,t)=>1===e.compare(t),"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")}},c,u({SS:o,DS:a,Ss:l}))})),BP=BD(IP,["typed","config"],(e=>{var{typed:t,config:r}=e;return t(IP,{"number, number":function(e,t){return e>t&&!yS(e,t,r.epsilon)}})})),UP=BD("log",["config","typed","divideScalar","Complex"],(e=>{var{typed:t,config:r,divideScalar:n,Complex:i}=e;return t("log",{number:function(e){return e>=0||r.predictable?function(e,t){return t?Math.log(e)/Math.log(t):Math.log(e)}(e):new i(e,0).log()},Complex:function(e){return e.log()},BigNumber:function(e){return!e.isNegative()||r.predictable?e.ln():new i(e.toNumber(),0).log()},"any, any":t.referToSelf((e=>(t,r)=>n(e(t),e(r))))})})),$P="matrixFromRows",zP=BD($P,["typed","matrix","flatten","size"],(e=>{var{typed:t,matrix:r,flatten:n,size:i}=e;return t($P,{"...Array":function(e){return s(e)},"...Matrix":function(e){return r(s(e.map((e=>e.toArray()))))}});function s(e){if(0===e.length)throw new TypeError("At least one row is needed to construct a matrix.");var t=a(e[0]),r=[];for(var i of e){var s=a(i);if(s!==t)throw new TypeError("The vectors had different length: "+(0|t)+" ≠ "+(0|s));r.push(n(i))}return r}function a(e){var t=i(e);if(1===t.length)return t[0];if(2===t.length){if(1===t[0])return t[1];if(1===t[1])return t[0];throw new TypeError("At least one of the arguments is not a vector.")}throw new TypeError("Only one- or two-dimensional vectors are supported.")}})),jP="multiply",qP=BD(jP,["typed","matrix","addScalar","multiplyScalar","equalScalar","dot"],(e=>{var{typed:t,matrix:r,addScalar:n,multiplyScalar:i,equalScalar:s,dot:a}=e,o=sI({typed:t,equalScalar:s}),l=lI({typed:t});function u(e,t){switch(e.length){case 1:switch(t.length){case 1:if(e[0]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Vectors must have the same length");break;case 2:if(e[0]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Vector length ("+e[0]+") must match Matrix rows ("+t[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+t.length+" dimensions)")}break;case 2:switch(t.length){case 1:if(e[1]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Matrix columns ("+e[1]+") must match Vector length ("+t[0]+")");break;case 2:if(e[1]!==t[0])throw new RangeError("Dimension mismatch in multiplication. Matrix A columns ("+e[1]+") must match Matrix B rows ("+t[0]+")");break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix B has "+t.length+" dimensions)")}break;default:throw new Error("Can only multiply a 1 or 2 dimensional matrix (Matrix A has "+e.length+" dimensions)")}}function c(e,r){if("dense"!==r.storage())throw new Error("Support for SparseMatrix not implemented");return function(e,r){var s,a=e._data,o=e._size,l=e._datatype,u=r._data,c=r._size,d=r._datatype,h=o[0],f=c[1],p=n,m=i;l&&d&&l===d&&"string"==typeof l&&(s=l,p=t.find(n,[s,s]),m=t.find(i,[s,s]));for(var g=[],y=0;y<f;y++){for(var v=m(a[0],u[0][y]),b=1;b<h;b++)v=p(v,m(a[b],u[b][y]));g[y]=v}return e.createDenseMatrix({data:g,size:[f],datatype:s})}(e,r)}var d=t("_multiplyMatrixVector",{"DenseMatrix, any":function(e,r){var s,a=e._data,o=e._size,l=e._datatype,u=r._data,c=r._datatype,d=o[0],h=o[1],f=n,p=i;l&&c&&l===c&&"string"==typeof l&&(s=l,f=t.find(n,[s,s]),p=t.find(i,[s,s]));for(var m=[],g=0;g<d;g++){for(var y=a[g],v=p(y[0],u[0]),b=1;b<h;b++)v=f(v,p(y[b],u[b]));m[g]=v}return e.createDenseMatrix({data:m,size:[d],datatype:s})},"SparseMatrix, any":function(e,r){var a=e._values,o=e._index,l=e._ptr,u=e._datatype;if(!a)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var c,d=r._data,h=r._datatype,f=e._size[0],p=r._size[0],m=[],g=[],y=[],v=n,b=i,w=s,x=0;u&&h&&u===h&&"string"==typeof u&&(c=u,v=t.find(n,[c,c]),b=t.find(i,[c,c]),w=t.find(s,[c,c]),x=t.convert(0,c));var E=[],D=[];y[0]=0;for(var S=0;S<p;S++){var A=d[S];if(!w(A,x))for(var T=l[S],C=l[S+1],N=T;N<C;N++){var k=o[N];D[k]?E[k]=v(E[k],b(A,a[N])):(D[k]=!0,g.push(k),E[k]=b(A,a[N]))}}for(var M=g.length,O=0;O<M;O++){var F=g[O];m[O]=E[F]}return y[1]=g.length,e.createSparseMatrix({values:m,index:g,ptr:y,size:[f,1],datatype:c})}}),h=t("_multiplyMatrixMatrix",{"DenseMatrix, DenseMatrix":function(e,r){var s,a=e._data,o=e._size,l=e._datatype,u=r._data,c=r._size,d=r._datatype,h=o[0],f=o[1],p=c[1],m=n,g=i;l&&d&&l===d&&"string"==typeof l&&(s=l,m=t.find(n,[s,s]),g=t.find(i,[s,s]));for(var y=[],v=0;v<h;v++){var b=a[v];y[v]=[];for(var w=0;w<p;w++){for(var x=g(b[0],u[0][w]),E=1;E<f;E++)x=m(x,g(b[E],u[E][w]));y[v][w]=x}}return e.createDenseMatrix({data:y,size:[h,p],datatype:s})},"DenseMatrix, SparseMatrix":function(e,r){var a=e._data,o=e._size,l=e._datatype,u=r._values,c=r._index,d=r._ptr,h=r._size,f=r._datatype;if(!u)throw new Error("Cannot multiply Dense Matrix times Pattern only Matrix");var p,m=o[0],g=h[1],y=n,v=i,b=s,w=0;l&&f&&l===f&&"string"==typeof l&&(p=l,y=t.find(n,[p,p]),v=t.find(i,[p,p]),b=t.find(s,[p,p]),w=t.convert(0,p));for(var x=[],E=[],D=[],S=r.createSparseMatrix({values:x,index:E,ptr:D,size:[m,g],datatype:p}),A=0;A<g;A++){D[A]=E.length;var T=d[A],C=d[A+1];if(C>T)for(var N=0,k=0;k<m;k++){for(var M=k+1,O=void 0,F=T;F<C;F++){var L=c[F];N!==M?(O=v(a[k][L],u[F]),N=M):O=y(O,v(a[k][L],u[F]))}N!==M||b(O,w)||(E.push(k),x.push(O))}}return D[g]=E.length,S},"SparseMatrix, DenseMatrix":function(e,r){var a=e._values,o=e._index,l=e._ptr,u=e._datatype;if(!a)throw new Error("Cannot multiply Pattern only Matrix times Dense Matrix");var c,d=r._data,h=r._datatype,f=e._size[0],p=r._size[0],m=r._size[1],g=n,y=i,v=s,b=0;u&&h&&u===h&&"string"==typeof u&&(c=u,g=t.find(n,[c,c]),y=t.find(i,[c,c]),v=t.find(s,[c,c]),b=t.convert(0,c));for(var w=[],x=[],E=[],D=e.createSparseMatrix({values:w,index:x,ptr:E,size:[f,m],datatype:c}),S=[],A=[],T=0;T<m;T++){E[T]=x.length;for(var C=T+1,N=0;N<p;N++){var k=d[N][T];if(!v(k,b))for(var M=l[N],O=l[N+1],F=M;F<O;F++){var L=o[F];A[L]!==C?(A[L]=C,x.push(L),S[L]=y(k,a[F])):S[L]=g(S[L],y(k,a[F]))}}for(var _=E[T],R=x.length,I=_;I<R;I++){var P=x[I];w[I]=S[P]}}return E[m]=x.length,D},"SparseMatrix, SparseMatrix":function(e,r){var s,a=e._values,o=e._index,l=e._ptr,u=e._datatype,c=r._values,d=r._index,h=r._ptr,f=r._datatype,p=e._size[0],m=r._size[1],g=a&&c,y=n,v=i;u&&f&&u===f&&"string"==typeof u&&(s=u,y=t.find(n,[s,s]),v=t.find(i,[s,s]));for(var b,w,x,E,D,S,A,T,C=g?[]:void 0,N=[],k=[],M=e.createSparseMatrix({values:C,index:N,ptr:k,size:[p,m],datatype:s}),O=g?[]:void 0,F=[],L=0;L<m;L++){k[L]=N.length;var _=L+1;for(D=h[L],S=h[L+1],E=D;E<S;E++)if(T=d[E],g)for(w=l[T],x=l[T+1],b=w;b<x;b++)F[A=o[b]]!==_?(F[A]=_,N.push(A),O[A]=v(c[E],a[b])):O[A]=y(O[A],v(c[E],a[b]));else for(w=l[T],x=l[T+1],b=w;b<x;b++)F[A=o[b]]!==_&&(F[A]=_,N.push(A));if(g)for(var R=k[L],I=N.length,P=R;P<I;P++){var B=N[P];C[P]=O[B]}}return k[m]=N.length,M}});return t(jP,i,{"Array, Array":t.referTo("Matrix, Matrix",(e=>(t,n)=>{u(PS(t),PS(n));var i=e(r(t),r(n));return QE(i)?i.valueOf():i})),"Matrix, Matrix":function(e,t){var r=e.size(),n=t.size();return u(r,n),1===r.length?1===n.length?function(e,t,r){if(0===r)throw new Error("Cannot multiply two empty vectors");return a(e,t)}(e,t,r[0]):c(e,t):1===n.length?d(e,t):h(e,t)},"Matrix, Array":t.referTo("Matrix,Matrix",(e=>(t,n)=>e(t,r(n)))),"Array, Matrix":t.referToSelf((e=>(t,n)=>e(r(t,n.storage()),n))),"SparseMatrix, any":function(e,t){return o(e,t,i,!1)},"DenseMatrix, any":function(e,t){return l(e,t,i,!1)},"any, SparseMatrix":function(e,t){return o(t,e,i,!0)},"any, DenseMatrix":function(e,t){return l(t,e,i,!0)},"Array, any":function(e,t){return l(r(e),t,i,!1).valueOf()},"any, Array":function(e,t){return l(r(t),e,i,!0).valueOf()},"any, any":i,"any, any, ...any":t.referToSelf((e=>(t,r,n)=>{for(var i=e(t,r),s=0;s<n.length;s++)i=e(i,n[s]);return i}))})})),HP="nthRoots",VP=BD(HP,["config","typed","divideScalar","Complex"],(e=>{var{typed:t,config:r,divideScalar:n,Complex:i}=e,s=[function(e){return new i(e,0)},function(e){return new i(0,e)},function(e){return new i(-e,0)},function(e){return new i(0,-e)}];function a(e,t){if(t<0)throw new Error("Root must be greater than zero");if(0===t)throw new Error("Root must be non-zero");if(t%1!=0)throw new Error("Root must be an integer");if(0===e||0===e.abs())return[new i(0,0)];var r,n="number"==typeof e;(n||0===e.re||0===e.im)&&(r=n?2*+(e<0):0===e.im?2*+(e.re<0):2*+(e.im<0)+1);for(var a=e.arg(),o=e.abs(),l=[],u=Math.pow(o,1/t),c=0;c<t;c++){var d=(r+4*c)/t;d!==Math.round(d)?l.push(new i({r:u,phi:(a+2*Math.PI*c)/t})):l.push(s[d%4](u))}return l}return t(HP,{Complex:function(e){return a(e,2)},"Complex, number":a})})),GP=BD("or",["typed","matrix","equalScalar","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,DenseMatrix:i,concat:s}=e,a=nI({typed:t}),o=jI({typed:t,equalScalar:n}),l=aI({typed:t,DenseMatrix:i}),u=cI({typed:t,matrix:r,concat:s});return t("or",{"number, number":c_,"Complex, Complex":function(e,t){return 0!==e.re||0!==e.im||0!==t.re||0!==t.im},"BigNumber, BigNumber":function(e,t){return!e.isZero()&&!e.isNaN()||!t.isZero()&&!t.isNaN()},"Unit, Unit":t.referToSelf((e=>(t,r)=>e(t.value||0,r.value||0)))},u({SS:o,DS:a,Ss:l}))})),KP="partitionSelect",WP=BD(KP,["typed","isNumeric","isNaN","compare"],(e=>{var{typed:t,isNumeric:r,isNaN:n,compare:i}=e,s=i,a=(e,t)=>-i(e,t);return t(KP,{"Array | Matrix, number":function(e,t){return o(e,t,s)},"Array | Matrix, number, string":function(e,t,r){if("asc"===r)return o(e,t,s);if("desc"===r)return o(e,t,a);throw new Error('Compare string must be "asc" or "desc"')},"Array | Matrix, number, function":o});function o(e,t,r){if(!rS(t)||t<0)throw new Error("k must be a non-negative integer");if(QE(e)){if(e.size().length>1)throw new Error("Only one dimensional matrices supported");return l(e.valueOf(),t,r)}if(Array.isArray(e))return l(e,t,r)}function l(e,t,i){if(t>=e.length)throw new Error("k out of bounds");for(var s=0;s<e.length;s++)if(r(e[s])&&n(e[s]))return e[s];for(var a=0,o=e.length-1;a<o;){for(var l=a,u=o,c=e[Math.floor(Math.random()*(o-a+1))+a];l<u;)if(i(e[l],c)>=0){var d=e[u];e[u]=e[l],e[l]=d,--u}else++l;i(e[l],c)>0&&--l,t<=l?o=l:a=l+1}return e[t]}})),YP=BD("quantileSeq",["typed","add","multiply","partitionSelect","compare"],(e=>{var{typed:t,add:r,multiply:n,partitionSelect:i,compare:s}=e;function a(e,t,a){var l=JS(e),u=l.length;if(0===u)throw new Error("Cannot calculate quantile of an empty sequence");if(GE(t)){var c=t*(u-1),d=c%1;if(0===d){var h=a?l[c]:i(l,c);return o(h),h}var f,p,m=Math.floor(c);if(a)f=l[m],p=l[m+1];else{p=i(l,m+1),f=l[m];for(var g=0;g<m;++g)s(l[g],f)>0&&(f=l[g])}return o(f),o(p),r(n(f,1-d),n(p,d))}var y=t.times(u-1);if(y.isInteger()){y=y.toNumber();var v=a?l[y]:i(l,y);return o(v),v}var b,w,x=y.floor(),E=y.minus(x),D=x.toNumber();if(a)b=l[D],w=l[D+1];else{w=i(l,D+1),b=l[D];for(var S=0;S<D;++S)s(l[S],b)>0&&(b=l[S])}o(b),o(w);var A=new E.constructor(1);return r(n(b,A.minus(E)),n(w,E))}var o=t({"number | BigNumber | Unit":function(e){return e}});return function(e,t,r){var n,i,s;if(arguments.length<2||arguments.length>3)throw new SyntaxError("Function quantileSeq requires two or three parameters");if(eD(e)){if("boolean"==typeof(r=r||!1)){if(i=e.valueOf(),GE(t)){if(t<0)throw new Error("N/prob must be non-negative");if(t<=1)return a(i,t,r);if(t>1){if(!rS(t))throw new Error("N must be a positive integer");var o=t+1;n=new Array(t);for(var l=0;l<t;)n[l]=a(i,++l/o,r);return n}}if(KE(t)){var u=t.constructor;if(t.isNegative())throw new Error("N/prob must be non-negative");if(s=new u(1),t.lte(s))return new u(a(i,t,r));if(t.gt(s)){if(!t.isInteger())throw new Error("N must be a positive integer");var c=t.toNumber();if(c>4294967295)throw new Error("N must be less than or equal to 2^32-1, as that is the maximum length of an Array");var d=new u(c+1);n=new Array(c);for(var h=0;h<c;)n[h]=new u(a(i,new u(++h).div(d),r));return n}}if(eD(t)){var f=t.valueOf();n=new Array(f.length);for(var p=0;p<n.length;++p){var m=f[p];if(GE(m)){if(m<0||m>1)throw new Error("Probability must be between 0 and 1, inclusive")}else{if(!KE(m))throw new TypeError("Unexpected type of argument in function quantileSeq");if(s=new m.constructor(1),m.isNegative()||m.gt(s))throw new Error("Probability must be between 0 and 1, inclusive")}n[p]=a(i,m,r)}return n}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}throw new TypeError("Unexpected type of argument in function quantileSeq")}})),JP="rightLogShift",ZP=BD(JP,["typed","matrix","equalScalar","zeros","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,zeros:i,DenseMatrix:s,concat:a}=e,o=vI({typed:t}),l=rI({typed:t,equalScalar:n}),u=II({typed:t,equalScalar:n}),c=wI({typed:t,DenseMatrix:s}),d=sI({typed:t,equalScalar:n}),h=lI({typed:t}),f=cI({typed:t,matrix:r,concat:a}),p=PI({typed:t,matrix:r});return t(JP,{"number, number":zF,"SparseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>n(r,0)?t.clone():d(t,r,e,!1))),"DenseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>n(r,0)?t.clone():h(t,r,e,!1))),"number | BigNumber, SparseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):c(r,t,e,!0))),"number | BigNumber, DenseMatrix":t.referToSelf((e=>(t,r)=>n(t,0)?i(r.size(),r.storage()):h(r,t,e,!0)))},p,f({SS:u,DS:o,SD:l}))})),XP="smallerEq",QP=BD(XP,["typed","config","matrix","DenseMatrix","concat"],(e=>{var{typed:t,config:r,matrix:n,DenseMatrix:i,concat:s}=e,a=nI({typed:t}),o=iI({typed:t,DenseMatrix:i}),l=aI({typed:t,DenseMatrix:i}),u=cI({typed:t,matrix:n,concat:s}),c=dL({typed:t});return t(XP,eB({typed:t,config:r}),{"boolean, boolean":(e,t)=>e<=t,"BigNumber, BigNumber":function(e,t){return e.lte(t)||cL(e,t,r.epsilon)},"Fraction, Fraction":(e,t)=>1!==e.compare(t),"Complex, Complex":function(){throw new TypeError("No ordering relation is defined for complex numbers")}},c,u({SS:o,DS:a,Ss:l}))})),eB=BD(XP,["typed","config"],(e=>{var{typed:t,config:r}=e;return t(XP,{"number, number":function(e,t){return e<=t||yS(e,t,r.epsilon)}})})),tB="subtract",rB=BD(tB,["typed","matrix","equalScalar","addScalar","unaryMinus","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,addScalar:i,unaryMinus:s,DenseMatrix:a,concat:o}=e,l=vI({typed:t}),u=nI({typed:t}),c=jI({typed:t,equalScalar:n}),d=wI({typed:t,DenseMatrix:a}),h=aI({typed:t,DenseMatrix:a}),f=cI({typed:t,matrix:r,concat:o});return t(tB,{"number, number":(e,t)=>e-t,"Complex, Complex":(e,t)=>e.sub(t),"BigNumber, BigNumber":(e,t)=>e.minus(t),"Fraction, Fraction":(e,t)=>e.sub(t),"Unit, Unit":t.referToSelf((e=>(r,n)=>{if(null===r.value)throw new Error("Parameter x contains a unit with undefined value");if(null===n.value)throw new Error("Parameter y contains a unit with undefined value");if(!r.equalBase(n))throw new Error("Units do not match");var i=r.clone();return i.value=t.find(e,[i.valueType(),n.valueType()])(i.value,n.value),i.fixPrefix=!1,i}))},f({SS:c,DS:l,SD:u,Ss:h,sS:d}))})),nB=BD("trace",["typed","matrix","add"],(e=>{var{typed:t,matrix:r,add:n}=e;return t("trace",{Array:function(e){return i(r(e))},SparseMatrix:function(e){var t=e._values,r=e._index,i=e._ptr,s=e._size,a=s[0],o=s[1];if(a===o){var l=0;if(t.length>0)for(var u=0;u<o;u++)for(var c=i[u],d=i[u+1],h=c;h<d;h++){var f=r[h];if(f===u){l=n(l,t[h]);break}if(f>u)break}return l}throw new RangeError("Matrix must be square (size: "+NS(s)+")")},DenseMatrix:i,any:_D});function i(e){var t=e._size,r=e._data;switch(t.length){case 1:if(1===t[0])return _D(r[0]);throw new RangeError("Matrix must be square (size: "+NS(t)+")");case 2:var i=t[0];if(i===t[1]){for(var s=0,a=0;a<i;a++)s=n(s,r[a][a]);return s}throw new RangeError("Matrix must be square (size: "+NS(t)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+NS(t)+")")}}}));function iB(e){var{DenseMatrix:t}=e;return function(e,r,n){var i=e.size();if(2!==i.length)throw new RangeError("Matrix must be two dimensional (size: "+NS(i)+")");var s=i[0];if(s!==i[1])throw new RangeError("Matrix must be square (size: "+NS(i)+")");var a=[];if(QE(r)){var o=r.size(),l=r._data;if(1===o.length){if(o[0]!==s)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var u=0;u<s;u++)a[u]=[l[u]];return new t({data:a,size:[s,1],datatype:r._datatype})}if(2===o.length){if(o[0]!==s||1!==o[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");if(tD(r)){if(n){a=[];for(var c=0;c<s;c++)a[c]=[l[c][0]];return new t({data:a,size:[s,1],datatype:r._datatype})}return r}if(rD(r)){for(var d=0;d<s;d++)a[d]=[0];for(var h=r._values,f=r._index,p=r._ptr,m=p[1],g=p[0];g<m;g++){a[f[g]][0]=h[g]}return new t({data:a,size:[s,1],datatype:r._datatype})}}throw new RangeError("Dimension mismatch. The right side has to be either 1- or 2-dimensional vector.")}if(XE(r)){var y=PS(r);if(1===y.length){if(y[0]!==s)throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var v=0;v<s;v++)a[v]=[r[v]];return new t({data:a,size:[s,1]})}if(2===y.length){if(y[0]!==s||1!==y[1])throw new RangeError("Dimension mismatch. Matrix columns must match vector length.");for(var b=0;b<s;b++)a[b]=[r[b][0]];return new t({data:a,size:[s,1]})}throw new RangeError("Dimension mismatch. The right side has to be either 1- or 2-dimensional vector.")}}}var sB="usolve",aB=BD(sB,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:r,divideScalar:n,multiplyScalar:i,subtract:s,equalScalar:a,DenseMatrix:o}=e,l=iB({DenseMatrix:o});return t(sB,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var r=(t=l(e,t,!0))._data,u=e._size[0],c=e._size[1],d=e._values,h=e._index,f=e._ptr,p=[],m=c-1;m>=0;m--){var g=r[m][0]||0;if(a(g,0))p[m]=[0];else{for(var y=0,v=[],b=[],w=f[m],x=f[m+1]-1;x>=w;x--){var E=h[x];E===m?y=d[x]:E<m&&(v.push(d[x]),b.push(E))}if(a(y,0))throw new Error("Linear system cannot be solved since matrix is singular");for(var D=n(g,y),S=0,A=b.length;S<A;S++){var T=b[S];r[T]=[s(r[T][0],i(D,v[S]))]}p[m]=[D]}}return new o({data:p,size:[u,1]})}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return u(e,t)},"Array, Array | Matrix":function(e,t){return u(r(e),t).valueOf()}});function u(e,t){for(var r=(t=l(e,t,!0))._data,u=e._size[0],c=e._size[1],d=[],h=e._data,f=c-1;f>=0;f--){var p=r[f][0]||0,m=void 0;if(a(p,0))m=0;else{var g=h[f][f];if(a(g,0))throw new Error("Linear system cannot be solved since matrix is singular");m=n(p,g);for(var y=f-1;y>=0;y--)r[y]=[s(r[y][0]||0,i(m,h[y][f]))]}d[f]=[m]}return new o({data:d,size:[u,1]})}})),oB="zpk2tf",lB=BD(oB,["typed","add","multiply","Complex","number"],(e=>{var{typed:t,add:r,multiply:n,Complex:i,number:s}=e;return t(oB,{"Array,Array,number":function(e,t,r){return a(e,t,r)},"Array,Array":function(e,t){return a(e,t,1)},"Matrix,Matrix,number":function(e,t,r){return a(e.valueOf(),t.valueOf(),r)},"Matrix,Matrix":function(e,t){return a(e.valueOf(),t.valueOf(),1)}});function a(e,t,r){e.some((e=>"BigNumber"===e.type))&&(e=e.map((e=>s(e)))),t.some((e=>"BigNumber"===e.type))&&(t=t.map((e=>s(e))));for(var a=[i(1,0)],l=[i(1,0)],u=0;u<e.length;u++){var c=e[u];"number"==typeof c&&(c=i(c,0)),a=o(a,[i(1,0),i(-c.re,-c.im)])}for(var d=0;d<t.length;d++){var h=t[d];"number"==typeof h&&(h=i(h,0)),l=o(l,[i(1,0),i(-h.re,-h.im)])}for(var f=0;f<a.length;f++)a[f]=n(a[f],r);return[a,l]}function o(e,t){for(var s=[],a=0;a<e.length+t.length-1;a++){s[a]=i(0,0);for(var o=0;o<e.length;o++)a-o>=0&&a-o<t.length&&(s[a]=r(s[a],n(e[o],t[a-o])))}return s}})),uB=BD("and",["typed","matrix","equalScalar","zeros","not","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,zeros:i,not:s,concat:a}=e,o=rI({typed:t,equalScalar:n}),l=HI({typed:t,equalScalar:n}),u=sI({typed:t,equalScalar:n}),c=lI({typed:t}),d=cI({typed:t,matrix:r,concat:a});return t("and",{"number, number":h_,"Complex, Complex":function(e,t){return!(0===e.re&&0===e.im||0===t.re&&0===t.im)},"BigNumber, BigNumber":function(e,t){return!(e.isZero()||t.isZero()||e.isNaN()||t.isNaN())},"Unit, Unit":t.referToSelf((e=>(t,r)=>e(t.value||0,r.value||0))),"SparseMatrix, any":t.referToSelf((e=>(t,r)=>s(r)?i(t.size(),t.storage()):u(t,r,e,!1))),"DenseMatrix, any":t.referToSelf((e=>(t,r)=>s(r)?i(t.size(),t.storage()):c(t,r,e,!1))),"any, SparseMatrix":t.referToSelf((e=>(t,r)=>s(t)?i(t.size(),t.storage()):u(r,t,e,!0))),"any, DenseMatrix":t.referToSelf((e=>(t,r)=>s(t)?i(t.size(),t.storage()):c(r,t,e,!0))),"Array, any":t.referToSelf((e=>(t,n)=>e(r(t),n).valueOf())),"any, Array":t.referToSelf((e=>(t,n)=>e(t,r(n)).valueOf()))},d({SS:l,DS:o}))})),cB="bitOr",dB=BD(cB,["typed","matrix","equalScalar","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,DenseMatrix:i,concat:s}=e,a=vI({typed:t}),o=bI({typed:t,equalScalar:n}),l=wI({typed:t,DenseMatrix:i}),u=cI({typed:t,matrix:r,concat:s});return t(cB,{"number, number":PF,"BigNumber, BigNumber":NF},u({SS:o,DS:a,Ss:l}))})),hB="ceil",fB=["typed","config","round","matrix","equalScalar","zeros","DenseMatrix"],pB=BD(hB,["typed","config","round"],(e=>{var{typed:t,config:r,round:n}=e;return t(hB,{number:function(e){return yS(e,n(e),r.epsilon)?n(e):Math.ceil(e)},"number, number":function(e,t){if(yS(e,n(e,t),r.epsilon))return n(e,t);var[i,s]="".concat(e,"e").split("e"),a=Math.ceil(Number("".concat(i,"e").concat(Number(s)+t)));return[i,s]="".concat(a,"e").split("e"),Number("".concat(i,"e").concat(Number(s)-t))}})})),mB=BD(hB,fB,(e=>{var{typed:t,config:r,round:n,matrix:i,equalScalar:s,zeros:a,DenseMatrix:o}=e,l=sI({typed:t,equalScalar:s}),u=aI({typed:t,DenseMatrix:o}),c=lI({typed:t}),d=pB({typed:t,config:r,round:n});return t("ceil",{number:d.signatures.number,"number,number":d.signatures["number,number"],Complex:function(e){return e.ceil()},"Complex, number":function(e,t){return e.ceil(t)},"Complex, BigNumber":function(e,t){return e.ceil(t.toNumber())},BigNumber:function(e){return cL(e,n(e),r.epsilon)?n(e):e.ceil()},"BigNumber, BigNumber":function(e,t){return cL(e,n(e,t),r.epsilon)?n(e,t):e.toDecimalPlaces(t.toNumber(),Lk.ROUND_CEIL)},Fraction:function(e){return e.ceil()},"Fraction, number":function(e,t){return e.ceil(t)},"Fraction, BigNumber":function(e,t){return e.ceil(t.toNumber())},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0))),"Array, number | BigNumber":t.referToSelf((e=>(t,r)=>eT(t,(t=>e(t,r)),!0))),"SparseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>l(t,r,e,!1))),"DenseMatrix, number | BigNumber":t.referToSelf((e=>(t,r)=>c(t,r,e,!1))),"number | Complex | Fraction | BigNumber, Array":t.referToSelf((e=>(t,r)=>c(i(r),t,e,!0).valueOf())),"number | Complex | Fraction | BigNumber, Matrix":t.referToSelf((e=>(t,r)=>s(t,0)?a(r.size(),r.storage()):"dense"===r.storage()?c(r,t,e,!0):u(r,t,e,!0)))})})),gB=r(3228),yB="compareNatural",vB=BD(yB,["typed","compare"],(e=>{var{typed:t,compare:r}=e,n=r.signatures["boolean,boolean"];return t(yB,{"any, any":function e(t,a){var o,l=FD(t),u=FD(a);if(!("number"!==l&&"BigNumber"!==l&&"Fraction"!==l||"number"!==u&&"BigNumber"!==u&&"Fraction"!==u))return"0"!==(o=r(t,a)).toString()?o>0?1:-1:gB(l,u);var c=["Array","DenseMatrix","SparseMatrix"];if(c.includes(l)||c.includes(u))return 0!==(o=i(e,t,a))?o:gB(l,u);if(l!==u)return gB(l,u);if("Complex"===l)return function(e,t){if(e.re>t.re)return 1;if(e.re<t.re)return-1;if(e.im>t.im)return 1;if(e.im<t.im)return-1;return 0}(t,a);if("Unit"===l)return t.equalBase(a)?e(t.value,a.value):s(e,t.formatUnits(),a.formatUnits());if("boolean"===l)return n(t,a);if("string"===l)return gB(t,a);if("Object"===l)return function(e,t,r){var n=Object.keys(t),i=Object.keys(r);n.sort(gB),i.sort(gB);var a=s(e,n,i);if(0!==a)return a;for(var o=0;o<n.length;o++){var l=e(t[n[o]],r[i[o]]);if(0!==l)return l}return 0}(e,t,a);if("null"===l)return 0;if("undefined"===l)return 0;throw new TypeError('Unsupported type of value "'+l+'"')}});function i(e,t,r){return rD(t)&&rD(r)?s(e,t.toJSON().values,r.toJSON().values):rD(t)?i(e,t.toArray(),r):rD(r)?i(e,t,r.toArray()):tD(t)?i(e,t.toJSON().data,r):tD(r)?i(e,t,r.toJSON().data):Array.isArray(t)?Array.isArray(r)?s(e,t,r):i(e,t,[r]):i(e,[t],r)}function s(e,t,r){for(var n=0,i=Math.min(t.length,r.length);n<i;n++){var s=e(t[n],r[n]);if(0!==s)return s}return t.length>r.length?1:t.length<r.length?-1:0}}));var bB="composition",wB=BD(bB,["typed","addScalar","combinations","isNegative","isPositive","isInteger","larger"],(e=>{var{typed:t,addScalar:r,combinations:n,isPositive:i,isNegative:s,isInteger:a,larger:o}=e;return t(bB,{"number | BigNumber, number | BigNumber":function(e,t){if(!(a(e)&&i(e)&&a(t)&&i(t)))throw new TypeError("Positive integer value expected in function composition");if(o(t,e))throw new TypeError("k must be less than or equal to n in function composition");return n(r(e,-1),r(t,-1))}})})),xB="cross",EB=BD(xB,["typed","matrix","subtract","multiply"],(e=>{var{typed:t,matrix:r,subtract:n,multiply:i}=e;return t(xB,{"Matrix, Matrix":function(e,t){return r(s(e.toArray(),t.toArray()))},"Matrix, Array":function(e,t){return r(s(e.toArray(),t))},"Array, Matrix":function(e,t){return r(s(e,t.toArray()))},"Array, Array":s});function s(e,t){var r=Math.max(PS(e).length,PS(t).length);e=GS(e),t=GS(t);var s=PS(e),a=PS(t);if(1!==s.length||1!==a.length||3!==s[0]||3!==a[0])throw new RangeError("Vectors with length 3 expected (Size A = ["+s.join(", ")+"], B = ["+a.join(", ")+"])");var o=[n(i(e[1],t[2]),i(e[2],t[1])),n(i(e[2],t[0]),i(e[0],t[2])),n(i(e[0],t[1]),i(e[1],t[0]))];return r>1?[o]:o}})),DB=BD("det",["typed","matrix","subtract","multiply","divideScalar","isZero","unaryMinus"],(e=>{var{typed:t,matrix:r,subtract:n,multiply:i,divideScalar:s,isZero:a,unaryMinus:o}=e;return t("det",{any:function(e){return _D(e)},"Array | Matrix":function(e){var t;switch((t=QE(e)?e.size():Array.isArray(e)?(e=r(e)).size():[]).length){case 0:return _D(e);case 1:if(1===t[0])return _D(e.valueOf()[0]);if(0===t[0])return 1;throw new RangeError("Matrix must be square (size: "+NS(t)+")");case 2:var l=t[0],u=t[1];if(l===u)return function(e,t,r){if(1===t)return _D(e[0][0]);if(2===t)return n(i(e[0][0],e[1][1]),i(e[1][0],e[0][1]));for(var l=!1,u=new Array(t).fill(0).map(((e,t)=>t)),c=0;c<t;c++){var d=u[c];if(a(e[d][c])){var h=void 0;for(h=c+1;h<t;h++)if(!a(e[u[h]][c])){d=u[h],u[h]=u[c],u[c]=d,l=!l;break}if(h===t)return e[d][c]}for(var f=e[d][c],p=0===c?1:e[u[c-1]][c-1],m=c+1;m<t;m++)for(var g=u[m],y=c+1;y<t;y++)e[g][y]=s(n(i(e[g][y],f),i(e[g][c],e[d][y])),p)}var v=e[u[t-1]][t-1];return l?o(v):v}(e.clone().valueOf(),l);if(0===u)return 1;throw new RangeError("Matrix must be square (size: "+NS(t)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+NS(t)+")")}}})})),SB="distance",AB=BD(SB,["typed","addScalar","subtract","divideScalar","multiplyScalar","deepEqual","sqrt","abs"],(e=>{var{typed:t,addScalar:r,subtract:n,multiplyScalar:i,divideScalar:s,deepEqual:a,sqrt:o,abs:l}=e;return t(SB,{"Array, Array, Array":function(e,t,r){if(2===e.length&&2===t.length&&2===r.length){if(!c(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!c(t))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!c(r))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");if(a(t,r))throw new TypeError("LinePoint1 should not be same with LinePoint2");var s=n(r[1],t[1]),o=n(t[0],r[0]),l=n(i(r[0],t[1]),i(t[0],r[1]));return m(e[0],e[1],s,o,l)}throw new TypeError("Invalid Arguments: Try again")},"Object, Object, Object":function(e,t,r){if(2===Object.keys(e).length&&2===Object.keys(t).length&&2===Object.keys(r).length){if(!c(e))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!c(t))throw new TypeError("Values of lineOnePtX and lineOnePtY should be numbers or BigNumbers");if(!c(r))throw new TypeError("Values of lineTwoPtX and lineTwoPtY should be numbers or BigNumbers");if(a(p(t),p(r)))throw new TypeError("LinePoint1 should not be same with LinePoint2");if("pointX"in e&&"pointY"in e&&"lineOnePtX"in t&&"lineOnePtY"in t&&"lineTwoPtX"in r&&"lineTwoPtY"in r){var s=n(r.lineTwoPtY,t.lineOnePtY),o=n(t.lineOnePtX,r.lineTwoPtX),l=n(i(r.lineTwoPtX,t.lineOnePtY),i(t.lineOnePtX,r.lineTwoPtY));return m(e.pointX,e.pointY,s,o,l)}throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},"Array, Array":function(e,t){if(2===e.length&&3===t.length){if(!c(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!d(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");return m(e[0],e[1],t[0],t[1],t[2])}if(3===e.length&&6===t.length){if(!d(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!f(t))throw new TypeError("Array with 6 numbers or BigNumbers expected for second argument");return g(e[0],e[1],e[2],t[0],t[1],t[2],t[3],t[4],t[5])}if(e.length===t.length&&e.length>0){if(!h(e))throw new TypeError("All values of an array should be numbers or BigNumbers");if(!h(t))throw new TypeError("All values of an array should be numbers or BigNumbers");return y(e,t)}throw new TypeError("Invalid Arguments: Try again")},"Object, Object":function(e,t){if(2===Object.keys(e).length&&3===Object.keys(t).length){if(!c(e))throw new TypeError("Values of pointX and pointY should be numbers or BigNumbers");if(!d(t))throw new TypeError("Values of xCoeffLine, yCoeffLine and constant should be numbers or BigNumbers");if("pointX"in e&&"pointY"in e&&"xCoeffLine"in t&&"yCoeffLine"in t&&"constant"in t)return m(e.pointX,e.pointY,t.xCoeffLine,t.yCoeffLine,t.constant);throw new TypeError("Key names do not match")}if(3===Object.keys(e).length&&6===Object.keys(t).length){if(!d(e))throw new TypeError("Values of pointX, pointY and pointZ should be numbers or BigNumbers");if(!f(t))throw new TypeError("Values of x0, y0, z0, a, b and c should be numbers or BigNumbers");if("pointX"in e&&"pointY"in e&&"x0"in t&&"y0"in t&&"z0"in t&&"a"in t&&"b"in t&&"c"in t)return g(e.pointX,e.pointY,e.pointZ,t.x0,t.y0,t.z0,t.a,t.b,t.c);throw new TypeError("Key names do not match")}if(2===Object.keys(e).length&&2===Object.keys(t).length){if(!c(e))throw new TypeError("Values of pointOneX and pointOneY should be numbers or BigNumbers");if(!c(t))throw new TypeError("Values of pointTwoX and pointTwoY should be numbers or BigNumbers");if("pointOneX"in e&&"pointOneY"in e&&"pointTwoX"in t&&"pointTwoY"in t)return y([e.pointOneX,e.pointOneY],[t.pointTwoX,t.pointTwoY]);throw new TypeError("Key names do not match")}if(3===Object.keys(e).length&&3===Object.keys(t).length){if(!d(e))throw new TypeError("Values of pointOneX, pointOneY and pointOneZ should be numbers or BigNumbers");if(!d(t))throw new TypeError("Values of pointTwoX, pointTwoY and pointTwoZ should be numbers or BigNumbers");if("pointOneX"in e&&"pointOneY"in e&&"pointOneZ"in e&&"pointTwoX"in t&&"pointTwoY"in t&&"pointTwoZ"in t)return y([e.pointOneX,e.pointOneY,e.pointOneZ],[t.pointTwoX,t.pointTwoY,t.pointTwoZ]);throw new TypeError("Key names do not match")}throw new TypeError("Invalid Arguments: Try again")},Array:function(e){if(!function(e){if(2===e[0].length&&u(e[0][0])&&u(e[0][1])){if(e.some((e=>2!==e.length||!u(e[0])||!u(e[1]))))return!1}else{if(!(3===e[0].length&&u(e[0][0])&&u(e[0][1])&&u(e[0][2])))return!1;if(e.some((e=>3!==e.length||!u(e[0])||!u(e[1])||!u(e[2]))))return!1}return!0}(e))throw new TypeError("Incorrect array format entered for pairwise distance calculation");return function(e){for(var t=[],r=[],n=[],i=0;i<e.length-1;i++)for(var s=i+1;s<e.length;s++)2===e[0].length?(r=[e[i][0],e[i][1]],n=[e[s][0],e[s][1]]):3===e[0].length&&(r=[e[i][0],e[i][1],e[i][2]],n=[e[s][0],e[s][1],e[s][2]]),t.push(y(r,n));return t}(e)}});function u(e){return"number"==typeof e||KE(e)}function c(e){return e.constructor!==Array&&(e=p(e)),u(e[0])&&u(e[1])}function d(e){return e.constructor!==Array&&(e=p(e)),u(e[0])&&u(e[1])&&u(e[2])}function h(e){return Array.isArray(e)||(e=p(e)),e.every(u)}function f(e){return e.constructor!==Array&&(e=p(e)),u(e[0])&&u(e[1])&&u(e[2])&&u(e[3])&&u(e[4])&&u(e[5])}function p(e){for(var t=Object.keys(e),r=[],n=0;n<t.length;n++)r.push(e[t[n]]);return r}function m(e,t,n,a,u){var c=l(r(r(i(n,e),i(a,t)),u)),d=o(r(i(n,n),i(a,a)));return s(c,d)}function g(e,t,a,l,u,c,d,h,f){var p=[n(i(n(u,t),f),i(n(c,a),h)),n(i(n(c,a),d),i(n(l,e),f)),n(i(n(l,e),h),i(n(u,t),d))];p=o(r(r(i(p[0],p[0]),i(p[1],p[1])),i(p[2],p[2])));var m=o(r(r(i(d,d),i(h,h)),i(f,f)));return s(p,m)}function y(e,t){for(var s=e.length,a=0,l=0,u=0;u<s;u++)l=n(e[u],t[u]),a=r(i(l,l),a);return o(a)}})),TB=BD("matAlgo09xS0Sf",["typed","equalScalar"],(e=>{var{typed:t,equalScalar:r}=e;return function(e,n,i){var s=e._values,a=e._index,o=e._ptr,l=e._size,u=e._datatype,c=n._values,d=n._index,h=n._ptr,f=n._size,p=n._datatype;if(l.length!==f.length)throw new RS(l.length,f.length);if(l[0]!==f[0]||l[1]!==f[1])throw new RangeError("Dimension mismatch. Matrix A ("+l+") must match Matrix B ("+f+")");var m,g=l[0],y=l[1],v=r,b=0,w=i;"string"==typeof u&&u===p&&(m=u,v=t.find(r,[m,m]),b=t.convert(0,m),w=t.find(i,[m,m]));var x,E,D,S,A,T=s&&c?[]:void 0,C=[],N=[],k=T?[]:void 0,M=[];for(E=0;E<y;E++){N[E]=C.length;var O=E+1;if(k)for(S=h[E],A=h[E+1],D=S;D<A;D++)M[x=d[D]]=O,k[x]=c[D];for(S=o[E],A=o[E+1],D=S;D<A;D++)if(x=a[D],k){var F=M[x]===O?k[x]:b,L=w(s[D],F);v(L,b)||(C.push(x),T.push(L))}else C.push(x)}return N[y]=C.length,e.createSparseMatrix({values:T,index:C,ptr:N,size:[g,y],datatype:m})}})),CB="dotMultiply",NB=BD(CB,["typed","matrix","equalScalar","multiplyScalar","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,multiplyScalar:i,concat:s}=e,a=rI({typed:t,equalScalar:n}),o=TB({typed:t,equalScalar:n}),l=sI({typed:t,equalScalar:n}),u=cI({typed:t,matrix:r,concat:s});return t(CB,u({elop:i,SS:o,DS:a,Ss:l}))})),kB=BD("FibonacciHeap",["smaller","larger"],(e=>{var{smaller:t,larger:r}=e,n=1/Math.log((1+Math.sqrt(5))/2);function i(){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");this._minimum=null,this._size=0}function s(e,t,r){t.left.right=t.right,t.right.left=t.left,r.degree--,r.child===t&&(r.child=t.right),0===r.degree&&(r.child=null),t.left=e,t.right=e.right,e.right=t,t.right.left=t,t.parent=null,t.mark=!1}function a(e,t){var r=t.parent;r&&(t.mark?(s(e,t,r),a(r)):t.mark=!0)}i.prototype.type="FibonacciHeap",i.prototype.isFibonacciHeap=!0,i.prototype.insert=function(e,r){var n={key:e,value:r,degree:0};if(this._minimum){var i=this._minimum;n.left=i,n.right=i.right,i.right=n,n.right.left=n,t(e,i.key)&&(this._minimum=n)}else n.left=n,n.right=n,this._minimum=n;return this._size++,n},i.prototype.size=function(){return this._size},i.prototype.clear=function(){this._minimum=null,this._size=0},i.prototype.isEmpty=function(){return 0===this._size},i.prototype.extractMinimum=function(){var e=this._minimum;if(null===e)return e;for(var i=this._minimum,s=e.degree,a=e.child;s>0;){var l=a.right;a.left.right=a.right,a.right.left=a.left,a.left=i,a.right=i.right,i.right=a,a.right.left=a,a.parent=null,a=l,s--}return e.left.right=e.right,e.right.left=e.left,i=e===e.right?null:function(e,i){var s,a=Math.floor(Math.log(i)*n)+1,l=new Array(a),u=0,c=e;if(c)for(u++,c=c.right;c!==e;)u++,c=c.right;for(;u>0;){for(var d=c.degree,h=c.right;s=l[d];){if(r(c.key,s.key)){var f=s;s=c,c=f}o(s,c),l[d]=null,d++}l[d]=c,c=h,u--}e=null;for(var p=0;p<a;p++)(s=l[p])&&(e?(s.left.right=s.right,s.right.left=s.left,s.left=e,s.right=e.right,e.right=s,s.right.left=s,t(s.key,e.key)&&(e=s)):e=s);return e}(i=e.right,this._size),this._size--,this._minimum=i,e},i.prototype.remove=function(e){this._minimum=function(e,r,n){r.key=n;var i=r.parent;i&&t(r.key,i.key)&&(s(e,r,i),a(e,i));t(r.key,e.key)&&(e=r);return e}(this._minimum,e,-1),this.extractMinimum()};var o=function(e,t){e.left.right=e.right,e.right.left=e.left,e.parent=t,t.child?(e.left=t.child,e.right=t.child.right,t.child.right=e,e.right.left=e):(t.child=e,e.right=e,e.left=e),t.degree++,e.mark=!1};return i}),{isClass:!0}),MB="fix",OB=["typed","Complex","matrix","ceil","floor","equalScalar","zeros","DenseMatrix"],FB=BD(MB,["typed","ceil","floor"],(e=>{var{typed:t,ceil:r,floor:n}=e;return t(MB,{number:function(e){return e>0?n(e):r(e)},"number, number":function(e,t){return e>0?n(e,t):r(e,t)}})})),LB=BD(MB,OB,(e=>{var{typed:t,Complex:r,matrix:n,ceil:i,floor:s,equalScalar:a,zeros:o,DenseMatrix:l}=e,u=aI({typed:t,DenseMatrix:l}),c=lI({typed:t}),d=FB({typed:t,ceil:i,floor:s});return t("fix",{number:d.signatures.number,"number, number | BigNumber":d.signatures["number,number"],Complex:function(e){return new r(e.re>0?Math.floor(e.re):Math.ceil(e.re),e.im>0?Math.floor(e.im):Math.ceil(e.im))},"Complex, number":function(e,t){return new r(e.re>0?s(e.re,t):i(e.re,t),e.im>0?s(e.im,t):i(e.im,t))},"Complex, BigNumber":function(e,t){var n=t.toNumber();return new r(e.re>0?s(e.re,n):i(e.re,n),e.im>0?s(e.im,n):i(e.im,n))},BigNumber:function(e){return e.isNegative()?i(e):s(e)},"BigNumber, number | BigNumber":function(e,t){return e.isNegative()?i(e,t):s(e,t)},Fraction:function(e){return e.s<0?e.ceil():e.floor()},"Fraction, number | BigNumber":function(e,t){return e.s<0?i(e,t):s(e,t)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e,!0))),"Array | Matrix, number | BigNumber":t.referToSelf((e=>(t,r)=>eT(t,(t=>e(t,r)),!0))),"number | Complex | Fraction | BigNumber, Array":t.referToSelf((e=>(t,r)=>c(n(r),t,e,!0).valueOf())),"number | Complex | Fraction | BigNumber, Matrix":t.referToSelf((e=>(t,r)=>a(t,0)?o(r.size(),r.storage()):"dense"===r.storage()?c(r,t,e,!0):u(r,t,e,!0)))})})),_B="index",RB=BD(_B,["typed","Index"],(e=>{var{typed:t,Index:r}=e;return t(_B,{"...number | string | BigNumber | Range | Array | Matrix":function(e){var t=e.map((function(e){return KE(e)?e.toNumber():Array.isArray(e)||QE(e)?e.map((function(e){return KE(e)?e.toNumber():e})):e})),n=new r;return r.apply(n,t),n}})})),IB=BD("intersect",["typed","config","abs","add","addScalar","matrix","multiply","multiplyScalar","divideScalar","subtract","smaller","equalScalar","flatten","isZero","isNumeric"],(e=>{var{typed:t,config:r,abs:n,add:i,addScalar:s,matrix:a,multiply:o,multiplyScalar:l,divideScalar:u,subtract:c,smaller:d,equalScalar:h,flatten:f,isZero:p,isNumeric:m}=e;return t("intersect",{"Array, Array, Array":g,"Array, Array, Array, Array":y,"Matrix, Matrix, Matrix":function(e,t,r){var n=g(e.valueOf(),t.valueOf(),r.valueOf());return null===n?null:a(n)},"Matrix, Matrix, Matrix, Matrix":function(e,t,r,n){var i=y(e.valueOf(),t.valueOf(),r.valueOf(),n.valueOf());return null===i?null:a(i)}});function g(e,t,r){if(e=v(e),t=v(t),r=v(r),!w(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!w(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!function(e){return 4===e.length&&m(e[0])&&m(e[1])&&m(e[2])&&m(e[3])}(r))throw new TypeError("Array with 4 numbers expected as third argument");return function(e,t,r,n,i,a,o,d,h,f){var p=l(e,o),m=l(n,o),g=l(t,d),y=l(i,d),v=l(r,h),b=l(a,h),w=c(c(c(f,p),g),v),x=c(c(c(s(s(m,y),b),p),g),v),E=u(w,x),D=s(e,l(E,c(n,e))),S=s(t,l(E,c(i,t))),A=s(r,l(E,c(a,r)));return[D,S,A]}(e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],r[3])}function y(e,t,a,f){if(e=v(e),t=v(t),a=v(a),f=v(f),2===e.length){if(!b(e))throw new TypeError("Array with 2 numbers or BigNumbers expected for first argument");if(!b(t))throw new TypeError("Array with 2 numbers or BigNumbers expected for second argument");if(!b(a))throw new TypeError("Array with 2 numbers or BigNumbers expected for third argument");if(!b(f))throw new TypeError("Array with 2 numbers or BigNumbers expected for fourth argument");return function(e,t,a,h){var f=e,m=a,g=c(f,t),y=c(m,h),v=c(l(g[0],y[1]),l(y[0],g[1]));if(p(v))return null;if(d(n(v),r.epsilon))return null;var b=l(y[0],f[1]),w=l(y[1],f[0]),x=l(y[0],m[1]),E=l(y[1],m[0]),D=u(s(c(c(b,w),x),E),v);return i(o(g,D),f)}(e,t,a,f)}if(3===e.length){if(!w(e))throw new TypeError("Array with 3 numbers or BigNumbers expected for first argument");if(!w(t))throw new TypeError("Array with 3 numbers or BigNumbers expected for second argument");if(!w(a))throw new TypeError("Array with 3 numbers or BigNumbers expected for third argument");if(!w(f))throw new TypeError("Array with 3 numbers or BigNumbers expected for fourth argument");return function(e,t,r,n,i,a,o,d,f,m,g,y){var v=x(e,o,m,o,t,d,g,d,r,f,y,f),b=x(m,o,n,e,g,d,i,t,y,f,a,r),w=x(e,o,n,e,t,d,i,t,r,f,a,r),E=x(m,o,m,o,g,d,g,d,y,f,y,f),D=x(n,e,n,e,i,t,i,t,a,r,a,r),S=c(l(v,b),l(w,E)),A=c(l(D,E),l(b,b));if(p(A))return null;var T=u(S,A),C=u(s(v,l(T,b)),E),N=s(e,l(T,c(n,e))),k=s(t,l(T,c(i,t))),M=s(r,l(T,c(a,r))),O=s(o,l(C,c(m,o))),F=s(d,l(C,c(g,d))),L=s(f,l(C,c(y,f)));return h(N,O)&&h(k,F)&&h(M,L)?[N,k,M]:null}(e[0],e[1],e[2],t[0],t[1],t[2],a[0],a[1],a[2],f[0],f[1],f[2])}throw new TypeError("Arrays with two or thee dimensional points expected")}function v(e){return 1===e.length?e[0]:e.length>1&&Array.isArray(e[0])&&e.every((e=>Array.isArray(e)&&1===e.length))?f(e):e}function b(e){return 2===e.length&&m(e[0])&&m(e[1])}function w(e){return 3===e.length&&m(e[0])&&m(e[1])&&m(e[2])}function x(e,t,r,n,i,a,o,u,d,h,f,p){var m=l(c(e,t),c(r,n)),g=l(c(i,a),c(o,u)),y=l(c(d,h),c(f,p));return s(s(m,g),y)}})),PB=BD("lcm",["typed","matrix","equalScalar","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,concat:i}=e,s=rI({typed:t,equalScalar:n}),a=HI({typed:t,equalScalar:n}),o=sI({typed:t,equalScalar:n}),l=cI({typed:t,matrix:r,concat:i}),u="number | BigNumber | Fraction | Matrix | Array",c={};return c["".concat(u,", ").concat(u,", ...").concat(u)]=t.referToSelf((e=>(t,r,n)=>{for(var i=e(t,r),s=0;s<n.length;s++)i=e(i,n[s]);return i})),t("lcm",{"number, number":_O,"BigNumber, BigNumber":function(e,t){if(!e.isInt()||!t.isInt())throw new Error("Parameters in function lcm must be integer numbers");if(e.isZero())return e;if(t.isZero())return t;var r=e.times(t);for(;!t.isZero();){var n=t;t=e.mod(n),e=n}return r.div(e).abs()},"Fraction, Fraction":(e,t)=>e.lcm(t)},l({SS:a,DS:s,Ss:o}),c)})),BB="log1p",UB=BD(BB,["typed","config","divideScalar","log","Complex"],(e=>{var{typed:t,config:r,divideScalar:n,log:i,Complex:s}=e;return t(BB,{number:function(e){return e>=-1||r.predictable?aS(e):a(new s(e,0))},Complex:a,BigNumber:function(e){var t=e.plus(1);return!t.isNegative()||r.predictable?t.ln():a(new s(e.toNumber(),0))},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e))),"any, any":t.referToSelf((e=>(t,r)=>n(e(t),i(r))))});function a(e){var t=e.re+1;return new s(Math.log(Math.sqrt(t*t+e.im*e.im)),Math.atan2(e.im,t))}})),$B="lsolve",zB=BD($B,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:r,divideScalar:n,multiplyScalar:i,subtract:s,equalScalar:a,DenseMatrix:o}=e,l=iB({DenseMatrix:o});return t($B,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var r=(t=l(e,t,!0))._data,u=e._size[0],c=e._size[1],d=e._values,h=e._index,f=e._ptr,p=[],m=0;m<c;m++){var g=r[m][0]||0;if(a(g,0))p[m]=[0];else{for(var y=0,v=[],b=[],w=f[m],x=f[m+1],E=w;E<x;E++){var D=h[E];D===m?y=d[E]:D>m&&(v.push(d[E]),b.push(D))}if(a(y,0))throw new Error("Linear system cannot be solved since matrix is singular");for(var S=n(g,y),A=0,T=b.length;A<T;A++){var C=b[A];r[C]=[s(r[C][0]||0,i(S,v[A]))]}p[m]=[S]}}return new o({data:p,size:[u,1]})}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return u(e,t)},"Array, Array | Matrix":function(e,t){return u(r(e),t).valueOf()}});function u(e,t){for(var r=(t=l(e,t,!0))._data,u=e._size[0],c=e._size[1],d=[],h=e._data,f=0;f<c;f++){var p=r[f][0]||0,m=void 0;if(a(p,0))m=0;else{var g=h[f][f];if(a(g,0))throw new Error("Linear system cannot be solved since matrix is singular");m=n(p,g);for(var y=f+1;y<u;y++)r[y]=[s(r[y][0]||0,i(m,h[y][f]))]}d[f]=[m]}return new o({data:d,size:[u,1]})}})),jB=BD("qr",["typed","matrix","zeros","identity","isZero","equal","sign","sqrt","conj","unaryMinus","addScalar","divideScalar","multiplyScalar","subtract","complex"],(e=>{var{typed:t,matrix:r,zeros:n,identity:i,isZero:s,equal:a,sign:o,sqrt:l,conj:u,unaryMinus:c,addScalar:d,divideScalar:h,multiplyScalar:f,subtract:p,complex:m}=e;return zE(t("qr",{DenseMatrix:function(e){return y(e)},SparseMatrix:function(e){return function(e){throw new Error("qr not implemented for sparse matrices yet")}()},Array:function(e){var t=y(r(e));return{Q:t.Q.valueOf(),R:t.R.valueOf()}}}),{_denseQRimpl:g});function g(e){var t,r,m,g=e._size[0],y=e._size[1],v=i([g],"dense"),b=v._data,w=e.clone(),x=w._data,E=n([g],"");for(m=0;m<Math.min(y,g);++m){var D=x[m][m],S=c(a(D,0)?1:o(D)),A=u(S),T=0;for(t=m;t<g;t++)T=d(T,f(x[t][m],u(x[t][m])));var C=f(S,l(T));if(!s(C)){var N=p(D,C);for(E[m]=1,t=m+1;t<g;t++)E[t]=h(x[t][m],N);var k=c(u(h(N,C))),M=void 0;for(r=m;r<y;r++){for(M=0,t=m;t<g;t++)M=d(M,f(u(E[t]),x[t][r]));for(M=f(M,k),t=m;t<g;t++)x[t][r]=f(p(x[t][r],f(E[t],M)),A)}for(t=0;t<g;t++){for(M=0,r=m;r<g;r++)M=d(M,f(b[t][r],E[r]));for(M=f(M,k),r=m;r<g;++r)b[t][r]=h(p(b[t][r],f(M,u(E[r]))),A)}}}return{Q:v,R:w,toString:function(){return"Q: "+this.Q.toString()+"\nR: "+this.R.toString()}}}function y(e){var t=g(e),r=t.R._data;if(e._data.length>0)for(var n="Complex"===r[0][0].type?m(0):0,i=0;i<r.length;++i)for(var s=0;s<i&&s<(r[0]||[]).length;++s)r[i][s]=n;return t}})),qB="setCartesian",HB=BD(qB,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:r,subset:n,compareNatural:i,Index:s,DenseMatrix:a}=e;return t(qB,{"Array | Matrix, Array | Matrix":function(e,t){var o=[];if(0!==n(r(e),new s(0))&&0!==n(r(t),new s(0))){var l=JS(Array.isArray(e)?e:e.toArray()).sort(i),u=JS(Array.isArray(t)?t:t.toArray()).sort(i);o=[];for(var c=0;c<l.length;c++)for(var d=0;d<u.length;d++)o.push([l[c],u[d]])}return Array.isArray(e)&&Array.isArray(t)?o:new a(o)}})})),VB="setDistinct",GB=BD(VB,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:r,subset:n,compareNatural:i,Index:s,DenseMatrix:a}=e;return t(VB,{"Array | Matrix":function(e){var t;if(0===n(r(e),new s(0)))t=[];else{var o=JS(Array.isArray(e)?e:e.toArray()).sort(i);(t=[]).push(o[0]);for(var l=1;l<o.length;l++)0!==i(o[l],o[l-1])&&t.push(o[l])}return Array.isArray(e)?t:new a(t)}})})),KB="setIsSubset",WB=BD(KB,["typed","size","subset","compareNatural","Index"],(e=>{var{typed:t,size:r,subset:n,compareNatural:i,Index:s}=e;return t(KB,{"Array | Matrix, Array | Matrix":function(e,t){if(0===n(r(e),new s(0)))return!0;if(0===n(r(t),new s(0)))return!1;for(var a,o=rA(JS(Array.isArray(e)?e:e.toArray()).sort(i)),l=rA(JS(Array.isArray(t)?t:t.toArray()).sort(i)),u=0;u<o.length;u++){a=!1;for(var c=0;c<l.length;c++)if(0===i(o[u].value,l[c].value)&&o[u].identifier===l[c].identifier){a=!0;break}if(!1===a)return!1}return!0}})})),YB="setPowerset",JB=BD(YB,["typed","size","subset","compareNatural","Index"],(e=>{var{typed:t,size:r,subset:n,compareNatural:i,Index:s}=e;return t(YB,{"Array | Matrix":function(e){if(0===n(r(e),new s(0)))return[];for(var t=JS(Array.isArray(e)?e:e.toArray()).sort(i),o=[],l=0;l.toString(2).length<=t.length;)o.push(a(t,l.toString(2).split("").reverse())),l++;return function(e){for(var t=[],r=e.length-1;r>0;r--)for(var n=0;n<r;n++)e[n].length>e[n+1].length&&(t=e[n],e[n]=e[n+1],e[n+1]=t);return e}(o)}});function a(e,t){for(var r=[],n=0;n<t.length;n++)"1"===t[n]&&r.push(e[n]);return r}}));function ZB(e,t,r,n,i,s,a){var o=0;for(r[a]=e;o>=0;){var l=r[a+o],u=r[n+l];-1===u?(o--,s[t++]=l):(r[n+l]=r[i+u],r[a+ ++o]=u)}return t}function XB(e){return-e-2}var QB=BD("csAmd",["add","multiply","transpose"],(e=>{var{add:t,multiply:r,transpose:n}=e;return function(e,a){if(!a||e<=0||e>3)return null;var o=a._size,l=o[0],u=o[1],c=0,d=Math.max(16,10*Math.sqrt(u)),h=function(e,i,s,a,o){var l=n(i);if(1===e&&a===s)return t(i,l);if(2===e){for(var u=l._index,c=l._ptr,d=0,h=0;h<s;h++){var f=c[h];if(c[h]=d,!(c[h+1]-f>o))for(var p=c[h+1];f<p;f++)u[d++]=u[f]}return c[s]=d,i=n(l),r(l,i)}return r(l,i)}(e,a,l,u,d=Math.min(u-2,d));!function(e,t,r){for(var n=e._values,i=e._index,s=e._ptr,a=e._size[1],o=0,l=0;l<a;l++){var u=s[l];for(s[l]=o;u<s[l+1];u++)t(i[u],l,n?n[u]:1,r)&&(i[o]=i[u],n&&(n[o]=n[u]),o++)}s[a]=o,i.splice(o,i.length-o),n&&n.splice(o,n.length-o)}(h,s,null);for(var f,p,m,g,y,v,b,w,x,E,D,S,A,T,C,N,k=h._index,M=h._ptr,O=M[u],F=[],L=[],_=u+1,R=2*(u+1),I=3*(u+1),P=4*(u+1),B=5*(u+1),U=6*(u+1),$=7*(u+1),z=F,j=function(e,t,r,n,s,a,o,l,u,c,d,h){for(var f=0;f<e;f++)r[n+f]=t[f+1]-t[f];r[n+e]=0;for(var p=0;p<=e;p++)r[s+p]=-1,a[p]=-1,r[o+p]=-1,r[l+p]=-1,r[u+p]=1,r[c+p]=1,r[d+p]=0,r[h+p]=r[n+p];var m=i(0,0,r,c,e);return r[d+e]=-2,t[e]=-1,r[c+e]=0,m}(u,M,L,0,I,z,R,$,_,U,P,B),q=function(e,t,r,n,i,s,a,o,l,u,c){for(var d=0,h=0;h<e;h++){var f=r[n+h];if(0===f)r[i+h]=-2,d++,t[h]=-1,r[s+h]=0;else if(f>a)r[o+h]=0,r[i+h]=-1,d++,t[h]=XB(e),r[o+e]++;else{var p=r[l+f];-1!==p&&(u[p]=h),r[c+h]=r[l+f],r[l+f]=h}}return d}(u,M,L,B,P,U,d,_,I,z,R),H=0;q<u;){for(m=-1;H<u&&-1===(m=L[I+H]);H++);-1!==L[R+m]&&(z[L[R+m]]=-1),L[I+H]=L[R+m];var V=L[P+m],G=L[_+m];q+=G;var K=0;L[_+m]=-G;var W=M[m],Y=0===V?W:O,J=Y;for(g=1;g<=V+1;g++){for(g>V?(v=m,b=W,w=L[0+m]-V):(b=M[v=k[W++]],w=L[0+v]),y=1;y<=w;y++)(x=L[_+(f=k[b++])])<=0||(K+=x,L[_+f]=-x,k[J++]=f,-1!==L[R+f]&&(z[L[R+f]]=z[f]),-1!==z[f]?L[R+z[f]]=L[R+f]:L[I+L[B+f]]=L[R+f]);v!==m&&(M[v]=XB(m),L[U+v]=0)}for(0!==V&&(O=J),L[B+m]=K,M[m]=Y,L[0+m]=J-Y,L[P+m]=-2,j=i(j,c,L,U,u),E=Y;E<J;E++)if(!((D=L[P+(f=k[E])])<=0)){var Z=j-(x=-L[_+f]);for(W=M[f],S=M[f]+D-1;W<=S;W++)L[U+(v=k[W])]>=j?L[U+v]-=x:0!==L[U+v]&&(L[U+v]=L[B+v]+Z)}for(E=Y;E<J;E++){for(A=(S=M[f=k[E]])+L[P+f]-1,T=S,C=0,N=0,W=S;W<=A;W++)if(0!==L[U+(v=k[W])]){var X=L[U+v]-j;X>0?(N+=X,k[T++]=v,C+=v):(M[v]=XB(m),L[U+v]=0)}L[P+f]=T-S+1;var Q=T,ee=S+L[0+f];for(W=A+1;W<ee;W++){var te=L[_+(p=k[W])];te<=0||(N+=te,k[T++]=p,C+=p)}0===N?(M[f]=XB(m),K-=x=-L[_+f],G+=x,q+=x,L[_+f]=0,L[P+f]=-1):(L[B+f]=Math.min(L[B+f],N),k[T]=k[Q],k[Q]=k[S],k[S]=m,L[0+f]=T-S+1,C=(C<0?-C:C)%u,L[R+f]=L[$+C],L[$+C]=f,z[f]=C)}for(L[B+m]=K,j=i(j+(c=Math.max(c,K)),c,L,U,u),E=Y;E<J;E++)if(!(L[_+(f=k[E])]>=0))for(f=L[$+(C=z[f])],L[$+C]=-1;-1!==f&&-1!==L[R+f];f=L[R+f],j++){for(w=L[0+f],D=L[P+f],W=M[f]+1;W<=M[f]+w-1;W++)L[U+k[W]]=j;var re=f;for(p=L[R+f];-1!==p;){var ne=L[0+p]===w&&L[P+p]===D;for(W=M[p]+1;ne&&W<=M[p]+w-1;W++)L[U+k[W]]!==j&&(ne=0);ne?(M[p]=XB(f),L[_+f]+=L[_+p],L[_+p]=0,L[P+p]=-1,p=L[R+p],L[R+re]=p):(re=p,p=L[R+p])}}for(W=Y,E=Y;E<J;E++)(x=-L[_+(f=k[E])])<=0||(L[_+f]=x,N=L[B+f]+K-x,-1!==L[I+(N=Math.min(N,u-q-x))]&&(z[L[I+N]]=f),L[R+f]=L[I+N],z[f]=-1,L[I+N]=f,H=Math.min(H,N),L[B+f]=N,k[W++]=f);L[_+m]=G,0==(L[0+m]=W-Y)&&(M[m]=-1,L[U+m]=0),0!==V&&(O=W)}for(f=0;f<u;f++)M[f]=XB(M[f]);for(p=0;p<=u;p++)L[I+p]=-1;for(p=u;p>=0;p--)L[_+p]>0||(L[R+p]=L[I+M[p]],L[I+M[p]]=p);for(v=u;v>=0;v--)L[_+v]<=0||-1!==M[v]&&(L[R+v]=L[I+M[v]],L[I+M[v]]=v);for(m=0,f=0;f<=u;f++)-1===M[f]&&(m=ZB(f,m,L,I,R,F,U));return F.splice(F.length-1,1),F};function i(e,t,r,n,i){if(e<2||e+t<0){for(var s=0;s<i;s++)0!==r[n+s]&&(r[n+s]=1);e=2}return e}function s(e,t){return e!==t}}));function eU(e,t,r,n,i,s,a){var o,l,u,c=0;if(e<=t||r[n+t]<=r[i+e])return-1;r[i+e]=r[n+t];var d=r[s+e];if(r[s+e]=t,-1===d)c=1,u=e;else{for(c=2,u=d;u!==r[a+u];u=r[a+u]);for(o=d;o!==u;o=l)l=r[a+o],r[a+o]=u}return{jleaf:c,q:u}}var tU=BD("csCounts",["transpose"],(e=>{var{transpose:t}=e;return function(e,r,n,i){if(!e||!r||!n)return null;var s,a,o,l,u,c,d,h=e._size,f=h[0],p=h[1],m=4*p+(i?p+f+1:0),g=[],y=p,v=2*p,b=3*p,w=4*p,x=5*p+1;for(o=0;o<m;o++)g[o]=-1;var E=[],D=t(e),S=D._index,A=D._ptr;for(o=0;o<p;o++)for(E[a=n[o]]=-1===g[b+a]?1:0;-1!==a&&-1===g[b+a];a=r[a])g[b+a]=o;if(i){for(o=0;o<p;o++)g[n[o]]=o;for(s=0;s<f;s++){for(o=p,c=A[s],d=A[s+1],u=c;u<d;u++)o=Math.min(o,g[S[u]]);g[x+s]=g[w+o],g[w+o]=s}}for(s=0;s<p;s++)g[0+s]=s;for(o=0;o<p;o++){for(-1!==r[a=n[o]]&&E[r[a]]--,l=i?g[w+o]:a;-1!==l;l=i?g[x+l]:-1)for(u=A[l];u<A[l+1];u++){var T=eU(s=S[u],a,g,b,y,v,0);T.jleaf>=1&&E[a]++,2===T.jleaf&&E[T.q]--}-1!==r[a]&&(g[0+a]=r[a])}for(a=0;a<p;a++)-1!==r[a]&&(E[r[a]]+=E[a]);return E}})),rU=BD("csSqr",["add","multiply","transpose"],(e=>{var{add:t,multiply:r,transpose:n}=e,i=QB({add:t,multiply:r,transpose:n}),s=tU({transpose:n});return function(e,t,r){var n,a=t._ptr,o=t._size[1],l={};if(l.q=i(e,t),e&&!l.q)return null;if(r){var u=e?function(e,t,r,n){for(var i=e._values,s=e._index,a=e._ptr,o=e._size,l=e._datatype,u=o[0],c=o[1],d=n&&e._values?[]:null,h=[],f=[],p=0,m=0;m<c;m++){f[m]=p;for(var g=r?r[m]:m,y=a[g],v=a[g+1],b=y;b<v;b++){var w=t?t[s[b]]:s[b];h[p]=w,d&&(d[p]=i[b]),p++}}return f[c]=p,e.createSparseMatrix({values:d,index:h,ptr:f,size:[u,c],datatype:l})}(t,null,l.q,0):t;l.parent=function(e,t){if(!e)return null;var r,n,i=e._index,s=e._ptr,a=e._size,o=a[0],l=a[1],u=[],c=[],d=l;if(t)for(r=0;r<o;r++)c[d+r]=-1;for(var h=0;h<l;h++){u[h]=-1,c[0+h]=-1;for(var f=s[h],p=s[h+1],m=f;m<p;m++){var g=i[m];for(r=t?c[d+g]:g;-1!==r&&r<h;r=n)n=c[0+r],c[0+r]=h,-1===n&&(u[r]=h);t&&(c[d+g]=h)}}return u}(u,1);var c=function(e,t){if(!e)return null;var r,n=0,i=[],s=[],a=t,o=2*t;for(r=0;r<t;r++)s[0+r]=-1;for(r=t-1;r>=0;r--)-1!==e[r]&&(s[a+r]=s[0+e[r]],s[0+e[r]]=r);for(r=0;r<t;r++)-1===e[r]&&(n=ZB(r,n,s,0,a,i,o));return i}(l.parent,o);if(l.cp=s(u,l.parent,c,1),u&&l.parent&&l.cp&&function(e,t){var r=e._ptr,n=e._index,i=e._size,s=i[0],a=i[1];t.pinv=[],t.leftmost=[];var o,l,u,c,d,h=t.parent,f=t.pinv,p=t.leftmost,m=[],g=0,y=s,v=s+a,b=s+2*a;for(l=0;l<a;l++)m[y+l]=-1,m[v+l]=-1,m[b+l]=0;for(o=0;o<s;o++)p[o]=-1;for(l=a-1;l>=0;l--)for(c=r[l],d=r[l+1],u=c;u<d;u++)p[n[u]]=l;for(o=s-1;o>=0;o--)f[o]=-1,-1!==(l=p[o])&&(0==m[b+l]++&&(m[v+l]=o),m[g+o]=m[y+l],m[y+l]=o);for(t.lnz=0,t.m2=s,l=0;l<a;l++)if(o=m[y+l],t.lnz++,o<0&&(o=t.m2++),f[o]=l,!(--b[l]<=0)){t.lnz+=m[b+l];var w=h[l];-1!==w&&(0===m[b+w]&&(m[v+w]=m[v+l]),m[g+m[v+l]]=m[y+w],m[y+w]=m[g+o],m[b+w]+=m[b+l])}for(o=0;o<s;o++)f[o]<0&&(f[o]=l++);return!0}(u,l))for(l.unz=0,n=0;n<o;n++)l.unz+=l.cp[n]}else l.unz=4*a[o]+o,l.lnz=l.unz;return l}}));function nU(e,t){return e[t]<0}function iU(e,t){e[t]=XB(e[t])}function sU(e){return e<0?XB(e):e}function aU(e,t,r,n,i){var s,a,o,l=t._index,u=t._ptr,c=t._size[1],d=0;for(n[0]=e;d>=0;){e=n[d];var h=i?i[e]:e;nU(u,e)||(iU(u,e),n[c+d]=h<0?0:sU(u[h]));var f=1;for(a=n[c+d],o=h<0?0:sU(u[h+1]);a<o;a++)if(!nU(u,s=l[a])){n[c+d]=a,n[++d]=s,f=0;break}f&&(d--,n[--r]=e)}return r}var oU=BD("csSpsolve",["divideScalar","multiply","subtract"],(e=>{var{divideScalar:t,multiply:r,subtract:n}=e;return function(e,i,s,a,o,l,u){var c,d,h,f,p=e._values,m=e._index,g=e._ptr,y=e._size[1],v=i._values,b=i._index,w=i._ptr,x=function(e,t,r,n,i){var s,a,o,l=e._ptr,u=e._size,c=t._index,d=t._ptr,h=u[1],f=h;for(a=d[r],o=d[r+1],s=a;s<o;s++){var p=c[s];nU(l,p)||(f=aU(p,e,f,n,i))}for(s=f;s<h;s++)iU(l,n[s]);return f}(e,i,s,a,l);for(c=x;c<y;c++)o[a[c]]=0;for(d=w[s],h=w[s+1],c=d;c<h;c++)o[b[c]]=v[c];for(var E=x;E<y;E++){var D=a[E],S=l?l[D]:D;if(!(S<0))for(d=g[S],h=g[S+1],o[D]=t(o[D],p[u?d:h-1]),c=u?d+1:d,f=u?h:h-1;c<f;c++){var A=m[c];o[A]=n(o[A],r(p[c],o[D]))}}return x}})),lU=BD("csLu",["abs","divideScalar","multiply","subtract","larger","largerEq","SparseMatrix"],(e=>{var{abs:t,divideScalar:r,multiply:n,subtract:i,larger:s,largerEq:a,SparseMatrix:o}=e,l=oU({divideScalar:r,multiply:n,subtract:i});return function(e,i,u){if(!e)return null;var c,d=e._size[1],h=100,f=100;i&&(c=i.q,h=i.lnz||h,f=i.unz||f);var p,m,g=[],y=[],v=[],b=new o({values:g,index:y,ptr:v,size:[d,d]}),w=[],x=[],E=[],D=new o({values:w,index:x,ptr:E,size:[d,d]}),S=[],A=[],T=[];for(p=0;p<d;p++)A[p]=0,S[p]=-1,v[p+1]=0;h=0,f=0;for(var C=0;C<d;C++){v[C]=h,E[C]=f;var N=c?c[C]:C,k=l(b,e,N,T,A,S,1),M=-1,O=-1;for(m=k;m<d;m++)if(S[p=T[m]]<0){var F=t(A[p]);s(F,O)&&(O=F,M=p)}else x[f]=S[p],w[f++]=A[p];if(-1===M||O<=0)return null;S[N]<0&&a(t(A[N]),n(O,u))&&(M=N);var L=A[M];for(x[f]=C,w[f++]=L,S[M]=C,y[h]=M,g[h++]=1,m=k;m<d;m++)S[p=T[m]]<0&&(y[h]=p,g[h++]=r(A[p],L)),A[p]=0}for(v[d]=h,E[d]=f,m=0;m<h;m++)y[m]=S[y[m]];return g.splice(h,g.length-h),y.splice(h,y.length-h),w.splice(f,w.length-f),x.splice(f,x.length-f),{L:b,U:D,pinv:S}}})),uU=BD("slu",["typed","abs","add","multiply","transpose","divideScalar","subtract","larger","largerEq","SparseMatrix"],(e=>{var{typed:t,abs:r,add:n,multiply:i,transpose:s,divideScalar:a,subtract:o,larger:l,largerEq:u,SparseMatrix:c}=e,d=rU({add:n,multiply:i,transpose:s}),h=lU({abs:r,divideScalar:a,multiply:i,subtract:o,larger:l,largerEq:u,SparseMatrix:c});return t("slu",{"SparseMatrix, number, number":function(e,t,r){if(!rS(t)||t<0||t>3)throw new Error("Symbolic Ordering and Analysis order must be an integer number in the interval [0, 3]");if(r<0||r>1)throw new Error("Partial pivoting threshold must be a number from 0 to 1");var n=d(t,e,!1),i=h(e,n,r);return{L:i.L,U:i.U,p:i.pinv,q:n.q,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\np: "+this.p.toString()+(this.q?"\nq: "+this.q.toString():"")+"\n"}}}})})),cU="sort",dU=BD(cU,["typed","matrix","compare","compareNatural"],(e=>{var{typed:t,matrix:r,compare:n,compareNatural:i}=e,s=n,a=(e,t)=>-n(e,t);return t(cU,{Array:function(e){return l(e),e.sort(s)},Matrix:function(e){return u(e),r(e.toArray().sort(s),e.storage())},"Array, function":function(e,t){return l(e),e.sort(t)},"Matrix, function":function(e,t){return u(e),r(e.toArray().sort(t),e.storage())},"Array, string":function(e,t){return l(e),e.sort(o(t))},"Matrix, string":function(e,t){return u(e),r(e.toArray().sort(o(t)),e.storage())}});function o(e){if("asc"===e)return s;if("desc"===e)return a;if("natural"===e)return i;throw new Error('String "asc", "desc", or "natural" expected')}function l(e){if(1!==PS(e).length)throw new Error("One dimensional array expected")}function u(e){if(1!==e.size().length)throw new Error("One dimensional matrix expected")}})),hU="usolveAll",fU=BD(hU,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:r,divideScalar:n,multiplyScalar:i,subtract:s,equalScalar:a,DenseMatrix:o}=e,l=iB({DenseMatrix:o});return t(hU,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var r=[l(e,t,!0)._data.map((e=>e[0]))],u=e._size[0],c=e._size[1],d=e._values,h=e._index,f=e._ptr,p=c-1;p>=0;p--)for(var m=r.length,g=0;g<m;g++){for(var y=r[g],v=[],b=[],w=f[p],x=0,E=f[p+1]-1;E>=w;E--){var D=h[E];D===p?x=d[E]:D<p&&(v.push(d[E]),b.push(D))}if(a(x,0))if(a(y[p],0)){if(0===g){var S=[...y];S[p]=1;for(var A=0,T=b.length;A<T;A++){var C=b[A];S[C]=s(S[C],v[A])}r.push(S)}}else{if(0===g)return[];r.splice(g,1),g-=1,m-=1}else{y[p]=n(y[p],x);for(var N=0,k=b.length;N<k;N++){var M=b[N];y[M]=s(y[M],i(y[p],v[N]))}}}return r.map((e=>new o({data:e.map((e=>[e])),size:[u,1]})))}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return u(e,t)},"Array, Array | Matrix":function(e,t){return u(r(e),t).map((e=>e.valueOf()))}});function u(e,t){for(var r=[l(e,t,!0)._data.map((e=>e[0]))],u=e._data,c=e._size[0],d=e._size[1]-1;d>=0;d--)for(var h=r.length,f=0;f<h;f++){var p=r[f];if(a(u[d][d],0))if(a(p[d],0)){if(0===f){var m=[...p];m[d]=1;for(var g=d-1;g>=0;g--)m[g]=s(m[g],u[g][d]);r.push(m)}}else{if(0===f)return[];r.splice(f,1),f-=1,h-=1}else{p[d]=n(p[d],u[d][d]);for(var y=d-1;y>=0;y--)p[y]=s(p[y],i(p[d],u[y][d]))}}return r.map((e=>new o({data:e.map((e=>[e])),size:[c,1]})))}})),pU="atan2",mU=BD(pU,["typed","matrix","equalScalar","BigNumber","DenseMatrix","concat"],(e=>{var{typed:t,matrix:r,equalScalar:n,BigNumber:i,DenseMatrix:s,concat:a}=e,o=rI({typed:t,equalScalar:n}),l=nI({typed:t}),u=TB({typed:t,equalScalar:n}),c=sI({typed:t,equalScalar:n}),d=aI({typed:t,DenseMatrix:s}),h=cI({typed:t,matrix:r,concat:a});return t(pU,{"number, number":Math.atan2,"BigNumber, BigNumber":(e,t)=>i.atan2(e,t)},h({scalar:"number | BigNumber",SS:u,DS:l,SD:o,Ss:c,sS:d}))})),gU="lsolveAll",yU=BD(gU,["typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix"],(e=>{var{typed:t,matrix:r,divideScalar:n,multiplyScalar:i,subtract:s,equalScalar:a,DenseMatrix:o}=e,l=iB({DenseMatrix:o});return t(gU,{"SparseMatrix, Array | Matrix":function(e,t){return function(e,t){for(var r=[l(e,t,!0)._data.map((e=>e[0]))],u=e._size[0],c=e._size[1],d=e._values,h=e._index,f=e._ptr,p=0;p<c;p++)for(var m=r.length,g=0;g<m;g++){for(var y=r[g],v=[],b=[],w=f[p],x=f[p+1],E=0,D=w;D<x;D++){var S=h[D];S===p?E=d[D]:S>p&&(v.push(d[D]),b.push(S))}if(a(E,0))if(a(y[p],0)){if(0===g){var A=[...y];A[p]=1;for(var T=0,C=b.length;T<C;T++){var N=b[T];A[N]=s(A[N],v[T])}r.push(A)}}else{if(0===g)return[];r.splice(g,1),g-=1,m-=1}else{y[p]=n(y[p],E);for(var k=0,M=b.length;k<M;k++){var O=b[k];y[O]=s(y[O],i(y[p],v[k]))}}}return r.map((e=>new o({data:e.map((e=>[e])),size:[u,1]})))}(e,t)},"DenseMatrix, Array | Matrix":function(e,t){return u(e,t)},"Array, Array | Matrix":function(e,t){return u(r(e),t).map((e=>e.valueOf()))}});function u(e,t){for(var r=[l(e,t,!0)._data.map((e=>e[0]))],u=e._data,c=e._size[0],d=e._size[1],h=0;h<d;h++)for(var f=r.length,p=0;p<f;p++){var m=r[p];if(a(u[h][h],0))if(a(m[h],0)){if(0===p){var g=[...m];g[h]=1;for(var y=h+1;y<d;y++)g[y]=s(g[y],u[y][h]);r.push(g)}}else{if(0===p)return[];r.splice(p,1),p-=1,f-=1}else{m[h]=n(m[h],u[h][h]);for(var v=h+1;v<d;v++)m[v]=s(m[v],i(m[h],u[v][h]))}}return r.map((e=>new o({data:e.map((e=>[e])),size:[c,1]})))}})),vU="setDifference",bU=BD(vU,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:r,subset:n,compareNatural:i,Index:s,DenseMatrix:a}=e;return t(vU,{"Array | Matrix, Array | Matrix":function(e,t){var o;if(0===n(r(e),new s(0)))o=[];else{if(0===n(r(t),new s(0)))return JS(e.toArray());var l,u=rA(JS(Array.isArray(e)?e:e.toArray()).sort(i)),c=rA(JS(Array.isArray(t)?t:t.toArray()).sort(i));o=[];for(var d=0;d<u.length;d++){l=!1;for(var h=0;h<c.length;h++)if(0===i(u[d].value,c[h].value)&&u[d].identifier===c[h].identifier){l=!0;break}l||o.push(u[d])}}return Array.isArray(e)&&Array.isArray(t)?nA(o):new a(nA(o))}})})),wU="setMultiplicity",xU=BD(wU,["typed","size","subset","compareNatural","Index"],(e=>{var{typed:t,size:r,subset:n,compareNatural:i,Index:s}=e;return t(wU,{"number | BigNumber | Fraction | Complex, Array | Matrix":function(e,t){if(0===n(r(t),new s(0)))return 0;for(var a=JS(Array.isArray(t)?t:t.toArray()),o=0,l=0;l<a.length;l++)0===i(a[l],e)&&o++;return o}})})),EU="setSymDifference",DU=BD(EU,["typed","size","concat","subset","setDifference","Index"],(e=>{var{typed:t,size:r,concat:n,subset:i,setDifference:s,Index:a}=e;return t(EU,{"Array | Matrix, Array | Matrix":function(e,t){if(0===i(r(e),new a(0)))return JS(t);if(0===i(r(t),new a(0)))return JS(e);var o=JS(e),l=JS(t);return n(s(o,l),s(l,o))}})})),SU=BD("Spa",["addScalar","equalScalar","FibonacciHeap"],(e=>{var{addScalar:t,equalScalar:r,FibonacciHeap:n}=e;function i(){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");this._values=[],this._heap=new n}return i.prototype.type="Spa",i.prototype.isSpa=!0,i.prototype.set=function(e,t){if(this._values[e])this._values[e].value=t;else{var r=this._heap.insert(e,t);this._values[e]=r}},i.prototype.get=function(e){var t=this._values[e];return t?t.value:0},i.prototype.accumulate=function(e,r){var n=this._values[e];n?n.value=t(n.value,r):(n=this._heap.insert(e,r),this._values[e]=n)},i.prototype.forEach=function(e,t,n){var i=this._heap,s=this._values,a=[],o=i.extractMinimum();for(o&&a.push(o);o&&o.key<=t;)o.key>=e&&(r(o.value,0)||n(o.key,o.value,this)),(o=i.extractMinimum())&&a.push(o);for(var l=0;l<a.length;l++){var u=a[l];s[(o=i.insert(u.key,u.value)).key]=o}},i.prototype.swap=function(e,t){var r=this._values[e],n=this._values[t];if(!r&&n)r=this._heap.insert(e,n.value),this._heap.remove(n),this._values[e]=r,this._values[t]=void 0;else if(r&&!n)n=this._heap.insert(t,r.value),this._heap.remove(r),this._values[t]=n,this._values[e]=void 0;else if(r&&n){var i=r.value;r.value=n.value,n.value=i}},i}),{isClass:!0}),AU=BD("inv",["typed","matrix","divideScalar","addScalar","multiply","unaryMinus","det","identity","abs"],(e=>{var{typed:t,matrix:r,divideScalar:n,addScalar:i,multiply:s,unaryMinus:a,det:o,identity:l,abs:u}=e;return t("inv",{"Array | Matrix":function(e){var t=QE(e)?e.size():PS(e);switch(t.length){case 1:if(1===t[0])return QE(e)?r([n(1,e.valueOf()[0])]):[n(1,e[0])];throw new RangeError("Matrix must be square (size: "+NS(t)+")");case 2:var i=t[0],s=t[1];if(i===s)return QE(e)?r(c(e.valueOf(),i,s),e.storage()):c(e,i,s);throw new RangeError("Matrix must be square (size: "+NS(t)+")");default:throw new RangeError("Matrix must be two dimensional (size: "+NS(t)+")")}},any:function(e){return n(1,e)}});function c(e,t,r){var c,d,h,f,p;if(1===t){if(0===(f=e[0][0]))throw Error("Cannot calculate inverse, determinant is zero");return[[n(1,f)]]}if(2===t){var m=o(e);if(0===m)throw Error("Cannot calculate inverse, determinant is zero");return[[n(e[1][1],m),n(a(e[0][1]),m)],[n(a(e[1][0]),m),n(e[0][0],m)]]}var g=e.concat();for(c=0;c<t;c++)g[c]=g[c].concat();for(var y=l(t).valueOf(),v=0;v<r;v++){var b=u(g[v][v]),w=v;for(c=v+1;c<t;)u(g[c][v])>b&&(b=u(g[c][v]),w=c),c++;if(0===b)throw Error("Cannot calculate inverse, determinant is zero");(c=w)!==v&&(p=g[v],g[v]=g[c],g[c]=p,p=y[v],y[v]=y[c],y[c]=p);var x=g[v],E=y[v];for(c=0;c<t;c++){var D=g[c],S=y[c];if(c!==v){if(0!==D[v]){for(h=n(a(D[v]),x[v]),d=v;d<r;d++)D[d]=i(D[d],s(h,x[d]));for(d=0;d<r;d++)S[d]=i(S[d],s(h,E[d]))}}else{for(h=x[v],d=v;d<r;d++)D[d]=n(D[d],h);for(d=0;d<r;d++)S[d]=n(S[d],h)}}}return y}})),TU=BD("lup",["typed","matrix","abs","addScalar","divideScalar","multiplyScalar","subtract","larger","equalScalar","unaryMinus","DenseMatrix","SparseMatrix","Spa"],(e=>{var{typed:t,matrix:r,abs:n,addScalar:i,divideScalar:s,multiplyScalar:a,subtract:o,larger:l,equalScalar:u,unaryMinus:c,DenseMatrix:d,SparseMatrix:h,Spa:f}=e;return t("lup",{DenseMatrix:function(e){return p(e)},SparseMatrix:function(e){return m(e)},Array:function(e){var t=p(r(e));return{L:t.L.valueOf(),U:t.U.valueOf(),p:t.p}}});function p(e){var t,r,c,h=e._size[0],f=e._size[1],p=Math.min(h,f),m=_D(e._data),g=[],y=[h,p],v=[],b=[p,f],w=[];for(t=0;t<h;t++)w[t]=t;for(r=0;r<f;r++){if(r>0)for(t=0;t<h;t++){var x=Math.min(t,r),E=0;for(c=0;c<x;c++)E=i(E,a(m[t][c],m[c][r]));m[t][r]=o(m[t][r],E)}var D=r,S=0,A=0;for(t=r;t<h;t++){var T=m[t][r],C=n(T);l(C,S)&&(D=t,S=C,A=T)}if(r!==D&&(w[r]=[w[D],w[D]=w[r]][0],d._swapRows(r,D,m)),r<h)for(t=r+1;t<h;t++){var N=m[t][r];u(N,0)||(m[t][r]=s(m[t][r],A))}}for(r=0;r<f;r++)for(t=0;t<h;t++)0===r&&(t<f&&(v[t]=[]),g[t]=[]),t<r?(t<f&&(v[t][r]=m[t][r]),r<h&&(g[t][r]=0)):t!==r?(t<f&&(v[t][r]=0),r<h&&(g[t][r]=m[t][r])):(t<f&&(v[t][r]=m[t][r]),r<h&&(g[t][r]=1));var k=new d({data:g,size:y}),M=new d({data:v,size:b}),O=[];for(t=0,p=w.length;t<p;t++)O[w[t]]=t;return{L:k,U:M,p:O,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}function m(e){var t,r,i,o=e._size[0],d=e._size[1],p=Math.min(o,d),m=e._values,g=e._index,y=e._ptr,v=[],b=[],w=[],x=[o,p],E=[],D=[],S=[],A=[p,d],T=[],C=[];for(t=0;t<o;t++)T[t]=t,C[t]=t;var N=function(){var e=new f;r<o&&(w.push(v.length),v.push(1),b.push(r)),S.push(E.length);var d=y[r],p=y[r+1];for(i=d;i<p;i++)t=g[i],e.set(T[t],m[i]);r>0&&e.forEach(0,r-1,(function(t,r){h._forEachRow(t,v,b,w,(function(n,i){n>t&&e.accumulate(n,c(a(i,r)))}))}));var N,k,M,O,F=r,L=e.get(r),_=n(L);e.forEach(r+1,o-1,(function(e,t){var r=n(t);l(r,_)&&(F=e,_=r,L=t)})),r!==F&&(h._swapRows(r,F,x[1],v,b,w),h._swapRows(r,F,A[1],E,D,S),e.swap(r,F),k=F,M=C[N=r],O=C[k],T[M]=k,T[O]=N,C[N]=O,C[k]=M),e.forEach(0,o-1,(function(e,t){e<=r?(E.push(t),D.push(e)):(t=s(t,L),u(t,0)||(v.push(t),b.push(e)))}))};for(r=0;r<d;r++)N();return S.push(E.length),w.push(v.length),{L:new h({values:v,index:b,ptr:w,size:x}),U:new h({values:E,index:D,ptr:S,size:A}),p:T,toString:function(){return"L: "+this.L.toString()+"\nU: "+this.U.toString()+"\nP: "+this.p}}}})),CU="pinv",NU=BD(CU,["typed","matrix","inv","deepEqual","equal","dotDivide","dot","ctranspose","divideScalar","multiply","add","Complex"],(e=>{var{typed:t,matrix:r,inv:n,deepEqual:i,equal:s,dotDivide:a,dot:o,ctranspose:l,divideScalar:u,multiply:c,add:d,Complex:h}=e;return t(CU,{"Array | Matrix":function(e){var t=QE(e)?e.size():PS(e);switch(t.length){case 1:return m(e)?l(e):1===t[0]?n(e):a(l(e),o(e,e));case 2:if(m(e))return l(e);var i=t[0],s=t[1];if(i===s)try{return n(e)}catch(e){if(!(e instanceof Error&&e.message.match(/Cannot calculate inverse, determinant is zero/)))throw e}return QE(e)?r(f(e.valueOf(),i,s),e.storage()):f(e,i,s);default:throw new RangeError("Matrix must be two dimensional (size: "+NS(t)+")")}},any:function(e){return s(e,0)?_D(e):u(1,e)}});function f(e,t,r){var{C:i,F:s}=function(e,t,r){var n=function(e,t,r){for(var n=_D(e),i=0,s=0;s<t;s++){if(r<=i)return n;for(var o=s;p(n[o][i]);)if(t===++o&&(o=s,r===++i))return n;[n[o],n[s]]=[n[s],n[o]];for(var l=n[s][i],u=0;u<r;u++)n[s][u]=a(n[s][u],l);for(var h=0;h<t;h++)if(h!==s){l=n[h][i];for(var f=0;f<r;f++)n[h][f]=d(n[h][f],c(-1,c(l,n[s][f])))}i++}return n}(e,t,r),i=e.map(((e,r)=>e.filter(((e,r)=>r<t&&!p(o(n[r],n[r])))))),s=n.filter(((e,t)=>!p(o(n[t],n[t]))));return{C:i,F:s}}(e,t,r),u=c(n(c(l(i),i)),l(i)),h=c(l(s),n(c(s,l(s))));return c(h,u)}function p(e){return s(d(e,h(1,1)),d(0,h(1,1)))}function m(e){return i(d(e,h(1,1)),d(c(e,0),h(1,1)))}})),kU=BD("pow",["typed","config","identity","multiply","matrix","inv","fraction","number","Complex"],(e=>{var{typed:t,config:r,identity:n,multiply:i,matrix:s,inv:a,number:o,fraction:l,Complex:u}=e;return t("pow",{"number, number":c,"Complex, Complex":function(e,t){return e.pow(t)},"BigNumber, BigNumber":function(e,t){return t.isInteger()||e>=0||r.predictable?e.pow(t):new u(e.toNumber(),0).pow(t.toNumber(),0)},"Fraction, Fraction":function(e,t){var n=e.pow(t);if(null!=n)return n;if(r.predictable)throw new Error("Result of pow is non-rational and cannot be expressed as a fraction");return c(e.valueOf(),t.valueOf())},"Array, number":d,"Array, BigNumber":function(e,t){return d(e,t.toNumber())},"Matrix, number":h,"Matrix, BigNumber":function(e,t){return h(e,t.toNumber())},"Unit, number | BigNumber":function(e,t){return e.pow(t)}});function c(e,t){if(r.predictable&&!rS(t)&&e<0)try{var n=l(t),i=o(n);if((t===i||Math.abs((t-i)/t)<1e-14)&&n.d%2==1)return(n.n%2==0?1:-1)*Math.pow(-e,t)}catch(e){}return r.predictable&&(e<-1&&t===1/0||e>-1&&e<0&&t===-1/0)?NaN:rS(t)||e>=0||r.predictable?jO(e,t):e*e<1&&t===1/0||e*e>1&&t===-1/0?0:new u(e,0).pow(t,0)}function d(e,t){if(!rS(t))throw new TypeError("For A^b, b must be an integer (value is "+t+")");var r=PS(e);if(2!==r.length)throw new Error("For A^b, A must be 2 dimensional (A has "+r.length+" dimensions)");if(r[0]!==r[1])throw new Error("For A^b, A must be square (size is "+r[0]+"x"+r[1]+")");if(t<0)try{return d(a(e),-t)}catch(e){if("Cannot calculate inverse, determinant is zero"===e.message)throw new TypeError("For A^b, when A is not invertible, b must be a positive integer (value is "+t+")");throw e}for(var s=n(r[0]).valueOf(),o=e;t>=1;)1==(1&t)&&(s=i(o,s)),t>>=1,o=i(o,o);return s}function h(e,t){return s(d(e.valueOf(),t))}})),MU="setIntersect",OU=BD(MU,["typed","size","subset","compareNatural","Index","DenseMatrix"],(e=>{var{typed:t,size:r,subset:n,compareNatural:i,Index:s,DenseMatrix:a}=e;return t(MU,{"Array | Matrix, Array | Matrix":function(e,t){var o;if(0===n(r(e),new s(0))||0===n(r(t),new s(0)))o=[];else{var l=rA(JS(Array.isArray(e)?e:e.toArray()).sort(i)),u=rA(JS(Array.isArray(t)?t:t.toArray()).sort(i));o=[];for(var c=0;c<l.length;c++)for(var d=0;d<u.length;d++)if(0===i(l[c].value,u[d].value)&&l[c].identifier===u[d].identifier){o.push(l[c]);break}}return Array.isArray(e)&&Array.isArray(t)?nA(o):new a(nA(o))}})})),FU="setUnion",LU=BD(FU,["typed","size","concat","subset","setIntersect","setSymDifference","Index"],(e=>{var{typed:t,size:r,concat:n,subset:i,setIntersect:s,setSymDifference:a,Index:o}=e;return t(FU,{"Array | Matrix, Array | Matrix":function(e,t){if(0===i(r(e),new o(0)))return JS(t);if(0===i(r(t),new o(0)))return JS(e);var l=JS(e),u=JS(t);return n(a(l,u),s(l,u))}})})),_U="sqrtm",RU=BD(_U,["typed","abs","add","multiply","map","sqrt","subtract","inv","size","max","identity"],(e=>{var{typed:t,abs:r,add:n,multiply:i,map:s,sqrt:a,subtract:o,inv:l,size:u,max:c,identity:d}=e,h=1e-6;function f(e){var t,s=0,a=e,f=d(u(e));do{var p=a;if(a=i(.5,n(p,l(f))),f=i(.5,n(f,l(p))),(t=c(r(o(a,p))))>h&&++s>1e3)throw new Error("computing square root of matrix: iterative method could not converge")}while(t>h);return a}return t(_U,{"Array | Matrix":function(e){var t=QE(e)?e.size():PS(e);switch(t.length){case 1:if(1===t[0])return s(e,a);throw new RangeError("Matrix must be square (size: "+NS(t)+")");case 2:if(t[0]===t[1])return f(e);throw new RangeError("Matrix must be square (size: "+NS(t)+")");default:throw new RangeError("Matrix must be at most two dimensional (size: "+NS(t)+")")}}})}));function IU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function PU(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?IU(Object(r),!0).forEach((function(t){tS(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IU(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var BU=BD("Unit",["?on","config","addScalar","subtract","multiplyScalar","divideScalar","pow","abs","fix","round","equal","isNumeric","format","number","Complex","BigNumber","Fraction"],(e=>{var t,r,n,{on:i,config:s,addScalar:a,subtract:o,multiplyScalar:l,divideScalar:u,pow:c,abs:d,fix:h,round:f,equal:p,isNumeric:m,format:g,number:y,Complex:v,BigNumber:b,Fraction:w}=e,x=y;function E(e,t){if(!(this instanceof E))throw new Error("Constructor must be called with the new operator");if(null!=e&&!m(e)&&!WE(e))throw new TypeError("First parameter in Unit constructor must be number, BigNumber, Fraction, Complex, or undefined");if(this.fixPrefix=!1,this.skipAutomaticSimplification=!0,void 0===t)this.units=[],this.dimensions=L.map((e=>0));else if("string"==typeof t){var r=E.parse(t);this.units=r.units,this.dimensions=r.dimensions}else{if(!JE(t)||null!==t.value)throw new TypeError("Second parameter in Unit constructor must be a string or valueless Unit");this.fixPrefix=t.fixPrefix,this.skipAutomaticSimplification=t.skipAutomaticSimplification,this.dimensions=t.dimensions.slice(0),this.units=t.units.map((e=>zE({},e)))}this.value=this._normalize(e)}function D(){for(;" "===n||"\t"===n;)A()}function S(e){return e>="0"&&e<="9"}function A(){r++,n=t.charAt(r)}function T(e){r=e,n=t.charAt(r)}function C(){var e="",t=r;if("+"===n?A():"-"===n&&(e+=n,A()),!function(e){return e>="0"&&e<="9"||"."===e}(n))return T(t),null;if("."===n){if(e+=n,A(),!S(n))return T(t),null}else{for(;S(n);)e+=n,A();"."===n&&(e+=n,A())}for(;S(n);)e+=n,A();if("E"===n||"e"===n){var i="",s=r;if(i+=n,A(),"+"!==n&&"-"!==n||(i+=n,A()),!S(n))return T(s),e;for(e+=i;S(n);)e+=n,A()}return e}function N(){for(var e="";S(n)||E.isValidAlpha(n);)e+=n,A();var t=e.charAt(0);return E.isValidAlpha(t)?e:null}function k(e){return n===e?(A(),e):null}Object.defineProperty(E,"name",{value:"Unit"}),E.prototype.constructor=E,E.prototype.type="Unit",E.prototype.isUnit=!0,E.parse=function(e,i){if(i=i||{},r=-1,n="","string"!=typeof(t=e))throw new TypeError("Invalid argument in Unit.parse, string expected");var a=new E;a.units=[];var o=1,l=!1;A(),D();var u=C(),c=null;if(u){if("BigNumber"===s.number)c=new b(u);else if("Fraction"===s.number)try{c=new w(u)}catch(e){c=parseFloat(u)}else c=parseFloat(u);D(),k("*")?(o=1,l=!0):k("/")&&(o=-1,l=!0)}for(var d=[],h=1;;){for(D();"("===n;)d.push(o),h*=o,o=1,A(),D();var f=void 0;if(!n)break;var p=n;if(null===(f=N()))throw new SyntaxError('Unexpected "'+p+'" in "'+t+'" at index '+r.toString());var m=M(f);if(null===m)throw new SyntaxError('Unit "'+f+'" not found.');var g=o*h;if(D(),k("^")){D();var y=C();if(null===y)throw new SyntaxError('In "'+e+'", "^" must be followed by a floating-point number');g*=y}a.units.push({unit:m.unit,prefix:m.prefix,power:g});for(var v=0;v<L.length;v++)a.dimensions[v]+=(m.unit.dimensions[v]||0)*g;for(D();")"===n;){if(0===d.length)throw new SyntaxError('Unmatched ")" in "'+t+'" at index '+r.toString());h/=d.pop(),A(),D()}if(l=!1,k("*")?(o=1,l=!0):k("/")?(o=-1,l=!0):o=1,m.unit.base){var x=m.unit.base.key;$.auto[x]={unit:m.unit,prefix:m.prefix}}}if(D(),n)throw new SyntaxError('Could not parse: "'+e+'"');if(l)throw new SyntaxError('Trailing characters: "'+e+'"');if(0!==d.length)throw new SyntaxError('Unmatched "(" in "'+t+'"');if(0===a.units.length&&!i.allowNoUnits)throw new SyntaxError('"'+e+'" contains no units');return a.value=void 0!==c?a._normalize(c):null,a},E.prototype.clone=function(){var e=new E;e.fixPrefix=this.fixPrefix,e.skipAutomaticSimplification=this.skipAutomaticSimplification,e.value=_D(this.value),e.dimensions=this.dimensions.slice(0),e.units=[];for(var t=0;t<this.units.length;t++)for(var r in e.units[t]={},this.units[t])PD(this.units[t],r)&&(e.units[t][r]=this.units[t][r]);return e},E.prototype.valueType=function(){return FD(this.value)},E.prototype._isDerived=function(){return 0!==this.units.length&&(this.units.length>1||Math.abs(this.units[0].power-1)>1e-15)},E.prototype._normalize=function(e){if(null==e||0===this.units.length)return e;for(var t=e,r=E._getNumberConverter(FD(e)),n=0;n<this.units.length;n++){var i=r(this.units[n].unit.value),s=r(this.units[n].prefix.value),a=r(this.units[n].power);t=l(t,c(l(i,s),a))}return t},E.prototype._denormalize=function(e,t){if(null==e||0===this.units.length)return e;for(var r=e,n=E._getNumberConverter(FD(e)),i=0;i<this.units.length;i++){var s=n(this.units[i].unit.value),a=n(this.units[i].prefix.value),o=n(this.units[i].power);r=u(r,c(l(s,a),o))}return r};var M=Bk((e=>{if(PD(P,e)){var t=P[e];return{unit:t,prefix:t.prefixes[""]}}for(var r in P)if(PD(P,r)&&CS(e,r)){var n=P[r],i=e.length-r.length,s=e.substring(0,i),a=PD(n.prefixes,s)?n.prefixes[s]:void 0;if(void 0!==a)return{unit:n,prefix:a}}return null}),{hasher:e=>e[0],limit:100});function O(e){return e.equalBase(_.NONE)&&null!==e.value&&!s.predictable?e.value:e}E.isValuelessUnit=function(e){return null!==M(e)},E.prototype.hasBase=function(e){if("string"==typeof e&&(e=_[e]),!e)return!1;for(var t=0;t<L.length;t++)if(Math.abs((this.dimensions[t]||0)-(e.dimensions[t]||0))>1e-12)return!1;return!0},E.prototype.equalBase=function(e){for(var t=0;t<L.length;t++)if(Math.abs((this.dimensions[t]||0)-(e.dimensions[t]||0))>1e-12)return!1;return!0},E.prototype.equals=function(e){return this.equalBase(e)&&p(this.value,e.value)},E.prototype.multiply=function(e){for(var t=this.clone(),r=JE(e)?e:new E(e),n=0;n<L.length;n++)t.dimensions[n]=(this.dimensions[n]||0)+(r.dimensions[n]||0);for(var i=0;i<r.units.length;i++){var s=PU({},r.units[i]);t.units.push(s)}if(null!==this.value||null!==r.value){var a=null===this.value?this._normalize(1):this.value,o=null===r.value?r._normalize(1):r.value;t.value=l(a,o)}else t.value=null;return JE(e)&&(t.skipAutomaticSimplification=!1),O(t)},E.prototype.divideInto=function(e){return new E(e).divide(this)},E.prototype.divide=function(e){for(var t=this.clone(),r=JE(e)?e:new E(e),n=0;n<L.length;n++)t.dimensions[n]=(this.dimensions[n]||0)-(r.dimensions[n]||0);for(var i=0;i<r.units.length;i++){var s=PU(PU({},r.units[i]),{},{power:-r.units[i].power});t.units.push(s)}if(null!==this.value||null!==r.value){var a=null===this.value?this._normalize(1):this.value,o=null===r.value?r._normalize(1):r.value;t.value=u(a,o)}else t.value=null;return JE(e)&&(t.skipAutomaticSimplification=!1),O(t)},E.prototype.pow=function(e){for(var t=this.clone(),r=0;r<L.length;r++)t.dimensions[r]=(this.dimensions[r]||0)*e;for(var n=0;n<t.units.length;n++)t.units[n].power*=e;return null!==t.value?t.value=c(t.value,e):t.value=null,t.skipAutomaticSimplification=!1,O(t)},E.prototype.abs=function(){var e=this.clone();if(null!==e.value)if(e._isDerived()||0===e.units[0].unit.offset)e.value=d(e.value);else{var t=e._numberConverter(),r=t(e.units[0].unit.value),n=t(e.units[0].unit.offset),i=l(r,n);e.value=o(d(a(e.value,i)),i)}for(var s in e.units)"VA"!==e.units[s].unit.name&&"VAR"!==e.units[s].unit.name||(e.units[s].unit=P.W);return e},E.prototype.to=function(e){var t,r=null===this.value?this._normalize(1):this.value;if("string"==typeof e)t=E.parse(e);else{if(!JE(e))throw new Error("String or Unit expected as parameter");t=e.clone()}if(!this.equalBase(t))throw new Error("Units do not match ('".concat(t.toString(),"' != '").concat(this.toString(),"')"));if(null!==t.value)throw new Error("Cannot convert to a unit with a value");if(null===this.value||this._isDerived()||this.units[0].unit.offset===t.units[0].unit.offset)t.value=_D(r);else{var n=E._getNumberConverter(FD(r)),i=this.units[0].unit.value,s=this.units[0].unit.offset,u=l(i,s),c=t.units[0].unit.value,d=t.units[0].unit.offset,h=l(c,d);t.value=a(r,n(o(u,h)))}return t.fixPrefix=!0,t.skipAutomaticSimplification=!0,t},E.prototype.toNumber=function(e){return x(this.toNumeric(e))},E.prototype.toNumeric=function(e){var t;return(t=e?this.to(e):this.clone())._isDerived()||0===t.units.length?t._denormalize(t.value):t._denormalize(t.value,t.units[0].prefix.value)},E.prototype.toString=function(){return this.format()},E.prototype.toJSON=function(){return{mathjs:"Unit",value:this._denormalize(this.value),unit:this.formatUnits(),fixPrefix:this.fixPrefix}},E.fromJSON=function(e){var t=new E(e.value,e.unit);return t.fixPrefix=e.fixPrefix||!1,t},E.prototype.valueOf=E.prototype.toString,E.prototype.simplify=function(){var e,t,r=this.clone(),n=[];for(var i in z)if(PD(z,i)&&r.hasBase(_[i])){e=i;break}if("NONE"===e)r.units=[];else if(e&&PD(z,e)&&(t=z[e]),t)r.units=[{unit:t.unit,prefix:t.prefix,power:1}];else{for(var s=!1,a=0;a<L.length;a++){var o=L[a];Math.abs(r.dimensions[a]||0)>1e-12&&(PD(z,o)?n.push({unit:z[o].unit,prefix:z[o].prefix,power:r.dimensions[a]||0}):s=!0)}n.length<r.units.length&&!s&&(r.units=n)}return r},E.prototype.toSI=function(){for(var e=this.clone(),t=[],r=0;r<L.length;r++){var n=L[r];if(Math.abs(e.dimensions[r]||0)>1e-12){if(!PD($.si,n))throw new Error("Cannot express custom unit "+n+" in SI units");t.push({unit:$.si[n].unit,prefix:$.si[n].prefix,power:e.dimensions[r]||0})}}return e.units=t,e.fixPrefix=!0,e.skipAutomaticSimplification=!0,e},E.prototype.formatUnits=function(){for(var e="",t="",r=0,n=0,i=0;i<this.units.length;i++)this.units[i].power>0?(r++,e+=" "+this.units[i].prefix.name+this.units[i].unit.name,Math.abs(this.units[i].power-1)>1e-15&&(e+="^"+this.units[i].power)):this.units[i].power<0&&n++;if(n>0)for(var s=0;s<this.units.length;s++)this.units[s].power<0&&(r>0?(t+=" "+this.units[s].prefix.name+this.units[s].unit.name,Math.abs(this.units[s].power+1)>1e-15&&(t+="^"+-this.units[s].power)):(t+=" "+this.units[s].prefix.name+this.units[s].unit.name,t+="^"+this.units[s].power));e=e.substr(1),t=t.substr(1),r>1&&n>0&&(e="("+e+")"),n>1&&r>0&&(t="("+t+")");var a=e;return r>0&&n>0&&(a+=" / "),a+=t},E.prototype.format=function(e){var t=this.skipAutomaticSimplification||null===this.value?this.clone():this.simplify(),r=!1;for(var n in void 0!==t.value&&null!==t.value&&WE(t.value)&&(r=Math.abs(t.value.re)<1e-14),t.units)PD(t.units,n)&&t.units[n].unit&&("VA"===t.units[n].unit.name&&r?t.units[n].unit=P.VAR:"VAR"!==t.units[n].unit.name||r||(t.units[n].unit=P.VA));1!==t.units.length||t.fixPrefix||Math.abs(t.units[0].power-Math.round(t.units[0].power))<1e-14&&(t.units[0].prefix=t._bestPrefix());var i=t._denormalize(t.value),s=null!==t.value?g(i,e||{}):"",a=t.formatUnits();return t.value&&WE(t.value)&&(s="("+s+")"),a.length>0&&s.length>0&&(s+=" "),s+=a},E.prototype._bestPrefix=function(){if(1!==this.units.length)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");if(Math.abs(this.units[0].power-Math.round(this.units[0].power))>=1e-14)throw new Error("Can only compute the best prefix for single units with integer powers, like kg, s^2, N^-1, and so forth!");var e=null!==this.value?d(this.value):0,t=d(this.units[0].unit.value),r=this.units[0].prefix;if(0===e)return r;var n=this.units[0].power,i=Math.log(e/Math.pow(r.value*t,n))/Math.LN10-1.2;if(i>-2.200001&&i<1.800001)return r;i=Math.abs(i);var s=this.units[0].unit.prefixes;for(var a in s)if(PD(s,a)){var o=s[a];if(o.scientific){var l=Math.abs(Math.log(e/Math.pow(o.value*t,n))/Math.LN10-1.2);(l<i||l===i&&o.name.length<r.name.length)&&(r=o,i=l)}}return r},E.prototype.splitUnit=function(e){for(var t=this.clone(),r=[],n=0;n<e.length&&(t=t.to(e[n]),n!==e.length-1);n++){var i=t.toNumeric(),s=f(i),l=new E(p(s,i)?s:h(t.toNumeric()),e[n].toString());r.push(l),t=o(t,l)}for(var u=0,c=0;c<r.length;c++)u=a(u,r[c].value);return p(u,this.value)&&(t.value=0),r.push(t),r};var F={NONE:{"":{name:"",value:1,scientific:!0}},SHORT:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:10,scientific:!1},h:{name:"h",value:100,scientific:!1},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0},d:{name:"d",value:.1,scientific:!1},c:{name:"c",value:.01,scientific:!1},m:{name:"m",value:.001,scientific:!0},u:{name:"u",value:1e-6,scientific:!0},n:{name:"n",value:1e-9,scientific:!0},p:{name:"p",value:1e-12,scientific:!0},f:{name:"f",value:1e-15,scientific:!0},a:{name:"a",value:1e-18,scientific:!0},z:{name:"z",value:1e-21,scientific:!0},y:{name:"y",value:1e-24,scientific:!0}},LONG:{"":{name:"",value:1,scientific:!0},deca:{name:"deca",value:10,scientific:!1},hecto:{name:"hecto",value:100,scientific:!1},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0},deci:{name:"deci",value:.1,scientific:!1},centi:{name:"centi",value:.01,scientific:!1},milli:{name:"milli",value:.001,scientific:!0},micro:{name:"micro",value:1e-6,scientific:!0},nano:{name:"nano",value:1e-9,scientific:!0},pico:{name:"pico",value:1e-12,scientific:!0},femto:{name:"femto",value:1e-15,scientific:!0},atto:{name:"atto",value:1e-18,scientific:!0},zepto:{name:"zepto",value:1e-21,scientific:!0},yocto:{name:"yocto",value:1e-24,scientific:!0}},SQUARED:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:100,scientific:!1},h:{name:"h",value:1e4,scientific:!1},k:{name:"k",value:1e6,scientific:!0},M:{name:"M",value:1e12,scientific:!0},G:{name:"G",value:1e18,scientific:!0},T:{name:"T",value:1e24,scientific:!0},P:{name:"P",value:1e30,scientific:!0},E:{name:"E",value:1e36,scientific:!0},Z:{name:"Z",value:1e42,scientific:!0},Y:{name:"Y",value:1e48,scientific:!0},d:{name:"d",value:.01,scientific:!1},c:{name:"c",value:1e-4,scientific:!1},m:{name:"m",value:1e-6,scientific:!0},u:{name:"u",value:1e-12,scientific:!0},n:{name:"n",value:1e-18,scientific:!0},p:{name:"p",value:1e-24,scientific:!0},f:{name:"f",value:1e-30,scientific:!0},a:{name:"a",value:1e-36,scientific:!0},z:{name:"z",value:1e-42,scientific:!0},y:{name:"y",value:1e-48,scientific:!0}},CUBIC:{"":{name:"",value:1,scientific:!0},da:{name:"da",value:1e3,scientific:!1},h:{name:"h",value:1e6,scientific:!1},k:{name:"k",value:1e9,scientific:!0},M:{name:"M",value:1e18,scientific:!0},G:{name:"G",value:1e27,scientific:!0},T:{name:"T",value:1e36,scientific:!0},P:{name:"P",value:1e45,scientific:!0},E:{name:"E",value:1e54,scientific:!0},Z:{name:"Z",value:1e63,scientific:!0},Y:{name:"Y",value:1e72,scientific:!0},d:{name:"d",value:.001,scientific:!1},c:{name:"c",value:1e-6,scientific:!1},m:{name:"m",value:1e-9,scientific:!0},u:{name:"u",value:1e-18,scientific:!0},n:{name:"n",value:1e-27,scientific:!0},p:{name:"p",value:1e-36,scientific:!0},f:{name:"f",value:1e-45,scientific:!0},a:{name:"a",value:1e-54,scientific:!0},z:{name:"z",value:1e-63,scientific:!0},y:{name:"y",value:1e-72,scientific:!0}},BINARY_SHORT_SI:{"":{name:"",value:1,scientific:!0},k:{name:"k",value:1e3,scientific:!0},M:{name:"M",value:1e6,scientific:!0},G:{name:"G",value:1e9,scientific:!0},T:{name:"T",value:1e12,scientific:!0},P:{name:"P",value:1e15,scientific:!0},E:{name:"E",value:1e18,scientific:!0},Z:{name:"Z",value:1e21,scientific:!0},Y:{name:"Y",value:1e24,scientific:!0}},BINARY_SHORT_IEC:{"":{name:"",value:1,scientific:!0},Ki:{name:"Ki",value:1024,scientific:!0},Mi:{name:"Mi",value:Math.pow(1024,2),scientific:!0},Gi:{name:"Gi",value:Math.pow(1024,3),scientific:!0},Ti:{name:"Ti",value:Math.pow(1024,4),scientific:!0},Pi:{name:"Pi",value:Math.pow(1024,5),scientific:!0},Ei:{name:"Ei",value:Math.pow(1024,6),scientific:!0},Zi:{name:"Zi",value:Math.pow(1024,7),scientific:!0},Yi:{name:"Yi",value:Math.pow(1024,8),scientific:!0}},BINARY_LONG_SI:{"":{name:"",value:1,scientific:!0},kilo:{name:"kilo",value:1e3,scientific:!0},mega:{name:"mega",value:1e6,scientific:!0},giga:{name:"giga",value:1e9,scientific:!0},tera:{name:"tera",value:1e12,scientific:!0},peta:{name:"peta",value:1e15,scientific:!0},exa:{name:"exa",value:1e18,scientific:!0},zetta:{name:"zetta",value:1e21,scientific:!0},yotta:{name:"yotta",value:1e24,scientific:!0}},BINARY_LONG_IEC:{"":{name:"",value:1,scientific:!0},kibi:{name:"kibi",value:1024,scientific:!0},mebi:{name:"mebi",value:Math.pow(1024,2),scientific:!0},gibi:{name:"gibi",value:Math.pow(1024,3),scientific:!0},tebi:{name:"tebi",value:Math.pow(1024,4),scientific:!0},pebi:{name:"pebi",value:Math.pow(1024,5),scientific:!0},exi:{name:"exi",value:Math.pow(1024,6),scientific:!0},zebi:{name:"zebi",value:Math.pow(1024,7),scientific:!0},yobi:{name:"yobi",value:Math.pow(1024,8),scientific:!0}},BTU:{"":{name:"",value:1,scientific:!0},MM:{name:"MM",value:1e6,scientific:!0}}};F.SHORTLONG=zE({},F.SHORT,F.LONG),F.BINARY_SHORT=zE({},F.BINARY_SHORT_SI,F.BINARY_SHORT_IEC),F.BINARY_LONG=zE({},F.BINARY_LONG_SI,F.BINARY_LONG_IEC);var L=["MASS","LENGTH","TIME","CURRENT","TEMPERATURE","LUMINOUS_INTENSITY","AMOUNT_OF_SUBSTANCE","ANGLE","BIT"],_={NONE:{dimensions:[0,0,0,0,0,0,0,0,0]},MASS:{dimensions:[1,0,0,0,0,0,0,0,0]},LENGTH:{dimensions:[0,1,0,0,0,0,0,0,0]},TIME:{dimensions:[0,0,1,0,0,0,0,0,0]},CURRENT:{dimensions:[0,0,0,1,0,0,0,0,0]},TEMPERATURE:{dimensions:[0,0,0,0,1,0,0,0,0]},LUMINOUS_INTENSITY:{dimensions:[0,0,0,0,0,1,0,0,0]},AMOUNT_OF_SUBSTANCE:{dimensions:[0,0,0,0,0,0,1,0,0]},FORCE:{dimensions:[1,1,-2,0,0,0,0,0,0]},SURFACE:{dimensions:[0,2,0,0,0,0,0,0,0]},VOLUME:{dimensions:[0,3,0,0,0,0,0,0,0]},ENERGY:{dimensions:[1,2,-2,0,0,0,0,0,0]},POWER:{dimensions:[1,2,-3,0,0,0,0,0,0]},PRESSURE:{dimensions:[1,-1,-2,0,0,0,0,0,0]},ELECTRIC_CHARGE:{dimensions:[0,0,1,1,0,0,0,0,0]},ELECTRIC_CAPACITANCE:{dimensions:[-1,-2,4,2,0,0,0,0,0]},ELECTRIC_POTENTIAL:{dimensions:[1,2,-3,-1,0,0,0,0,0]},ELECTRIC_RESISTANCE:{dimensions:[1,2,-3,-2,0,0,0,0,0]},ELECTRIC_INDUCTANCE:{dimensions:[1,2,-2,-2,0,0,0,0,0]},ELECTRIC_CONDUCTANCE:{dimensions:[-1,-2,3,2,0,0,0,0,0]},MAGNETIC_FLUX:{dimensions:[1,2,-2,-1,0,0,0,0,0]},MAGNETIC_FLUX_DENSITY:{dimensions:[1,0,-2,-1,0,0,0,0,0]},FREQUENCY:{dimensions:[0,0,-1,0,0,0,0,0,0]},ANGLE:{dimensions:[0,0,0,0,0,0,0,1,0]},BIT:{dimensions:[0,0,0,0,0,0,0,0,1]}};for(var R in _)PD(_,R)&&(_[R].key=R);var I={name:"",base:{},value:1,offset:0,dimensions:L.map((e=>0))},P={meter:{name:"meter",base:_.LENGTH,prefixes:F.LONG,value:1,offset:0},inch:{name:"inch",base:_.LENGTH,prefixes:F.NONE,value:.0254,offset:0},foot:{name:"foot",base:_.LENGTH,prefixes:F.NONE,value:.3048,offset:0},yard:{name:"yard",base:_.LENGTH,prefixes:F.NONE,value:.9144,offset:0},mile:{name:"mile",base:_.LENGTH,prefixes:F.NONE,value:1609.344,offset:0},link:{name:"link",base:_.LENGTH,prefixes:F.NONE,value:.201168,offset:0},rod:{name:"rod",base:_.LENGTH,prefixes:F.NONE,value:5.0292,offset:0},chain:{name:"chain",base:_.LENGTH,prefixes:F.NONE,value:20.1168,offset:0},angstrom:{name:"angstrom",base:_.LENGTH,prefixes:F.NONE,value:1e-10,offset:0},m:{name:"m",base:_.LENGTH,prefixes:F.SHORT,value:1,offset:0},in:{name:"in",base:_.LENGTH,prefixes:F.NONE,value:.0254,offset:0},ft:{name:"ft",base:_.LENGTH,prefixes:F.NONE,value:.3048,offset:0},yd:{name:"yd",base:_.LENGTH,prefixes:F.NONE,value:.9144,offset:0},mi:{name:"mi",base:_.LENGTH,prefixes:F.NONE,value:1609.344,offset:0},li:{name:"li",base:_.LENGTH,prefixes:F.NONE,value:.201168,offset:0},rd:{name:"rd",base:_.LENGTH,prefixes:F.NONE,value:5.02921,offset:0},ch:{name:"ch",base:_.LENGTH,prefixes:F.NONE,value:20.1168,offset:0},mil:{name:"mil",base:_.LENGTH,prefixes:F.NONE,value:254e-7,offset:0},m2:{name:"m2",base:_.SURFACE,prefixes:F.SQUARED,value:1,offset:0},sqin:{name:"sqin",base:_.SURFACE,prefixes:F.NONE,value:64516e-8,offset:0},sqft:{name:"sqft",base:_.SURFACE,prefixes:F.NONE,value:.09290304,offset:0},sqyd:{name:"sqyd",base:_.SURFACE,prefixes:F.NONE,value:.83612736,offset:0},sqmi:{name:"sqmi",base:_.SURFACE,prefixes:F.NONE,value:2589988.110336,offset:0},sqrd:{name:"sqrd",base:_.SURFACE,prefixes:F.NONE,value:25.29295,offset:0},sqch:{name:"sqch",base:_.SURFACE,prefixes:F.NONE,value:404.6873,offset:0},sqmil:{name:"sqmil",base:_.SURFACE,prefixes:F.NONE,value:6.4516e-10,offset:0},acre:{name:"acre",base:_.SURFACE,prefixes:F.NONE,value:4046.86,offset:0},hectare:{name:"hectare",base:_.SURFACE,prefixes:F.NONE,value:1e4,offset:0},m3:{name:"m3",base:_.VOLUME,prefixes:F.CUBIC,value:1,offset:0},L:{name:"L",base:_.VOLUME,prefixes:F.SHORT,value:.001,offset:0},l:{name:"l",base:_.VOLUME,prefixes:F.SHORT,value:.001,offset:0},litre:{name:"litre",base:_.VOLUME,prefixes:F.LONG,value:.001,offset:0},cuin:{name:"cuin",base:_.VOLUME,prefixes:F.NONE,value:16387064e-12,offset:0},cuft:{name:"cuft",base:_.VOLUME,prefixes:F.NONE,value:.028316846592,offset:0},cuyd:{name:"cuyd",base:_.VOLUME,prefixes:F.NONE,value:.764554857984,offset:0},teaspoon:{name:"teaspoon",base:_.VOLUME,prefixes:F.NONE,value:5e-6,offset:0},tablespoon:{name:"tablespoon",base:_.VOLUME,prefixes:F.NONE,value:15e-6,offset:0},drop:{name:"drop",base:_.VOLUME,prefixes:F.NONE,value:5e-8,offset:0},gtt:{name:"gtt",base:_.VOLUME,prefixes:F.NONE,value:5e-8,offset:0},minim:{name:"minim",base:_.VOLUME,prefixes:F.NONE,value:6.161152e-8,offset:0},fluiddram:{name:"fluiddram",base:_.VOLUME,prefixes:F.NONE,value:36966911e-13,offset:0},fluidounce:{name:"fluidounce",base:_.VOLUME,prefixes:F.NONE,value:2957353e-11,offset:0},gill:{name:"gill",base:_.VOLUME,prefixes:F.NONE,value:.0001182941,offset:0},cc:{name:"cc",base:_.VOLUME,prefixes:F.NONE,value:1e-6,offset:0},cup:{name:"cup",base:_.VOLUME,prefixes:F.NONE,value:.0002365882,offset:0},pint:{name:"pint",base:_.VOLUME,prefixes:F.NONE,value:.0004731765,offset:0},quart:{name:"quart",base:_.VOLUME,prefixes:F.NONE,value:.0009463529,offset:0},gallon:{name:"gallon",base:_.VOLUME,prefixes:F.NONE,value:.003785412,offset:0},beerbarrel:{name:"beerbarrel",base:_.VOLUME,prefixes:F.NONE,value:.1173478,offset:0},oilbarrel:{name:"oilbarrel",base:_.VOLUME,prefixes:F.NONE,value:.1589873,offset:0},hogshead:{name:"hogshead",base:_.VOLUME,prefixes:F.NONE,value:.238481,offset:0},fldr:{name:"fldr",base:_.VOLUME,prefixes:F.NONE,value:36966911e-13,offset:0},floz:{name:"floz",base:_.VOLUME,prefixes:F.NONE,value:2957353e-11,offset:0},gi:{name:"gi",base:_.VOLUME,prefixes:F.NONE,value:.0001182941,offset:0},cp:{name:"cp",base:_.VOLUME,prefixes:F.NONE,value:.0002365882,offset:0},pt:{name:"pt",base:_.VOLUME,prefixes:F.NONE,value:.0004731765,offset:0},qt:{name:"qt",base:_.VOLUME,prefixes:F.NONE,value:.0009463529,offset:0},gal:{name:"gal",base:_.VOLUME,prefixes:F.NONE,value:.003785412,offset:0},bbl:{name:"bbl",base:_.VOLUME,prefixes:F.NONE,value:.1173478,offset:0},obl:{name:"obl",base:_.VOLUME,prefixes:F.NONE,value:.1589873,offset:0},g:{name:"g",base:_.MASS,prefixes:F.SHORT,value:.001,offset:0},gram:{name:"gram",base:_.MASS,prefixes:F.LONG,value:.001,offset:0},ton:{name:"ton",base:_.MASS,prefixes:F.SHORT,value:907.18474,offset:0},t:{name:"t",base:_.MASS,prefixes:F.SHORT,value:1e3,offset:0},tonne:{name:"tonne",base:_.MASS,prefixes:F.LONG,value:1e3,offset:0},grain:{name:"grain",base:_.MASS,prefixes:F.NONE,value:6479891e-11,offset:0},dram:{name:"dram",base:_.MASS,prefixes:F.NONE,value:.0017718451953125,offset:0},ounce:{name:"ounce",base:_.MASS,prefixes:F.NONE,value:.028349523125,offset:0},poundmass:{name:"poundmass",base:_.MASS,prefixes:F.NONE,value:.45359237,offset:0},hundredweight:{name:"hundredweight",base:_.MASS,prefixes:F.NONE,value:45.359237,offset:0},stick:{name:"stick",base:_.MASS,prefixes:F.NONE,value:.115,offset:0},stone:{name:"stone",base:_.MASS,prefixes:F.NONE,value:6.35029318,offset:0},gr:{name:"gr",base:_.MASS,prefixes:F.NONE,value:6479891e-11,offset:0},dr:{name:"dr",base:_.MASS,prefixes:F.NONE,value:.0017718451953125,offset:0},oz:{name:"oz",base:_.MASS,prefixes:F.NONE,value:.028349523125,offset:0},lbm:{name:"lbm",base:_.MASS,prefixes:F.NONE,value:.45359237,offset:0},cwt:{name:"cwt",base:_.MASS,prefixes:F.NONE,value:45.359237,offset:0},s:{name:"s",base:_.TIME,prefixes:F.SHORT,value:1,offset:0},min:{name:"min",base:_.TIME,prefixes:F.NONE,value:60,offset:0},h:{name:"h",base:_.TIME,prefixes:F.NONE,value:3600,offset:0},second:{name:"second",base:_.TIME,prefixes:F.LONG,value:1,offset:0},sec:{name:"sec",base:_.TIME,prefixes:F.LONG,value:1,offset:0},minute:{name:"minute",base:_.TIME,prefixes:F.NONE,value:60,offset:0},hour:{name:"hour",base:_.TIME,prefixes:F.NONE,value:3600,offset:0},day:{name:"day",base:_.TIME,prefixes:F.NONE,value:86400,offset:0},week:{name:"week",base:_.TIME,prefixes:F.NONE,value:604800,offset:0},month:{name:"month",base:_.TIME,prefixes:F.NONE,value:2629800,offset:0},year:{name:"year",base:_.TIME,prefixes:F.NONE,value:31557600,offset:0},decade:{name:"decade",base:_.TIME,prefixes:F.NONE,value:315576e3,offset:0},century:{name:"century",base:_.TIME,prefixes:F.NONE,value:315576e4,offset:0},millennium:{name:"millennium",base:_.TIME,prefixes:F.NONE,value:315576e5,offset:0},hertz:{name:"Hertz",base:_.FREQUENCY,prefixes:F.LONG,value:1,offset:0,reciprocal:!0},Hz:{name:"Hz",base:_.FREQUENCY,prefixes:F.SHORT,value:1,offset:0,reciprocal:!0},rad:{name:"rad",base:_.ANGLE,prefixes:F.SHORT,value:1,offset:0},radian:{name:"radian",base:_.ANGLE,prefixes:F.LONG,value:1,offset:0},deg:{name:"deg",base:_.ANGLE,prefixes:F.SHORT,value:null,offset:0},degree:{name:"degree",base:_.ANGLE,prefixes:F.LONG,value:null,offset:0},grad:{name:"grad",base:_.ANGLE,prefixes:F.SHORT,value:null,offset:0},gradian:{name:"gradian",base:_.ANGLE,prefixes:F.LONG,value:null,offset:0},cycle:{name:"cycle",base:_.ANGLE,prefixes:F.NONE,value:null,offset:0},arcsec:{name:"arcsec",base:_.ANGLE,prefixes:F.NONE,value:null,offset:0},arcmin:{name:"arcmin",base:_.ANGLE,prefixes:F.NONE,value:null,offset:0},A:{name:"A",base:_.CURRENT,prefixes:F.SHORT,value:1,offset:0},ampere:{name:"ampere",base:_.CURRENT,prefixes:F.LONG,value:1,offset:0},K:{name:"K",base:_.TEMPERATURE,prefixes:F.SHORT,value:1,offset:0},degC:{name:"degC",base:_.TEMPERATURE,prefixes:F.SHORT,value:1,offset:273.15},degF:{name:"degF",base:_.TEMPERATURE,prefixes:F.SHORT,value:new w(5,9),offset:459.67},degR:{name:"degR",base:_.TEMPERATURE,prefixes:F.SHORT,value:new w(5,9),offset:0},kelvin:{name:"kelvin",base:_.TEMPERATURE,prefixes:F.LONG,value:1,offset:0},celsius:{name:"celsius",base:_.TEMPERATURE,prefixes:F.LONG,value:1,offset:273.15},fahrenheit:{name:"fahrenheit",base:_.TEMPERATURE,prefixes:F.LONG,value:new w(5,9),offset:459.67},rankine:{name:"rankine",base:_.TEMPERATURE,prefixes:F.LONG,value:new w(5,9),offset:0},mol:{name:"mol",base:_.AMOUNT_OF_SUBSTANCE,prefixes:F.SHORT,value:1,offset:0},mole:{name:"mole",base:_.AMOUNT_OF_SUBSTANCE,prefixes:F.LONG,value:1,offset:0},cd:{name:"cd",base:_.LUMINOUS_INTENSITY,prefixes:F.SHORT,value:1,offset:0},candela:{name:"candela",base:_.LUMINOUS_INTENSITY,prefixes:F.LONG,value:1,offset:0},N:{name:"N",base:_.FORCE,prefixes:F.SHORT,value:1,offset:0},newton:{name:"newton",base:_.FORCE,prefixes:F.LONG,value:1,offset:0},dyn:{name:"dyn",base:_.FORCE,prefixes:F.SHORT,value:1e-5,offset:0},dyne:{name:"dyne",base:_.FORCE,prefixes:F.LONG,value:1e-5,offset:0},lbf:{name:"lbf",base:_.FORCE,prefixes:F.NONE,value:4.4482216152605,offset:0},poundforce:{name:"poundforce",base:_.FORCE,prefixes:F.NONE,value:4.4482216152605,offset:0},kip:{name:"kip",base:_.FORCE,prefixes:F.LONG,value:4448.2216,offset:0},kilogramforce:{name:"kilogramforce",base:_.FORCE,prefixes:F.NONE,value:9.80665,offset:0},J:{name:"J",base:_.ENERGY,prefixes:F.SHORT,value:1,offset:0},joule:{name:"joule",base:_.ENERGY,prefixes:F.SHORT,value:1,offset:0},erg:{name:"erg",base:_.ENERGY,prefixes:F.NONE,value:1e-7,offset:0},Wh:{name:"Wh",base:_.ENERGY,prefixes:F.SHORT,value:3600,offset:0},BTU:{name:"BTU",base:_.ENERGY,prefixes:F.BTU,value:1055.05585262,offset:0},eV:{name:"eV",base:_.ENERGY,prefixes:F.SHORT,value:1602176565e-28,offset:0},electronvolt:{name:"electronvolt",base:_.ENERGY,prefixes:F.LONG,value:1602176565e-28,offset:0},W:{name:"W",base:_.POWER,prefixes:F.SHORT,value:1,offset:0},watt:{name:"watt",base:_.POWER,prefixes:F.LONG,value:1,offset:0},hp:{name:"hp",base:_.POWER,prefixes:F.NONE,value:745.6998715386,offset:0},VAR:{name:"VAR",base:_.POWER,prefixes:F.SHORT,value:v.I,offset:0},VA:{name:"VA",base:_.POWER,prefixes:F.SHORT,value:1,offset:0},Pa:{name:"Pa",base:_.PRESSURE,prefixes:F.SHORT,value:1,offset:0},psi:{name:"psi",base:_.PRESSURE,prefixes:F.NONE,value:6894.75729276459,offset:0},atm:{name:"atm",base:_.PRESSURE,prefixes:F.NONE,value:101325,offset:0},bar:{name:"bar",base:_.PRESSURE,prefixes:F.SHORTLONG,value:1e5,offset:0},torr:{name:"torr",base:_.PRESSURE,prefixes:F.NONE,value:133.322,offset:0},mmHg:{name:"mmHg",base:_.PRESSURE,prefixes:F.NONE,value:133.322,offset:0},mmH2O:{name:"mmH2O",base:_.PRESSURE,prefixes:F.NONE,value:9.80665,offset:0},cmH2O:{name:"cmH2O",base:_.PRESSURE,prefixes:F.NONE,value:98.0665,offset:0},coulomb:{name:"coulomb",base:_.ELECTRIC_CHARGE,prefixes:F.LONG,value:1,offset:0},C:{name:"C",base:_.ELECTRIC_CHARGE,prefixes:F.SHORT,value:1,offset:0},farad:{name:"farad",base:_.ELECTRIC_CAPACITANCE,prefixes:F.LONG,value:1,offset:0},F:{name:"F",base:_.ELECTRIC_CAPACITANCE,prefixes:F.SHORT,value:1,offset:0},volt:{name:"volt",base:_.ELECTRIC_POTENTIAL,prefixes:F.LONG,value:1,offset:0},V:{name:"V",base:_.ELECTRIC_POTENTIAL,prefixes:F.SHORT,value:1,offset:0},ohm:{name:"ohm",base:_.ELECTRIC_RESISTANCE,prefixes:F.SHORTLONG,value:1,offset:0},henry:{name:"henry",base:_.ELECTRIC_INDUCTANCE,prefixes:F.LONG,value:1,offset:0},H:{name:"H",base:_.ELECTRIC_INDUCTANCE,prefixes:F.SHORT,value:1,offset:0},siemens:{name:"siemens",base:_.ELECTRIC_CONDUCTANCE,prefixes:F.LONG,value:1,offset:0},S:{name:"S",base:_.ELECTRIC_CONDUCTANCE,prefixes:F.SHORT,value:1,offset:0},weber:{name:"weber",base:_.MAGNETIC_FLUX,prefixes:F.LONG,value:1,offset:0},Wb:{name:"Wb",base:_.MAGNETIC_FLUX,prefixes:F.SHORT,value:1,offset:0},tesla:{name:"tesla",base:_.MAGNETIC_FLUX_DENSITY,prefixes:F.LONG,value:1,offset:0},T:{name:"T",base:_.MAGNETIC_FLUX_DENSITY,prefixes:F.SHORT,value:1,offset:0},b:{name:"b",base:_.BIT,prefixes:F.BINARY_SHORT,value:1,offset:0},bits:{name:"bits",base:_.BIT,prefixes:F.BINARY_LONG,value:1,offset:0},B:{name:"B",base:_.BIT,prefixes:F.BINARY_SHORT,value:8,offset:0},bytes:{name:"bytes",base:_.BIT,prefixes:F.BINARY_LONG,value:8,offset:0}},B={meters:"meter",inches:"inch",feet:"foot",yards:"yard",miles:"mile",links:"link",rods:"rod",chains:"chain",angstroms:"angstrom",lt:"l",litres:"litre",liter:"litre",liters:"litre",teaspoons:"teaspoon",tablespoons:"tablespoon",minims:"minim",fluiddrams:"fluiddram",fluidounces:"fluidounce",gills:"gill",cups:"cup",pints:"pint",quarts:"quart",gallons:"gallon",beerbarrels:"beerbarrel",oilbarrels:"oilbarrel",hogsheads:"hogshead",gtts:"gtt",grams:"gram",tons:"ton",tonnes:"tonne",grains:"grain",drams:"dram",ounces:"ounce",poundmasses:"poundmass",hundredweights:"hundredweight",sticks:"stick",lb:"lbm",lbs:"lbm",kips:"kip",kgf:"kilogramforce",acres:"acre",hectares:"hectare",sqfeet:"sqft",sqyard:"sqyd",sqmile:"sqmi",sqmiles:"sqmi",mmhg:"mmHg",mmh2o:"mmH2O",cmh2o:"cmH2O",seconds:"second",secs:"second",minutes:"minute",mins:"minute",hours:"hour",hr:"hour",hrs:"hour",days:"day",weeks:"week",months:"month",years:"year",decades:"decade",centuries:"century",millennia:"millennium",hertz:"hertz",radians:"radian",degrees:"degree",gradians:"gradian",cycles:"cycle",arcsecond:"arcsec",arcseconds:"arcsec",arcminute:"arcmin",arcminutes:"arcmin",BTUs:"BTU",watts:"watt",joules:"joule",amperes:"ampere",amps:"ampere",amp:"ampere",coulombs:"coulomb",volts:"volt",ohms:"ohm",farads:"farad",webers:"weber",teslas:"tesla",electronvolts:"electronvolt",moles:"mole",bit:"bits",byte:"bytes"};function U(e){if("BigNumber"===e.number){var t=jk(b);P.rad.value=new b(1),P.deg.value=t.div(180),P.grad.value=t.div(200),P.cycle.value=t.times(2),P.arcsec.value=t.div(648e3),P.arcmin.value=t.div(10800)}else P.rad.value=1,P.deg.value=Math.PI/180,P.grad.value=Math.PI/200,P.cycle.value=2*Math.PI,P.arcsec.value=Math.PI/648e3,P.arcmin.value=Math.PI/10800;P.radian.value=P.rad.value,P.degree.value=P.deg.value,P.gradian.value=P.grad.value}U(s),i&&i("config",(function(e,t){e.number!==t.number&&U(e)}));var $={si:{NONE:{unit:I,prefix:F.NONE[""]},LENGTH:{unit:P.m,prefix:F.SHORT[""]},MASS:{unit:P.g,prefix:F.SHORT.k},TIME:{unit:P.s,prefix:F.SHORT[""]},CURRENT:{unit:P.A,prefix:F.SHORT[""]},TEMPERATURE:{unit:P.K,prefix:F.SHORT[""]},LUMINOUS_INTENSITY:{unit:P.cd,prefix:F.SHORT[""]},AMOUNT_OF_SUBSTANCE:{unit:P.mol,prefix:F.SHORT[""]},ANGLE:{unit:P.rad,prefix:F.SHORT[""]},BIT:{unit:P.bits,prefix:F.SHORT[""]},FORCE:{unit:P.N,prefix:F.SHORT[""]},ENERGY:{unit:P.J,prefix:F.SHORT[""]},POWER:{unit:P.W,prefix:F.SHORT[""]},PRESSURE:{unit:P.Pa,prefix:F.SHORT[""]},ELECTRIC_CHARGE:{unit:P.C,prefix:F.SHORT[""]},ELECTRIC_CAPACITANCE:{unit:P.F,prefix:F.SHORT[""]},ELECTRIC_POTENTIAL:{unit:P.V,prefix:F.SHORT[""]},ELECTRIC_RESISTANCE:{unit:P.ohm,prefix:F.SHORT[""]},ELECTRIC_INDUCTANCE:{unit:P.H,prefix:F.SHORT[""]},ELECTRIC_CONDUCTANCE:{unit:P.S,prefix:F.SHORT[""]},MAGNETIC_FLUX:{unit:P.Wb,prefix:F.SHORT[""]},MAGNETIC_FLUX_DENSITY:{unit:P.T,prefix:F.SHORT[""]},FREQUENCY:{unit:P.Hz,prefix:F.SHORT[""]}}};$.cgs=JSON.parse(JSON.stringify($.si)),$.cgs.LENGTH={unit:P.m,prefix:F.SHORT.c},$.cgs.MASS={unit:P.g,prefix:F.SHORT[""]},$.cgs.FORCE={unit:P.dyn,prefix:F.SHORT[""]},$.cgs.ENERGY={unit:P.erg,prefix:F.NONE[""]},$.us=JSON.parse(JSON.stringify($.si)),$.us.LENGTH={unit:P.ft,prefix:F.NONE[""]},$.us.MASS={unit:P.lbm,prefix:F.NONE[""]},$.us.TEMPERATURE={unit:P.degF,prefix:F.NONE[""]},$.us.FORCE={unit:P.lbf,prefix:F.NONE[""]},$.us.ENERGY={unit:P.BTU,prefix:F.BTU[""]},$.us.POWER={unit:P.hp,prefix:F.NONE[""]},$.us.PRESSURE={unit:P.psi,prefix:F.NONE[""]},$.auto=JSON.parse(JSON.stringify($.si));var z=$.auto;for(var j in E.setUnitSystem=function(e){if(!PD($,e))throw new Error("Unit system "+e+" does not exist. Choices are: "+Object.keys($).join(", "));z=$[e]},E.getUnitSystem=function(){for(var e in $)if(PD($,e)&&$[e]===z)return e},E.typeConverters={BigNumber:function(e){return null!=e&&e.isFraction?new b(e.n).div(e.d).times(e.s):new b(e+"")},Fraction:function(e){return new w(e)},Complex:function(e){return e},number:function(e){return null!=e&&e.isFraction?y(e):e}},E.prototype._numberConverter=function(){var e=E.typeConverters[this.valueType()];if(e)return e;throw new TypeError('Unsupported Unit value type "'+this.valueType()+'"')},E._getNumberConverter=function(e){if(!E.typeConverters[e])throw new TypeError('Unsupported type "'+e+'"');return E.typeConverters[e]},P)if(PD(P,j)){var q=P[j];q.dimensions=q.base.dimensions}for(var H in B)if(PD(B,H)){var V=P[B[H]],G={};for(var K in V)PD(V,K)&&(G[K]=V[K]);G.name=H,P[H]=G}return E.isValidAlpha=function(e){return/^[a-zA-Z]$/.test(e)},E.createUnit=function(e,t){if("object"!=typeof e)throw new TypeError("createUnit expects first parameter to be of type 'Object'");if(t&&t.override)for(var r in e)if(PD(e,r)&&E.deleteUnit(r),e[r].aliases)for(var n=0;n<e[r].aliases.length;n++)E.deleteUnit(e[r].aliases[n]);var i;for(var s in e)PD(e,s)&&(i=E.createUnitSingle(s,e[s]));return i},E.createUnitSingle=function(e,t){if(null==t&&(t={}),"string"!=typeof e)throw new TypeError("createUnitSingle expects first parameter to be of type 'string'");if(PD(P,e))throw new Error('Cannot create unit "'+e+'": a unit with that name already exists');!function(e){for(var t=0;t<e.length;t++){if(n=e.charAt(t),0===t&&!E.isValidAlpha(n))throw new Error('Invalid unit name (must begin with alpha character): "'+e+'"');if(t>0&&!E.isValidAlpha(n)&&!S(n))throw new Error('Invalid unit name (only alphanumeric characters are allowed): "'+e+'"')}}(e);var r,i,s,a=null,o=[],l=0;if(t&&"Unit"===t.type)a=t.clone();else if("string"==typeof t)""!==t&&(r=t);else{if("object"!=typeof t)throw new TypeError('Cannot create unit "'+e+'" from "'+t.toString()+'": expecting "string" or "Unit" or "Object"');r=t.definition,i=t.prefixes,l=t.offset,s=t.baseName,t.aliases&&(o=t.aliases.valueOf())}if(o)for(var u=0;u<o.length;u++)if(PD(P,o[u]))throw new Error('Cannot create alias "'+o[u]+'": a unit with that name already exists');if(r&&"string"==typeof r&&!a)try{a=E.parse(r,{allowNoUnits:!0})}catch(t){throw t.message='Could not create unit "'+e+'" from "'+r+'": '+t.message,t}else r&&"Unit"===r.type&&(a=r.clone());o=o||[],l=l||0,i=i&&i.toUpperCase&&F[i.toUpperCase()]||F.NONE;var c={};if(a){c={name:e,value:a.value,dimensions:a.dimensions.slice(0),prefixes:i,offset:l};var d=!1;for(var h in _)if(PD(_,h)){for(var f=!0,p=0;p<L.length;p++)if(Math.abs((c.dimensions[p]||0)-(_[h].dimensions[p]||0))>1e-12){f=!1;break}if(f){d=!0,c.base=_[h];break}}if(!d){s=s||e+"_STUFF";var m={dimensions:a.dimensions.slice(0)};m.key=s,_[s]=m,z[s]={unit:c,prefix:F.NONE[""]},c.base=_[s]}}else{if(s=s||e+"_STUFF",L.indexOf(s)>=0)throw new Error('Cannot create new base unit "'+e+'": a base unit with that name already exists (and cannot be overridden)');for(var g in L.push(s),_)PD(_,g)&&(_[g].dimensions[L.length-1]=0);for(var y={dimensions:[]},v=0;v<L.length;v++)y.dimensions[v]=0;y.dimensions[L.length-1]=1,y.key=s,_[s]=y,c={name:e,value:1,dimensions:_[s].dimensions.slice(0),prefixes:i,offset:l,base:_[s]},z[s]={unit:c,prefix:F.NONE[""]}}E.UNITS[e]=c;for(var b=0;b<o.length;b++){var w=o[b],x={};for(var D in c)PD(c,D)&&(x[D]=c[D]);x.name=w,E.UNITS[w]=x}return delete M.cache,new E(null,e)},E.deleteUnit=function(e){delete E.UNITS[e]},E.PREFIXES=F,E.BASE_DIMENSIONS=L,E.BASE_UNITS=_,E.UNIT_SYSTEMS=$,E.UNITS=P,E}),{isClass:!0}),UU="createUnit",$U=BD(UU,["typed","Unit"],(e=>{var{typed:t,Unit:r}=e;return t(UU,{"Object, Object":function(e,t){return r.createUnit(e,t)},Object:function(e){return r.createUnit(e,{})},"string, Unit | string | Object, Object":function(e,t,n){var i={};return i[e]=t,r.createUnit(i,n)},"string, Unit | string | Object":function(e,t){var n={};return n[e]=t,r.createUnit(n,{})},string:function(e){var t={};return t[e]={},r.createUnit(t,{})}})})),zU="dotPow",jU=BD(zU,["typed","equalScalar","matrix","pow","DenseMatrix","concat"],(e=>{var{typed:t,equalScalar:r,matrix:n,pow:i,DenseMatrix:s,concat:a}=e,o=nI({typed:t}),l=iI({typed:t,DenseMatrix:s}),u=sI({typed:t,equalScalar:r}),c=aI({typed:t,DenseMatrix:s}),d=cI({typed:t,matrix:n,concat:a}),h={};for(var f in i.signatures)Object.prototype.hasOwnProperty.call(i.signatures,f)&&(f.includes("Matrix")||f.includes("Array")||(h[f]=i.signatures[f]));var p=t(h);return t(zU,d({elop:p,SS:l,DS:o,Ss:u,sS:c}))})),qU="expm",HU=BD(qU,["typed","abs","add","identity","inv","multiply"],(e=>{var{typed:t,abs:r,add:n,identity:i,inv:s,multiply:a}=e;return t(qU,{Matrix:function(e){var t=e.size();if(2!==t.length||t[0]!==t[1])throw new RangeError("Matrix must be square (size: "+NS(t)+")");for(var l=t[0],u=function(e){for(var t=e.size()[0],n=0,i=0;i<t;i++){for(var s=0,a=0;a<t;a++)s+=r(e.get([i,a]));n=Math.max(s,n)}return n}(e),c=function(e,t){for(var r=30,n=0;n<r;n++)for(var i=0;i<=n;i++){var s=n-i;if(o(e,i,s)<t)return{q:i,j:s}}throw new Error("Could not find acceptable parameters to compute the matrix exponential (try increasing maxSearchSize in expm.js)")}(u,1e-15),d=c.q,h=c.j,f=a(e,Math.pow(2,-h)),p=i(l),m=i(l),g=1,y=f,v=-1,b=1;b<=d;b++)b>1&&(y=a(y,f),v=-v),p=n(p,a(g=g*(d-b+1)/((2*d-b+1)*b),y)),m=n(m,a(g*v,y));for(var w=a(s(m),p),x=0;x<h;x++)w=a(w,w);return rD(e)?e.createSparseMatrix(w):w}});function o(e,t,r){for(var n=1,i=2;i<=t;i++)n*=i;for(var s=n,a=t+1;a<=2*t;a++)s*=a;var o=s*(2*t+1);return 8*Math.pow(e/Math.pow(2,r),2*t)*n*n/(s*o)}})),VU=BD("fft",["typed","matrix","addScalar","multiplyScalar","divideScalar","exp","tau","i","dotDivide","conj","pow","ceil","log2"],(e=>{var{typed:t,matrix:r,addScalar:n,multiplyScalar:i,divideScalar:s,exp:a,tau:o,i:l,dotDivide:u,conj:c,pow:d,ceil:h,log2:f}=e;return t("fft",{Array:p,Matrix:function(e){return e.create(p(e.toArray()))}});function p(e){var t=PS(e);return 1===t.length?g(e,t[0]):m(e.map((e=>p(e,t.slice(1)))),0)}function m(e,t){var r=PS(e);if(0!==t)return new Array(r[0]).fill(0).map(((r,n)=>m(e[n],t-1)));if(1===r.length)return g(e);function n(e){var t=PS(e);return new Array(t[1]).fill(0).map(((r,n)=>new Array(t[0]).fill(0).map(((t,r)=>e[r][n]))))}return n(m(n(e),1))}function g(e){var t=e.length;if(1===t)return[e[0]];if(t%2==0){for(var r=[...g(e.filter(((e,t)=>t%2==0))),...g(e.filter(((e,t)=>t%2==1)))],m=0;m<t/2;m++){var y=r[m],v=i(r[m+t/2],a(i(i(o,l),s(-m,t))));r[m]=n(y,v),r[m+t/2]=n(y,i(-1,v))}return r}return function(e){for(var t=e.length,r=a(s(i(-1,i(l,o)),t)),n=[],m=1-t;m<t;m++)n.push(d(r,s(d(m,2),2)));for(var y=d(2,h(f(t+t-1))),v=[...new Array(t).fill(0).map(((r,s)=>i(e[s],n[t-1+s]))),...new Array(y-t).fill(0)],b=[...new Array(t+t-1).fill(0).map(((e,t)=>s(1,n[t]))),...new Array(y-(t+t-1)).fill(0)],w=g(v),x=g(b),E=new Array(y).fill(0).map(((e,t)=>i(w[t],x[t]))),D=u(c(p(c(E))),y),S=[],A=t-1;A<t+t-1;A++)S.push(i(D[A],n[A]));return S}(e)}})),GU="gamma",KU=BD(GU,["typed","config","multiplyScalar","pow","BigNumber","Complex"],(e=>{var{typed:t,config:r,multiplyScalar:n,pow:i,BigNumber:s,Complex:a}=e;return t(GU,{number:KL,Complex:function e(t){if(0===t.im)return KL(t.re);if(t.re<.5){var r=new a(1-t.re,-t.im),n=new a(Math.PI*t.re,Math.PI*t.im);return new a(Math.PI).div(n.sin()).div(e(r))}t=new a(t.re-1,t.im);for(var i=new a(YL[0],0),s=1;s<YL.length;++s){var o=new a(YL[s],0);i=i.add(o.div(t.add(s)))}var l=new a(t.re+WL+.5,t.im),u=Math.sqrt(2*Math.PI),c=l.pow(t.add(.5)),d=l.neg().exp();return i.mul(u).mul(c).mul(d)},BigNumber:function(e){if(e.isInteger())return e.isNegative()||e.isZero()?new s(1/0):o(e.minus(1));if(!e.isFinite())return new s(e.isNegative()?NaN:1/0);throw new Error("Integer BigNumber expected")}});function o(e){if(e<8)return new s([1,1,2,6,24,120,720,5040][e]);var t=r.precision+(0|Math.log(e.toNumber())),n=s.clone({precision:t});if(e%2==1)return e.times(o(new s(e-1)));for(var i=e,a=new n(e),l=e.toNumber();i>2;)l+=i-=2,a=a.times(l);return new s(a.toPrecision(s.precision))}})),WU="ifft",YU=BD(WU,["typed","fft","dotDivide","conj"],(e=>{var{typed:t,fft:r,dotDivide:n,conj:i}=e;return t(WU,{"Array | Matrix":function(e){var t=QE(e)?e.size():PS(e);return n(i(r(i(e))),t.reduce(((e,t)=>e*t),1))}})})),JU=BD("divide",["typed","matrix","multiply","equalScalar","divideScalar","inv"],(e=>{var{typed:t,matrix:r,multiply:n,equalScalar:i,divideScalar:s,inv:a}=e,o=sI({typed:t,equalScalar:i}),l=lI({typed:t});return t("divide",RD({"Array | Matrix, Array | Matrix":function(e,t){return n(e,a(t))},"DenseMatrix, any":function(e,t){return l(e,t,s,!1)},"SparseMatrix, any":function(e,t){return o(e,t,s,!1)},"Array, any":function(e,t){return l(r(e),t,s,!1).valueOf()},"any, Array | Matrix":function(e,t){return n(e,a(t))}},s.signatures))})),ZU="factorial",XU=BD(ZU,["typed","gamma"],(e=>{var{typed:t,gamma:r}=e;return t(ZU,{number:function(e){if(e<0)throw new Error("Value must be non-negative");return r(e+1)},BigNumber:function(e){if(e.isNegative())throw new Error("Value must be non-negative");return r(e.plus(1))},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})}));function QU(e,t){var r,n=t.length,i=[];if(e)for(r=0;r<n;r++)i[e[r]]=t[r];else for(r=0;r<n;r++)i[r]=t[r];return i}var e$="lusolve",t$=BD(e$,["typed","matrix","lup","slu","usolve","lsolve","DenseMatrix"],(e=>{var{typed:t,matrix:r,lup:n,slu:i,usolve:s,lsolve:a,DenseMatrix:o}=e,l=iB({DenseMatrix:o});return t(e$,{"Array, Array | Matrix":function(e,t){e=r(e);var i=n(e);return c(i.L,i.U,i.p,null,t).valueOf()},"DenseMatrix, Array | Matrix":function(e,t){var r=n(e);return c(r.L,r.U,r.p,null,t)},"SparseMatrix, Array | Matrix":function(e,t){var r=n(e);return c(r.L,r.U,r.p,null,t)},"SparseMatrix, Array | Matrix, number, number":function(e,t,r,n){var s=i(e,r,n);return c(s.L,s.U,s.p,s.q,t)},"Object, Array | Matrix":function(e,t){return c(e.L,e.U,e.p,e.q,t)}});function u(e){if(QE(e))return e;if(XE(e))return r(e);throw new TypeError("Invalid Matrix LU decomposition")}function c(e,t,r,n,i){e=u(e),t=u(t),r&&((i=l(e,i,!0))._data=QU(r,i._data));var o=a(e,i),c=s(t,o);return n&&(c._data=QU(n,c._data)),c}})),r$="multinomial",n$=BD(r$,["typed","add","divide","multiply","factorial","isInteger","isPositive"],(e=>{var{typed:t,add:r,divide:n,multiply:i,factorial:s,isInteger:a,isPositive:o}=e;return t(r$,{"Array | Matrix":function(e){var t=0,l=1;return QA(e,(function(e){if(!a(e)||!o(e))throw new TypeError("Positive integer value expected in function multinomial");t=r(t,e),l=i(l,s(e))})),n(s(t),l)}})})),i$="permutations",s$=BD(i$,["typed","factorial"],(e=>{var{typed:t,factorial:r}=e;return t(i$,{"number | BigNumber":r,"number, number":function(e,t){if(!rS(e)||e<0)throw new TypeError("Positive integer value expected in function permutations");if(!rS(t)||t<0)throw new TypeError("Positive integer value expected in function permutations");if(t>e)throw new TypeError("second argument k must be less than or equal to first argument n");return WF(e-t+1,e)},"BigNumber, BigNumber":function(e,t){var r,n;if(!a$(e)||!a$(t))throw new TypeError("Positive integer value expected in function permutations");if(t.gt(e))throw new TypeError("second argument k must be less than or equal to first argument n");for(r=e.mul(0).add(1),n=e.minus(t).plus(1);n.lte(e);n=n.plus(1))r=r.times(n);return r}})}));function a$(e){return e.isInteger()&&e.gte(0)}var o$="polynomialRoot",l$=BD(o$,["typed","isZero","equalScalar","add","subtract","multiply","divide","sqrt","unaryMinus","cbrt","typeOf","im","re"],(e=>{var{typed:t,isZero:r,equalScalar:n,add:i,subtract:s,multiply:a,divide:o,sqrt:l,unaryMinus:u,cbrt:c,typeOf:d,im:h,re:f}=e;return t(o$,{"number|Complex, ...number|Complex":(e,t)=>{for(var p=[e,...t];p.length>0&&r(p[p.length-1]);)p.pop();if(p.length<2)throw new RangeError("Polynomial [".concat(e,", ").concat(t,"] must have a non-zero non-constant coefficient"));switch(p.length){case 2:return[u(o(p[0],p[1]))];case 3:var[m,g,y]=p,v=a(2,y),b=a(g,g),w=a(4,y,m);if(n(b,w))return[o(u(g),v)];var x=l(s(b,w));return[o(s(x,g),v),o(s(u(x),g),v)];case 4:var[E,D,S,A]=p,T=u(a(3,A)),C=a(S,S),N=a(3,A,D),k=i(a(2,S,S,S),a(27,A,A,E)),M=a(9,A,S,D);if(n(C,N)&&n(k,M))return[o(S,T)];var O,F=s(C,N),L=s(k,M),_=i(a(18,A,S,D,E),a(S,S,D,D)),R=i(a(4,S,S,S,E),a(4,A,D,D,D),a(27,A,A,E,E));if(n(_,R))return[o(s(a(4,A,S,D),i(a(9,A,A,E),a(S,S,S))),a(A,F)),o(s(a(9,A,E),a(S,D)),a(2,F))];O=n(C,N)?L:o(i(L,l(s(a(L,L),a(4,F,F,F)))),2);return c(O,!0).toArray().map((e=>o(i(S,e,o(F,e)),T))).map((e=>"Complex"===d(e)&&n(f(e),f(e)+h(e))?f(e):e));default:throw new RangeError("only implemented for cubic or lower-order polynomials, not ".concat(p))}}})})),u$="setSize",c$=BD(u$,["typed","compareNatural"],(e=>{var{typed:t,compareNatural:r}=e;return t(u$,{"Array | Matrix":function(e){return Array.isArray(e)?JS(e).length:JS(e.toArray()).length},"Array | Matrix, boolean":function(e,t){if(!1===t||0===e.length)return Array.isArray(e)?JS(e).length:JS(e.toArray()).length;for(var n=JS(Array.isArray(e)?e:e.toArray()).sort(r),i=1,s=1;s<n.length;s++)0!==r(n[s],n[s-1])&&i++;return i}})}));function d$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var h$=BD("solveODE",["typed","add","subtract","multiply","divide","max","map","abs","isPositive","isNegative","larger","smaller","matrix","bignumber","unaryMinus"],(e=>{var{typed:t,add:r,subtract:n,multiply:i,divide:s,max:a,map:o,abs:l,isPositive:u,isNegative:c,larger:d,smaller:h,matrix:f,bignumber:p,unaryMinus:m}=e;function g(e){return function(t,f,g,y){if(!(2===f.length&&(f.every(w)||f.every(JE))))throw new Error('"tspan" must be an Array of two numeric values or two units [tStart, tEnd]');var v=f[0],b=f[1],x=d(b,v),E=y.firstStep;if(void 0!==E&&!u(E))throw new Error('"firstStep" must be positive');var D=y.maxStep;if(void 0!==D&&!u(D))throw new Error('"maxStep" must be positive');var S=y.minStep;if(S&&c(S))throw new Error('"minStep" must be positive or zero');var A=[v,b,E,S,D].filter((e=>void 0!==e));if(!A.every(w)&&!A.every(JE))throw new Error('Inconsistent type of "t" dependant variables');for(var T=y.tol?y.tol:1e-4,C=y.minDelta?y.minDelta:.2,N=y.maxDelta?y.maxDelta:5,k=y.maxIter?y.maxIter:1e4,M=[v,b,...g,D,S].some(KE),[O,F,L,_]=M?[p(e.a),p(e.c),p(e.b),p(e.bp)]:[e.a,e.c,e.b,e.bp],R=E?x?E:m(E):s(n(b,v),1),I=[v],P=[g],B=n(L,_),U=0,$=0,z=function(e){return e?h:d}(x),j=function(e){var t=e?d:h;return function(e,i,s){var a=r(e,s);return t(a,i)?n(i,e):s}}(x);z(I[U],b);){var q=[];R=j(I[U],b,R),q.push(t(I[U],P[U]));for(var H=1;H<F.length;++H)q.push(t(r(I[U],i(F[H],R)),r(P[U],i(R,O[H],q))));var V=a(l(o(i(B,q),(e=>JE(e)?e.value:e))));V<T&&T/V>1/4&&(I.push(r(I[U],R)),P.push(r(P[U],i(R,L,q))),U++);var G=.84*(T/V)**.2;if(h(G,C)?G=C:d(G,N)&&(G=N),G=M?p(G):G,R=i(R,G),D&&d(l(R),D)?R=x?D:m(D):S&&h(l(R),S)&&(R=x?S:m(S)),++$>k)throw new Error("Maximum number of iterations reached, try changing options")}return{t:I,y:P}}}function y(e,t,r,n){return g({a:[[],[.5],[0,3/4],[2/9,1/3,4/9]],c:[null,.5,3/4,1],b:[2/9,1/3,4/9,0],bp:[7/24,1/4,1/3,1/8]})(e,t,r,n)}function v(e,t,r,n){return g({a:[[],[.2],[3/40,9/40],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]],c:[null,.2,.3,.8,8/9,1,1],b:[35/384,0,500/1113,125/192,-2187/6784,11/84,0],bp:[5179/57600,0,7571/16695,393/640,-92097/339200,187/2100,1/40]})(e,t,r,n)}function b(e,t,r,n){var i=n.method?n.method:"RK45",s={RK23:y,RK45:v};if(i.toUpperCase()in s){var a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d$(Object(r),!0).forEach((function(t){tS(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},n);return delete a.method,s[i.toUpperCase()](e,t,r,a)}var o=Object.keys(s).map((e=>'"'.concat(e,'"'))),l="".concat(o.slice(0,-1).join(", ")," and ").concat(o.slice(-1));throw new Error('Unavailable method "'.concat(i,'". Available methods are ').concat(l))}function w(e){return KE(e)||GE(e)}function x(e,t,r,n){var i=b(e,t.toArray(),r.toArray(),n);return{t:f(i.t),y:f(i.y)}}return t("solveODE",{"function, Array, Array, Object":b,"function, Matrix, Matrix, Object":x,"function, Array, Array":(e,t,r)=>b(e,t,r,{}),"function, Matrix, Matrix":(e,t,r)=>x(e,t,r,{}),"function, Array, number | BigNumber | Unit":(e,t,r)=>{var n=b(e,t,[r],{});return{t:n.t,y:n.y.map((e=>e[0]))}},"function, Matrix, number | BigNumber | Unit":(e,t,r)=>{var n=b(e,t.toArray(),[r],{});return{t:f(n.t),y:f(n.y.map((e=>e[0])))}},"function, Array, number | BigNumber | Unit, Object":(e,t,r,n)=>{var i=b(e,t,[r],n);return{t:i.t,y:i.y.map((e=>e[0]))}},"function, Matrix, number | BigNumber | Unit, Object":(e,t,r,n)=>{var i=b(e,t.toArray(),[r],n);return{t:f(i.t),y:f(i.y.map((e=>e[0])))}}})})),f$="stirlingS2",p$=BD(f$,["typed","addScalar","subtract","multiplyScalar","divideScalar","pow","factorial","combinations","isNegative","isInteger","number","?bignumber","larger"],(e=>{var{typed:t,addScalar:r,subtract:n,multiplyScalar:i,divideScalar:s,pow:a,factorial:o,combinations:l,isNegative:u,isInteger:c,number:d,bignumber:h,larger:f}=e,p=[],m=[];return t(f$,{"number | BigNumber, number | BigNumber":function(e,t){if(!c(e)||u(e)||!c(t)||u(t))throw new TypeError("Non-negative integer value expected in function stirlingS2");if(f(t,e))throw new TypeError("k must be less than or equal to n in function stirlingS2");var n=!(GE(e)&&GE(t)),s=n?m:p,a=n?h:d,o=d(e),l=d(t);if(s[o]&&s[o].length>l)return s[o][l];for(var g=0;g<=o;++g)if(s[g]||(s[g]=[a(0===g?1:0)]),0!==g)for(var y=s[g],v=s[g-1],b=y.length;b<=g&&b<=l;++b)y[b]=b===g?1:r(i(a(b),v[b]),v[b-1]);return s[o][l]}})})),m$="unit",g$=BD(m$,["typed","Unit"],(e=>{var{typed:t,Unit:r}=e;return t(m$,{Unit:function(e){return e.clone()},string:function(e){return r.isValuelessUnit(e)?new r(null,e):r.parse(e,{allowNoUnits:!0})},"number | BigNumber | Fraction | Complex, string | Unit":function(e,t){return new r(e,t)},"number | BigNumber | Fraction":function(e){return new r(e)},"Array | Matrix":t.referToSelf((e=>t=>eT(t,e)))})})),y$="bellNumbers",v$=BD(y$,["typed","addScalar","isNegative","isInteger","stirlingS2"],(e=>{var{typed:t,addScalar:r,isNegative:n,isInteger:i,stirlingS2:s}=e;return t(y$,{"number | BigNumber":function(e){if(!i(e)||n(e))throw new TypeError("Non-negative integer value expected in function bellNumbers");for(var t=0,a=0;a<=e;a++)t=r(t,s(e,a));return t}})}));function b$(e){var{addScalar:t,subtract:r,flatten:n,multiply:i,multiplyScalar:s,divideScalar:a,sqrt:o,abs:l,bignumber:u,diag:c,inv:d,qr:h,usolve:f,usolveAll:p,equal:m,complex:g,larger:y,smaller:v,matrixFromColumns:b,dot:w}=e;function x(e,n,i,a){var l=t(e,a),u=r(s(e,a),s(n,i)),c=s(l,.5),d=s(o(r(s(l,l),s(4,u))),.5);return[t(c,d),r(c,d)]}function E(e,t,n,i,s,a,o,c){var d="BigNumber"===c,h="Complex"===c,f=d?u(0):h?g(0):0,p=d?u(1):h?g(1):1;if(v(l(n),o))return[[p,f],[f,p]];if(y(l(r(s,a)),o))return[[r(s,i),r(a,i)],[n,n]];var m=r(e,s),b=r(t,s),w=r(n,s),x=r(i,s);return v(l(b),o)?[[m,p],[w,f]]:[[b,f],[x,p]]}function D(e,t){for(var r=0;r<e.length;r++)e[r].push(...Array(t-e[r].length).fill(0));for(var n=e.length;n<t;n++)e.push(Array(t).fill(0)),e[n][n]=1;return e}function S(e,t,r){for(var n=0;n<e.length;n++)if(r(e[n],t))return n;return-1}function A(e,t,r,n,i){for(var s,a="BigNumber"===i?u(1e3):1e3,o=0;s=T(t,r,i),s=f(e,s),!y(N(s),a);)if(++o>=5)return null;for(o=0;;){var l=f(e,s);if(v(N(C(s,[l])),n))break;if(++o>=10)return null;s=k(l)}return s}function T(e,t,r){var n="BigNumber"===r,i="Complex"===r,s=Array(e).fill(0).map((e=>2*Math.random()-1));return n&&(s=s.map((e=>u(e)))),i&&(s=s.map((e=>g(e)))),k(s=C(s,t),r)}function C(e,t){for(var n of t)e=r(e,i(a(w(n,e),w(n,n)),n));return e}function N(e){return l(o(w(e,e)))}function k(e,t){var r="Complex"===t,n="BigNumber"===t?u(1):r?g(1):1;return i(a(n,N(e)),e)}return function(e,o,f,w,T){void 0===T&&(T=!0);var C=function(e,r,n,i,o){var d,h="BigNumber"===i,f="Complex"===i,p=h?u(0):0,b=h?u(1):f?g(1):1,w=h?u(1):1,x=h?u(10):2,E=s(x,x);o&&(d=Array(r).fill(b));var D=!1;for(;!D;){D=!0;for(var S=0;S<r;S++){for(var A=p,T=p,C=0;C<r;C++)if(S!==C){var N=l(e[S][C]);A=t(A,N),T=t(T,N)}if(!m(A,0)&&!m(T,0)){for(var k=w,M=A,O=a(T,x),F=s(T,x);v(M,O);)M=s(M,E),k=s(k,x);for(;y(M,F);)M=a(M,E),k=a(k,x);if(v(a(t(M,T),k),s(t(A,T),.95))){D=!1;for(var L=a(1,k),_=0;_<r;_++)S!==_&&(e[S][_]=s(e[S][_],k),e[_][S]=s(e[_][S],L));o&&(d[S]=s(d[S],k))}}}}return c(d)}(e,o,0,w,T);!function(e,n,i,o,c,d){var h="BigNumber"===o,f="Complex"===o,p=h?u(0):f?g(0):0;h&&(i=u(i));for(var m=0;m<n-2;m++){for(var y=0,b=p,w=m+1;w<n;w++){var x=e[w][m];v(l(b),l(x))&&(b=x,y=w)}if(!v(l(b),i)){if(y!==m+1){var E=e[y];e[y]=e[m+1],e[m+1]=E;for(var D=0;D<n;D++){var S=e[D][y];e[D][y]=e[D][m+1],e[D][m+1]=S}if(c){var A=d[y];d[y]=d[m+1],d[m+1]=A}}for(var T=m+2;T<n;T++){var C=a(e[T][m],b);if(0!==C){for(var N=0;N<n;N++)e[T][N]=r(e[T][N],s(C,e[m+1][N]));for(var k=0;k<n;k++)e[k][m+1]=t(e[k][m+1],s(C,e[k][T]));if(c)for(var M=0;M<n;M++)d[T][M]=r(d[T][M],s(C,d[m+1][M]))}}}}}(e,o,f,w,T,C);var N,{values:k,C:M}=function(e,n,s,a,o){var d="BigNumber"===a,f="Complex"===a,p=d?u(1):f?g(1):1;d&&(s=u(s));var m=_D(e),y=[],b=n,w=[],S=o?c(Array(n).fill(p)):void 0,A=o?c(Array(b).fill(p)):void 0,T=0;for(;T<=100;){T+=1;for(var C=0,N=0;N<b;N++)m[N][N]=r(m[N][N],C);var{Q:k,R:M}=h(m);m=i(M,k);for(var O=0;O<b;O++)m[O][O]=t(m[O][O],C);if(o&&(A=i(A,k)),1===b||v(l(m[b-1][b-2]),s)){T=0,y.push(m[b-1][b-1]),o&&(w.unshift([[1]]),D(A,n),S=i(S,A),b>1&&(A=c(Array(b-1).fill(p)))),b-=1,m.pop();for(var F=0;F<b;F++)m[F].pop()}else if(2===b||v(l(m[b-2][b-3]),s)){T=0;var L=x(m[b-2][b-2],m[b-2][b-1],m[b-1][b-2],m[b-1][b-1]);y.push(...L),o&&(w.unshift(E(m[b-2][b-2],m[b-2][b-1],m[b-1][b-2],m[b-1][b-1],L[0],L[1],s,a)),D(A,n),S=i(S,A),b>2&&(A=c(Array(b-2).fill(p)))),b-=2,m.pop(),m.pop();for(var _=0;_<b;_++)m[_].pop(),m[_].pop()}if(0===b)break}if(y.sort(((e,t)=>+r(l(e),l(t)))),T>100){var R=Error("The eigenvalues failed to converge. Only found these eigenvalues: "+y.join(", "));throw R.values=y,R.vectors=[],R}var I=o?i(S,function(e,t){for(var r=[],n=0;n<t;n++)r[n]=Array(t).fill(0);var i=0;for(var s of e){for(var a=s.length,o=0;o<a;o++)for(var l=0;l<a;l++)r[i+o][i+l]=s[o][l];i+=a}return r}(w,n)):void 0;return{values:y,C:I}}(e,o,f,w,T);return T&&(N=function(e,t,s,a,o,l,h){var f=d(s),y=i(f,e,s),v="BigNumber"===h,b="Complex"===h,w=v?u(0):b?g(0):0,x=v?u(1):b?g(1):1,E=[],D=[];for(var T of o){var C=S(E,T,m);-1===C?(E.push(T),D.push(1)):D[C]+=1}for(var N=[],k=E.length,M=Array(t).fill(w),O=c(Array(t).fill(x)),F=[],L=function(){var e=E[_],o=r(y,i(e,O)),u=p(o,M);for(u.shift();u.length<D[_];){var c=A(o,t,u,l,h);if(null==c){F.push(e);break}u.push(c)}var f=i(d(a),s);u=u.map((e=>i(f,e))),N.push(...u.map((e=>n(e))))},_=0;_<k;_++)L();if(0!==F.length){var R=new Error("Failed to find eigenvectors for the following eigenvalues: "+F.join(", "));throw R.values=o,R.vectors=N,R}return N}(e,o,M,C,k,f,w),N=b(...N)),{values:k,vectors:N}}}function w$(e){var{config:t,addScalar:r,subtract:n,abs:i,atan:s,cos:a,sin:o,multiplyScalar:l,inv:u,bignumber:c,multiply:d,add:h}=e;function f(e,r,n){var i=r-e;return Math.abs(i)<=t.epsilon?Math.PI/4:.5*Math.atan(2*n/(r-e))}function p(e,r,a){var o=n(r,e);return i(o)<=t.epsilon?c(-1).acos().div(4):l(.5,s(d(2,a,u(o))))}function m(e,t,r,n){for(var i=e.length,s=Math.cos(t),a=Math.sin(t),o=E(i,0),l=E(i,0),u=0;u<i;u++)o[u]=s*e[u][r]-a*e[u][n],l[u]=a*e[u][r]+s*e[u][n];for(var c=0;c<i;c++)e[c][r]=o[c],e[c][n]=l[c];return e}function g(e,t,i,s){for(var u=e.length,d=a(t),h=o(t),f=E(u,c(0)),p=E(u,c(0)),m=0;m<u;m++)f[m]=n(l(d,e[m][i]),l(h,e[m][s])),p[m]=r(l(h,e[m][i]),l(d,e[m][s]));for(var g=0;g<u;g++)e[g][i]=f[g],e[g][s]=p[g];return e}function y(e,t,i,s){for(var u=e.length,f=c(a(t)),p=c(o(t)),m=l(f,f),g=l(p,p),y=E(u,c(0)),v=E(u,c(0)),b=d(c(2),f,p,e[i][s]),w=r(n(l(m,e[i][i]),b),l(g,e[s][s])),x=h(l(g,e[i][i]),b,l(m,e[s][s])),D=0;D<u;D++)y[D]=n(l(f,e[i][D]),l(p,e[s][D])),v[D]=r(l(p,e[i][D]),l(f,e[s][D]));e[i][i]=w,e[s][s]=x,e[i][s]=c(0),e[s][i]=c(0);for(var S=0;S<u;S++)S!==i&&S!==s&&(e[i][S]=y[S],e[S][i]=y[S],e[s][S]=v[S],e[S][s]=v[S]);return e}function v(e,t,r,n){for(var i=e.length,s=Math.cos(t),a=Math.sin(t),o=s*s,l=a*a,u=E(i,0),c=E(i,0),d=o*e[r][r]-2*s*a*e[r][n]+l*e[n][n],h=l*e[r][r]+2*s*a*e[r][n]+o*e[n][n],f=0;f<i;f++)u[f]=s*e[r][f]-a*e[n][f],c[f]=a*e[r][f]+s*e[n][f];e[r][r]=d,e[n][n]=h,e[r][n]=0,e[n][r]=0;for(var p=0;p<i;p++)p!==r&&p!==n&&(e[r][p]=u[p],e[p][r]=u[p],e[n][p]=c[p],e[p][n]=c[p]);return e}function b(e){for(var t=e.length,r=0,n=[0,1],i=0;i<t;i++)for(var s=i+1;s<t;s++)Math.abs(r)<Math.abs(e[i][s])&&(r=Math.abs(e[i][s]),n=[i,s]);return[n,r]}function w(e){for(var t=e.length,r=0,n=[0,1],s=0;s<t;s++)for(var a=s+1;a<t;a++)i(r)<i(e[s][a])&&(r=i(e[s][a]),n=[s,a]);return[n,r]}function x(e,t){for(var r=e.length,n=Array(r),s=Array(r),a=0;a<r;a++)s[a]=Array(r);for(var o=0;o<r;o++){for(var l=0,u=e[0],c=0;c<e.length;c++)i(e[c])<i(u)&&(u=e[l=c]);n[o]=e.splice(l,1)[0];for(var d=0;d<r;d++)s[d][o]=t[d][l],t[d].splice(l,1)}return{values:n,vectors:s}}function E(e,t){for(var r=new Array(e),n=0;n<e;n++)r[n]=t;return r}return function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.epsilon,s=arguments.length>3?arguments[3]:void 0;if("number"===s)return function(e,t){for(var r,n=e.length,i=Math.abs(t/n),s=new Array(n),a=0;a<n;a++)s[a]=E(n,0),s[a][a]=1;var o=b(e);for(;Math.abs(o[1])>=Math.abs(i);){var l=o[0][0],u=o[0][1];e=v(e,r=f(e[l][l],e[u][u],e[l][u]),l,u),s=m(s,r,l,u),o=b(e)}for(var c=E(n,0),d=0;d<n;d++)c[d]=e[d][d];return x(_D(c),_D(s))}(e,n);if("BigNumber"===s)return function(e,t){for(var r,n=e.length,s=i(t/n),a=new Array(n),o=0;o<n;o++)a[o]=E(n,0),a[o][o]=1;var l=w(e);for(;i(l[1])>=i(s);){var u=l[0][0],c=l[0][1];e=y(e,r=p(e[u][u],e[c][c],e[u][c]),u,c),a=g(a,r,u,c),l=w(e)}for(var d=E(n,0),h=0;h<n;h++)d[h]=e[h][h];return x(_D(d),_D(a))}(e,n);throw TypeError("Unsupported data type: "+s)}}var x$=["config","typed","matrix","addScalar","equal","subtract","abs","atan","cos","sin","multiplyScalar","divideScalar","inv","bignumber","multiply","add","larger","column","flatten","number","complex","sqrt","diag","qr","usolve","usolveAll","im","re","smaller","matrixFromColumns","dot"],E$=BD("eigs",x$,(e=>{var{config:t,typed:r,matrix:n,addScalar:i,subtract:s,equal:a,abs:o,atan:l,cos:u,sin:c,multiplyScalar:d,divideScalar:h,inv:f,bignumber:p,multiply:m,add:g,larger:y,column:v,flatten:b,number:w,complex:x,sqrt:E,diag:D,qr:S,usolve:A,usolveAll:T,im:C,re:N,smaller:k,matrixFromColumns:M,dot:O}=e,F=w$({config:t,addScalar:i,subtract:s,column:v,flatten:b,equal:a,abs:o,atan:l,cos:u,sin:c,multiplyScalar:d,inv:f,bignumber:p,complex:x,multiply:m,add:g}),L=b$({config:t,addScalar:i,subtract:s,multiply:m,multiplyScalar:d,flatten:b,divideScalar:h,sqrt:E,abs:o,bignumber:p,diag:D,qr:S,inv:f,usolve:A,usolveAll:T,equal:a,complex:x,larger:y,smaller:k,matrixFromColumns:M,dot:O});return r("eigs",{Array:function(e){return _(n(e))},"Array, number|BigNumber":function(e,t){return _(n(e),t)},Matrix:function(e){var{values:t,vectors:r}=_(e);return{values:n(t),vectors:n(r)}},"Matrix, number|BigNumber":function(e,t){var{values:r,vectors:i}=_(e,t);return{values:n(r),vectors:n(i)}}});function _(e,r){void 0===r&&(r=t.epsilon);var n=e.size();if(2!==n.length||n[0]!==n[1])throw new RangeError("Matrix must be square (size: "+NS(n)+")");var i=e.toArray(),a=n[0];if(function(e,t,r){for(var n=0;n<t;n++)for(var i=0;i<t;i++)if(y(p(o(C(e[n][i]))),r))return!1;return!0}(i,a,r)&&(function(e,t){for(var r=0;r<t;r++)for(var n=0;n<t;n++)e[r][n]=N(e[r][n])}(i,a),function(e,t,r){for(var n=0;n<t;n++)for(var i=n;i<t;i++)if(y(p(o(s(e[n][i],e[i][n]))),r))return!1;return!0}(i,a,r))){var l=R(e,i,a);return F(i,a,r,l)}var u=R(e,i,a);return L(i,a,r,u)}function R(e,t,r){var n=e.datatype();if("number"===n||"BigNumber"===n||"Complex"===n)return n;for(var i=!1,s=!1,a=!1,o=0;o<r;o++)for(var l=0;l<r;l++){var u=t[o][l];if(GE(u)||YE(u))i=!0;else if(KE(u))s=!0;else{if(!WE(u))throw TypeError("Unsupported type in Matrix: "+FD(u));a=!0}}if(s&&a&&console.warn("Complex BigNumbers not supported, this operation will lose precission."),a){for(var c=0;c<r;c++)for(var d=0;d<r;d++)t[c][d]=x(t[c][d]);return"Complex"}if(s){for(var h=0;h<r;h++)for(var f=0;f<r;f++)t[h][f]=p(t[h][f]);return"BigNumber"}if(i){for(var m=0;m<r;m++)for(var g=0;g<r;g++)t[m][g]=w(t[m][g]);return"number"}throw TypeError("Matrix contains unsupported types only.")}})),D$="median",S$=["typed","add","divide","compare","partitionSelect"],A$=BD(D$,S$,(e=>{var{typed:t,add:r,divide:n,compare:i,partitionSelect:s}=e;function a(e){try{var t=(e=JS(e.valueOf())).length;if(0===t)throw new Error("Cannot calculate median of an empty array");if(t%2==0){for(var r=t/2-1,n=s(e,r+1),a=e[r],u=0;u<r;++u)i(e[u],a)>0&&(a=e[u]);return l(a,n)}var c=s(e,(t-1)/2);return o(c)}catch(e){throw mC(e,"median")}}var o=t({"number | BigNumber | Complex | Unit":function(e){return e}}),l=t({"number | BigNumber | Complex | Unit, number | BigNumber | Complex | Unit":function(e,t){return n(r(e,t),2)}});return t(D$,{"Array | Matrix":a,"Array | Matrix, number | BigNumber":function(e,t){throw new Error("median(A, dim) is not yet supported")},"...":function(e){if(XA(e))throw new TypeError("Scalar values expected in function median");return a(e)}})})),T$="kldivergence",C$=["typed","matrix","divide","sum","multiply","map","dotDivide","log","isNumeric"],N$=BD(T$,C$,(e=>{var{typed:t,matrix:r,divide:n,sum:i,multiply:s,map:a,dotDivide:o,log:l,isNumeric:u}=e;return t(T$,{"Array, Array":function(e,t){return c(r(e),r(t))},"Matrix, Array":function(e,t){return c(e,r(t))},"Array, Matrix":function(e,t){return c(r(e),t)},"Matrix, Matrix":function(e,t){return c(e,t)}});function c(e,t){var r=t.size().length,c=e.size().length;if(r>1)throw new Error("first object must be one dimensional");if(c>1)throw new Error("second object must be one dimensional");if(r!==c)throw new Error("Length of two vectors must be equal");if(0===i(e))throw new Error("Sum of elements in first object must be non zero");if(0===i(t))throw new Error("Sum of elements in second object must be non zero");var d=n(e,i(e)),h=n(t,i(t)),f=i(s(d,a(o(d,h),(e=>l(e)))));return u(f)?f:Number.NaN}})),k$=["typed","abs","map","median","subtract"],M$=BD("mad",k$,(e=>{var{typed:t,abs:r,map:n,median:i,subtract:s}=e;return t("mad",{"Array | Matrix":a,"...":function(e){return a(e)}});function a(e){if(0===(e=JS(e.valueOf())).length)throw new Error("Cannot calculate median absolute deviation (mad) of an empty array");try{var t=i(e);return i(n(e,(function(e){return r(s(e,t))})))}catch(e){throw e instanceof TypeError&&-1!==e.message.indexOf("median")?new TypeError(e.message.replace("median","mad")):mC(e,"mad")}}})),O$="freqz",F$=["typed","add","multiply","Complex","divide","matrix"],L$=BD(O$,F$,(e=>{var{typed:t,add:r,multiply:n,Complex:i,divide:s,matrix:a}=e;return t(O$,{"Array, Array":function(e,t){return o(e,t,l(512))},"Array, Array, Array":function(e,t,r){return o(e,t,r)},"Array, Array, number":function(e,t,r){if(r<0)throw new Error("w must be a positive number");return o(e,t,l(r))},"Matrix, Matrix":function(e,t){var r=l(512),{w:n,h:i}=o(e.valueOf(),t.valueOf(),r);return{w:a(n),h:a(i)}},"Matrix, Matrix, Matrix":function(e,t,r){var{h:n}=o(e.valueOf(),t.valueOf(),r.valueOf());return{h:a(n),w:a(r)}},"Matrix, Matrix, number":function(e,t,r){if(r<0)throw new Error("w must be a positive number");var n=l(r),{h:i}=o(e.valueOf(),t.valueOf(),n);return{h:a(i),w:a(n)}}});function o(e,t,a){for(var o=[],l=[],u=0;u<a.length;u++){for(var c=i(0,0),d=i(0,0),h=0;h<e.length;h++)c=r(c,n(e[h],i(Math.cos(-h*a[u]),Math.sin(-h*a[u]))));for(var f=0;f<t.length;f++)d=r(d,n(t[f],i(Math.cos(-f*a[u]),Math.sin(-f*a[u]))));o.push(c),l.push(d)}for(var p=[],m=0;m<o.length;m++)p.push(s(o[m],l[m]));return{h:p,w:a}}function l(e){for(var t=[],r=0;r<e;r++)t.push(r/e*Math.PI);return t}})),_$="norm",R$=["typed","abs","add","pow","conj","sqrt","multiply","equalScalar","larger","smaller","matrix","ctranspose","eigs"],I$=BD(_$,R$,(e=>{var{typed:t,abs:r,add:n,pow:i,conj:s,sqrt:a,multiply:o,equalScalar:l,larger:u,smaller:c,matrix:d,ctranspose:h,eigs:f}=e;return t(_$,{number:Math.abs,Complex:function(e){return e.abs()},BigNumber:function(e){return e.abs()},boolean:function(e){return Math.abs(e)},Array:function(e){return g(d(e),2)},Matrix:function(e){return g(e,2)},"Array, number | BigNumber | string":function(e,t){return g(d(e),t)},"Matrix, number | BigNumber | string":function(e,t){return g(e,t)}});function p(e,t){if(t===Number.POSITIVE_INFINITY||"inf"===t)return function(e){var t=0;return e.forEach((function(e){var n=r(e);u(n,t)&&(t=n)}),!0),t}(e);if(t===Number.NEGATIVE_INFINITY||"-inf"===t)return function(e){var t;return e.forEach((function(e){var n=r(e);t&&!c(n,t)||(t=n)}),!0),t||0}(e);if("fro"===t)return g(e,2);if("number"==typeof t&&!isNaN(t)){if(!l(t,0)){var s=0;return e.forEach((function(e){s=n(i(r(e),t),s)}),!0),i(s,1/t)}return Number.POSITIVE_INFINITY}throw new Error("Unsupported parameter value")}function m(e,t){if(1===t)return function(e){var t=[],i=0;return e.forEach((function(e,s){var a=s[1],o=n(t[a]||0,r(e));u(o,i)&&(i=o),t[a]=o}),!0),i}(e);if(t===Number.POSITIVE_INFINITY||"inf"===t)return function(e){var t=[],i=0;return e.forEach((function(e,s){var a=s[0],o=n(t[a]||0,r(e));u(o,i)&&(i=o),t[a]=o}),!0),i}(e);if("fro"===t)return function(e){var t=0;return e.forEach((function(e,r){t=n(t,o(e,s(e)))})),r(a(t))}(e);if(2===t)return function(e){var t=e.size();if(t[0]!==t[1])throw new RangeError("Invalid matrix dimensions");var n=h(e),i=o(n,e),s=f(i).values.toArray(),l=s[s.length-1];return r(a(l))}(e);throw new Error("Unsupported parameter value "+t)}function g(e,t){var r=e.size();if(1===r.length)return p(e,t);if(2===r.length){if(r[0]&&r[1])return m(e,t);throw new RangeError("Invalid matrix dimensions")}}})),P$="rotationMatrix",B$=["typed","config","multiplyScalar","addScalar","unaryMinus","norm","matrix","BigNumber","DenseMatrix","SparseMatrix","cos","sin"],U$=BD(P$,B$,(e=>{var{typed:t,config:r,multiplyScalar:n,addScalar:i,unaryMinus:s,norm:a,BigNumber:o,matrix:l,DenseMatrix:u,SparseMatrix:c,cos:d,sin:h}=e;return t(P$,{"":function(){return"Matrix"===r.matrix?l([]):[]},string:function(e){return l(e)},"number | BigNumber | Complex | Unit":function(e){return f(e,"Matrix"===r.matrix?"dense":void 0)},"number | BigNumber | Complex | Unit, string":function(e,t){return f(e,t)},"number | BigNumber | Complex | Unit, Array":function(e,t){var r=l(t);return p(r),y(e,r,void 0)},"number | BigNumber | Complex | Unit, Matrix":function(e,t){p(t);var n=t.storage()||("Matrix"===r.matrix?"dense":void 0);return y(e,t,n)},"number | BigNumber | Complex | Unit, Array, string":function(e,t,r){var n=l(t);return p(n),y(e,n,r)},"number | BigNumber | Complex | Unit, Matrix, string":function(e,t,r){return p(t),y(e,t,r)}});function f(e,t){var r=KE(e)?new o(-1):-1,i=d(e),s=h(e);return g([[i,n(r,s)],[s,i]],t)}function p(e){var t=e.size();if(t.length<1||3!==t[0])throw new RangeError("Vector must be of dimensions 1x3")}function m(e){return e.reduce(((e,t)=>n(e,t)))}function g(e,t){if(t){if("sparse"===t)return new c(e);if("dense"===t)return new u(e);throw new TypeError('Unknown matrix type "'.concat(t,'"'))}return e}function y(e,t,r){var n=a(t);if(0===n)throw new RangeError("Rotation around zero vector");var l=KE(e)?o:null,u=l?new l(1):1,c=l?new l(-1):-1,f=l?new l(t.get([0])/n):t.get([0])/n,p=l?new l(t.get([1])/n):t.get([1])/n,y=l?new l(t.get([2])/n):t.get([2])/n,v=d(e),b=i(u,s(v)),w=h(e);return g([[i(v,m([f,f,b])),i(m([f,p,b]),m([c,y,w])),i(m([f,y,b]),m([p,w]))],[i(m([f,p,b]),m([y,w])),i(v,m([p,p,b])),i(m([p,y,b]),m([c,f,w]))],[i(m([f,y,b]),m([c,p,w])),i(m([p,y,b]),m([f,w])),i(v,m([y,y,b]))]],r)}})),$$="schur",z$=["typed","matrix","identity","multiply","qr","norm","subtract"],j$=BD($$,z$,(e=>{var{typed:t,matrix:r,identity:n,multiply:i,qr:s,norm:a,subtract:o}=e;return t($$,{Array:function(e){var t=l(r(e));return{U:t.U.valueOf(),T:t.T.valueOf()}},Matrix:function(e){return l(e)}});function l(e){var t,r=e.size()[0],l=e,u=n(r),c=0;do{t=l;var d=s(l),h=d.Q,f=d.R;if(l=i(f,h),u=i(u,h),c++>100)break}while(a(o(l,t))>1e-4);return{U:u,T:l}}})),q$="rotate",H$=["typed","multiply","rotationMatrix"],V$=BD(q$,H$,(e=>{var{typed:t,multiply:r,rotationMatrix:n}=e;return t(q$,{"Array , number | BigNumber | Complex | Unit":function(e,t){return i(e,2),r(n(t),e).toArray()},"Matrix , number | BigNumber | Complex | Unit":function(e,t){return i(e,2),r(n(t),e)},"Array, number | BigNumber | Complex | Unit, Array | Matrix":function(e,t,s){return i(e,3),r(n(t,s),e)},"Matrix, number | BigNumber | Complex | Unit, Array | Matrix":function(e,t,s){return i(e,3),r(n(t,s),e)}});function i(e,t){var r=Array.isArray(e)?PS(e):e.size();if(r.length>2)throw new RangeError("Vector must be of dimensions 1x".concat(t));if(2===r.length&&1!==r[1])throw new RangeError("Vector must be of dimensions 1x".concat(t));if(r[0]!==t)throw new RangeError("Vector must be of dimensions 1x".concat(t))}})),G$="sylvester",K$=["typed","schur","matrixFromColumns","matrix","multiply","range","concat","transpose","index","subset","add","subtract","identity","lusolve","abs"],W$=BD(G$,K$,(e=>{var{typed:t,schur:r,matrixFromColumns:n,matrix:i,multiply:s,range:a,concat:o,transpose:l,index:u,subset:c,add:d,subtract:h,identity:f,lusolve:p,abs:m}=e;return t(G$,{"Matrix, Matrix, Matrix":g,"Array, Matrix, Matrix":function(e,t,r){return g(i(e),t,r)},"Array, Array, Matrix":function(e,t,r){return g(i(e),i(t),r)},"Array, Matrix, Array":function(e,t,r){return g(i(e),t,i(r))},"Matrix, Array, Matrix":function(e,t,r){return g(e,i(t),r)},"Matrix, Array, Array":function(e,t,r){return g(e,i(t),i(r))},"Matrix, Matrix, Array":function(e,t,r){return g(e,t,i(r))},"Array, Array, Array":function(e,t,r){return g(i(e),i(t),i(r)).toArray()}});function g(e,t,g){for(var y=t.size()[0],v=e.size()[0],b=r(e),w=b.T,x=b.U,E=r(s(-1,t)),D=E.T,S=E.U,A=s(s(l(x),g),S),T=a(0,v),C=[],N=(e,t)=>o(e,t,1),k=(e,t)=>o(e,t,0),M=0;M<y;M++)if(M<y-1&&m(c(D,u(M+1,M)))>1e-5){for(var O=k(c(A,u(T,M)),c(A,u(T,M+1))),F=0;F<M;F++)O=d(O,k(s(C[F],c(D,u(F,M))),s(C[F],c(D,u(F,M+1)))));var L=s(f(v),s(-1,c(D,u(M,M)))),_=s(f(v),s(-1,c(D,u(M+1,M)))),R=s(f(v),s(-1,c(D,u(M,M+1)))),I=s(f(v),s(-1,c(D,u(M+1,M+1)))),P=k(N(d(w,L),_),N(R,d(w,I))),B=p(P,O);C[M]=B.subset(u(a(0,v),0)),C[M+1]=B.subset(u(a(v,2*v),0)),M++}else{for(var U=c(A,u(T,M)),$=0;$<M;$++)U=d(U,s(C[$],c(D,u($,M))));var z=c(D,u(M,M)),j=h(w,s(z,f(v)));C[M]=p(j,U)}var q=i(n(...C));return s(x,s(q,l(S)))}})),Y$="lyap",J$=["typed","matrix","sylvester","multiply","transpose"],Z$=BD(Y$,J$,(e=>{var{typed:t,matrix:r,sylvester:n,multiply:i,transpose:s}=e;return t(Y$,{"Matrix, Matrix":function(e,t){return n(e,s(e),i(-1,t))},"Array, Matrix":function(e,t){return n(r(e),s(r(e)),i(-1,t))},"Matrix, Array":function(e,t){return n(e,s(r(e)),r(i(-1,t)))},"Array, Array":function(e,t){return n(r(e),s(r(e)),r(i(-1,t))).toArray()}})})),X$=_k({config:VE}),Q$=Ik({}),ez=tM({BigNumber:X$,config:VE}),tz=Yk({}),rz=OM({BigNumber:X$,config:VE}),nz=dO({}),iz=uM({Complex:Q$}),sz=Zk({BigNumber:X$,config:VE}),az=iM({BigNumber:X$,config:VE}),oz=aM({BigNumber:X$,config:VE}),lz=hO({}),uz=Xk({BigNumber:X$,config:VE}),cz=Jk({}),dz=rM({BigNumber:X$,config:VE}),hz=fO({}),fz=pO({}),pz=oM({BigNumber:X$,config:VE}),mz=JM({BigNumber:X$,config:VE}),gz=eM({BigNumber:X$,config:VE}),yz=Wk({}),vz=cM({}),bz=mO({Matrix:lz}),wz=$M({BigNumber:X$,config:VE}),xz=nM({BigNumber:X$,config:VE}),Ez=Qk({BigNumber:X$,config:VE}),Dz=gO({}),Sz=lM({BigNumber:X$,config:VE}),Az=vO({BigNumber:X$,Complex:Q$,DenseMatrix:bz,Fraction:nz}),Tz=VO({BigNumber:X$,config:VE,typed:Az}),Cz=UM({BigNumber:X$,config:VE}),Nz=GO({typed:Az}),kz=WO({Complex:Q$,config:VE,typed:Az}),Mz=fF({BigNumber:X$,typed:Az}),Oz=mF({BigNumber:X$,Complex:Q$,config:VE,typed:Az}),Fz=yF({typed:Az}),Lz=vF({typed:Az}),_z=wF({BigNumber:X$,Complex:Q$,config:VE,typed:Az}),Rz=xF({typed:Az}),Iz=EF({typed:Az}),Pz=SF({Complex:Q$,config:VE,typed:Az}),Bz=AF({BigNumber:X$,typed:Az}),Uz=qF({typed:Az}),$z=VF({typed:Az}),zz=KF({typed:Az}),jz=ZF({typed:Az}),qz=QF({Complex:Q$,typed:Az}),Hz=tL({typed:Az}),Vz=nL({typed:Az}),Gz=sL({BigNumber:X$,typed:Az}),Kz=oL({BigNumber:X$,typed:Az}),Wz=uL({typed:Az}),Yz=fL({config:VE,typed:Az}),Jz=pL({typed:Az}),Zz=wL({typed:Az}),Xz=EL({Complex:Q$,typed:Az}),Qz=DL({typed:Az}),ej=TL({typed:Az}),tj=kL({typed:Az}),rj=OL({typed:Az}),nj=FL({format:tj,typed:Az}),ij=LL({typed:Az}),sj=RL({typed:Az}),aj=jL({typed:Az}),oj=HL({typed:Az}),lj=GL({typed:Az}),uj=sM({BigNumber:X$,config:VE}),cj=e_({Complex:Q$,typed:Az}),dj=r_({Complex:Q$,config:VE,typed:Az}),hj=i_({Complex:Q$,config:VE,typed:Az}),fj=s_({typed:Az}),pj=o_({typed:Az}),mj=f_({typed:Az}),gj=p_({typed:Az}),yj=m_({format:tj,typed:Az}),vj=w_({config:VE,typed:Az}),bj=E_({typed:Az}),wj=T_({config:VE,typed:Az}),xj=C_({typed:Az}),Ej=N_({BigNumber:X$,typed:Az}),Dj=M_({BigNumber:X$,Fraction:nz,complex:qz,typed:Az}),Sj=O_({typed:Az}),Aj=F_({Matrix:lz,equalScalar:Yz,typed:Az}),Tj=__({typed:Az}),Cj=I_({typed:Az}),Nj=B_({typed:Az}),kj=U_({typed:Az}),Mj=z_({typed:Az}),Oj=q_({Complex:Q$,config:VE,typed:Az}),Fj=V_({BigNumber:X$,typed:Az}),Lj=tC({isInteger:sj,typed:Az}),_j=K_({BigNumber:X$,Complex:Q$,config:VE,typed:Az}),Rj=W_({format:tj,typed:Az}),Ij=J_({typed:Az}),Pj=X_({typed:Az}),Bj=eR({BigNumber:X$,typed:Az}),Uj=rR({typed:Az}),$j=iR({typed:Az}),zj=aR({config:VE,typed:Az}),jj=lR({BigNumber:X$,typed:Az}),qj=cR({typed:Az}),Hj=hR({SparseMatrix:Aj,typed:Az}),Vj=fR({Complex:Q$,config:VE,typed:Az}),Gj=pR({typed:Az}),Kj=gR({typed:Az}),Wj=vR({BigNumber:X$,Complex:Q$,config:VE,typed:Az}),Yj=bR({BigNumber:X$,typed:Az}),Jj=wR({Fraction:nz,typed:Az}),Zj=ER({typed:Az}),Xj=SR({DenseMatrix:bz,Matrix:lz,SparseMatrix:Aj,typed:Az}),Qj=TR({isZero:lj,matrix:Xj,typed:Az}),eq=NR({isNaN:Uj,isNumeric:Zj,typed:Az}),tq=kR({bignumber:Bz,fraction:Jj,number:gj}),rq=OR({config:VE,multiplyScalar:pj,numeric:tq,typed:Az}),nq=LR({isInteger:sj,matrix:Xj,typed:Az}),iq=RR({matrix:Xj,config:VE,typed:Az}),sq=PR({matrix:Xj,typed:Az}),aq=sC({matrix:Xj,typed:Az}),oq=UR({matrix:Xj,typed:Az}),lq=zR({BigNumber:X$,config:VE,matrix:Xj,typed:Az}),uq=qR({BigNumber:X$,config:VE,matrix:Xj,typed:Az}),cq=VR({Complex:Q$,config:VE,typed:Az}),dq=KR({BigNumber:X$,Complex:Q$,Fraction:nz,config:VE,isNegative:aj,matrix:Xj,typed:Az,unaryMinus:Kj}),hq=hC({isInteger:sj,matrix:Xj,typed:Az}),fq=YR({prod:rq,size:iq,typed:Az}),pq=ZR({conj:Hz,transpose:oq,typed:Az}),mq=QR({DenseMatrix:bz,SparseMatrix:Aj,matrix:Xj,typed:Az}),gq=tI({numeric:tq,typed:Az}),yq=hI({DenseMatrix:bz,concat:hq,divideScalar:gq,equalScalar:Yz,matrix:Xj,typed:Az}),vq=pI({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),bq=yI({matrix:Xj,typed:Az}),wq=TI({BigNumber:X$,DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),xq=NI({isNumeric:Zj,typed:Az}),Eq=MI({BigNumber:X$,DenseMatrix:bz,SparseMatrix:Aj,config:VE,matrix:Xj,typed:Az}),Dq=FI({matrix:Xj,multiplyScalar:pj,typed:Az}),Sq=_I({DenseMatrix:bz,concat:hq,config:VE,matrix:Xj,typed:Az}),Aq=UI({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az,zeros:uq}),Tq=zI({flatten:bq,matrix:Xj,size:iq,typed:Az}),Cq=qI({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),Nq=GI({BigNumber:X$,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),kq=KI({BigNumber:X$,config:VE,matrix:Xj,typed:Az}),Mq=WI({config:VE,matrix:Xj}),Oq=JI({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az,zeros:uq}),Fq=QI({BigNumber:X$,DenseMatrix:bz,equalScalar:Yz,matrix:Xj,typed:Az,zeros:uq}),Lq=tP({DenseMatrix:bz,concat:hq,config:VE,matrix:Xj,typed:Az}),_q=nP({concat:hq,matrix:Xj,typed:Az}),Rq=sP({DenseMatrix:bz,concat:hq,config:VE,equalScalar:Yz,matrix:Xj,typed:Az}),Iq=oP({DenseMatrix:bz,concat:hq,matrix:Xj,typed:Az}),Pq=lP({DenseMatrix:bz,SparseMatrix:Aj,addScalar:Fz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),Bq=cP({concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),Uq=hP({DenseMatrix:bz,concat:hq,matrix:Xj,typed:Az}),$q=pP({addScalar:Fz,combinations:jz,divideScalar:gq,isInteger:sj,isNegative:aj,multiplyScalar:pj,typed:Az}),zq=gP({BigNumber:X$,DenseMatrix:bz,Fraction:nz,concat:hq,config:VE,equalScalar:Yz,matrix:Xj,typed:Az}),jq=wP({concat:hq,matrix:Xj,typed:Az}),qq=TC({add:Pq,typed:Az,unaryPlus:Tz}),Hq=EP({equal:vq,typed:Az}),Vq=DP({addScalar:Fz,conj:Hz,multiplyScalar:pj,size:iq,typed:Az}),Gq=AP({compareText:jq,isZero:lj,typed:Az}),Kq=kP({DenseMatrix:bz,config:VE,equalScalar:Yz,matrix:Xj,round:Fq,typed:Az,zeros:uq}),Wq=OP({abs:Nz,addScalar:Fz,divideScalar:gq,isPositive:oj,multiplyScalar:pj,smaller:Lq,sqrt:Vj,typed:Az}),Yq=FP({DenseMatrix:bz,smaller:Lq}),Jq=LP({ImmutableDenseMatrix:Yq}),Zq=RP({BigNumber:X$,add:Pq,config:VE,equal:vq,isInteger:sj,mod:Cq,smaller:Lq,typed:Az,xgcd:lq}),Xq=PP({DenseMatrix:bz,concat:hq,config:VE,matrix:Xj,typed:Az}),Qq=UP({Complex:Q$,config:VE,divideScalar:gq,typed:Az}),eH=zP({flatten:bq,matrix:Xj,size:iq,typed:Az}),tH=DC({config:VE,numeric:tq,smaller:Lq,typed:Az}),rH=qP({addScalar:Fz,dot:Vq,equalScalar:Yz,matrix:Xj,multiplyScalar:pj,typed:Az}),nH=VP({Complex:Q$,config:VE,divideScalar:gq,typed:Az}),iH=GP({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),sH=WP({compare:zq,isNaN:Uj,isNumeric:Zj,typed:Az}),aH=YP({add:Pq,compare:zq,multiply:rH,partitionSelect:sH,typed:Az}),oH=ZP({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az,zeros:uq}),lH=QP({DenseMatrix:bz,concat:hq,config:VE,matrix:Xj,typed:Az}),uH=rB({DenseMatrix:bz,addScalar:Fz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az,unaryMinus:Kj}),cH=nB({add:Pq,matrix:Xj,typed:Az}),dH=aB({DenseMatrix:bz,divideScalar:gq,equalScalar:Yz,matrix:Xj,multiplyScalar:pj,subtract:uH,typed:Az}),hH=lB({Complex:Q$,add:Pq,multiply:rH,number:gj,typed:Az}),fH=uB({concat:hq,equalScalar:Yz,matrix:Xj,not:mj,typed:Az,zeros:uq}),pH=dB({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),mH=mB({DenseMatrix:bz,config:VE,equalScalar:Yz,matrix:Xj,round:Fq,typed:Az,zeros:uq}),gH=vB({compare:zq,typed:Az}),yH=wB({addScalar:Fz,combinations:jz,isInteger:sj,isNegative:aj,isPositive:oj,larger:Xq,typed:Az}),vH=EB({matrix:Xj,multiply:rH,subtract:uH,typed:Az}),bH=DB({divideScalar:gq,isZero:lj,matrix:Xj,multiply:rH,subtract:uH,typed:Az,unaryMinus:Kj}),wH=MC({matrix:Xj,number:gj,subtract:uH,typed:Az}),xH=AB({abs:Nz,addScalar:Fz,deepEqual:Hq,divideScalar:gq,multiplyScalar:pj,sqrt:Vj,subtract:uH,typed:Az}),EH=NB({concat:hq,equalScalar:Yz,matrix:Xj,multiplyScalar:pj,typed:Az}),DH=kB({larger:Xq,smaller:Lq}),SH=LB({Complex:Q$,DenseMatrix:bz,ceil:mH,equalScalar:Yz,floor:Kq,matrix:Xj,typed:Az,zeros:uq}),AH=RB({Index:Jq,typed:Az}),TH=IB({abs:Nz,add:Pq,addScalar:Fz,config:VE,divideScalar:gq,equalScalar:Yz,flatten:bq,isNumeric:Zj,isZero:lj,matrix:Xj,multiply:rH,multiplyScalar:pj,smaller:Lq,subtract:uH,typed:Az}),CH=PB({concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),NH=UB({Complex:Q$,config:VE,divideScalar:gq,log:Qq,typed:Az}),kH=zB({DenseMatrix:bz,divideScalar:gq,equalScalar:Yz,matrix:Xj,multiplyScalar:pj,subtract:uH,typed:Az}),MH=gC({config:VE,larger:Xq,numeric:tq,typed:Az}),OH=jB({addScalar:Fz,complex:qz,conj:Hz,divideScalar:gq,equal:vq,identity:Eq,isZero:lj,matrix:Xj,multiplyScalar:pj,sign:Dj,sqrt:Vj,subtract:uH,typed:Az,unaryMinus:Kj,zeros:uq}),FH=RC({bignumber:Bz,matrix:Xj,add:Pq,config:VE,isPositive:oj,larger:Xq,largerEq:Sq,smaller:Lq,smallerEq:lH,typed:Az}),LH=PC({Index:Jq,matrix:Xj,range:FH,typed:Az}),_H=HB({DenseMatrix:bz,Index:Jq,compareNatural:gH,size:iq,subset:aq,typed:Az}),RH=GB({DenseMatrix:bz,Index:Jq,compareNatural:gH,size:iq,subset:aq,typed:Az}),IH=WB({Index:Jq,compareNatural:gH,size:iq,subset:aq,typed:Az}),PH=JB({Index:Jq,compareNatural:gH,size:iq,subset:aq,typed:Az}),BH=uU({SparseMatrix:Aj,abs:Nz,add:Pq,divideScalar:gq,larger:Xq,largerEq:Sq,multiply:rH,subtract:uH,transpose:oq,typed:Az}),UH=dU({compare:zq,compareNatural:gH,matrix:Xj,typed:Az}),$H=xC({add:Pq,config:VE,numeric:tq,typed:Az}),zH=fU({DenseMatrix:bz,divideScalar:gq,equalScalar:Yz,matrix:Xj,multiplyScalar:pj,subtract:uH,typed:Az}),jH=mU({BigNumber:X$,DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,typed:Az}),qH=$C({Index:Jq,matrix:Xj,range:FH,typed:Az}),HH=yU({DenseMatrix:bz,divideScalar:gq,equalScalar:Yz,matrix:Xj,multiplyScalar:pj,subtract:uH,typed:Az}),VH=bU({DenseMatrix:bz,Index:Jq,compareNatural:gH,size:iq,subset:aq,typed:Az}),GH=xU({Index:Jq,compareNatural:gH,size:iq,subset:aq,typed:Az}),KH=DU({Index:Jq,concat:hq,setDifference:VH,size:iq,subset:aq,typed:Az}),WH=SU({FibonacciHeap:DH,addScalar:Fz,equalScalar:Yz}),YH=AU({abs:Nz,addScalar:Fz,det:bH,divideScalar:gq,identity:Eq,matrix:Xj,multiply:rH,typed:Az,unaryMinus:Kj}),JH=TU({DenseMatrix:bz,Spa:WH,SparseMatrix:Aj,abs:Nz,addScalar:Fz,divideScalar:gq,equalScalar:Yz,larger:Xq,matrix:Xj,multiplyScalar:pj,subtract:uH,typed:Az,unaryMinus:Kj}),ZH=NU({Complex:Q$,add:Pq,ctranspose:pq,deepEqual:Hq,divideScalar:gq,dot:Vq,dotDivide:yq,equal:vq,inv:YH,matrix:Xj,multiply:rH,typed:Az}),XH=kU({Complex:Q$,config:VE,fraction:Jj,identity:Eq,inv:YH,matrix:Xj,multiply:rH,number:gj,typed:Az}),QH=OU({DenseMatrix:bz,Index:Jq,compareNatural:gH,size:iq,subset:aq,typed:Az}),eV=LU({Index:Jq,concat:hq,setIntersect:QH,setSymDifference:KH,size:iq,subset:aq,typed:Az}),tV=RU({abs:Nz,add:Pq,identity:Eq,inv:YH,map:fj,max:MH,multiply:rH,size:iq,sqrt:Vj,subtract:uH,typed:Az}),rV=BU({BigNumber:X$,Complex:Q$,Fraction:nz,abs:Nz,addScalar:Fz,config:VE,divideScalar:gq,equal:vq,fix:SH,format:tj,isNumeric:Zj,multiplyScalar:pj,number:gj,pow:XH,round:Fq,subtract:uH}),nV=vM({BigNumber:X$,Unit:rV,config:VE}),iV=QM({BigNumber:X$,Unit:rV,config:VE}),sV=zM({BigNumber:X$,Unit:rV,config:VE}),aV=xM({BigNumber:X$,Unit:rV,config:VE}),oV=qM({BigNumber:X$,Unit:rV,config:VE}),lV=EM({BigNumber:X$,Unit:rV,config:VE}),uV=$U({Unit:rV,typed:Az}),cV=_M({BigNumber:X$,Unit:rV,config:VE}),dV=jU({DenseMatrix:bz,concat:hq,equalScalar:Yz,matrix:Xj,pow:XH,typed:Az}),hV=yM({BigNumber:X$,Unit:rV,config:VE}),fV=wM({BigNumber:X$,Unit:rV,config:VE}),pV=HU({abs:Nz,add:Pq,identity:Eq,inv:YH,multiply:rH,typed:Az}),mV=HM({BigNumber:X$,Unit:rV,config:VE}),gV=VU({addScalar:Fz,ceil:mH,conj:Hz,divideScalar:gq,dotDivide:yq,exp:Zz,i:iz,log2:hj,matrix:Xj,multiplyScalar:pj,pow:XH,tau:gz,typed:Az}),yV=KU({BigNumber:X$,Complex:Q$,config:VE,multiplyScalar:pj,pow:XH,typed:Az}),vV=fM({BigNumber:X$,Unit:rV,config:VE}),bV=FM({BigNumber:X$,Unit:rV,config:VE}),wV=YU({conj:Hz,dotDivide:yq,fft:gV,typed:Az}),xV=TM({BigNumber:X$,Unit:rV,config:VE}),EV=GM({BigNumber:X$,Unit:rV,config:VE}),DV=gM({BigNumber:X$,Unit:rV,config:VE}),SV=eO({BigNumber:X$,Unit:rV,config:VE}),AV=WM({BigNumber:X$,Unit:rV,config:VE}),TV=RM({BigNumber:X$,Unit:rV,config:VE}),CV=AM({BigNumber:X$,Unit:rV,config:VE}),NV=aO({BigNumber:X$,Unit:rV,config:VE}),kV=nO({BigNumber:X$,Unit:rV,config:VE}),MV=oO({BigNumber:X$,Unit:rV,config:VE}),OV=LM({BigNumber:X$,Unit:rV,config:VE}),FV=mM({BigNumber:X$,Unit:rV,config:VE}),LV=PM({BigNumber:X$,Unit:rV,config:VE}),_V=ZM({BigNumber:X$,Unit:rV,config:VE}),RV=hM({BigNumber:X$,Unit:rV,config:VE}),IV=XM({BigNumber:X$,Unit:rV,config:VE}),PV=BM({BigNumber:X$,Unit:rV,config:VE}),BV=jM({BigNumber:X$,Unit:rV,config:VE}),UV=CM({BigNumber:X$,Unit:rV,config:VE}),$V=bM({BigNumber:X$,Unit:rV,config:VE}),zV=JU({divideScalar:gq,equalScalar:Yz,inv:YH,matrix:Xj,multiply:rH,typed:Az}),jV=kM({BigNumber:X$,Unit:rV,config:VE}),qV=XU({gamma:yV,typed:Az}),HV=VM({BigNumber:X$,Unit:rV,config:VE}),VV=rO({BigNumber:X$,Unit:rV,config:VE}),GV=DM({BigNumber:X$,Unit:rV,config:VE}),KV=t$({DenseMatrix:bz,lsolve:kH,lup:JH,matrix:Xj,slu:BH,typed:Az,usolve:dH}),WV=SM({BigNumber:X$,Unit:rV,config:VE}),YV=tO({BigNumber:X$,Unit:rV,config:VE}),JV=n$({add:Pq,divide:zV,factorial:qV,isInteger:sj,isPositive:oj,multiply:rH,typed:Az}),ZV=s$({factorial:qV,typed:Az}),XV=iO({BigNumber:X$,Unit:rV,config:VE}),QV=l$({add:Pq,cbrt:dq,divide:zV,equalScalar:Yz,im:ij,isZero:lj,multiply:rH,re:xj,sqrt:Vj,subtract:uH,typeOf:Mj,typed:Az,unaryMinus:Kj}),eG=c$({compareNatural:gH,typed:Az}),tG=h$({abs:Nz,add:Pq,bignumber:Bz,divide:zV,isNegative:aj,isPositive:oj,larger:Xq,map:fj,matrix:Xj,max:MH,multiply:rH,smaller:Lq,subtract:uH,typed:Az,unaryMinus:Kj}),rG=p$({bignumber:Bz,addScalar:Fz,combinations:jz,divideScalar:gq,factorial:qV,isInteger:sj,isNegative:aj,larger:Xq,multiplyScalar:pj,number:gj,pow:XH,subtract:uH,typed:Az}),nG=g$({Unit:rV,typed:Az}),iG=v$({addScalar:Fz,isInteger:sj,isNegative:aj,stirlingS2:rG,typed:Az}),sG=E$({abs:Nz,add:Pq,addScalar:Fz,atan:Iz,bignumber:Bz,column:qH,complex:qz,config:VE,cos:Pj,diag:mq,divideScalar:gq,dot:Vq,equal:vq,flatten:bq,im:ij,inv:YH,larger:Xq,matrix:Xj,matrixFromColumns:Tq,multiply:rH,multiplyScalar:pj,number:gj,qr:OH,re:xj,sin:Sj,smaller:Lq,sqrt:Vj,subtract:uH,typed:Az,usolve:dH,usolveAll:zH}),aG=MM({BigNumber:X$,Unit:rV,config:VE}),oG=KM({BigNumber:X$,Unit:rV,config:VE}),lG=qC({add:Pq,divide:zV,typed:Az}),uG=YM({BigNumber:X$,Unit:rV,config:VE}),cG=pM({BigNumber:X$,Unit:rV,config:VE}),dG=IM({BigNumber:X$,Unit:rV,config:VE}),hG=KC({add:Pq,apply:Lj,divide:zV,isNaN:Uj,multiply:rH,subtract:uH,typed:Az}),fG=NM({BigNumber:X$,Unit:rV,config:VE}),pG=A$({add:Pq,compare:zq,divide:zV,partitionSelect:sH,typed:Az}),mG=N$({divide:zV,dotDivide:yq,isNumeric:Zj,log:Qq,map:fj,matrix:Xj,multiply:rH,sum:$H,typed:Az}),gG=M$({abs:Nz,map:fj,median:pG,subtract:uH,typed:Az}),yG=JC({map:fj,sqrt:Vj,typed:Az,variance:hG}),vG=L$({Complex:Q$,add:Pq,divide:zV,matrix:Xj,multiply:rH,typed:Az}),bG=I$({abs:Nz,add:Pq,conj:Hz,ctranspose:pq,eigs:sG,equalScalar:Yz,larger:Xq,matrix:Xj,multiply:rH,pow:XH,smaller:Lq,sqrt:Vj,typed:Az}),wG=U$({BigNumber:X$,DenseMatrix:bz,SparseMatrix:Aj,addScalar:Fz,config:VE,cos:Pj,matrix:Xj,multiplyScalar:pj,norm:bG,sin:Sj,typed:Az,unaryMinus:Kj}),xG=sO({BigNumber:X$,Unit:rV,config:VE}),EG=j$({identity:Eq,matrix:Xj,multiply:rH,norm:bG,qr:OH,subtract:uH,typed:Az}),DG=V$({multiply:rH,rotationMatrix:wG,typed:Az}),SG=W$({abs:Nz,add:Pq,concat:hq,identity:Eq,index:AH,lusolve:KV,matrix:Xj,matrixFromColumns:Tq,multiply:rH,range:FH,schur:EG,subset:aq,subtract:uH,transpose:oq,typed:Az}),AG=Z$({matrix:Xj,multiply:rH,sylvester:SG,transpose:oq,typed:Az}),TG={},CG={},NG={},kG=XD({mathWithTransform:CG}),MG=_S({Node:kG}),OG=vA({Node:kG}),FG=wA({Node:kG}),LG=EA({Node:kG}),_G=SA({Node:kG}),RG=TA({Node:kG,ResultSet:fz}),IG=NA({Node:kG}),PG=MA({Node:kG}),BG=FA({Node:kG}),UG=LA({classes:NG}),$G=_A({math:TG,typed:Az}),zG=IA({Node:kG,typed:Az}),jG=BA({Chain:$G,typed:Az}),qG=jA({Node:kG,subset:aq}),HG=HA({Node:kG,size:iq}),VG=GA({matrix:Xj,Node:kG,subset:aq}),GG=KA({Unit:rV,Node:kG,math:TG}),KG=JA({Node:kG,SymbolNode:GG,math:TG}),WG=sT({AccessorNode:qG,ArrayNode:_G,AssignmentNode:VG,BlockNode:RG,ConditionalNode:IG,ConstantNode:PG,FunctionAssignmentNode:zG,FunctionNode:KG,IndexNode:HG,ObjectNode:MG,OperatorNode:OG,ParenthesisNode:FG,RangeNode:BG,RelationalNode:LG,SymbolNode:GG,config:VE,numeric:tq,typed:Az}),YG=aT({ConstantNode:PG,FunctionNode:KG,OperatorNode:OG,ParenthesisNode:FG,parse:WG,typed:Az}),JG=pT({bignumber:Bz,fraction:Jj,AccessorNode:qG,ArrayNode:_G,ConstantNode:PG,FunctionNode:KG,IndexNode:HG,ObjectNode:MG,OperatorNode:OG,SymbolNode:GG,config:VE,mathWithTransform:CG,matrix:Xj,typed:Az}),ZG=yT({parse:WG,typed:Az}),XG=bT({parse:WG}),QG=ET({parse:WG,typed:Az}),eK=AT({AccessorNode:qG,ArrayNode:_G,ConstantNode:PG,FunctionNode:KG,IndexNode:HG,ObjectNode:MG,OperatorNode:OG,ParenthesisNode:FG,SymbolNode:GG,add:Pq,divide:zV,equal:vq,isZero:lj,multiply:rH,parse:WG,pow:XH,subtract:uH,typed:Az}),tK=NT({parse:WG,typed:Az}),rK=LT({Help:XG,mathWithTransform:CG,typed:Az}),nK=_T({evaluate:tK}),iK=PT({bignumber:Bz,fraction:Jj,AccessorNode:qG,ArrayNode:_G,ConstantNode:PG,FunctionNode:KG,IndexNode:HG,ObjectNode:MG,OperatorNode:OG,ParenthesisNode:FG,SymbolNode:GG,add:Pq,config:VE,divide:zV,equal:vq,isZero:lj,mathWithTransform:CG,matrix:Xj,multiply:rH,parse:WG,pow:XH,resolve:YG,simplifyConstant:JG,simplifyCore:eK,subtract:uH,typed:Az}),sK=UT({OperatorNode:OG,parse:WG,simplify:iK,typed:Az}),aK=zT({ConstantNode:PG,FunctionNode:KG,OperatorNode:OG,ParenthesisNode:FG,SymbolNode:GG,config:VE,equal:vq,isZero:lj,numeric:tq,parse:WG,simplify:iK,typed:Az}),oK=qT({Parser:nK,typed:Az}),lK=VT({bignumber:Bz,fraction:Jj,AccessorNode:qG,ArrayNode:_G,ConstantNode:PG,FunctionNode:KG,IndexNode:HG,ObjectNode:MG,OperatorNode:OG,ParenthesisNode:FG,SymbolNode:GG,add:Pq,config:VE,divide:zV,equal:vq,isZero:lj,mathWithTransform:CG,matrix:Xj,multiply:rH,parse:WG,pow:XH,simplify:iK,simplifyConstant:JG,simplifyCore:eK,subtract:uH,typed:Az});zE(TG,{e:ez,false:tz,fineStructure:rz,i:iz,Infinity:sz,LN10:az,LOG10E:oz,NaN:uz,null:cz,phi:dz,SQRT1_2:pz,sackurTetrode:mz,tau:gz,true:yz,E:ez,version:vz,efimovFactor:wz,LN2:xz,pi:Ez,replacer:Dz,reviver:UG,SQRT2:Sz,typed:Az,unaryPlus:Tz,PI:Ez,weakMixingAngle:Cz,abs:Nz,acos:kz,acot:Mz,acsc:Oz,addScalar:Fz,arg:Lz,asech:_z,asinh:Rz,atan:Iz,atanh:Pz,bignumber:Bz,bitNot:Uz,boolean:$z,clone:zz,combinations:jz,complex:qz,conj:Hz,cosh:Vz,coth:Gz,csc:Kz,cube:Wz,equalScalar:Yz,erf:Jz,exp:Zz,expm1:Xz,filter:Qz,forEach:ej,format:tj,getMatrixDataType:rj,hex:nj,im:ij,isInteger:sj,isNegative:aj,isPositive:oj,isZero:lj,LOG2E:uj,lgamma:cj,log10:dj,log2:hj,map:fj,multiplyScalar:pj,not:mj,number:gj,oct:yj,pickRandom:vj,print:bj,random:wj,re:xj,sec:Ej,sign:Dj,sin:Sj,splitUnit:Tj,square:Cj,string:Nj,tan:kj,typeOf:Mj,acosh:Oj,acsch:Fj,apply:Lj,asec:_j,bin:Rj,chain:jG,combinationsWithRep:Ij,cos:Pj,csch:Bj,isNaN:Uj,isPrime:$j,randomInt:zj,sech:jj,sinh:qj,sparse:Hj,sqrt:Vj,tanh:Gj,unaryMinus:Kj,acoth:Wj,cot:Yj,fraction:Jj,isNumeric:Zj,matrix:Xj,matrixFromFunction:Qj,mode:eq,numeric:tq,prod:rq,reshape:nq,size:iq,squeeze:sq,subset:aq,transpose:oq,xgcd:lq,zeros:uq,asin:cq,cbrt:dq,concat:hq,count:fq,ctranspose:pq,diag:mq,divideScalar:gq,dotDivide:yq,equal:vq,flatten:bq,gcd:wq,hasNumericValue:xq,identity:Eq,kron:Dq,largerEq:Sq,leftShift:Aq,matrixFromColumns:Tq,mod:Cq,nthRoot:Nq,ones:kq,resize:Mq,rightArithShift:Oq,round:Fq,smaller:Lq,to:_q,unequal:Rq,xor:Iq,add:Pq,bitAnd:Bq,bitXor:Uq,catalan:$q,compare:zq,compareText:jq,cumsum:qq,deepEqual:Hq,dot:Vq,equalText:Gq,floor:Kq,hypot:Wq,invmod:Zq,larger:Xq,log:Qq,matrixFromRows:eH,min:tH,multiply:rH,nthRoots:nH,or:iH,partitionSelect:sH,quantileSeq:aH,rightLogShift:oH,smallerEq:lH,subtract:uH,trace:cH,usolve:dH,zpk2tf:hH,and:fH,bitOr:pH,ceil:mH,compareNatural:gH,composition:yH,cross:vH,det:bH,diff:wH,distance:xH,dotMultiply:EH,fix:SH,index:AH,intersect:TH,lcm:CH,log1p:NH,lsolve:kH,max:MH,qr:OH,range:FH,row:LH,setCartesian:_H,setDistinct:RH,setIsSubset:IH,setPowerset:PH,slu:BH,sort:UH,sum:$H,usolveAll:zH,atan2:jH,column:qH,lsolveAll:HH,setDifference:VH,setMultiplicity:GH,setSymDifference:KH,inv:YH,lup:JH,pinv:ZH,pow:XH,setIntersect:QH,setUnion:eV,sqrtm:tV,vacuumImpedance:nV,wienDisplacement:iV,atomicMass:sV,bohrMagneton:aV,boltzmann:oV,conductanceQuantum:lV,createUnit:uV,deuteronMass:cV,dotPow:dV,electricConstant:hV,elementaryCharge:fV,expm:pV,faraday:mV,fft:gV,gamma:yV,gravitationConstant:vV,hartreeEnergy:bV,ifft:wV,klitzing:xV,loschmidt:EV,magneticConstant:DV,molarMass:SV,molarPlanckConstant:AV,neutronMass:TV,nuclearMagneton:CV,planckCharge:NV,planckLength:kV,planckTemperature:MV,protonMass:OV,reducedPlanckConstant:FV,rydberg:LV,secondRadiation:_V,speedOfLight:RV,stefanBoltzmann:IV,thomsonCrossSection:PV,avogadro:BV,bohrRadius:UV,coulomb:$V,divide:zV,electronMass:jV,factorial:qV,firstRadiation:HV,gravity:VV,inverseConductanceQuantum:GV,lusolve:KV,magneticFluxQuantum:WV,molarMassC12:YV,multinomial:JV,parse:WG,permutations:ZV,planckMass:XV,polynomialRoot:QV,resolve:YG,setSize:eG,simplifyConstant:JG,solveODE:tG,stirlingS2:rG,unit:nG,bellNumbers:iG,compile:ZG,eigs:sG,fermiCoupling:aG,gasConstant:oG,leafCount:QG,mean:lG,molarVolume:uG,planckConstant:cG,quantumOfCirculation:dG,simplifyCore:eK,variance:hG,classicalElectronRadius:fG,evaluate:tK,help:rK,median:pG,simplify:iK,symbolicEqual:sK,derivative:aK,kldivergence:mG,mad:gG,parser:oK,rationalize:lK,std:yG,freqz:vG,norm:bG,rotationMatrix:wG,planckTime:xG,schur:EG,rotate:DG,sylvester:SG,lyap:AG,config:VE}),zE(CG,TG,{filter:YT({typed:Az}),forEach:ZT({typed:Az}),map:XT({typed:Az}),apply:nC({isInteger:sj,typed:Az}),subset:cC({matrix:Xj,typed:Az}),concat:pC({isInteger:sj,matrix:Xj,typed:Az}),max:wC({config:VE,larger:Xq,numeric:tq,typed:Az}),sum:EC({add:Pq,config:VE,numeric:tq,typed:Az}),min:SC({config:VE,numeric:tq,smaller:Lq,typed:Az}),cumsum:NC({add:Pq,typed:Az,unaryPlus:Tz}),diff:FC({bignumber:Bz,matrix:Xj,number:gj,subtract:uH,typed:Az}),index:LC({Index:Jq}),range:IC({bignumber:Bz,matrix:Xj,add:Pq,config:VE,isPositive:oj,larger:Xq,largerEq:Sq,smaller:Lq,smallerEq:lH,typed:Az}),row:BC({Index:Jq,matrix:Xj,range:FH,typed:Az}),column:zC({Index:Jq,matrix:Xj,range:FH,typed:Az}),mean:HC({add:Pq,divide:zV,typed:Az}),variance:YC({add:Pq,apply:Lj,divide:zV,isNaN:Uj,multiply:rH,subtract:uH,typed:Az}),std:ZC({map:fj,sqrt:Vj,typed:Az,variance:hG})}),zE(NG,{BigNumber:X$,Complex:Q$,Fraction:nz,Matrix:lz,Node:kG,ObjectNode:MG,OperatorNode:OG,ParenthesisNode:FG,Range:hz,RelationalNode:LG,ResultSet:fz,ArrayNode:_G,BlockNode:RG,ConditionalNode:IG,ConstantNode:PG,DenseMatrix:bz,RangeNode:BG,Chain:$G,FunctionAssignmentNode:zG,SparseMatrix:Aj,AccessorNode:qG,IndexNode:HG,AssignmentNode:VG,ImmutableDenseMatrix:Yq,Index:Jq,FibonacciHeap:DH,Spa:WH,Unit:rV,SymbolNode:GG,FunctionNode:KG,Help:XG,Parser:nK}),$G.createProxy(TG),IE.plugin($E),IE.data("drawer",(function(){return{init:function(){document.body.classList.add("overflow-hidden")},destroy:function(){document.body.classList.remove("overflow-hidden"),this.$el.remove()}}})),IE.data("modal",(function(){return{closeModal:function(e){e.classList.add("closing"),e.addEventListener("animationend",(function(){return e.remove()}),{once:!0})}}})),IE.data("videoPlaceholder",(function(){return{open:function(){document.querySelector("[video-placeholder]").classList.remove("hidden")},close:function(){var e;console.log("closing video player"),null===(e=window.player)||void 0===e||e.pause(),document.querySelector("[video-placeholder]").classList.add("hidden")}}})),IE.data("videoAutoPlayNext",(function(){var e=arguments.length>1?arguments[1]:void 0;return{enabled:!!e&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]),displayed:!1,timeRemaining:100,threshold:15,onTimeUpdate:function(e){if(this.enabled){var t=e.detail.player,r=t.currentTime,n=t.duration,i=jG(n).subtract(r).done();this.timeRemaining=Math.floor(i),this.displayed=this.timeRemaining<=this.threshold,0===this.timeRemaining&&this.onPlayNext()}},onPlayNext:function(){this.enabled&&window.up.visit(e+"?autoplay=1")},onCancel:function(){this.enabled=!1,this.displayed=!1}}})),IE.data("copyToClipboard",(function(e){return{copyText:e,copyNotification:!1,copyToClipboard:function(){var e=this;navigator.clipboard.writeText(this.copyText),this.copyNotification=!0,setTimeout((function(){return e.copyNotification=!1}),3e3)}}})),IE.data("comments",(function(){return{editId:null,createId:null,create:function(e){this.cancel(),this.createId=e},edit:function(e){this.cancel(),this.editId=e},cancel:function(){this.editId=null,this.createId=null}}})),IE.data("turnstile",(function(){return{onRender:function(e){turnstile.render(this.$el,{sitekey:e,callback:function(e){}})}}})),window.countdown=function(e){var t=e.dateTime;return{target:t,interval:null,days:0,hours:0,minutes:0,seconds:0,init:function(){var e=this,r=qi.fromISO(t);this.interval=setInterval((function(){var t=r.diff(qi.now(),["milliseconds"]).milliseconds;e.days=Math.floor(t/864e5),e.hours=Math.floor(t%864e5/36e5),e.minutes=Math.floor(t%36e5/6e4),e.seconds=Math.floor(t%6e4/1e3),e.days||e.hours||e.minutes||e.seconds||clearInterval(e.interval)}),1e3)},destroy:function(){clearInterval(this.interval)}}},IE.start();r(1014);function uK(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var cK,dK,hK,fK,pK,mK={exports:{}};cK=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,dK=/^(?=([^\/?#]*))\1([^]*)$/,hK=/(?:\/|^)\.(?=\/)/g,fK=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,mK.exports=pK={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=pK.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=pK.normalizePath(n.path),pK.buildURLFromParts(n)}var i=pK.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=pK.normalizePath(i.path),pK.buildURLFromParts(i)):t;var s=pK.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var a=dK.exec(s.path);s.netLoc=a[1],s.path=a[2]}s.netLoc&&!s.path&&(s.path="/");var o={scheme:s.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(o.netLoc=s.netLoc,"/"!==i.path[0]))if(i.path){var l=s.path,u=l.substring(0,l.lastIndexOf("/")+1)+i.path;o.path=pK.normalizePath(u)}else o.path=s.path,i.params||(o.params=s.params,i.query||(o.query=s.query));return null===o.path&&(o.path=r.alwaysNormalize?pK.normalizePath(i.path):i.path),pK.buildURLFromParts(o)},parseURL:function(e){var t=cK.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(hK,"");e.length!==(e=e.replace(fK,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};var gK=mK.exports;function yK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function vK(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yK(Object(r),!0).forEach((function(t){bK(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yK(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function bK(e,t,r){return t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wK(){return wK=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wK.apply(this,arguments)}const xK=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)};let EK=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),DK=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),SK=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({});const AK=function(){},TK={trace:AK,debug:AK,log:AK,warn:AK,info:AK,error:AK};let CK=TK;function NK(e,...t){t.forEach((function(t){CK[t]=e[t]?e[t].bind(e):function(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):AK}(t)}))}const kK=CK,MK=/^(\d+)x(\d+)$/,OK=/(.+?)=(".*?"|.*?)(?:,|$)/g;class FK{constructor(e){"string"==typeof e&&(e=FK.parseAttrList(e));for(const t in e)e.hasOwnProperty(t)&&("X-"===t.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=MK.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={};for(OK.lastIndex=0;null!==(t=OK.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1));r[t[1].trim()]=e}return r}}function LK(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class _K{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const t in r)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==r[t]){kK.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=wK(new FK({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);xK(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(xK(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&xK(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class RK{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var IK="audio",PK="video",BK="audiovideo";class UK{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[IK]:null,[PK]:null,[BK]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2),n=[];1===r.length?n[0]=t?t.byteRangeEndOffset:0:n[0]=parseInt(r[1]),n[1]=parseInt(r[0])+n[0],this._byteRange=n}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=gK.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class $K extends UK{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new RK,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!xK(this.programDateTime))return null;const e=xK(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,n,i,s=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,i)):a[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:s}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[IK]=null,e[PK]=null,e[BK]=null}}class zK extends UK{constructor(e,t,r,n,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new RK,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}class jK{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&xK(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function qK(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function HK(e){const t=e.split(":");let r=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),n=e[e.length-1].split(",");if(2===n.length){const t="base64"===n[0],i=n[1];t?(e.splice(-1,1),r=qK(i)):r=function(e){const t=VK(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}(i)}}return r}function VK(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}var GK={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KK="org.w3.clearkey",WK="com.apple.streamingkeydelivery",YK="com.microsoft.playready",JK="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function ZK(e){switch(e){case WK:return GK.FAIRPLAY;case YK:return GK.PLAYREADY;case JK:return GK.WIDEVINE;case KK:return GK.CLEARKEY}}var XK="edef8ba979d64acea3c827dcd51d21ed";function QK(e){switch(e){case GK.FAIRPLAY:return WK;case GK.PLAYREADY:return YK;case GK.WIDEVINE:return JK;case GK.CLEARKEY:return KK}}function eW(e){const{drmSystems:t,widevineLicenseUrl:r}=e,n=t?[GK.FAIRPLAY,GK.WIDEVINE,GK.PLAYREADY,GK.CLEARKEY].filter((e=>!!t[e])):[];return!n[GK.WIDEVINE]&&r&&n.push(GK.WIDEVINE),n}const tW="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function rW(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}const nW=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,iW=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,sW=(e,t)=>{const r=t;let n=0;for(;nW(e,t);){n+=10;n+=aW(e,t+6),iW(e,t+10)&&(n+=10),t+=n}if(n>0)return e.subarray(r,r+n)},aW=(e,t)=>{let r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r},oW=(e,t)=>nW(e,t)&&aW(e,t+6)+10<=e.length-t,lW=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,uW=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=aW(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},cW=e=>{let t=0;const r=[];for(;nW(e,t);){const n=aW(e,t+6);t+=10;const i=t+n;for(;t+8<i;){const n=uW(e.subarray(t)),i=dW(n);i&&r.push(i),t+=n.size+10}iW(e,t)&&(t+=10)}return r},dW=e=>"PRIV"===e.type?hW(e):"W"===e.type[0]?pW(e):fW(e),hW=e=>{if(e.size<2)return;const t=gW(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}},fW=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const r=gW(e.data.subarray(t),!0);t+=r.length+1;const n=gW(e.data.subarray(t));return{key:e.type,info:r,data:n}}const t=gW(e.data.subarray(1));return{key:e.type,data:t}},pW=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const r=gW(e.data.subarray(t),!0);t+=r.length+1;const n=gW(e.data.subarray(t));return{key:e.type,info:r,data:n}}const t=gW(e.data);return{key:e.type,data:t}},mW=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),r=1&t[3];let n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}},gW=(e,t=!1)=>{const r=vW();if(r){const n=r.decode(e);if(t){const e=n.indexOf("\0");return-1!==e?n.substring(0,e):n}return n.replace(/\0/g,"")}const n=e.length;let i,s,a,o="",l=0;for(;l<n;){if(i=e[l++],0===i&&t)return o;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:s=e[l++],o+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=e[l++],a=e[l++],o+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&a)<<0)}}return o};let yW;function vW(){return yW||void 0===self.TextDecoder||(yW=new self.TextDecoder("utf-8")),yW}const bW=function(e){let t="";for(let r=0;r<e.length;r++){let n=e[r].toString(16);n.length<2&&(n="0"+n),t+=n}return t},wW=Math.pow(2,32)-1,xW=[].push,EW={video:1,audio:2,id3:3,text:4};function DW(e){return String.fromCharCode.apply(null,e)}function SW(e,t){const r=e[t]<<8|e[t+1];return r<0?65536+r:r}function AW(e,t){const r=TW(e,t);return r<0?4294967296+r:r}function TW(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function CW(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function NW(e,t){const r=[];if(!t.length)return r;const n=e.byteLength;for(let i=0;i<n;){const s=AW(e,i),a=s>1?i+s:n;if(DW(e.subarray(i+4,i+8))===t[0])if(1===t.length)r.push(e.subarray(i+8,a));else{const n=NW(e.subarray(i+8,a),t.slice(1));n.length&&xW.apply(r,n)}i=a}return r}function kW(e){const t=[],r=e[0];let n=8;const i=AW(e,n);n+=4;n+=0===r?8:16,n+=2;let s=e.length+0;const a=SW(e,n);n+=2;for(let r=0;r<a;r++){let r=n;const a=AW(e,r);r+=4;const o=2147483647&a;if(1===(2147483648&a)>>>31)return kK.warn("SIDX has hierarchical references (not supported)"),null;const l=AW(e,r);r+=4,t.push({referenceSize:o,subsegmentDuration:l,info:{duration:l/i,start:s,end:s+o-1}}),s+=o,r+=4,n=r}return{earliestPresentationTime:0,timescale:i,version:r,referencesCount:a,references:t}}function MW(e){const t=[],r=NW(e,["moov","trak"]);for(let e=0;e<r.length;e++){const n=r[e],i=NW(n,["tkhd"])[0];if(i){let e=i[0],r=0===e?12:20;const s=AW(i,r),a=NW(n,["mdia","mdhd"])[0];if(a){e=a[0],r=0===e?12:20;const i=AW(a,r),o=NW(n,["mdia","hdlr"])[0];if(o){const e=DW(o.subarray(8,12)),r={soun:IK,vide:PK}[e];if(r){const e=NW(n,["mdia","minf","stbl","stsd"])[0];let a;e&&(a=DW(e.subarray(12,16))),t[s]={timescale:i,type:r},t[r]={timescale:i,id:s,codec:a}}}}}}return NW(e,["moov","mvex","trex"]).forEach((e=>{const r=AW(e,4),n=t[r];n&&(n.default={duration:AW(e,12),flags:AW(e,20)})})),t}function OW(e){const t=NW(e,["schm"])[0];if(t){const r=DW(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return NW(e,["schi","tenc"])[0]}return kK.error("[eme] missing 'schm' box"),null}function FW(e){const t=AW(e,0);let r=8;1&t&&(r+=4),4&t&&(r+=4);let n=0;const i=AW(e,4);for(let s=0;s<i;s++){if(256&t){n+=AW(e,r),r+=4}512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4)}return n}function LW(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function _W(e,t){const r=[],n=t.samples,i=t.timescale,s=t.id;let a=!1;return NW(n,["moof"]).map((o=>{const l=o.byteOffset-8;NW(o,["traf"]).map((o=>{const u=NW(o,["tfdt"]).map((e=>{const t=e[0];let r=AW(e,4);return 1===t&&(r*=Math.pow(2,32),r+=AW(e,8)),r/i}))[0];return void 0!==u&&(e=u),NW(o,["tfhd"]).map((u=>{const c=AW(u,4),d=16777215&AW(u,0);let h=0;const f=0!=(16&d);let p=0;const m=0!=(32&d);let g=8;c===s&&(0!=(1&d)&&(g+=8),0!=(2&d)&&(g+=4),0!=(8&d)&&(h=AW(u,g),g+=4),f&&(p=AW(u,g),g+=4),m&&(g+=4),"video"===t.type&&(a=function(e){if(!e)return!1;const t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),NW(o,["trun"]).map((s=>{const o=s[0],u=16777215&AW(s,0),c=0!=(1&u);let d=0;const f=0!=(4&u),m=0!=(256&u);let g=0;const y=0!=(512&u);let v=0;const b=0!=(1024&u),w=0!=(2048&u);let x=0;const E=AW(s,4);let D=8;c&&(d=AW(s,D),D+=4),f&&(D+=4);let S=d+l;for(let l=0;l<E;l++){if(m?(g=AW(s,D),D+=4):g=h,y?(v=AW(s,D),D+=4):v=p,b&&(D+=4),w&&(x=0===o?AW(s,D):TW(s,D),D+=4),t.type===PK){let t=0;for(;t<v;){const s=AW(n,S);if(S+=4,RW(a,n[S])){IW(n.subarray(S,S+s),a?2:1,e+x/i,r)}S+=s,t+=s+4}}e+=g/i}})))}))}))})),r}function RW(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function IW(e,t,r,n){const i=PW(e);let s=0;s+=t;let a=0,o=0,l=!1,u=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;u=i[s++],a+=u}while(255===u);o=0;do{if(s>=i.length)break;u=i[s++],o+=u}while(255===u);const e=i.length-s;if(!l&&4===a&&s<i.length){l=!0;if(181===i[s++]){const e=SW(i,s);if(s+=2,49===e){const e=AW(i,s);if(s+=4,1195456820===e){const e=i[s++];if(3===e){const t=i[s++],o=64&t,l=o?2+3*(31&t):0,u=new Uint8Array(l);if(o){u[0]=t;for(let e=1;e<l;e++)u[e]=i[s++]}n.push({type:e,payloadType:a,pts:r,bytes:u})}}}}}else if(5===a&&o<e){if(l=!0,o>16){const e=[];for(let t=0;t<16;t++){const r=i[s++].toString(16);e.push(1==r.length?"0"+r:r),3!==t&&5!==t&&7!==t&&9!==t||e.push("-")}const t=o-16,l=new Uint8Array(t);for(let e=0;e<t;e++)l[e]=i[s++];n.push({payloadType:a,pts:r,uuid:e.join(""),userData:gW(l),userDataBytes:l})}}else if(o<e)s+=o;else if(o>e)break}}function PW(e){const t=e.byteLength,r=[];let n=1;for(;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;const i=t-r.length,s=new Uint8Array(i);let a=0;for(n=0;n<i;a++,n++)a===r[0]&&(a++,r.shift()),s[n]=e[a];return s}function BW(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");let n,i,s;if(t){n=1,i=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const r=t[e];if(16!==r.byteLength)throw new RangeError("Invalid key");i.set(r,16*e)}}else n=0,i=new Uint8Array;n>0?(s=new Uint8Array(4),t.length>0&&new DataView(s.buffer).setUint32(0,t.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(a.buffer).setUint32(0,r.byteLength,!1),function(e,...t){const r=t.length;let n=8,i=r;for(;i--;)n+=t[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=255&n,s.set(e,4),i=0,n=8;i<r;i++)s.set(t[i],n),n+=t[i].byteLength;return s}([112,115,115,104],new Uint8Array([n,0,0,0]),e,s,i,a,r||new Uint8Array)}let UW={};class $W{static clearKeyUriToKeyIdMap(){UW={}}constructor(e,t,r,n=[1],i=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=n,this.iv=i,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case WK:case JK:case YK:case KK:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||kK.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function(e){const t=new Uint8Array(16);for(let r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(e);return new $W(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=HK(this.uri);if(t)switch(this.keyFormat){case JK:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case YK:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=BW(e,null,t);const r=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),n=String.fromCharCode.apply(null,Array.from(r)),i=n.substring(n.indexOf("<"),n.length),s=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(s){const e=s.childNodes[0]?s.childNodes[0].nodeValue:s.getAttribute("VALUE");if(e){const t=qK(e).subarray(0,16);!function(e){const t=function(e,t,r){const n=e[t];e[t]=e[r],e[r]=n};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=UW[this.uri];if(!e){const t=Object.keys(UW).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),UW[this.uri]=e}this.keyId=e}return this}}const zW=/\{\$([a-zA-Z0-9-_]+)\}/g;function jW(e){return zW.test(e)}function qW(e,t,r){if(null!==e.variableList||e.hasVariableRefs)for(let n=r.length;n--;){const i=r[n],s=t[i];s&&(t[i]=HW(e,s))}}function HW(e,t){if(null!==e.variableList||e.hasVariableRefs){const r=e.variableList;return t.replace(zW,(t=>{const n=t.substring(2,t.length-1),i=null==r?void 0:r[n];return void 0===i?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),t):i}))}return t}function VW(e,t,r){let n,i,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){n=t.QUERYPARAM;try{const e=new self.URL(r).searchParams;if(!e.has(n))throw new Error(`"${n}" does not match any query parameter in URI: "${r}"`);i=e.get(n)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else n=t.NAME,i=t.VALUE;n in s?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):s[n]=i||""}function GW(e,t,r){const n=t.IMPORT;if(r&&n in r){let t=e.variableList;t||(e.variableList=t={}),t[n]=r[n]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}function KW(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}const WW={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},YW=KW();function JW(e,t){var r;return null!=(r=null==YW?void 0:YW.isTypeSupported(`${t||"video"}/mp4;codecs="${e}"`))&&r}const ZW=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,XW=/#EXT-X-MEDIA:(.*)/g,QW=/^#EXT(?:INF|-X-TARGETDURATION):/m,eY=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),tY=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class rY{static findGroup(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.id===t)return n}}static convertAVC1ToAVCOTI(e){const t=e.split(".");if(t.length>2){let e=t.shift()+".";return e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).slice(-4),e}return e}static resolve(e,t){return gK.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return QW.test(e)}static parseMasterPlaylist(e,t){const r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:jW(e)},n=[];let i;for(ZW.lastIndex=0;null!=(i=ZW.exec(e));)if(i[1]){var s;const e=new FK(i[1]);qW(r,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const a=HW(r,i[2]),o={attrs:e,bitrate:e.decimalInteger("AVERAGE-BANDWIDTH")||e.decimalInteger("BANDWIDTH"),name:e.NAME,url:rY.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),sY((e.CODECS||"").split(/[ ,]+/).filter((e=>e)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=rY.convertAVC1ToAVCOTI(o.videoCodec)),null!=(s=o.unknownCodecs)&&s.length||n.push(o),r.levels.push(o)}else if(i[3]){const e=i[3],n=i[4];switch(e){case"SESSION-DATA":{const e=new FK(n);qW(r,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[t]=e);break}case"SESSION-KEY":{const e=nY(n,t,r);e.encrypted&&e.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(e)):kK.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${n}"`);break}case"DEFINE":{const e=new FK(n);qW(r,e,["NAME","VALUE","QUERYPARAM"]),VW(r,e,t)}break;case"CONTENT-STEERING":{const e=new FK(n);qW(r,e,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:rY.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":r.startTimeOffset=iY(n)}}const a=n.length>0&&n.length<r.levels.length;return r.levels=a?n:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,r){let n;const i={},s=r.levels,a={AUDIO:s.map((e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec}))),SUBTITLES:s.map((e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(XW.lastIndex=0;null!==(n=XW.exec(e));){const e=new FK(n[1]),s=e.TYPE;if(s){const n=a[s],l=i[s]||[];i[s]=l,qW(r,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const u={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",instreamId:e["INSTREAM-ID"],name:e.NAME||e.LANGUAGE||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:e.LANGUAGE,url:e.URI?rY.resolve(e.URI,t):""};if(null!=n&&n.length){const e=rY.findGroup(n,u.groupId)||n[0];aY(u,e,"audioCodec"),aY(u,e,"textCodec")}l.push(u)}}return i}static parseLevelPlaylist(e,t,r,n,i,s){const a=new jK(t),o=a.fragments;let l,u,c,d=null,h=0,f=0,p=0,m=0,g=null,y=new $K(n,t),v=-1,b=!1;for(eY.lastIndex=0,a.m3u8=e,a.hasVariableRefs=jW(e);null!==(l=eY.exec(e));){b&&(b=!1,y=new $K(n,t),y.start=p,y.sn=h,y.cc=m,y.level=r,d&&(y.initSegment=d,y.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));const e=l[1];if(e){y.duration=parseFloat(e);const t=(" "+l[2]).slice(1);y.title=t||null,y.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(xK(y.duration)){y.start=p,c&&uY(y,c,a),y.sn=h,y.level=r,y.cc=m,y.urlId=i,o.push(y);const e=(" "+l[3]).slice(1);y.relurl=HW(a,e),oY(y,g),g=y,p+=y.duration,h++,f=0,b=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);g?y.setByteRange(e,g):y.setByteRange(e)}else if(l[5])y.rawProgramDateTime=(" "+l[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===v&&(v=o.length);else{if(l=l[0].match(tY),!l){kK.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length&&void 0===l[u];u++);const e=(" "+l[u]).slice(1),i=(" "+l[u+1]).slice(1),p=l[u+2]?(" "+l[u+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":a.type=i.toUpperCase();break;case"MEDIA-SEQUENCE":h=a.startSN=parseInt(i);break;case"SKIP":{const e=new FK(i);qW(a,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(xK(t)){a.skippedSegments=t;for(let e=t;e--;)o.unshift(null);h+=t}const r=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");r&&(a.recentlyRemovedDateranges=r.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(i),1);break;case"VERSION":a.version=parseInt(i);break;case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(i||p)&&y.tagList.push(p?[i,p]:[i]);break;case"DISCONTINUITY":m++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([e]);break;case"BITRATE":y.tagList.push([e,i]);break;case"DATERANGE":{const e=new FK(i);qW(a,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),qW(a,e,e.clientAttrs);const t=new _K(e,a.dateRanges[e.ID]);t.isValid||a.skippedSegments?a.dateRanges[t.id]=t:kK.warn(`Ignoring invalid DATERANGE tag: "${i}"`),y.tagList.push(["EXT-X-DATERANGE",i]);break}case"DEFINE":{const e=new FK(i);qW(a,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?GW(a,e,s):VW(a,e,t)}break;case"DISCONTINUITY-SEQUENCE":m=parseInt(i);break;case"KEY":{const e=nY(i,t,a);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}c||(c={}),c[e.keyFormat]&&(c=wK({},c)),c[e.keyFormat]=e}else kK.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${i}"`);break}case"START":a.startTimeOffset=iY(i);break;case"MAP":{const e=new FK(i);if(qW(a,e,["BYTERANGE","URI"]),y.duration){const i=new $K(n,t);lY(i,e,r,c),d=i,y.initSegment=d,d.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=d.rawProgramDateTime)}else lY(y,e,r,c),d=y,b=!0;break}case"SERVER-CONTROL":{const e=new FK(i);a.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),a.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new FK(i);a.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=a.partList;e||(e=a.partList=[]);const r=f>0?e[e.length-1]:void 0,n=f++,s=new FK(i);qW(a,s,["BYTERANGE","URI"]);const o=new zK(s,y,t,n,r);e.push(o),y.duration+=o.duration;break}case"PRELOAD-HINT":{const e=new FK(i);qW(a,e,["URI"]),a.preloadHint=e;break}case"RENDITION-REPORT":{const e=new FK(i);qW(a,e,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(e);break}default:kK.warn(`line parsed but not handled: ${l}`)}}}g&&!g.relurl?(o.pop(),p-=g.duration,a.partList&&(a.fragmentHint=g)):a.partList&&(oY(y,g),y.cc=m,a.fragmentHint=y,c&&uY(y,c,a));const w=o.length,x=o[0],E=o[w-1];if(p+=a.skippedSegments*a.targetduration,p>0&&w&&E){a.averagetargetduration=p/w;const e=E.sn;a.endSN="initSegment"!==e?e:0,a.live||(E.endList=!0),x&&(a.startCC=x.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(p+=a.fragmentHint.duration),a.totalduration=p,a.endCC=m,v>0&&function(e,t){let r=e[t];for(let n=t;n--;){const t=e[n];if(!t)return;t.programDateTime=r.programDateTime-1e3*t.duration,r=t}}(o,v),a}}function nY(e,t,r){var n,i;const s=new FK(e);qW(r,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=null!=(n=s.METHOD)?n:"",o=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=null!=(i=s.KEYFORMAT)?i:"identity";o&&s.IV&&!l&&kK.error(`Invalid IV: ${s.IV}`);const d=o?rY.resolve(o,t):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new $W(a,d,c,h,l)}function iY(e){const t=new FK(e).decimalFloatingPoint("TIME-OFFSET");return xK(t)?t:null}function sY(e,t){["video","audio","text"].forEach((r=>{const n=e.filter((e=>function(e,t){const r=WW[t];return!!r&&!0===r[e.slice(0,4)]}(e,r)));if(n.length){const i=n.filter((e=>0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)));t[`${r}Codec`]=i.length>0?i[0]:n[0],e=e.filter((e=>-1===n.indexOf(e)))}})),t.unknownCodecs=e}function aY(e,t,r){const n=t[r];n&&(e[r]=n)}function oY(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),xK(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function lY(e,t,r,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function uY(e,t,r){e.levelkeys=t;const{encryptedFragments:n}=r;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||n.push(e)}var cY="manifest",dY="level",hY="audioTrack",fY="subtitleTrack",pY="main",mY="audio",gY="subtitle";function yY(e){const{type:t}=e;switch(t){case hY:return mY;case fY:return gY;default:return pY}}function vY(e,t){let r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}class bY{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.LEVEL_LOADING,this.onLevelLoading,this),e.on(EK.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(EK.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.LEVEL_LOADING,this.onLevelLoading,this),e.off(EK.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(EK.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return this.loaders[e.type]=i,i}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:cY,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:n,url:i,deliveryDirectives:s}=t;this.load({id:r,level:n,responseType:"text",type:dY,url:i,deliveryDirectives:s})}onAudioTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:s}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:hY,url:i,deliveryDirectives:s})}onSubtitleTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:s}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:fY,url:i,deliveryDirectives:s})}load(e){var t;const r=this.hls.config;let n,i=this.getInternalLoader(e);if(i){const t=i.context;if(t&&t.url===e.url)return void kK.trace("[playlist-loader]: playlist request ongoing");kK.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}if(n=e.type===cY?r.manifestLoadPolicy.default:wK({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part){let t;if(e.type===dY&&null!==e.level?t=this.hls.levels[e.level].details:e.type===hY&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===fY&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,r=t.targetduration;if(e&&r){const t=1e3*Math.max(3*e,.8*r);n=wK({},n,{maxTimeToFirstByteMs:Math.min(t,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,n.maxTimeToFirstByteMs)})}}}const s=n.errorRetry||n.timeoutRetry||{},a={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},o={onSuccess:(e,t,r,n)=>{const i=this.getInternalLoader(r);this.resetInternalLoader(r.type);const s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),rY.isMediaPlaylist(s)?this.handleTrackOrLevelPlaylist(e,t,r,n||null,i):this.handleMasterPlaylist(e,t,r,n)):this.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),n||null,t)},onError:(e,t,r,n)=>{this.handleNetworkError(t,r,!1,e,n)},onTimeout:(e,t,r)=>{this.handleNetworkError(t,r,!0,void 0,e)}};i.load(e,a,o)}handleMasterPlaylist(e,t,r,n){const i=this.hls,s=e.data,a=vY(e,r),o=rY.parseMasterPlaylist(s,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,r,o.playlistParsingError,n,t);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f}=o;this.variableList=f;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":g}=rY.parseMasterPlaylistMedia(s,a,o);if(p.length){p.some((e=>!e.url))||!u[0].audioCodec||u[0].attrs.AUDIO||(kK.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new FK({}),bitrate:0,url:""}))}i.trigger(EK.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:m,captions:g,contentSteering:l,url:a,stats:t,networkDetails:n,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,r,n,i){const s=this.hls,{id:a,level:o,type:l}=r,u=vY(e,r),c=xK(a)?a:0,d=xK(o)?o:c,h=yY(r),f=rY.parseLevelPlaylist(e.data,u,d,h,c,this.variableList);if(l===cY){const e={attrs:new FK({}),bitrate:0,details:f,name:"",url:u};s.trigger(EK.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=f,this.handlePlaylistLoaded(f,e,t,r,n,i)}handleManifestParsingError(e,t,r,n,i){this.hls.trigger(EK.ERROR,{type:DK.NETWORK_ERROR,details:SK.MANIFEST_PARSING_ERROR,fatal:t.type===cY,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:i})}handleNetworkError(e,t,r=!1,n,i){let s=`A network ${r?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===dY?s+=`: ${e.level} id: ${e.id}`:e.type!==hY&&e.type!==fY||(s+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(s);kK.warn(`[playlist-loader]: ${s}`);let o=SK.UNKNOWN,l=!1;const u=this.getInternalLoader(e);switch(e.type){case cY:o=r?SK.MANIFEST_LOAD_TIMEOUT:SK.MANIFEST_LOAD_ERROR,l=!0;break;case dY:o=r?SK.LEVEL_LOAD_TIMEOUT:SK.LEVEL_LOAD_ERROR,l=!1;break;case hY:o=r?SK.AUDIO_TRACK_LOAD_TIMEOUT:SK.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case fY:o=r?SK.SUBTITLE_TRACK_LOAD_TIMEOUT:SK.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);const c={type:DK.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:i};if(n){const r=(null==t?void 0:t.url)||e.url;c.response=vK({url:r,data:void 0},n)}this.hls.trigger(EK.ERROR,c)}handlePlaylistLoaded(e,t,r,n,i,s){const a=this.hls,{type:o,level:l,id:u,groupId:c,deliveryDirectives:d}=n,h=vY(t,n),f=yY(n),p="number"==typeof n.level&&f===pY?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void a.trigger(EK.ERROR,{type:DK.NETWORK_ERROR,details:SK.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:e,reason:e.message,response:t,context:n,level:p,parent:f,networkDetails:i,stats:r})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m)a.trigger(EK.ERROR,{type:DK.NETWORK_ERROR,details:SK.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:t,context:n,level:p,parent:f,networkDetails:i,stats:r});else switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case cY:case dY:a.trigger(EK.LEVEL_LOADED,{details:e,level:p||0,id:u||0,stats:r,networkDetails:i,deliveryDirectives:d});break;case hY:a.trigger(EK.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:i,deliveryDirectives:d});break;case fY:a.trigger(EK.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:i,deliveryDirectives:d})}}}function wY(e,t){let r;try{r=new Event("addtrack")}catch(e){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function xY(e,t){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(r){kK.debug(`[texttrack-utils]: ${r}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,e.addCue(r)}catch(e){kK.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===r&&(e.mode=r)}function EY(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let t=e.cues.length;t--;)e.removeCue(e.cues[t]);"disabled"===t&&(e.mode=t)}function DY(e,t,r,n){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0){const i=function(e,t,r){const n=[],i=function(e,t){if(t<e[0].startTime)return 0;const r=e.length-1;if(t>e[r].endTime)return-1;let n=0,i=r;for(;n<=i;){const s=Math.floor((i+n)/2);if(t<e[s].startTime)i=s-1;else{if(!(t>e[s].startTime&&n<r))return s;n=s+1}}return e[n].startTime-t<t-e[i].startTime?n:i}(e,t);if(i>-1)for(let s=i,a=e.length;s<a;s++){const i=e[s];if(i.startTime>=t&&i.endTime<=r)n.push(i);else if(i.startTime>r)return n}return n}(e.cues,t,r);for(let t=0;t<i.length;t++)n&&!n(i[t])||e.removeCue(i[t])}"disabled"===i&&(e.mode=i)}var SY="org.id3",AY="com.apple.quicktime.HLS",TY="https://aomedia.org/emsg/ID3";function CY(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const NY=(()=>{const e=CY();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function kY(e,t){return e.getTime()/1e3-t}class MY{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(EK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(EK.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(EK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(EK.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(EY(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return wY(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:n}}}=this;if(!r&&!n)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=CY();for(let e=0;e<i.length;e++){const t=i[e].type;if(t===TY&&!r||!n)continue;const a=cW(i[e].data);if(a){const r=i[e].pts;let n=r+i[e].duration;n>NY&&(n=NY);n-r<=0&&(n=r+.25);for(let e=0;e<a.length;e++){const i=a[e];if(!lW(i)){this.updateId3CueEnds(r,t);const e=new s(r,n,"");e.value=i,t&&(e.type=t),this.id3Track.addCue(e)}}}}}updateId3CueEnds(e,t){var r;const n=null==(r=this.id3Track)?void 0:r.cues;if(n)for(let r=n.length;r--;){const i=n[r];i.type===t&&i.startTime<e&&i.endTime===NY&&(i.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:n}){const{id3Track:i,hls:s}=this;if(!s)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=s;if(i&&(a||o)){let e;e="audio"===n?e=>e.type===SY&&o:"video"===n?e=>e.type===TY&&a:e=>e.type===SY&&o||e.type===TY&&a,DY(i,t,r,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:n}=this,{dateRanges:i}=t,s=Object.keys(i);if(n){const e=Object.keys(r).filter((e=>!s.includes(e)));for(let t=e.length;t--;){const i=e[t];Object.keys(r[i].cues).forEach((e=>{n.removeCue(r[i].cues[e])})),delete r[i]}}const a=t.fragments[t.fragments.length-1];if(0===s.length||!xK(null==a?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=a.programDateTime/1e3-a.start,l=CY();for(let e=0;e<s.length;e++){const t=s[e],n=i[t],a=r[t],d=(null==a?void 0:a.cues)||{};let h=(null==a?void 0:a.durationKnown)||!1;const f=kY(n.startDate,o);let p=NY;const m=n.endDate;if(m)p=kY(m,o),h=!0;else if(n.endOnNext&&!h){const e=s.reduce(((e,t)=>{const r=i[t];return r.class===n.class&&r.id!==t&&r.startDate>n.startDate&&e.push(r),e}),[]).sort(((e,t)=>e.startDate.getTime()-t.startDate.getTime()))[0];e&&(p=kY(e.startDate,o),h=!0)}const g=Object.keys(n.attr);for(let e=0;e<g.length;e++){const r=g[e];if("ID"===(c=r)||"CLASS"===c||"START-DATE"===c||"DURATION"===c||"END-DATE"===c||"END-ON-NEXT"===c)continue;let i=d[r];if(i)h&&!a.durationKnown&&(i.endTime=p);else{let e=n.attr[r];i=new l(f,p,""),LK(r)&&(u=e,e=Uint8Array.from(u.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),i.value={key:r,data:e},i.type=AY,i.id=t,this.id3Track.addCue(i),d[r]=i}}r[t]={cues:d,dateRange:n,durationKnown:h}}var u,c}}class OY{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:r,targetduration:n}=e,{liveSyncDuration:i,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&r||t;(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==i?i:s*n);const u=n;return l+Math.min(1*this.stallCount,u)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;const n=r.edge,i=e-t-this.edgeStalled,s=n-r.totalduration,a=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(s,i),a)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(EK.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(EK.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(EK.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(EK.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===SK.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&kK.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:i}=this.config;if(!n||1===i)return;const s=this.targetLatency;if(null===s)return;const a=r-s,o=a<Math.min(this.maxLatency,s+t.targetduration);if(t.live&&o&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,i)),r=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,r))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const FY=["NONE","TYPE-0","TYPE-1",null];var LY="",_Y="YES",RY="v2";class IY{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class PY{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>e)).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(e){const t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}get audioGroupId(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}get textGroupId(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}addFallback(e){this.url.push(e.url),this._attrs.push(e.attrs)}}function BY(e,t){const r=t.startPTS;if(xK(r)){let n,i=0;t.sn>e.sn?(i=r-e.start,n=e):(i=e.start-r,n=t),n.duration!==i&&(n.duration=i)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function UY(e,t,r,n,i,s){n-r<=0&&(kK.warn("Fragment should have a positive duration",t),n=r+t.duration,s=i+t.duration);let a=r,o=n;const l=t.startPTS,u=t.endPTS;if(xK(l)){const e=Math.abs(l-r);xK(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,a=Math.max(r,l),r=Math.min(r,l),i=Math.min(i,t.startDTS),o=Math.min(n,u),n=Math.max(n,u),s=Math.max(s,t.endDTS)}const c=r-t.start;0!==t.start&&(t.start=r),t.duration=n-t.start,t.startPTS=r,t.maxStartPTS=a,t.startDTS=i,t.endPTS=n,t.minEndPTS=o,t.endDTS=s;const d=t.sn;if(!e||d<e.startSN||d>e.endSN)return 0;let h;const f=d-e.startSN,p=e.fragments;for(p[f]=t,h=f;h>0;h--)BY(p[h],p[h-1]);for(h=f;h<p.length-1;h++)BY(p[h],p[h+1]);return e.fragmentHint&&BY(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,c}function $Y(e,t){let r=null;const n=e.fragments;for(let e=n.length-1;e>=0;e--){const t=n[e].initSegment;if(t){r=t;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let i,s=0;if(function(e,t,r){const n=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let e=i;e<=s;e++){const i=l[a+e];let s=o[e];n&&!s&&e<n&&(s=t.fragments[e]=i),i&&s&&r(i,s)}}(e,t,((e,n)=>{e.relurl&&(s=e.cc-n.cc),xK(e.startPTS)&&xK(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(i=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,n.urlId=e.urlId,e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)})),r){(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((e=>{var t;e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((e=>!e)),t.deltaUpdateFailed){kK.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){const n=wK({},e);r&&r.forEach((e=>{delete n[e]}));return Object.keys(t).forEach((e=>{const r=new _K(t[e].attr,n[e]);r.isValid?n[e]=r:kK.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)})),n}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const a=t.fragments;if(s){kK.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<a.length;e++)a[e].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,r){if(e&&t){let n=0;for(let i=0,s=e.length;i<=s;i++){const s=e[i],a=t[i+n];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?r(s,a):n--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),i?UY(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):zY(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function zY(e,t){const r=t.startSN+t.skippedSegments-e.startSN,n=e.fragments;r<0||r>=n.length||jY(t,n[r].start)}function jY(e,t){if(t){const r=e.fragments;for(let n=e.skippedSegments;n<r.length;n++)r[n].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function qY(e,t,r){var n;return null!=e&&e.details?HY(null==(n=e.details)?void 0:n.partList,t,r):null}function HY(e,t,r){if(e)for(let n=e.length;n--;){const i=e[n];if(i.index===r&&i.fragment.sn===t)return i}return null}function VY(e){switch(e.details){case SK.FRAG_LOAD_TIMEOUT:case SK.KEY_LOAD_TIMEOUT:case SK.LEVEL_LOAD_TIMEOUT:case SK.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function GY(e,t){const r=VY(t);return e.default[(r?"timeout":"error")+"Retry"]}function KY(e,t){const r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function WY(e){return vK(vK({},e),{errorRetry:null,timeoutRetry:null})}function YY(e,t,r,n){return!!e&&t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(n)||!!r)}const JY={search:function(e,t){let r=0,n=e.length-1,i=null,s=null;for(;r<=n;){i=(r+n)/2|0,s=e[i];const a=t(s);if(a>0)r=i+1;else{if(!(a<0))return s;n=i-1}}return null}};function ZY(e,t,r=0,n=0){let i=null;if(e?i=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(i=t[0]),i&&0===XY(r,n,i))return i;const s=JY.search(t,XY.bind(null,r,n));return!s||s===e&&i?i:s}function XY(e=0,t=0,r){if(r.start<=e&&r.start+r.duration>e)return 0;const n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function QY(e,t,r){const n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>e}var eJ=0,tJ=2,rJ=5,nJ=0,iJ=1,sJ=2;function aJ(e,t,r){if(performance.now()-e.lastErrorPerfMs>3e5)return!0;const n=e.details;if(t.details===SK.FRAG_GAP&&n&&t.frag){const e=t.frag.start,r=ZY(null,n.fragments,e);if(r&&!r.gap)return!0}if(r&&e.errors.length<r.errors.length){const r=e.errors[e.errors.length-1];if(n&&r.frag&&t.frag&&Math.abs(r.frag.start-t.frag.start)>3*n.targetduration)return!0}return!1}class oJ{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=kK.log.bind(kK,`${t}:`),this.warn=kK.warn.bind(kK,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t){const r=null==t?void 0:t.renditionReports;if(r){let n=-1;for(let i=0;i<r.length;i++){const s=r[i];let a;try{a=new self.URL(s.URI,t.url).href}catch(e){kK.warn(`Could not construct new URL for Rendition Report: ${e}`),a=s.URI||""}if(a===e){n=i;break}a===e.substring(0,a.length)&&(n=i)}if(-1!==n){const e=r[n],i=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let s=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}return new IY(i,s>=0?s:void 0,LY)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:n,stats:i}=t,s=self.performance.now(),a=i.loading.first?Math.max(0,s-i.loading.first):0;if(n.advancedDateTime=Date.now()-a,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),r&&n.fragments.length>0&&$Y(r,n),!this.canLoad||!n.live)return;let a,o,l;if(n.canBlockReload&&n.endSN&&n.advanced){const e=this.hls.config.lowLatencyMode,i=n.lastPartSn,s=n.endSN,u=n.lastPartIndex,c=i===s;-1!==u?(o=c?s+1:i,l=c?e?0:u:u+1):o=s+1;const d=n.age,h=d+n.ageHeader;let f=Math.min(h-n.partTarget,1.5*n.targetduration);if(f>0){if(r&&f>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${f} with playlist age: ${n.age}`),f=0;else{const e=Math.floor(f/n.targetduration);if(o+=e,void 0!==l){l+=Math.round(f%n.targetduration/n.partTarget)}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${d.toFixed(2)}s goal: ${f} skip sn ${e} to part ${l}`)}n.tuneInGoal=f}if(a=this.getDeliveryDirectives(n,t.deliveryDirectives,o,l),e||!c)return void this.loadPlaylist(a)}else(n.canBlockReload||n.canSkipUntil)&&(a=this.getDeliveryDirectives(n,t.deliveryDirectives,o,l));const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,d=function(e,t=1/0){let r=1e3*e.targetduration;if(e.updated){const n=e.fragments,i=4;if(n.length&&r*i>t){const e=1e3*n[n.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}(n,1e3*(n.edge-c));n.updated&&s>this.requestScheduled+d&&(this.requestScheduled=i.loading.start),void 0!==o&&n.canBlockReload?this.requestScheduled=i.loading.first+d-(1e3*n.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+d<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=d);let h=this.requestScheduled-s;h=Math.max(0,h),this.log(`reload live playlist ${e} in ${Math.round(h)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(a)),h)}else this.clearTimer()}getDeliveryDirectives(e,t,r,n){let i=function(e,t){const{canSkipUntil:r,canSkipDateRanges:n,endSN:i}=e;return r&&(void 0!==t?t-i:0)<r?n?RY:_Y:LY}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,i=LY),new IY(r,n,i)}checkRetry(e){const t=e.details,r=VY(e),n=e.errorAction,{action:i,retryCount:s=0,retryConfig:a}=n||{},o=!!n&&!!a&&(i===rJ||!n.resolved&&i===tJ);if(o){var l;if(this.requestScheduled=-1,s>=a.maxNumRetry)return!1;if(r&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=KY(a,s);this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,n.resolved=!0}return o}}let lJ;class uJ extends oJ{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(EK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(EK.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(EK.FRAG_LOADED,this.onFragLoaded,this),e.on(EK.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(EK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(EK.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(EK.FRAG_LOADED,this.onFragLoaded,this),e.off(EK.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=[],n={};let i;t.levels.forEach((e=>{var t;const s=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(lJ||(lJ=/chrome|firefox/i.test(navigator.userAgent)),lJ&&(e.audioCodec=void 0));const{AUDIO:a,CODECS:o,"FRAME-RATE":l,"PATHWAY-ID":u,RESOLUTION:c,SUBTITLES:d}=s,h=`${`${u||"."}-`}${e.bitrate}-${c}-${l}-${o}`;i=n[h],i?i.addFallback(e):(i=new PY(e),n[h]=i,r.push(i)),cJ(i,"audio",a),cJ(i,"text",d)})),this.filterAndSortMediaOptions(r,t)}filterAndSortMediaOptions(e,t){let r=[],n=[],i=!1,s=!1,a=!1,o=e.filter((({audioCodec:e,videoCodec:t,width:r,height:n,unknownCodecs:o})=>(i||(i=!(!r||!n)),s||(s=!!t),a||(a=!!e),!(null!=o&&o.length)&&(!e||JW(e,"audio"))&&(!t||JW(t,"video")))));if((i||s)&&a&&(o=o.filter((({videoCodec:e,width:t,height:r})=>!!e||!(!t||!r)))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}));t.audioTracks&&(r=t.audioTracks.filter((e=>!e.audioCodec||JW(e.audioCodec,"audio"))),dJ(r)),t.subtitles&&(n=t.subtitles,dJ(n));const l=o.slice(0);o.sort(((e,t)=>e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):i&&e.height!==t.height?e.height-t.height:0));let u=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let e=0;e<l.length;e++)if(l[e].pathwayId===o[0].pathwayId){u=l[e];break}this._levels=o;for(let e=0;e<o.length;e++)if(o[e]===u){this._firstLevel=e,this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${u.bitrate}`);break}const c=a&&!s,d={levels:o,audioTracks:r,subtitleTracks:n,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:s,altAudio:!c&&r.some((e=>!!e.url))};this.hls.trigger(EK.MANIFEST_PARSED,d),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const r=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(EK.ERROR,{type:DK.OTHER_ERROR,details:SK.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:r,reason:r.message}),n)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,i=n?n.attrs["PATHWAY-ID"]:void 0,s=t[e],a=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,r===e&&s.details&&n&&i===a)return;this.log(`Switching to level ${e}${a?" with Pathway "+a:""} from level ${r}${i?" with Pathway "+i:""}`);const o=wK({},s,{level:e,maxBitrate:s.maxBitrate,attrs:s.attrs,uri:s.uri,urlId:s.urlId});delete o._attrs,delete o._urlId,this.hls.trigger(EK.LEVEL_SWITCHING,o);const l=s.details;if(!l||l.live){const e=this.switchParams(s.uri,null==n?void 0:n.details);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===dY&&t.context.level===this.level&&this.checkRetry(t)}onFragLoaded(e,{frag:t}){if(void 0!==t&&t.type===pY){const e=this._levels[t.level];void 0!==e&&(e.loadError=0)}}onLevelLoaded(e,t){var r;const{level:n,details:i}=t,s=this._levels[n];var a;if(!s)return this.warn(`Invalid level index ${n}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(i.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(n,t,s.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(i.deltaUpdateFailed=!0)}onAudioTrackSwitched(e,t){const r=this.currentLevel;if(!r)return;const n=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==n){let e=-1;for(let t=0;t<r.audioGroupIds.length;t++)if(r.audioGroupIds[t]===n){e=t;break}-1!==e&&e!==r.urlId&&(r.urlId=e,this.canLoad&&this.startLoad())}}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){const n=r.urlId;let i=r.uri;if(e)try{i=e.addDirectives(i)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}const s=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} URI ${n+1}/${r.url.length} ${i}`),this.clearTimer(),this.hls.trigger(EK.LEVEL_LOADING,{url:i,level:t,id:n,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e,t){const r=(e,r)=>r!==t,n=this._levels.filter(((n,i)=>i!==e||(n.url.length>1&&void 0!==t?(n.url=n.url.filter(r),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(r)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(r)),n.urlId=0,!0):(this.steering&&this.steering.removeLevel(n),!1))));this.hls.trigger(EK.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){t.forEach(((e,t)=>{const{details:r}=e;null!=r&&r.fragments&&r.fragments.forEach((e=>{e.level=t}))})),this._levels=t}}function cJ(e,t,r){r&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=r):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=r))}function dJ(e){const t={};e.forEach((e=>{const r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}var hJ="NOT_LOADED",fJ="APPENDING",pJ="PARTIAL",mJ="OK";class gJ{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(EK.BUFFER_APPENDED,this.onBufferAppended,this),e.on(EK.FRAG_BUFFERED,this.onFragBuffered,this),e.on(EK.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(EK.BUFFER_APPENDED,this.onBufferAppended,this),e.off(EK.FRAG_BUFFERED,this.onFragBuffered,this),e.off(EK.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let t=r.length;t--;){const n=r[t];if(!n)break;const i=n.end;if(n.start<=e&&null!==i&&e<=i)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,n=Object.keys(r);for(let i=n.length;i--;){const s=r[n[i]];if((null==s?void 0:s.body.type)===t&&s.buffered){const t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,r,n){this.timeRanges&&(this.timeRanges[e]=t);const i=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach((n=>{const s=this.fragments[n];if(!s)return;if(i>=s.body.sn)return;if(!s.buffered&&!s.loaded)return void(s.body.type===r&&this.removeFragment(s.body));const a=s.range[e];a&&a.time.some((e=>{const r=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&this.removeFragment(s.body),r}))}))}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:n}=e;if(!t||"initSegment"===r.sn)return;const i=vJ(r),s=this.fragments[i];if(!s||s.buffered&&r.gap)return;const a=!r.relurl;if(Object.keys(t).forEach((e=>{const i=r.elementaryStreams[e];if(!i)return;const o=t[e],l=a||!0===i.partial;s.range[e]=this.getBufferedTimes(r,n,l,o)})),s.loaded=null,Object.keys(s.range).length){s.buffered=!0;(s.body.endList=r.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),yJ(s)||this.removeParts(r.sn-1,r.type)}else this.removeFragment(s.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter((t=>t.fragment.sn>=e)))}fragBuffered(e,t){const r=vJ(e);let n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,r,n){const i={time:[],partial:r},s=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||s;for(let e=0;e<n.length;e++){const t=n.start(e)-this.bufferPadding,r=n.end(e)+this.bufferPadding;if(l>=t&&o<=r){i.time.push({startPTS:Math.max(s,n.start(e)),endPTS:Math.min(a,n.end(e))});break}if(s<r&&a>t)i.partial=!0,i.time.push({startPTS:Math.max(s,n.start(e)),endPTS:Math.min(a,n.end(e))});else if(a<=t)break}return i}getPartialFragment(e){let t,r,n,i=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach((l=>{const u=o[l];u&&yJ(u)&&(r=u.body.start-a,n=u.body.end+a,e>=r&&e<=n&&(t=Math.min(e-r,n-e),s<=t&&(i=u.body,s=t)))})),i}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||yJ(t))}getState(e){const t=vJ(e),r=this.fragments[t];return r?r.buffered?yJ(r)?pJ:mJ:fJ:hJ}isTimeBuffered(e,t,r){let n,i;for(let s=0;s<r.length;s++){if(n=r.start(s)-this.bufferPadding,i=r.end(s)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:n}=t;if("initSegment"===r.sn||r.bitrateTest)return;const i=n?null:t,s=vJ(r);this.fragments[s]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:n,timeRanges:i}=t;if("initSegment"===r.sn)return;const s=r.type;if(n){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(n)}this.timeRanges=i,Object.keys(i).forEach((e=>{const t=i[e];this.detectEvictedFragments(e,t,s,n)}))}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=vJ(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,n,i){n&&!this.hasGaps||Object.keys(this.fragments).forEach((s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==r||n&&!o.gap||o.start<t&&o.end>e&&(a.buffered||i)&&this.removeFragment(o)}))}removeFragment(e){const t=vJ(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const t=e.sn;this.activePartLists[e.type]=r.filter((e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function yJ(e){var t,r,n;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(r=e.range.audio)?void 0:r.partial)||(null==(n=e.range.audiovideo)?void 0:n.partial))}function vJ(e){return`${e.type}_${e.level}_${e.urlId}_${e.sn}`}const bJ=Math.pow(2,17);class wJ{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new DJ({type:DK.NETWORK_ERROR,details:SK.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const n=this.config,i=n.fLoader,s=n.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void o(EJ(e));e.gap=!1}const l=this.loader=e.loader=i?new i(n):new s(n),u=xJ(e),c=WY(n.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:bJ};e.stats=l.stats,l.load(u,d,{onSuccess:(t,r,n,i)=>{this.resetLoader(e,l);let s=t.data;n.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:e,part:null,payload:s,networkDetails:i})},onError:(t,n,i,s)=>{this.resetLoader(e,l),o(new DJ({type:DK.NETWORK_ERROR,details:SK.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:vK({url:r,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:i,stats:s}))},onAbort:(t,r,n)=>{this.resetLoader(e,l),o(new DJ({type:DK.NETWORK_ERROR,details:SK.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:n,stats:t}))},onTimeout:(t,r,n)=>{this.resetLoader(e,l),o(new DJ({type:DK.NETWORK_ERROR,details:SK.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:n,stats:t}))},onProgress:(r,n,i,s)=>{t&&t({frag:e,part:null,payload:i,networkDetails:s})}})}))}loadPart(e,t,r){this.abort();const n=this.config,i=n.fLoader,s=n.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(EJ(e,t));const l=this.loader=e.loader=i?new i(n):new s(n),u=xJ(e,t),c=WY(n.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:bJ};t.stats=l.stats,l.load(u,d,{onSuccess:(n,i,s,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const u={frag:e,part:t,payload:n.data,networkDetails:o};r(u),a(u)},onError:(r,n,i,s)=>{this.resetLoader(e,l),o(new DJ({type:DK.NETWORK_ERROR,details:SK.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:vK({url:u.url,data:void 0},r),error:new Error(`HTTP Error ${r.code} ${r.text}`),networkDetails:i,stats:s}))},onAbort:(r,n,i)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new DJ({type:DK.NETWORK_ERROR,details:SK.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:i,stats:r}))},onTimeout:(r,n,i)=>{this.resetLoader(e,l),o(new DJ({type:DK.NETWORK_ERROR,details:SK.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:i,stats:r}))}})}))}updateStatsFromPart(e,t){const r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){const n=Math.round(e.duration/t.duration),s=Math.min(Math.round(r.loaded/i),n),a=(n-s)*Math.round(r.loaded/s);r.total=r.loaded+a}else r.total=Math.max(r.loaded,r.total);const s=r.loading,a=n.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function xJ(e,t=null){const r=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},i=r.byteRangeStartOffset,s=r.byteRangeEndOffset;if(xK(i)&&xK(s)){var a;let t=i,r=s;if("initSegment"===e.sn&&"AES-128"===(null==(a=e.decryptdata)?void 0:a.method)){const e=s-i;e%16&&(r=s+(16-e%16)),0!==i&&(n.resetIV=!0,t=i-16)}n.rangeStart=t,n.rangeEnd=r}return n}function EJ(e,t){const r=new Error(`GAP ${e.gap?"tag":"attribute"} found`),n={type:DK.MEDIA_ERROR,details:SK.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new DJ(n)}class DJ extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class SJ{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const t in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=SK.KEY_LOAD_ERROR,r,n,i){return new DJ({type:DK.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:n})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:n}=e;for(let e=0;e<t.length;e++){const i=t[e];if(n<=i.cc&&("initSegment"===r||"initSegment"===i.sn||r<i.sn)){this.emeController.selectKeySystemFormat(i).then((e=>{i.setKeyFormat(e)}));break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}loadInternal(e,t){var r,n;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const r=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,SK.KEY_LOAD_ERROR,r))}const s=i.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,SK.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${s}"`)));let a=this.keyUriToKeyInfo[s];if(null!=(r=a)&&r.decryptdata.key)return i.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var o;if(null!=(n=a)&&n.keyLoadPromise)switch(null==(o=a.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then((t=>(i.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:a})))}switch(a=this.keyUriToKeyInfo[s]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,SK.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(r);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,r)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,n=new(0,r.loader)(r);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise(((i,s)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=r.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,n)=>{const{frag:a,keyInfo:o,url:l}=r;if(!a.decryptdata||o!==this.keyUriToKeyInfo[l])return s(this.createKeyLoadError(a,SK.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),n));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,i({frag:a,keyInfo:o})},onError:(e,r,n,i)=>{this.resetLoader(r),s(this.createKeyLoadError(t,SK.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),n,vK({url:a.url,data:void 0},e)))},onTimeout:(e,r,n)=>{this.resetLoader(r),s(this.createKeyLoadError(t,SK.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:(e,r,n)=>{this.resetLoader(r),s(this.createKeyLoadError(t,SK.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};n.load(a,l,u)}))}resetLoader(e){const{frag:t,keyInfo:r,url:n}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],i&&i.destroy()}}class AJ{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const TJ={length:0,start:()=>0,end:()=>0};class CJ{static isBuffered(e,t){try{if(e){const r=CJ.getBuffered(e);for(let e=0;e<r.length;e++)if(t>=r.start(e)&&t<=r.end(e))return!0}}catch(e){}return!1}static bufferInfo(e,t,r){try{if(e){const n=CJ.getBuffered(e),i=[];let s;for(s=0;s<n.length;s++)i.push({start:n.start(s),end:n.end(s)});return this.bufferedInfo(i,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort((function(e,t){const r=e.start-t.start;return r||t.end-e.end}));let n=[];if(r)for(let t=0;t<e.length;t++){const i=n.length;if(i){const s=n[i-1].end;e[t].start-s<r?e[t].end>s&&(n[i-1].end=e[t].end):n.push(e[t])}else n.push(e[t])}else n=e;let i,s=0,a=t,o=t;for(let e=0;e<n.length;e++){const l=n[e].start,u=n[e].end;if(t+r>=l&&t<u)a=l,o=u,s=o-t;else if(t+r<l){i=l;break}}return{len:s,start:a||0,end:o||0,nextStart:i}}static getBuffered(e){try{return e.buffered}catch(e){return kK.log("failed to get media.buffered",e),TJ}}}class NJ{constructor(e,t,r,n=0,i=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=i,this.partial=s}}function kJ(e,t){let r=null;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(i&&i.cc===t){r=i;break}}return r}function MJ(e,t){if(e){const r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function OJ(e,t){const r=t.fragments;for(let t=0,n=r.length;t<n;t++)MJ(r[t],e);t.fragmentHint&&MJ(t.fragmentHint,e),t.alignedSliding=!0}function FJ(e,t,r){t&&(!function(e,t,r){if(function(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}(e,r,t)){const e=function(e,t,r=0){const n=e.fragments,i=t.fragments;if(!i.length||!n.length)return void kK.log("No fragments to align");const s=kJ(n,i[0].cc);if(s&&(!s||s.startPTS))return s;kK.log("No frag in previous level to align on")}(r.details,t);e&&xK(e.start)&&(kK.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),OJ(e.start,t))}}(e,r,t),!r.alignedSliding&&t.details&&function(e,t){if(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)return;const r=t.fragments[0].programDateTime,n=e.fragments[0].programDateTime,i=(n-r)/1e3+t.fragments[0].start;i&&xK(i)&&(kK.log(`Adjusting PTS using programDateTime delta ${n-r}ms, sliding:${i.toFixed(3)} ${e.url} `),OJ(i,e))}(r,t.details),r.alignedSliding||!t.details||r.skippedSegments||zY(t.details,r))}function LJ(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const r=e.fragments,n=t.fragments;if(!r.length||!n.length)return;const i=n[Math.round(n.length/2)-1],s=kJ(r,i.cc)||r[Math.round(r.length/2)-1],a=i.programDateTime,o=s.programDateTime;if(null===a||null===o)return;OJ((o-a)/1e3-(s.start-i.start),e)}class _J{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class RJ{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class IJ{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let e=0;e<4;e++)r[e]=t.getUint32(4*e);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],s=r[2],a=r[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=new Uint32Array(256);let f=0,p=0,m=0;for(m=0;m<256;m++)h[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let r=p^p<<1^p<<2^p<<3^p<<4;r=r>>>8^255&r^99,e[f]=r,t[r]=f;const o=h[f],m=h[o],g=h[m];let y=257*h[r]^16843008*r;n[f]=y<<24|y>>>8,i[f]=y<<16|y>>>16,s[f]=y<<8|y>>>24,a[f]=y,y=16843009*g^65537*m^257*o^16843008*f,l[r]=y<<24|y>>>8,u[r]=y<<16|y>>>16,c[r]=y<<8|y>>>24,d[r]=y,f?(f=o^h[h[h[g^o]]],p^=h[h[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,n=0;for(;n<t.length&&r;)r=t[n]===this.key[n],n++;if(r)return;this.key=t;const i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const s=this.ksRows=4*(i+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),u=this.invKeySchedule=new Uint32Array(s),c=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],p=h[1],m=h[2],g=h[3];let y,v;for(a=0;a<s;a++)a<i?y=l[a]=t[a]:(v=y,a%i==0?(v=v<<8|v>>>24,v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v],v^=d[a/i|0]<<24):i>6&&a%i==4&&(v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v]),l[a]=y=(l[a-i]^v)>>>0);for(o=0;o<s;o++)a=s-o,v=3&o?l[a]:l[a-4],u[o]=o<4||a<=4?v:f[c[v>>>24]]^p[c[v>>>16&255]]^m[c[v>>>8&255]]^g[c[255&v]],u[o]=u[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const n=this.keySize+6,i=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],u=a[2],c=a[3],d=this.uint8ArrayToUint32Array_(r);let h=d[0],f=d[1],p=d[2],m=d[3];const g=new Int32Array(e),y=new Int32Array(g.length);let v,b,w,x,E,D,S,A,T,C,N,k,M,O;const F=this.networkToHostOrderSwap;for(;t<g.length;){for(T=F(g[t]),C=F(g[t+1]),N=F(g[t+2]),k=F(g[t+3]),E=T^i[0],D=k^i[1],S=N^i[2],A=C^i[3],M=4,O=1;O<n;O++)v=o[E>>>24]^l[D>>16&255]^u[S>>8&255]^c[255&A]^i[M],b=o[D>>>24]^l[S>>16&255]^u[A>>8&255]^c[255&E]^i[M+1],w=o[S>>>24]^l[A>>16&255]^u[E>>8&255]^c[255&D]^i[M+2],x=o[A>>>24]^l[E>>16&255]^u[D>>8&255]^c[255&S]^i[M+3],E=v,D=b,S=w,A=x,M+=4;v=s[E>>>24]<<24^s[D>>16&255]<<16^s[S>>8&255]<<8^s[255&A]^i[M],b=s[D>>>24]<<24^s[S>>16&255]<<16^s[A>>8&255]<<8^s[255&E]^i[M+1],w=s[S>>>24]<<24^s[A>>16&255]<<16^s[E>>8&255]<<8^s[255&D]^i[M+2],x=s[A>>>24]<<24^s[E>>16&255]<<16^s[D>>8&255]<<8^s[255&S]^i[M+3],y[t]=F(v^h),y[t+1]=F(x^f),y[t+2]=F(w^p),y[t+3]=F(b^m),h=T,f=C,p=N,m=k,t+=4}return y.buffer}}class PJ{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?rW(e,0,t-r):e}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise(((n,i)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const s=this.flush();s?n(s.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:n,currentResult:i,remainderData:s}=this;this.logOnce("JS AES decrypt"),s&&(e=LW(s,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;n&&(r=n);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new IJ),o.expandKey(t);const l=i;return this.currentResult=o.decrypt(a.buffer,0,r),this.currentIV=rW(a,-16).buffer,l||null}webCryptoDecrypt(e,t,r){const n=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new RJ(n,t)),this.fastAesKey.expandKey().then((t=>{if(!n)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new _J(n,new Uint8Array(r)).decrypt(e.buffer,t)})).catch((n=>(kK.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,r))))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=rW(e,0,r),this.remainderData=rW(e,r)),t}logOnce(e){this.logEnabled&&(kK.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const BJ=function(e){let t="";const r=e.length;for(let n=0;n<r;n++)t+=`[${e.start(n).toFixed(3)}-${e.end(n).toFixed(3)}]`;return t},UJ="STOPPED",$J="IDLE",zJ="KEY_LOADING",jJ="FRAG_LOADING",qJ="FRAG_LOADING_WAITING_RETRY",HJ="WAITING_TRACK",VJ="PARSING",GJ="PARSED",KJ="ENDED",WJ="ERROR",YJ="WAITING_INIT_PTS",JJ="WAITING_LEVEL";class ZJ extends AJ{constructor(e,t,r,n,i){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=UJ,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=i,this.logPrefix=n,this.log=kK.log.bind(kK,`${n}:`),this.warn=kK.warn.bind(kK,`${n}:`),this.hls=e,this.fragmentLoader=new wJ(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new PJ(e.config),e.on(EK.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=UJ}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(null!=r&&r.length){const e=r[r.length-1];return CJ.isBuffered(this.media,e.start+e.duration/2)}const n=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(n)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const n=this.config;this.levels&&n.autoStartLoad&&this.state===UJ&&this.startLoad(n.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:n,state:i}=this,s=r?r.currentTime:0,a=CJ.bufferInfo(n||r,s,e.maxBufferHole);if(this.log(`media seeking to ${xK(s)?s.toFixed(3):s}, state: ${i}`),this.state===KJ)this.resetLoadingState();else if(t){const r=e.maxFragLookUpTolerance,n=t.start-r,i=t.start+t.duration+r;if(!a.len||i<a.start||n>a.end){const e=s>i;(s<n||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=UJ,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,(t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)})).then((t=>{if(!t)return;const r=this.state;this.fragContextChanged(e)?(r===jJ||!this.fragCurrent&&r===VJ)&&(this.fragmentTracker.removeFragment(e),this.state=$J):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(EK.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))})).catch((t=>{this.state!==UJ&&this.state!==WJ&&(this.warn(t),this.resetFragmentLoading(e))}))}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===fJ){const t=e.type,n=this.getFwdBufferInfo(this.mediaBuffer,t),i=Math.max(e.duration,n?n.len:this.config.maxBufferLength);this.reduceMaxBufferLength(i)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===pJ&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:r};this.hls.trigger(EK.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then((t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t})).then((t=>{const{hls:r}=this,{payload:n}=t,i=e.decryptdata;if(n&&n.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch((t=>{throw r.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((n=>{const i=self.performance.now();return r.trigger(EK.FRAG_DECRYPTED,{frag:e,payload:n,stats:{tstart:s,tdecrypt:i}}),t.payload=n,t}))}return t})).then((r=>{const{fragCurrent:n,hls:i,levels:s}=this;if(!s)throw new Error("init load aborted, missing levels");const a=e.stats;this.state=$J,t.fragmentError=0,e.data=new Uint8Array(r.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),r.frag===n&&i.trigger(EK.FRAG_BUFFERED,{stats:a,frag:n,part:null,id:e.type}),this.tick()})).catch((t=>{this.state!==UJ&&this.state!==WJ&&(this.warn(t),this.resetFragmentLoading(e))}))}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}fragBufferedComplete(e,t){var r,n,i,s;const a=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===pY?"level":"track"} ${e.level} (frag:[${(null!=(r=e.startPTS)?r:NaN).toFixed(3)}-${(null!=(n=e.endPTS)?n:NaN).toFixed(3)}] > buffer:${a?BJ(CJ.getBuffered(a)):"(detached)"})`),this.state=$J,a&&(!this.loadedmetadata&&e.type==pY&&a.buffered.length&&(null==(i=this.fragCurrent)?void 0:i.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:n,partsLoaded:i}=e,s=!i||0===i.length||i.some((e=>!e)),a=new NJ(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!s);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,n){var i;const s=null==t?void 0:t.details;if(!this.levels||!s)throw new Error(`frag load aborted, missing level${s?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(i=e.decryptdata)&&i.key?!e.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(e,s.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${s.startSN}-${s.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=zJ,this.fragCurrent=e,a=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(EK.KEY_LOADED,e),this.state===zJ&&(this.state=$J),e})),this.hls.trigger(EK.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const i=s.partList;if(i&&n){r>e.end&&s.fragmentHint&&(e=s.fragmentHint);const o=this.getNextPart(i,e,r);if(o>-1){const l=i[o];let u;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${s.startSN}-${s.endSN}] parts [0-${o}-${i.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=jJ,u=a?a.then((r=>!r||this.fragContextChanged(r.frag)?null:this.doFragPartsLoad(e,l,t,n))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,n).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(EK.FRAG_LOADING,{frag:e,part:l,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!e.url||this.loadedEndOfParts(i,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${s?"of ["+s.startSN+"-"+s.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),xK(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=jJ;const o=this.config.progressive;let l;return l=o&&a?a.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,n))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,o?n:void 0),a]).then((([e])=>(!o&&e&&n&&n(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(EK.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,r,n){return new Promise(((i,s)=>{var a;const o=[],l=null==(a=r.details)?void 0:a.partList,u=t=>{this.fragmentLoader.loadPart(e,t,n).then((n=>{o[t.index]=n;const s=n.part;this.hls.trigger(EK.FRAG_LOADED,n);const a=qY(r,e.sn,t.index+1)||HY(l,e.sn,t.index+1);if(!a)return i({frag:e,part:s,partsLoaded:o});u(a)})).catch(s)};u(t)}))}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===SK.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(EK.ERROR,t)}else this.hls.trigger(EK.ERROR,{type:DK.OTHER_ERROR,details:SK.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==VJ)return void(this.fragCurrent||this.state===UJ||this.state===WJ||(this.state=$J));const{frag:r,part:n,level:i}=t,s=self.performance.now();r.stats.parsing.end=s,n&&(n.stats.parsing.end=s),this.updateLevelTiming(r,n,i,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:n,sn:i,part:s}=e;if(null==t||!t[n])return this.warn(`Levels object was unset while buffering fragment ${i} of level ${n}. The current chunk will not be buffered.`),null;const a=t[n],o=s>-1?qY(a,i,s):null,l=o?o.fragment:function(e,t,r){if(null==e||!e.details)return null;const n=e.details;let i=n.fragments[t-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===t?i:t<n.startSN&&r&&r.sn===t?r:null)}(a,i,r);return l?(r&&r!==l&&(l.stats=r.stats),{frag:l,part:o,level:a}):null}bufferFragmentData(e,t,r,n,i){var s;if(!e||this.state!==VJ)return;const{data1:a,data2:o}=e;let l=a;if(a&&o&&(l=LW(a,o)),null==(s=l)||!s.length)return;const u={type:e.type,frag:t,part:r,chunkMeta:n,parent:t.type,data:l};if(this.hls.trigger(EK.BUFFER_APPENDING,u),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!CJ.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,n=CJ.bufferInfo(t,r,0),i=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),a=Math.max(Math.min(e.start-s,n.end-s),r+s);e.start-a>s&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return xK(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:n}}=this,i=CJ.bufferInfo(e,t,n);if(0===i.len&&void 0!==i.nextStart){const s=this.fragmentTracker.getBufferedFrag(t,r);if(s&&i.nextStart<s.end)return CJ.bufferInfo(e,t,Math.max(i.nextStart,n))}return i}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0)}getAppendedFrag(e,t=pY){const r=this.fragmentTracker.getAppendedFrag(e,pY);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,n=r.length;if(!n)return null;const{config:i}=this,s=r[0].start;let a;if(t.live){const s=i.initialLiveManifestSize;if(n<s)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${s})`),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(a=this.getInitialLiveFragment(t,r),this.startPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=s&&(a=r[0]);if(!a){const r=i.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,r,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===mJ||r===pJ&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,n,i){const s=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,s&&e&&!e.gap&&r.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n);if(null!==t&&r.len+t.len>=i)return this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let n=-1,i=!1,s=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(s=s&&!o.independent,n>-1&&r<o.start)break;const l=o.loaded;l?n=-1:(i||o.independent||s)&&o.fragment===t&&(n=a),i=l}return n}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let n=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),n=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!xK(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(let n=0;n<e.length;++n){const i=e[n];if(QY(t,r,i))return i}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const s=t[i-e.startSN];r.cc===s.cc&&(n=s,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=function(e,t){return JY.search(e,(e=>e.cc<t?1:e.cc>t?-1:0))}(t,r.cc),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(n=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,r){const{config:n}=this;let{fragPrevious:i}=this,{fragments:s,endSN:a}=r;const{fragmentHint:o}=r,l=n.maxFragLookUpTolerance,u=r.partList,c=!!(n.lowLatencyMode&&null!=u&&u.length&&o);let d;if(c&&o&&!this.bitrateTest&&(s=s.concat(o),a=o.sn),e<t){d=ZY(i,s,e,e>t-l?0:l)}else d=s[s.length-1];if(d){const e=d.sn-r.startSN,t=this.fragmentTracker.getState(d);if((t===mJ||t===pJ&&d.gap)&&(i=d),i&&d.sn===i.sn&&(!c||u[0].fragment.sn>d.sn)){if(i&&d.level===i.level){const t=s[e+1];d=d.sn<a&&this.fragmentTracker.getState(t)!==mJ?t:null}}}return d}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,i=r.currentTime,s=e.fragments[0].start,a=e.edge,o=i>=s-t.maxFragLookUpTolerance&&i<=a;if(null!==n&&r.duration>n&&(i<n||!o)){const s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&r.readyState<4||i<a-s)&&(this.loadedmetadata||(this.nextLoadPosition=n),r.readyState&&(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${n.toFixed(3)}`),r.currentTime=n))}}alignPlaylists(e,t){const{levels:r,levelLastLoaded:n,fragPrevious:i}=this,s=null!==n?r[n]:null,a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;const o=e.fragments[0].start,l=!t,u=e.alignedSliding&&xK(o);if(l||!u&&!o){FJ(i,s,e);const r=e.fragments[0].start;return this.log(`Live playlist sliding: ${r.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${i?i.sn:"na"} fragments: ${a}`),r}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){const n=null!==this.startTimeOffset,i=n?this.startTimeOffset:e.startTimeOffset;null!==i&&xK(i)?(r=t+i,i<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${i} found in ${n?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===qJ)||(this.state=$J)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;var n;if(this.fragContextChanged(r))return void this.warn(`Frag load error must match current frag to retry ${r.url} > ${null==(n=this.fragCurrent)?void 0:n.url}`);const i=t.details===SK.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(r,!0);const s=t.errorAction,{action:a,retryCount:o=0,retryConfig:l}=s||{};if(s&&a===rJ&&l){var u;this.resetStartWhenNotLoaded(null!=(u=this.levelLastLoaded)?u:r.level);const n=KY(l,o);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${n}ms`),s.resolved=!0,this.retryDate=self.performance.now()+n,this.state=qJ}else l&&s?(this.resetFragmentErrors(e),o<l.maxNumRetry?i||(s.resolved=!0):kK.warn(`${t.details} reached or exceeded max retry (${o})`)):(null==s?void 0:s.action)===tJ?this.state=JJ:this.state=WJ;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===VJ||this.state===GJ){const t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),n=r&&r.len>.5;n&&this.reduceMaxBufferLength(r.len);const i=!n;return i&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){e===mY&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==UJ&&(this.state=$J)}afterBufferFlushed(e,t,r){if(!e)return;const n=CJ.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===KJ&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=$J}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){var t;this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,n){var i;const s=r.details;if(!s)return void this.warn("level.details undefined");if(Object.keys(e.elementaryStreams).reduce(((t,i)=>{const a=e.elementaryStreams[i];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${i} duration reliably (${o})`),t||!1;const l=n?0:UY(s,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(EK.LEVEL_PTS_UPDATED,{details:s,level:r,drift:l,type:i,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t}),!1))r.fragmentError=0;else if(null===(null==(i=this.transmuxer)?void 0:i.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=GJ,this.hls.trigger(EK.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){var t,r,n;"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(r=this.levelLastLoaded)?r:null==(n=this.fragCurrent)?void 0:n.level)?t:0),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function XJ(){return self.SourceBuffer||self.WebKitSourceBuffer}function QJ(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class eZ{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=LW(this.cachedData,e),this.cachedData=null);let r,n=sW(e,0),i=n?n.length:0;const s=this._audioTrack,a=this._id3Track,o=n?(e=>{const t=cW(e);for(let e=0;e<t.length;e++){const r=t[e];if(lW(r))return mW(r)}})(n):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&xK(o))&&(this.basePTS=tZ(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:SY,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const t=this.appendFrame(s,e,i);t?(this.frameIndex++,this.lastPTS=t.sample.pts,i+=t.length,r=i):i=l}else oW(e,i)?(n=sW(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:SY,duration:Number.POSITIVE_INFINITY}),i+=n.length,r=i):i++;if(i===l&&r!==l){const t=rW(e,r);this.cachedData?this.cachedData=LW(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:QJ(),id3Track:a,textTrack:QJ()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:QJ(),id3Track:this._id3Track,textTrack:QJ()}}destroy(){}}const tZ=(e,t,r)=>{if(xK(e))return 90*e;return 9e4*t+(r?9e4*r.baseTime/r.timescale:0)};function rZ(e,t){return 255===e[t]&&240==(246&e[t+1])}function nZ(e,t){return 1&e[t+1]?7:9}function iZ(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function sZ(e,t){return t+1<e.length&&rZ(e,t)}function aZ(e,t){if(sZ(e,t)){const r=nZ(e,t);if(t+r>=e.length)return!1;const n=iZ(e,t);if(n<=r)return!1;const i=t+n;return i===e.length||sZ(e,i)}return!1}function oZ(e,t,r,n,i){if(!e.samplerate){const s=function(e,t,r,n){let i,s,a,o;const l=navigator.userAgent.toLowerCase(),u=n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&t[r+2])>>>6);const d=(60&t[r+2])>>>2;if(!(d>c.length-1))return a=(1&t[r+2])<<2,a|=(192&t[r+3])>>>6,kK.log(`manifest codec:${n}, ADTS type:${i}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(i=5,o=new Array(4),s=d-3):(i=2,o=new Array(2),s=d):-1!==l.indexOf("android")?(i=2,o=new Array(2),s=d):(i=5,o=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&d>=6?s=d-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(d>=6&&1===a||/vivaldi/i.test(l))||!n&&1===a)&&(i=2,o=new Array(2)),s=d)),o[0]=i<<3,o[0]|=(14&d)>>1,o[1]|=(1&d)<<7,o[1]|=a<<3,5===i&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[d],channelCount:a,codec:"mp4a.40."+i,manifestCodec:u};e.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${d}`})}(t,r,n,i);if(!s)return;e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,kK.log(`parsed codec:${e.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function lZ(e){return 9216e4/e}function uZ(e,t,r,n,i){const s=n+i*lZ(e.samplerate),a=function(e,t){const r=nZ(e,t);if(t+r<=e.length){const n=iZ(e,t)-r;if(n>0)return{headerLength:r,frameLength:n}}}(t,r);let o;if(a){const{frameLength:n,headerLength:i}=a,l=i+n,u=Math.max(0,r+l-t.length);u?(o=new Uint8Array(l-i),o.set(t.subarray(r+i,t.length),0)):o=t.subarray(r+i,r+l);const c={unit:o,pts:s};return u||e.samples.push(c),{sample:c,length:l,missing:u}}const l=t.length-r;o=new Uint8Array(l),o.set(t.subarray(r,t.length),0);return{sample:{unit:o,pts:s},length:l,missing:-1}}const cZ=/\/emsg[-/]ID3/i;let dZ=null;const hZ=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],fZ=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],pZ=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],mZ=[0,1,1,4];function gZ(e,t,r,n,i){if(r+24>t.length)return;const s=yZ(t,r);if(s&&r+s.frameLength<=t.length){const a=n+i*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:t.subarray(r,r+s.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function yZ(e,t){const r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==r&&0!==i&&15!==i&&3!==s){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*hZ[14*(3===r?3-n:3===n?3:4)+i-1],u=fZ[3*(3===r?0:2===r?1:2)+s],c=3===o?1:2,d=pZ[r][n],h=mZ[n],f=8*d*h,p=Math.floor(d*l/u+a)*h;if(null===dZ){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);dZ=e?parseInt(e[1]):0}return!!dZ&&dZ<=87&&2===n&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:c,frameLength:p,samplesPerFrame:f}}}function vZ(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function bZ(e,t){return t+1<e.length&&vZ(e,t)}function wZ(e,t){if(t+1<e.length&&vZ(e,t)){const r=4,n=yZ(e,t);let i=r;null!=n&&n.frameLength&&(i=n.frameLength);const s=t+i;return s===e.length||bZ(e,s)}return!1}class xZ{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&kK.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,r=8,n=8;for(let i=0;i<e;i++)0!==n&&(t=this.readEG(),n=(r+t+256)%256),r=0===n?r:n}readSPS(){let e,t,r,n=0,i=0,s=0,a=0;const o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();const m=o();if(l(5),d(3),o(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){const e=u();if(3===e&&d(1),f(),f(),d(1),c())for(t=3!==e?8:12,r=0;r<t;r++)c()&&p(r<6?16:64)}f();const g=u();if(0===g)u();else if(1===g)for(d(1),h(),h(),e=u(),r=0;r<e;r++)h();f(),d(1);const y=u(),v=u(),b=l(1);0===b&&d(1),d(1),c()&&(n=u(),i=u(),s=u(),a=u());let w=[1,1];if(c()&&c()){switch(o()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:w=[o()<<8|o(),o()<<8|o()]}}return{width:Math.ceil(16*(y+1)-2*n-2*i),height:(2-b)*(v+1)*16-(b?2:4)*(s+a),pixelRatio:w}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class EZ{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new PJ(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const n=e[t].unit;if(n.length<=16)return;const i=n.subarray(16,n.length-n.length%16),s=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(s).then((i=>{const s=new Uint8Array(i);n.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}))}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let n=0;for(let t=32;t<e.length-16;t+=160,n+=16)r.set(e.subarray(t,t+16),n);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let n=0;for(let t=32;t<e.length-16;t+=160,n+=16)e.set(r.subarray(n,n+16),t);return e}decryptAvcSample(e,t,r,n,i){const s=PW(i.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then((a=>{i.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,n)}))}decryptAvcSamples(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void n();const i=e[t].units;for(;!(r>=i.length);r++){const s=i[r];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(e,t,r,n,s),this.decrypter.isSync())))return}}}}const DZ=188;class SZ{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}static probe(e){const t=SZ.syncOffset(e);return t>0&&kK.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let r=Math.min(940,e.length-DZ)+1,n=0;for(;n<r;){let i=!1,s=-1,a=0;for(let o=n;o<t;o+=DZ){if(71!==e[o]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(r=Math.min(s+18612,e.length-DZ)+1)),i||(i=0===TZ(e,o)),i&&a>1&&(0===s&&a>2||o+DZ>r))return s}n++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:EW[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=SZ.createTrack("video"),this._audioTrack=SZ.createTrack("audio",n),this._id3Track=SZ.createTrack("id3"),this._txtTrack=SZ.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_avcTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(e,t,r=!1,n=!1){let i;r||(this.sampleAes=null);const s=this._avcTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let u=s.pid,c=s.pesData,d=a.pid,h=o.pid,f=a.pesData,p=o.pesData,m=null,g=this.pmtParsed,y=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=LW(this.remainderData,e)).length,this.remainderData=null),v<DZ&&!n)return this.remainderData=e,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const b=Math.max(0,SZ.syncOffset(e));v-=(v-b)%DZ,v<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let w=0;for(let t=b;t<v;t+=DZ)if(71===e[t]){const n=!!(64&e[t+1]),v=TZ(e,t);let w;if((48&e[t+3])>>4>1){if(w=t+5+e[t+4],w===t+DZ)continue}else w=t+4;switch(v){case u:n&&(c&&(i=kZ(c))&&this.parseAVCPES(s,l,i,!1),c={data:[],size:0}),c&&(c.data.push(e.subarray(w,t+DZ)),c.size+=t+DZ-w);break;case d:if(n){if(f&&(i=kZ(f)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i)}f={data:[],size:0}}f&&(f.data.push(e.subarray(w,t+DZ)),f.size+=t+DZ-w);break;case h:n&&(p&&(i=kZ(p))&&this.parseID3PES(o,i),p={data:[],size:0}),p&&(p.data.push(e.subarray(w,t+DZ)),p.size+=t+DZ-w);break;case 0:n&&(w+=e[w]+1),y=this._pmtId=CZ(e,w);break;case y:{n&&(w+=e[w]+1);const i=NZ(e,w,this.typeSupported,r);u=i.avc,u>0&&(s.pid=u),d=i.audio,d>0&&(a.pid=d,a.segmentCodec=i.segmentCodec),h=i.id3,h>0&&(o.pid=h),null===m||g||(kK.warn(`MPEG-TS PMT found at ${t} after unknown PID '${m}'. Backtracking to sync byte @${b} to parse all TS packets.`),m=null,t=b-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=v}}else w++;if(w>0){const e=new Error(`Found ${w} TS packet/s that do not start with 0x47`);this.observer.emit(EK.ERROR,EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message})}s.pesData=c,a.pesData=f,o.pesData=p;const x={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return n&&this.extractRemainingSamples(x),x}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:n,textTrack:i}=e,s=r.pesData,a=t.pesData,o=n.pesData;let l;if(s&&(l=kZ(s))?(this.parseAVCPES(r,i,l,!0),r.pesData=null):r.pesData=s,a&&(l=kZ(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l)}t.pesData=null}else null!=a&&a.size&&kK.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=kZ(o))?(this.parseID3PES(n,l),n.pesData=null):n.pesData=o}demuxSampleAes(e,t,r){const n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new EZ(this.observer,this.config,t);return this.decrypt(n,i)}decrypt(e,t){return new Promise((r=>{const{audioTrack:n,videoTrack:i}=e;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,(()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,(()=>{r(e)})):r(e)})):i.samples&&t.decryptAvcSamples(i.samples,0,0,(()=>{r(e)}))}))}destroy(){this._duration=0}parseAVCPES(e,t,r,n){const i=this.parseAVCNALu(e,r.data);let s,a=this.avcSample,o=!1;r.data=null,a&&i.length&&!e.audFound&&(MZ(a,e),a=this.avcSample=AZ(!1,r.pts,r.dts,"")),i.forEach((n=>{var i;switch(n.type){case 1:{let t=!1;s=!0;const i=n.data;if(o&&i.length>4){const e=new xZ(i).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var l;if(t)null!=(l=a)&&l.frame&&!a.key&&(MZ(a,e),a=this.avcSample=null);a||(a=this.avcSample=AZ(!0,r.pts,r.dts,"")),a.frame=!0,a.key=t;break}case 5:s=!0,null!=(i=a)&&i.frame&&!a.key&&(MZ(a,e),a=this.avcSample=null),a||(a=this.avcSample=AZ(!0,r.pts,r.dts,"")),a.key=!0,a.frame=!0;break;case 6:s=!0,IW(n.data,1,r.pts,t.samples);break;case 7:if(s=!0,o=!0,!e.sps){const t=n.data,r=new xZ(t).readSPS();e.width=r.width,e.height=r.height,e.pixelRatio=r.pixelRatio,e.sps=[t],e.duration=this._duration;const i=t.subarray(1,4);let s="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),s+=t}e.codec=s}break;case 8:s=!0,e.pps||(e.pps=[n.data]);break;case 9:s=!1,e.audFound=!0,a&&MZ(a,e),a=this.avcSample=AZ(!1,r.pts,r.dts,"");break;case 12:s=!0;break;default:s=!1,a&&(a.debug+="unknown NAL "+n.type+" ")}if(a&&s){a.units.push(n)}})),n&&a&&(MZ(a,e),this.avcSample=null)}getLastNalUnit(e){var t;let r,n=this.avcSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){const e=n.units;r=e[e.length-1]}return r}parseAVCNALu(e,t){const r=t.byteLength;let n=e.naluState||0;const i=n,s=[];let a,o,l,u=0,c=-1,d=0;for(-1===n&&(c=0,d=31&t[0],n=0,u=1);u<r;)if(a=t[u++],n)if(1!==n)if(a)if(1===a){if(c>=0){const e={data:t.subarray(c,u-n-1),type:d};s.push(e)}else{const r=this.getLastNalUnit(e.samples);if(r&&(i&&u<=4-i&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-i)),o=u-n-1,o>0)){const e=new Uint8Array(r.data.byteLength+o);e.set(r.data,0),e.set(t.subarray(0,o),r.data.byteLength),r.data=e,r.state=0}}u<r?(l=31&t[u],c=u,d=l,n=0):n=-1}else n=0;else n=3;else n=a?0:2;else n=a?0:1;if(c>=0&&n>=0){const e={data:t.subarray(c,r),type:d,state:n};s.push(e)}if(0===s.length){const r=this.getLastNalUnit(e.samples);if(r){const e=new Uint8Array(r.data.byteLength+t.byteLength);e.set(r.data,0),e.set(t,r.data.byteLength),r.data=e}}return e.naluState=n,s}parseAACPES(e,t){let r=0;const n=this.aacOverFlow;let i,s,a,o=t.data;if(n){this.aacOverFlow=null;const t=n.missing,i=n.sample.unit.byteLength;if(-1===t){const e=new Uint8Array(i+o.byteLength);e.set(n.sample.unit,0),e.set(o,i),o=e}else{const s=i-t;n.sample.unit.set(o.subarray(0,t),s),e.samples.push(n.sample),r=n.missing}}for(i=r,s=o.length;i<s-1&&!sZ(o,i);i++);if(i!==r){let e;const t=i<s-1;e=t?`AAC PES did not start with ADTS header,offset:${i}`:"No ADTS header found in AAC PES";const r=new Error(e);if(kK.warn(`parsing error: ${e}`),this.observer.emit(EK.ERROR,EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:r,reason:e}),!t)return}if(oZ(e,this.observer,o,i,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!n)return void kK.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=lZ(e.samplerate);a=n.sample.pts+t}}let l,u=0;for(;i<s;){if(l=uZ(e,o,i,a,u),i+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;i<s-1&&!sZ(o,i);i++);}}parseMPEGPES(e,t){const r=t.data,n=r.length;let i=0,s=0;const a=t.pts;if(void 0!==a)for(;s<n;)if(bZ(r,s)){const t=gZ(e,r,s,a,i);if(!t)break;s+=t.length,i++}else s++;else kK.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseID3PES(e,t){if(void 0===t.pts)return void kK.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=wK({},t,{type:this._avcTrack?TY:SY,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function AZ(e,t,r,n){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:n,length:0}}function TZ(e,t){return((31&e[t+1])<<8)+e[t+2]}function CZ(e,t){return(31&e[t+10])<<8|e[t+11]}function NZ(e,t,r,n){const i={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){const s=TZ(e,t);switch(e[t]){case 207:if(!n){kK.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=s);break;case 21:-1===i.id3&&(i.id3=s);break;case 219:if(!n){kK.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=s);break;case 3:case 4:!0!==r.mpeg&&!0!==r.mp3?kK.log("MPEG audio found, not supported in this browser"):-1===i.audio&&(i.audio=s,i.segmentCodec="mp3");break;case 36:kK.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return i}function kZ(e){let t,r,n,i,s,a=0;const o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){const e=new Uint8Array(o[0].length+o[1].length);e.set(o[0]),e.set(o[1],o[0].length),o[0]=e,o.splice(1,1)}t=o[0];if(1===(t[0]<<16)+(t[1]<<8)+t[2]){if(r=(t[4]<<8)+t[5],r&&r>e.size-6)return null;const l=t[7];192&l&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,i-s>54e5&&(kK.warn(`${Math.round((i-s)/9e4)}s delta between PTS and DTS, align them`),i=s)):s=i),n=t[8];let u=n+9;if(e.size<=u)return null;e.size-=u;const c=new Uint8Array(e.size);for(let e=0,r=o.length;e<r;e++){t=o[e];let r=t.byteLength;if(u){if(u>r){u-=r;continue}t=t.subarray(u),r-=u,u=0}c.set(t,a),a+=r}return r&&(r-=n+3),{data:c,pts:i,dts:s,len:r}}return null}function MZ(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const r=t.samples,n=r.length;if(!n)return void t.dropped++;{const t=r[n-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&kK.log(e.pts+"/"+e.dts+":"+e.debug)}class OZ{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const FZ=Math.pow(2,32)-1;class LZ{static init(){let e;for(e in LZ.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},LZ.types)LZ.types.hasOwnProperty(e)&&(LZ.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);LZ.HDLR_TYPES={video:t,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);LZ.STTS=LZ.STSC=LZ.STCO=i,LZ.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),LZ.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),LZ.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),LZ.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);LZ.FTYP=LZ.box(LZ.types.ftyp,s,o,s,a),LZ.DINF=LZ.box(LZ.types.dinf,LZ.box(LZ.types.dref,n))}static box(e,...t){let r=8,n=t.length;const i=n;for(;n--;)r+=t[n].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(e,4),n=0,r=8;n<i;n++)s.set(t[n],r),r+=t[n].byteLength;return s}static hdlr(e){return LZ.box(LZ.types.hdlr,LZ.HDLR_TYPES[e])}static mdat(e){return LZ.box(LZ.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(FZ+1)),n=Math.floor(t%(FZ+1));return LZ.box(LZ.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}static mdia(e){return LZ.box(LZ.types.mdia,LZ.mdhd(e.timescale,e.duration),LZ.hdlr(e.type),LZ.minf(e))}static mfhd(e){return LZ.box(LZ.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?LZ.box(LZ.types.minf,LZ.box(LZ.types.smhd,LZ.SMHD),LZ.DINF,LZ.stbl(e)):LZ.box(LZ.types.minf,LZ.box(LZ.types.vmhd,LZ.VMHD),LZ.DINF,LZ.stbl(e))}static moof(e,t,r){return LZ.box(LZ.types.moof,LZ.mfhd(e),LZ.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=LZ.trak(e[t]);return LZ.box.apply(null,[LZ.types.moov,LZ.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(LZ.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=LZ.trex(e[t]);return LZ.box.apply(null,[LZ.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(FZ+1)),n=Math.floor(t%(FZ+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return LZ.box(LZ.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let n,i;for(n=0;n<t.length;n++)i=t[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return LZ.box(LZ.types.sdtp,r)}static stbl(e){return LZ.box(LZ.types.stbl,LZ.stsd(e),LZ.box(LZ.types.stts,LZ.STTS),LZ.box(LZ.types.stsc,LZ.STSC),LZ.box(LZ.types.stsz,LZ.STSZ),LZ.box(LZ.types.stco,LZ.STCO))}static avc1(e){let t,r,n,i=[],s=[];for(t=0;t<e.sps.length;t++)r=e.sps[t],n=r.byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)r=e.pps[t],n=r.byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));const a=LZ.box(LZ.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return LZ.box(LZ.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,LZ.box(LZ.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),LZ.box(LZ.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static mp4a(e){const t=e.samplerate;return LZ.box(LZ.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),LZ.box(LZ.types.esds,LZ.esds(e)))}static mp3(e){const t=e.samplerate;return LZ.box(LZ.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?LZ.box(LZ.types.stsd,LZ.STSD,LZ.mp3(e)):LZ.box(LZ.types.stsd,LZ.STSD,LZ.mp4a(e)):LZ.box(LZ.types.stsd,LZ.STSD,LZ.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,n=e.width,i=e.height,s=Math.floor(r/(FZ+1)),a=Math.floor(r%(FZ+1));return LZ.box(LZ.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}static traf(e,t){const r=LZ.sdtp(e),n=e.id,i=Math.floor(t/(FZ+1)),s=Math.floor(t%(FZ+1));return LZ.box(LZ.types.traf,LZ.box(LZ.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),LZ.box(LZ.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s])),LZ.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,LZ.box(LZ.types.trak,LZ.tkhd(e),LZ.mdia(e))}static trex(e){const t=e.id;return LZ.box(LZ.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],n=r.length,i=12+16*n,s=new Uint8Array(i);let a,o,l,u,c,d;for(t+=8+i,s.set(["video"===e.type?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<n;a++)o=r[a],l=o.duration,u=o.size,c=o.flags,d=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return LZ.box(LZ.types.trun,s)}static initSegment(e){LZ.types||LZ.init();const t=LZ.moov(e),r=new Uint8Array(LZ.FTYP.byteLength+t.byteLength);return r.set(LZ.FTYP),r.set(t,LZ.FTYP.byteLength),r}}LZ.types=void 0,LZ.HDLR_TYPES=void 0,LZ.STTS=void 0,LZ.STSC=void 0,LZ.STCO=void 0,LZ.STSZ=void 0,LZ.VMHD=void 0,LZ.SMHD=void 0,LZ.STSD=void 0,LZ.FTYP=void 0,LZ.DINF=void 0;const _Z=9e4;function RZ(e,t,r=1,n=!1){const i=e*t*r;return n?Math.round(i):i}function IZ(e,t=!1){return RZ(e,1e3,1/_Z,t)}let PZ,BZ=null,UZ=null;class $Z{constructor(e,t,r,n=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===BZ){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);BZ=e?parseInt(e[1]):0}if(null===UZ){const e=navigator.userAgent.match(/Safari\/(\d+)/i);UZ=e?parseInt(e[1]):0}}destroy(){}resetTimeStamp(e){kK.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){kK.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){kK.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(e){let t=!1;const r=e.reduce(((e,r)=>{const n=r.pts-e;return n<-4294967296?(t=!0,zZ(e,r.pts)):n>0?e:r.pts}),e[0].pts);return t&&kK.debug("PTS rollover detected"),r}remux(e,t,r,n,i,s,a,o){let l,u,c,d,h,f,p=i,m=i;const g=e.pid>-1,y=t.pid>-1,v=t.samples.length,b=e.samples.length>0,w=a&&v>0||v>1;if((!g||b)&&(!y||w)||this.ISGenerated||a){this.ISGenerated||(c=this.generateIS(e,t,i,s));const r=this.isVideoContiguous;let n,a=-1;if(w&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){kK.warn(`[mp4-remuxer]: Dropped ${a} out of ${v} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,m+=(t.samples[0].pts-e)/t.inputTimeScale,n=m}else-1===a&&(kK.warn(`[mp4-remuxer]: No keyframe found out of ${v} video samples`),f=!1);if(this.ISGenerated){if(b&&w){const r=this.getVideoStartPts(t.samples),n=(zZ(e.samples[0].pts,r)-r)/t.inputTimeScale;p+=Math.max(0,n),m+=Math.max(0,-n)}if(b){if(e.samplerate||(kK.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,i,s)),u=this.remuxAudio(e,p,this.isAudioContiguous,s,y||w||o===mY?m:void 0),w){const n=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(kK.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,i,s)),l=this.remuxVideo(t,m,r,n)}}else w&&(l=this.remuxVideo(t,m,r,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=n)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=jZ(r,i,this._initPTS,this._initDTS)),n.samples.length&&(d=qZ(n,i,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:d,id3:h}}generateIS(e,t,r,n){const i=e.samples,s=t.samples,a=this.typeSupported,o={},l=this._initPTS;let u,c,d,h=!l||n,f="audio/mp4";if(h&&(u=c=1/0),e.config&&i.length){if(e.timescale=e.samplerate,"mp3"===e.segmentCodec)a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):LZ.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(d=e.inputTimeScale,l&&d===l.timescale?h=!1:u=c=i[0].pts-Math.round(d*r))}if(t.sps&&t.pps&&s.length&&(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:LZ.initSegment([t]),metadata:{width:t.width,height:t.height}},h))if(d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(s),t=Math.round(d*r);c=Math.min(c,zZ(s[0].dts,e)-t),u=Math.min(u,e-t)}if(Object.keys(o).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:u,timescale:d},this._initDTS={baseTime:c,timescale:d}):u=d=void 0,{tracks:o,initPTS:u,timescale:d}}remuxVideo(e,t,r,n){const i=e.inputTimeScale,s=e.samples,a=[],o=s.length,l=this._initPTS;let u,c,d=this.nextAvcDts,h=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=!1;if(!r||null===d){d=t*i-(s[0].pts-zZ(s[0].dts,s[0].pts))}const y=l.baseTime*i/l.timescale;for(let e=0;e<o;e++){const t=s[e];t.pts=zZ(t.pts-y,d),t.dts=zZ(t.dts-y,d),t.dts<s[e>0?e-1:e].dts&&(g=!0)}g&&s.sort((function(e,t){const r=e.dts-t.dts,n=e.pts-t.pts;return r||n})),u=s[0].dts,c=s[s.length-1].dts;const v=c-u,b=v?Math.round(v/(o-1)):f||e.inputTimeScale/30;if(r){const e=u-d,t=e>b,r=e<-1;if((t||r)&&(t?kK.warn(`AVC: ${IZ(e,!0)} ms (${e}dts) hole between fragments detected, filling it`):kK.warn(`AVC: ${IZ(-e,!0)} ms (${e}dts) overlapping between fragments detected`),!r||d>=s[0].pts)){u=d;const t=s[0].pts-e;s[0].dts=u,s[0].pts=t,kK.log(`Video: First PTS/DTS adjusted: ${IZ(t,!0)}/${IZ(u,!0)}, delta: ${IZ(e,!0)} ms`)}}u=Math.max(0,u);let w=0,x=0;for(let e=0;e<o;e++){const t=s[e],r=t.units,n=r.length;let i=0;for(let e=0;e<n;e++)i+=r[e].data.length;x+=i,w+=n,t.length=i,t.dts=Math.max(t.dts,u),p=Math.min(t.pts,p),m=Math.max(t.pts,m)}c=s[o-1].dts;const E=x+4*w+8;let D;try{D=new Uint8Array(E)}catch(e){return void this.observer.emit(EK.ERROR,EK.ERROR,{type:DK.MUX_ERROR,details:SK.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:E,reason:`fail allocating video mdat ${E}`})}const S=new DataView(D.buffer);S.setUint32(0,E),D.set(LZ.types.mdat,4);let A=!1,T=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let e=0;e<o;e++){const t=s[e],r=t.units;let l,u=0;for(let e=0,t=r.length;e<t;e++){const t=r[e],n=t.data,i=t.data.byteLength;S.setUint32(h,i),h+=4,D.set(n,h),h+=i,u+=4+i}if(e<o-1)f=s[e+1].dts-t.dts,l=s[e+1].pts-t.pts;else{const r=this.config,a=e>0?t.dts-s[e-1].dts:b;if(l=e>0?t.pts-s[e-1].pts:b,r.stretchShortVideoTrack&&null!==this.nextAudioPts){const e=Math.floor(r.maxBufferHole*i),s=(n?p+n*i:this.nextAudioPts)-t.pts;s>e?(f=s-a,f<0?f=a:A=!0,kK.log(`[mp4-remuxer]: It is approximately ${s/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=a}else f=a}const c=Math.round(t.pts-t.dts);T=Math.min(T,f),N=Math.max(N,f),C=Math.min(C,l),k=Math.max(k,l),a.push(new HZ(t.key,f,u,c))}if(a.length)if(BZ){if(BZ<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(UZ&&k-C<N-T&&b/N<.025&&0===a[0].cts){kK.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,r=a.length;t<r;t++){const n=e+a[t].duration,i=e+a[t].cts;if(t<r-1){const e=n+a[t+1].cts;a[t].duration=e-i}else a[t].duration=t?a[t-1].duration:b;a[t].cts=0,e=n}}f=A||!f?b:f,this.nextAvcDts=d=c+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const M={data1:LZ.moof(e.sequenceNumber++,u,wK({},e,{samples:a})),data2:D,startPTS:p/i,endPTS:(m+f)/i,startDTS:u/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,M}remuxAudio(e,t,r,n,i){const s=e.inputTimeScale,a=s/(e.samplerate?e.samplerate:s),o="aac"===e.segmentCodec?1024:1152,l=o*a,u=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],h=void 0!==i;let f=e.samples,p=c?0:8,m=this.nextAudioPts||-1;const g=t*s,y=u.baseTime*s/u.timescale;if(this.isAudioContiguous=r=r||f.length&&m>0&&(n&&Math.abs(g-m)<9e3||Math.abs(zZ(f[0].pts-y,g)-m)<20*l),f.forEach((function(e){e.pts=zZ(e.pts-y,g)})),!r||m<0){if(f=f.filter((e=>e.pts>=0)),!f.length)return;m=0===i?0:n&&!h?Math.max(0,g):f[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let r=0,n=m;r<f.length;r++){const i=f[r],a=i.pts,o=a-n,u=Math.abs(1e3*o/s);if(o<=-t*l&&h)0===r&&(kK.warn(`Audio frame @ ${(a/s).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/s)} ms.`),this.nextAudioPts=m=n=a);else if(o>=t*l&&u<1e4&&h){let t=Math.round(o/l);n=a-t*l,n<0&&(t--,n+=l),0===r&&(this.nextAudioPts=m=n),kK.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(n/s).toFixed(3)}s due to ${Math.round(1e3*o/s)} ms gap.`);for(let s=0;s<t;s++){const t=Math.max(n,0);let s=OZ.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);s||(kK.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),s=i.unit.subarray()),f.splice(r,0,{unit:s,pts:t}),n+=l,r++}}i.pts=n,n+=l}}let v,b=null,w=null,x=0,E=f.length;for(;E--;)x+=f[E].unit.byteLength;for(let t=0,n=f.length;t<n;t++){const n=f[t],i=n.unit;let s=n.pts;if(null!==w){d[t-1].duration=Math.round((s-w)/a)}else{if(r&&"aac"===e.segmentCodec&&(s=m),b=s,!(x>0))return;x+=p;try{v=new Uint8Array(x)}catch(e){return void this.observer.emit(EK.ERROR,EK.ERROR,{type:DK.MUX_ERROR,details:SK.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:x,reason:`fail allocating audio mdat ${x}`})}if(!c){new DataView(v.buffer).setUint32(0,x),v.set(LZ.types.mdat,4)}}v.set(i,p);const l=i.byteLength;p+=l,d.push(new HZ(!0,o,l,0)),w=s}const D=d.length;if(!D)return;const S=d[d.length-1];this.nextAudioPts=m=w+a*S.duration;const A=c?new Uint8Array(0):LZ.moof(e.sequenceNumber++,b/a,wK({},e,{samples:d}));e.samples=[];const T=b/s,C=m/s,N={data1:A,data2:v,startPTS:T,endPTS:C,startDTS:T,endDTS:C,type:"audio",hasAudio:!0,hasVideo:!1,nb:D};return this.isAudioContiguous=!0,N}remuxEmptyAudio(e,t,r,n){const i=e.inputTimeScale,s=i/(e.samplerate?e.samplerate:i),a=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,u=(null!==a?a:n.startDTS*i)+l,c=n.endDTS*i+l,d=1024*s,h=Math.ceil((c-u)/d),f=OZ.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(kK.warn("[mp4-remuxer]: remux empty Audio"),!f)return void kK.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const p=[];for(let e=0;e<h;e++){const t=u+e*d;p.push({unit:f,pts:t,dts:t})}return e.samples=p,this.remuxAudio(e,t,r,!1)}}function zZ(e,t){let r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function jZ(e,t,r,n){const i=e.samples.length;if(!i)return;const s=e.inputTimeScale;for(let a=0;a<i;a++){const i=e.samples[a];i.pts=zZ(i.pts-r.baseTime*s/r.timescale,t*s)/s,i.dts=zZ(i.dts-n.baseTime*s/n.timescale,t*s)/s}const a=e.samples;return e.samples=[],{samples:a}}function qZ(e,t,r){const n=e.samples.length;if(!n)return;const i=e.inputTimeScale;for(let s=0;s<n;s++){const n=e.samples[s];n.pts=zZ(n.pts-r.baseTime*i/r.timescale,t*i)/i}e.samples.sort(((e,t)=>e.pts-t.pts));const s=e.samples;return e.samples=[],{samples:s}}class HZ{constructor(e,t,r,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=n,this.flags=new VZ(e)}}class VZ{constructor(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}}function GZ(e,t){const r=null==e?void 0:e.codec;return r&&r.length>4?r:"hvc1"===r||"hev1"===r?"hvc1.1.6.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||t===PK?"avc1.42e01e":"mp4a.40.5"}try{PZ=self.performance.now.bind(self.performance)}catch(e){kK.debug("Unable to use Performance API on this environment"),PZ="undefined"!=typeof self&&self.Date.now}const KZ=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,n){const i=this.videoTrack=QJ("video",1),s=this.audioTrack=QJ("audio",1),a=this.txtTrack=QJ("text",1);if(this.id3Track=QJ("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=MW(e);if(o.video){const{id:e,timescale:t,codec:r}=o.video;i.id=e,i.timescale=a.timescale=t,i.codec=r}if(o.audio){const{id:e,timescale:t,codec:r}=o.audio;s.id=e,s.timescale=t,s.codec=r}a.id=EW.text,i.sampleDuration=0,i.duration=s.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return NW(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}demux(e,t){this.timeOffset=t;let r=e;const n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=LW(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},r=NW(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;const n=r[r.length-1];return t.valid=rW(e,0,n.byteOffset-8),t.remainder=rW(e,n.byteOffset-8),t}(r);this.remainderData=t.remainder,n.samples=t.valid||new Uint8Array}else n.samples=r;const s=this.extractID3Track(n,t);return i.samples=_W(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return r.samples=_W(e,t),{videoTrack:t,audioTrack:QJ(),id3Track:n,textTrack:QJ()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const n=NW(e.samples,["emsg"]);n&&n.forEach((e=>{const n=function(e){const t=e[0];let r="",n="",i=0,s=0,a=0,o=0,l=0,u=0;if(0===t){for(;"\0"!==DW(e.subarray(u,u+1));)r+=DW(e.subarray(u,u+1)),u+=1;for(r+=DW(e.subarray(u,u+1)),u+=1;"\0"!==DW(e.subarray(u,u+1));)n+=DW(e.subarray(u,u+1)),u+=1;n+=DW(e.subarray(u,u+1)),u+=1,i=AW(e,12),s=AW(e,16),o=AW(e,20),l=AW(e,24),u=28}else if(1===t){u+=4,i=AW(e,u),u+=4;const t=AW(e,u);u+=4;const s=AW(e,u);for(u+=4,a=2**32*t+s,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,kK.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=AW(e,u),u+=4,l=AW(e,u),u+=4;"\0"!==DW(e.subarray(u,u+1));)r+=DW(e.subarray(u,u+1)),u+=1;for(r+=DW(e.subarray(u,u+1)),u+=1;"\0"!==DW(e.subarray(u,u+1));)n+=DW(e.subarray(u,u+1)),u+=1;n+=DW(e.subarray(u,u+1)),u+=1}return{schemeIdUri:r,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:e.subarray(u,e.byteLength)}}(e);if(cZ.test(n.schemeIdUri)){const e=xK(n.presentationTime)?n.presentationTime/n.timeScale:t+n.presentationTimeDelta/n.timeScale;let i=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;i<=.001&&(i=Number.POSITIVE_INFINITY);const s=n.payload;r.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:TY,duration:i})}}))}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(!e||!t)return e;const r=t.keyId;r&&t.isCommonEncryption&&NW(e,["moov","trak"]).forEach((e=>{const t=NW(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let n=NW(t,["enca"]);const i=n.length>0;i||(n=NW(t,["encv"])),n.forEach((e=>{NW(i?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=OW(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(kK.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${bW(e)} -> ${bW(r)}`),t.set(r,8))}}))}))}));return e}(e,n)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const n=this.initData=MW(e);t||(t=GZ(n.audio,IK)),r||(r=GZ(n.video,PK));const i={};n.audio&&n.video?i.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:n.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?i.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:kK.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}remux(e,t,r,n,i,s){var a,o;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};xK(u)||(u=this.lastEndTime=i||0);const d=t.samples;if(null==d||!d.length)return c;const h={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(d),f=this.initData),null==(o=f)||!o.length)return kK.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(e,t){let r=0,n=0,i=0;const s=NW(e,["moof","traf"]);for(let e=0;e<s.length;e++){const a=s[e],o=NW(a,["tfhd"])[0],l=t[AW(o,4)];if(!l)continue;const u=l.default,c=AW(o,0)|(null==u?void 0:u.flags);let d=null==u?void 0:u.duration;8&c&&(d=AW(o,2&c?12:8));const h=l.timescale||9e4,f=NW(a,["trun"]);for(let e=0;e<f.length;e++)r=FW(f[e]),!r&&d&&(r=d*AW(f[e],4)),l.type===PK?n+=r/h:l.type===IK&&(i+=r/h)}if(0===n&&0===i){let t=0;const r=NW(e,["sidx"]);for(let e=0;e<r.length;e++){const n=kW(r[e]);null!=n&&n.references&&(t+=n.references.reduce(((e,t)=>e+t.info.duration||0),0))}return t}return n||i}(d,f),m=function(e,t){return NW(t,["moof","traf"]).reduce(((t,r)=>{const n=NW(r,["tfdt"])[0],i=n[0],s=NW(r,["tfhd"]).reduce(((t,r)=>{const s=AW(r,4),a=e[s];if(a){let e=AW(n,4);if(1===i){if(e===wW)return kK.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=wW+1,e+=AW(n,8)}const r=e/(a.timescale||9e4);if(isFinite(r)&&(null===t||r<t))return r}return t}),null);return null!==s&&isFinite(s)&&(null===t||s<t)?s:t}),null)}(f,d),g=null===m?i:m;(function(e,t,r,n){if(null===e)return!0;const i=Math.max(n,1),s=t-e.baseTime/e.timescale;return Math.abs(s-r)>i}(l,g,i,p)||h.timescale!==l.timescale&&s)&&(h.initPTS=g-i,l&&1===l.timescale&&kK.warn("Adjusting initPTS by "+(h.initPTS-l.baseTime)),this.initPTS=l={baseTime:h.initPTS,timescale:1});const y=e?g-l.baseTime/l.timescale:u,v=y+p;!function(e,t,r){NW(t,["moof","traf"]).forEach((t=>{NW(t,["tfhd"]).forEach((n=>{const i=AW(n,4),s=e[i];if(!s)return;const a=s.timescale||9e4;NW(t,["tfdt"]).forEach((e=>{const t=e[0];let n=AW(e,4);if(0===t)n-=r*a,n=Math.max(n,0),CW(e,4,n);else{n*=Math.pow(2,32),n+=AW(e,8),n-=r*a,n=Math.max(n,0);const t=Math.floor(n/(wW+1)),i=Math.floor(n%(wW+1));CW(e,4,t),CW(e,8,i)}}))}))}))}(f,d,l.baseTime/l.timescale),p>0?this.lastEndTime=v:(kK.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const b=!!f.audio,w=!!f.video;let x="";b&&(x+="audio"),w&&(x+="video");const E={data1:d,startPTS:y,startDTS:y,endPTS:v,endDTS:v,type:x,hasAudio:b,hasVideo:w,nb:1,dropped:0};return c.audio="audio"===E.type?E:void 0,c.video="audio"!==E.type?E:void 0,c.initSegment=h,c.id3=jZ(r,i,l,l),n.samples.length&&(c.text=qZ(n,i,l)),c}}},{demux:SZ,remux:$Z},{demux:class extends eZ{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(sW(e,0)||[]).length;for(let r=e.length;t<r;t++)if(aZ(e,t))return kK.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&rZ(e,t)&&iZ(e,t)<=e.length-t}(e,t)}appendFrame(e,t,r){oZ(e,this.observer,t,r,e.manifestCodec);const n=uZ(e,t,r,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n}},remux:$Z},{demux:class extends eZ{resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=(sW(e,0)||[]).length;for(let r=e.length;t<r;t++)if(wZ(e,t))return kK.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return vZ(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return gZ(e,t,r,this.basePTS,this.frameIndex)}},remux:$Z}];class WZ{constructor(e,t,r,n,i){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=n,this.id=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,n){const i=r.transmuxing;i.executeStart=PZ();let s=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;n&&(this.currentTransmuxState=n);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=n||a,{audioCodec:p,videoCodec:m,defaultInitPts:g,duration:y,initSegmentData:v}=o,b=function(e,t){let r=null;e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(r=t);return r}(s,t);if(b&&"AES-128"===b.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(s,b.key.buffer,b.iv.buffer).then((e=>{const t=this.push(e,null,r);return this.decryptionPromise=null,t})),this.decryptionPromise;{let t=e.softwareDecrypt(s,b.key.buffer,b.iv.buffer);if(r.part>-1&&(t=e.flush()),!t)return i.executeEnd=PZ(),YZ(r);s=new Uint8Array(t)}}const w=this.needsProbing(u,c);if(w){const e=this.configureTransmuxer(s);if(e)return kK.warn(`[transmuxer] ${e.message}`),this.observer.emit(EK.ERROR,EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),i.executeEnd=PZ(),YZ(r)}(u||c||f||w)&&this.resetInitSegment(v,p,m,y,t),(u||f||w)&&this.resetInitialTimestamp(g),l||this.resetContiguity();const x=this.transmux(s,b,h,d,r),E=this.currentTransmuxState;return E.contiguous=!0,E.discontinuity=!1,E.trackSwitch=!1,i.executeEnd=PZ(),x}flush(e){const t=e.transmuxing;t.executeStart=PZ();const{decrypter:r,currentTransmuxState:n,decryptionPromise:i}=this;if(i)return i.then((()=>this.flush(e)));const s=[],{timeOffset:a}=n;if(r){const t=r.flush();t&&s.push(this.push(t,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l)return t.executeEnd=PZ(),[YZ(e)];const u=o.flush(a);return JZ(u)?u.then((t=>(this.flushRemux(s,t,e),s))):(this.flushRemux(s,u,e),s)}flushRemux(e,t,r){const{audioTrack:n,videoTrack:i,id3Track:s,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;kK.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const u=this.remuxer.remux(n,i,s,a,l,o,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=PZ()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,n,i){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(e,t,r,n),a.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,n,i){let s;return s=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,n,i):this.transmuxUnencrypted(e,r,n,i),s}transmuxUnencrypted(e,t,r,n){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,s,a,o,t,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,r,n,i){return this.demuxer.demuxSampleAes(e,t,r).then((e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,n,!1,this.id),chunkMeta:i})))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:n,vendor:i}=this;let s;for(let t=0,r=KZ.length;t<r;t++)if(KZ[t].demux.probe(e)){s=KZ[t];break}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=s.remux,u=s.demux;o&&o instanceof l||(this.remuxer=new l(r,t,n,i)),a&&a instanceof u||(this.demuxer=new u(r,t,n),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new PJ(this.config)),e}}const YZ=e=>({remuxResult:{},chunkMeta:e});function JZ(e){return"then"in e&&e.then instanceof Function}class ZZ{constructor(e,t,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i||null}}class XZ{constructor(e,t,r,n,i,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=s}}var QZ={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new i(n,s||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,a=new Array(s);i<s;i++)a[i]=n[i].fn;return a},o.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,i,s,a){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,s),!0;case 6:return c.fn.call(c.context,t,n,i,s,a),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||a(this,s);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(QZ);var eX=uK(QZ.exports);const tX=KW()||{isTypeSupported:()=>!1};class rX{constructor(e,t,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const s=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===EK.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new eX,this.observer.on(EK.FRAG_DECRYPTED,s),this.observer.on(EK.ERROR,s);const a={mp4:tX.isTypeSupported("video/mp4"),mpeg:tX.isTypeSupported("audio/mpeg"),mp3:tX.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){if(i.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{i.workerPath?(kK.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=function(e){const t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}(i.workerPath)):(kK.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}()),this.onwmsg=e=>this.onWorkerMessage(e);const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{const r=new Error(`${e.message}  (${e.filename}:${e.lineno})`);i.enableWorker=!1,kK.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(EK.ERROR,{type:DK.OTHER_ERROR,details:SK.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:r})},e.postMessage({cmd:"init",typeSupported:a,vendor:o,id:t,config:JSON.stringify(i)})}catch(e){kK.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new WZ(this.observer,a,i,o,t)}return}}this.transmuxer=new WZ(this.observer,a,i,o,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,n,i,s,a,o,l,u){var c,d;l.transmuxing.start=self.performance.now();const{transmuxer:h}=this,f=s?s.start:i.start,p=i.decryptdata,m=this.frag,g=!(m&&i.cc===m.cc),y=!(m&&l.level===m.level),v=m?l.sn-m.sn:-1,b=this.part?l.part-this.part.index:-1,w=0===v&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),x=!y&&(1===v||0===v&&(1===b||w&&b<=0)),E=self.performance.now();(y||v||0===i.stats.parsing.start)&&(i.stats.parsing.start=E),!s||!b&&x||(s.stats.parsing.start=E);const D=!(m&&(null==(c=i.initSegment)?void 0:c.url)===(null==(d=m.initSegment)?void 0:d.url)),S=new XZ(g,x,o,y,f,D);if(!x||g||D){kK.log(`[transmuxer-interface, ${i.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${g}\n        trackSwitch: ${y}\n        contiguous: ${x}\n        accurateTimeOffset: ${o}\n        timeOffset: ${f}\n        initSegmentChange: ${D}`);const e=new ZZ(r,n,t,a,u);this.configureTransmuxer(e)}if(this.frag=i,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:S},e instanceof ArrayBuffer?[e]:[]);else if(h){const t=h.push(e,p,l,S);JZ(t)?(h.async=!0,t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}))):(h.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);JZ(r)||t.async?(JZ(r)||(r=Promise.resolve(r)),r.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}))):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}onWorkerMessage(e){const t=e.data,r=this.hls;switch(t.event){case"init":{var n;const e=null==(n=this.workerContext)?void 0:n.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":kK[t.data.logType]&&kK[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class nX{constructor(e,t,r,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:n,stalled:i}=this;if(null===n)return;const{currentTime:s,seeking:a}=n,o=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,s!==e){if(this.moved=!0,null!==i){if(this.stallReported){const e=self.performance.now()-i;kK.warn(`playback not stuck anymore @${s}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(l||o)return void(this.stalled=null);if(n.paused&&!a||n.ended||0===n.playbackRate||!CJ.getBuffered(n).length)return;const u=CJ.bufferInfo(n,s,0),c=u.len>0,d=u.nextStart||0;if(!c&&!d)return;if(a){const e=u.len>2,r=!d||t&&t.start<=s||d-s>2&&!this.fragmentTracker.getPartialFragment(s);if(e||r)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var h;const e=Math.max(d,u.start||0)-s,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,r=(null==t||null==(h=t.details)?void 0:h.live)?2*t.details.targetduration:2,n=this.fragmentTracker.getPartialFragment(s);if(e>0&&(e<=r||n))return void this._trySkipBufferHole(n)}const f=self.performance.now();if(null===i)return void(this.stalled=f);const p=f-i;if(!a&&p>=250&&(this._reportStall(u),!this.media))return;const m=CJ.bufferInfo(n,s,r.maxBufferHole);this._tryFixBufferStall(m,p)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:n,media:i}=this;if(null===i)return;const s=i.currentTime,a=n.getPartialFragment(s);if(a){if(this._trySkipBufferHole(a)||!this.media)return}(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-s<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(kK.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:n}=this;if(!n&&r){this.stallReported=!0;const n=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);kK.warn(n.message),t.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:n}=this;if(null===n)return 0;const i=n.currentTime,s=CJ.bufferInfo(n,i,0),a=i<s.start?s.start:s.nextStart;if(a){const o=s.len<=t.maxBufferHole,l=s.len>0&&s.len<1&&n.readyState<3,u=a-i;if(u>0&&(o||l)){if(u>t.maxBufferHole){const{fragmentTracker:t}=this;let r=!1;if(0===i){const e=t.getAppendedFrag(0,pY);e&&a<e.end&&(r=!0)}if(!r){const r=e||t.getAppendedFrag(i,pY);if(r){let e=!1,n=r.end;for(;n<a;){const r=t.getPartialFragment(n);if(!r){e=!0;break}n+=r.duration}if(e)return 0}}}const s=Math.max(a+.05,i+.1);if(kK.warn(`skipping hole, adjusting currentTime from ${i} to ${s}`),this.moved=!0,this.stalled=null,n.currentTime=s,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${i} to ${s}`);r.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return s}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:n}=this;if(null===r)return;const i=r.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){const s=i+(n+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${i} to ${s}`);kK.warn(a.message),r.currentTime=s,t.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const r=new Error(`Playhead still not moving while enough data buffered @${i} after ${e.nudgeMaxRetry} nudges`);kK.error(r.message),t.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.BUFFER_STALLED_ERROR,error:r,fatal:!0})}}}class iX extends ZJ{constructor(e,t,r){super(e,t,r,"[stream-controller]",pY),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(EK.LEVEL_LOADING,this.onLevelLoading,this),e.on(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(EK.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(EK.ERROR,this.onError,this),e.on(EK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(EK.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(EK.BUFFER_CREATED,this.onBufferCreated,this),e.on(EK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(EK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(EK.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(EK.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(EK.ERROR,this.onError,this),e.off(EK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(EK.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(EK.BUFFER_CREATED,this.onBufferCreated,this),e.off(EK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(EK.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(EK.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=r.startLevel;-1===e&&(r.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=r.nextAutoLevel),this.level=r.nextLoadLevel=e,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=$J,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=UJ}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case JJ:{var e;const{levels:t,level:r}=this,n=null==t||null==(e=t[r])?void 0:e.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=$J;break}if(this.hls.nextLoadLevel!==this.level){this.state=$J;break}break}case qJ:{var t;const e=self.performance.now(),r=this.retryDate;(!r||e>=r||null!=(t=this.media)&&t.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=$J)}}this.state===$J&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:n}=this,{config:i,nextLoadLevel:s}=e;if(null===t||!n&&(this.startFragRequested||!i.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;if(null==r||!r[s])return;const a=r[s],o=this.getMainFwdBufferInfo();if(null===o)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(EK.BUFFER_EOS,e),void(this.state=KJ)}e.loadLevel!==s&&-1===e.manualLevel&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=a.details;if(!u||this.state===JJ||u.live&&this.levelLastLoaded!==s)return this.level=s,void(this.state=JJ);const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&"initSegment"!==f.sn&&this.fragmentTracker.getState(f)!==mJ){var p;const e=(null!=(p=this.backtrackFragment)?p:f).sn-u.startSN,t=u.fragments[e-1];t&&f.cc===t.cc&&(f=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const e=this.audioOnly&&!this.altAudio?IK:PK,t=(e===PK?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,pY)}f=this.getNextFragmentLoopLoading(f,u,o,pY,d)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,h))}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);this.fragCurrent=e,n===hJ||n===pJ?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,pY)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*i.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],n=this.fragLastKbps;r=n&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*n)+1:0}else r=0;const s=this.getBufferedFrag(t.currentTime+r);if(s){const e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,r=e.duration,n=Math.max(s.end,t+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,.5*r),.75*r));this.flushMainBuffer(n,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case zJ:case jJ:case qJ:case VJ:case GJ:this.state=$J}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new nX(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;xK(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(EK.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(e,t){let r,n=!1,i=!1;t.levels.forEach((e=>{r=e.audioCodec,r&&(-1!==r.indexOf("mp4a.40.2")&&(n=!0),-1!==r.indexOf("mp4a.40.5")&&(i=!0))})),this.audioCodecSwitch=n&&i&&!function(){var e;const t=XJ();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==$J)return;const n=r[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(n.details))&&(this.state=JJ)}onLevelLoaded(e,t){var r;const{levels:n}=this,i=t.level,s=t.details,a=s.totalduration;if(!n)return void this.warn(`Levels were reset while loading level ${i}`);this.log(`Level ${i} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""}, cc [${s.startCC}, ${s.endCC}] duration:${a}`);const o=n[i],l=this.fragCurrent;!l||this.state!==jJ&&this.state!==qJ||l.level===t.level&&l.urlId===o.urlId||!l.loader||this.abortCurrentFrag();let u=0;if(s.live||null!=(r=o.details)&&r.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;u=this.alignPlaylists(s,o.details)}if(o.details=s,this.levelLastLoaded=i,this.hls.trigger(EK.LEVEL_UPDATED,{details:s,level:i}),this.state===JJ){if(this.waitForCdnTuneIn(s))return;this.state=$J}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:n,payload:i}=e,{levels:s}=this;if(!s)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const a=s[r.level],o=a.details;if(!o)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const l=a.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=r.initSegment)?void 0:t.data,d=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new rX(this.hls,pY,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=n?n.index:-1,p=-1!==f,m=new NJ(r.level,r.sn,r.stats.chunkCount,i.byteLength,f,p),g=this.initPTS[r.cc];h.push(i,c,d,l,r,n,o.totalduration,u,m,g)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;r&&(e.trigger(EK.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(EK.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,n=!!this.hls.audioTracks[r].url;if(n){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=n,this.tick()}onBufferCreated(e,t){const r=t.tracks;let n,i,s=!1;for(const e in r){const t=r[e];if("main"===t.id){if(i=e,n=t,"video"===e){const t=r[e];t&&(this.videoBuffer=t.buffer)}}else s=!0}s&&n?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r&&r.type!==pY)return;if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===GJ&&(this.state=$J));const i=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}onError(e,t){var r;if(t.fatal)this.state=WJ;else switch(t.details){case SK.FRAG_GAP:case SK.FRAG_PARSING_ERROR:case SK.FRAG_DECRYPT_ERROR:case SK.FRAG_LOAD_ERROR:case SK.FRAG_LOAD_TIMEOUT:case SK.KEY_LOAD_ERROR:case SK.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pY,t);break;case SK.LEVEL_LOAD_ERROR:case SK.LEVEL_LOAD_TIMEOUT:case SK.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==JJ||(null==(r=t.context)?void 0:r.type)!==dY||(this.state=$J);break;case SK.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case SK.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!CJ.getBuffered(e).length){const e=this.state!==$J?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=$J,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==IK||this.audioOnly&&!this.altAudio){const e=(t===PK?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,pY)}}onLevelsUpdated(e,t){this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const n=CJ.getBuffered(e),i=(n.length?n.start(0):0)-r;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${i} to match buffer start`),r+=i,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((r=>{const{hls:n}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=$J,this.startFragRequested=!1,this.bitrateTest=!1;const i=e.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),n.trigger(EK.FRAG_LOADED,r),e.bitrateTest=!1}))}_handleTransmuxComplete(e){var t;const r="main",{hls:n}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:u}=a,{video:c,text:d,id3:h,initSegment:f}=i,{details:p}=u,m=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=VJ,f){if(null!=f&&f.tracks){const e=o.initSegment||o;this._bufferInitSegment(u,f.tracks,e,s),n.trigger(EK.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:f.tracks})}const e=f.initPTS,t=f.timescale;xK(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},n.trigger(EK.INIT_PTS_FOUND,{frag:o,id:r,initPTS:e,timescale:t}))}if(c&&p&&"initSegment"!==o.sn){const e=p.fragments[o.sn-1-p.startSN],t=o.sn===p.startSN,r=!e||o.cc>e.cc;if(!1!==i.independent){const{startPTS:e,endPTS:n,startDTS:i,endDTS:a}=c;if(l)l.elementaryStreams[c.type]={startPTS:e,endPTS:n,startDTS:i,endDTS:a};else if(c.firstKeyFrame&&c.independent&&1===s.id&&!r&&(this.couldBacktrack=!0),c.dropped&&c.independent){const i=this.getMainFwdBufferInfo(),s=(i?i.end:this.getLoadPosition())+this.config.maxBufferHole,l=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&s<l-this.config.maxBufferHole&&!r)return void this.backtrack(o);r&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,n,o.start,a,!0)}o.setElementaryStreamInfo(c.type,e,n,i,a),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,s,t||r)}else{if(!t&&!r)return void this.backtrack(o);o.gap=!0}}if(m){const{startPTS:e,endPTS:t,startDTS:r,endDTS:n}=m;l&&(l.elementaryStreams[IK]={startPTS:e,endPTS:t,startDTS:r,endDTS:n}),o.setElementaryStreamInfo(IK,e,t,r,n),this.bufferFragmentData(m,o,l,s)}if(p&&null!=h&&null!=(t=h.samples)&&t.length){const e={id:r,frag:o,details:p,samples:h.samples};n.trigger(EK.FRAG_PARSING_METADATA,e)}if(p&&d){const e={id:r,frag:o,details:p,samples:d.samples};n.trigger(EK.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,r,n){if(this.state!==VJ)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:i,video:s,audiovideo:a}=t;if(i){let t=e.audioCodec;const r=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==i.metadata.channelCount&&-1===r.indexOf("firefox")&&(t="mp4a.40.5")),-1!==r.indexOf("android")&&"audio/mpeg"!==i.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),i.levelCodec=t,i.id="main",this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${i.codec}]`)}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.attrs.CODECS||""}/${a.codec}]`),this.hls.trigger(EK.BUFFER_CODECS,t),Object.keys(t).forEach((e=>{const i=t[e].initSegment;null!=i&&i.byteLength&&this.hls.trigger(EK.BUFFER_APPENDING,{type:e,data:i,frag:r,part:null,chunkMeta:n,parent:r.type})})),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,pY)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=$J}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(CJ.isBuffered(e,r)?t=this.getAppendedFrag(r):CJ.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,r=t.level;e&&t.sn===e.sn&&e.level===r&&t.urlId===e.urlId||(this.fragPlaying=t,this.hls.trigger(EK.FRAG_CHANGED,{frag:t}),e&&e.level===r||this.hls.trigger(EK.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&xK(t)&&xK(r.programDateTime)){const e=r.programDateTime+1e3*(t-r.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class sX{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class aX{constructor(e,t,r,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new sX(e),this.fast_=new sX(t),this.defaultTTFB_=n,this.ttfb_=new sX(e)}update(e,t){const{slow_:r,fast_:n,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new sX(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new sX(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new sX(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){const r=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class oX{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function(e,t){const r=new Uint8Array(t);let n=0;for(let t=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function lX(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!uX(e[r].attrs,t[r].attrs))return!1;return!0}function uX(e,t){const r=e["STABLE-RENDITION-ID"];return r?r===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some((r=>e[r]!==t[r]))}class cX{constructor(e){this.buffered=void 0;const t=(t,r,n)=>{if((r>>>=0)>n-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${n})`);return e[r][t]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}function dX(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];"subtitles"!==n.kind&&"captions"!==n.kind||!n.label||t.push(e[r])}return t}class hX{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t){const r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise((e=>{t=e})),n={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(n,e),r}executeNext(e){const{buffers:t,queues:r}=this,n=t[e],i=r[e];if(i.length){const t=i[0];try{t.execute()}catch(r){kK.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),t.onError(r),null!=n&&n.updating||(i.shift(),this.executeNext(e))}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const fX=KW(),pX=/([ha]vc.)(?:\.[^.,]+)+/;const mX={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},gX=function(e){let t=e;return mX.hasOwnProperty(e)&&(t=mX[e]),String.fromCharCode(t)},yX=15,vX=100,bX={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},wX={17:2,18:4,21:6,22:8,23:10,19:13,20:15},xX={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},EX={25:2,26:4,29:6,30:8,31:10,27:13,28:15},DX=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class SX{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;kK.log(`${this.time} [${e}] ${r}`)}}}const AX=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class TX{constructor(e,t,r,n,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class CX{constructor(e,t,r,n,i,s){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new TX(t,r,n,i,s)}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class NX{constructor(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<vX;e++)this.chars.push(new CX);this.logger=e,this.pos=0,this.currPenState=new TX}equals(e){let t=!0;for(let r=0;r<vX;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}copy(e){for(let t=0;t<vX;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<vX;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>vX&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=vX)}moveCursor(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=gX(e);this.pos>=vX?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<vX;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<vX;r++){const n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class kX{constructor(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let t=0;t<yX;t++)this.rows.push(new NX(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let e=0;e<yX;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<yX;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<yX;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<yX;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,(()=>"pacData = "+JSON.stringify(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<yX;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const n=r.rows[e].cueStartTime,i=this.logger.time;if(n&&null!==i&&n<i)for(let n=0;n<this.nrRollUpRows;n++)this.rows[t-this.nrRollUpRows+n+1].copy(r.rows[e+n])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,n=Math.max(t-1,0);r.setCursor(e.indent),e.color=r.chars[n].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",n=-1;for(let r=0;r<yX;r++){const i=this.rows[r].getTextString();i&&(n=r+1,e?t.push("Row "+n+": '"+i+"'"):t.push(i.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class MX{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new kX(r),this.nonDisplayedMemory=new kX(r),this.lastOutputScreen=new kX(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class OX{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const n=new SX;this.channels=[null,new MX(e,t,n),new MX(e+1,r,n)],this.cmdHistory={a:null,b:null},this.logger=n}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let r,n,i,s=!1;this.logger.time=e;for(let e=0;e<t.length;e+=2)if(n=127&t[e],i=127&t[e+1],0!==n||0!==i){if(this.logger.log(3,"["+AX([t[e],t[e+1]])+"] -> ("+AX([n,i])+")"),r=this.parseCmd(n,i),r||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i)),!r&&(s=this.parseChars(n,i),s)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||s||this.logger.log(2,"Couldn't parse cleaned data "+AX([n,i])+" orig: "+AX([t[e],t[e+1]]))}}parseCmd(e,t){const{cmdHistory:r}=this;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(LX(e,t,r))return FX(null,null,r),this.logger.log(3,"Repeated command ("+AX([e,t])+") is dropped"),!0;const n=20===e||21===e||23===e?1:2,i=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),FX(e,t,r),this.currentChannel=n,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return!!n&&(n.ccMIDROW(t),this.logger.log(3,"MIDROW ("+AX([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;const n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(LX(e,t,n))return FX(null,null,n),!0;const i=e<=23?1:2;r=t>=64&&t<=95?1===i?bX[e]:xX[e]:1===i?wX[e]:EX[e];const s=this.channels[i];return!!s&&(s.setPAC(this.interpretPAC(r,t)),FX(e,t,n),this.currentChannel=i,!0)}interpretPAC(e,t){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=1==(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n}parseChars(e,t){let r,n=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let e;e=17===i?t+80:18===i?t+112:t+144,this.logger.log(2,"Special char '"+gX(e)+"' in channel "+r),n=[e]}else e>=32&&e<=127&&(n=0===t?[e]:[e,t]);if(n){const r=AX(n);this.logger.log(3,"Char codes =  "+r.join(",")),FX(e,t,this.cmdHistory)}return n}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let r;const n={};16===e||24===e?(r=Math.floor((t-32)/2),n.background=DX[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0));const i=e<=23?1:2;return this.channels[i].setBkgData(n),FX(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function FX(e,t,r){r.a=e,r.b=t}function LX(e,t,r){return r.a===e&&r.b===t}class _X{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var RX=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const r=t.toLowerCase();return!!~e.indexOf(r)&&r}function n(e){return r(t,e)}function i(e,...t){let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const r in t)e[r]=t[r]}return e}function s(t,s,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let u="",c=!1,d=t,h=s,f=a,p=null,m="",g=!0,y="auto",v="start",b=50,w="middle",x=50,E="middle";Object.defineProperty(o,"id",i({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return m},set:function(t){const n=function(t){return r(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");m=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return v},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return w},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");w=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return x},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");x=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return E},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class IX{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function PX(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(n||0)}const r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}class BX{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function UX(e,t,r,n){const i=n?e.split(n):[e];for(const e in i){if("string"!=typeof i[e])continue;const n=i[e].split(r);if(2!==n.length)continue;t(n[0],n[1])}}const $X=new RX(0,0,""),zX="middle"===$X.align?"middle":"center";function jX(e,t,r){const n=e;function i(){const t=PX(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=i(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.slice(3),s(),t.endTime=i(),s(),function(e,t){const n=new BX;UX(e,(function(e,t){let i;switch(e){case"region":for(let i=r.length-1;i>=0;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),n.integer(e,i[0]),n.percent(e,i[0])&&n.set("snapToLines",!1),n.alt(e,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",zX,"end"]);break;case"position":i=t.split(","),n.percent(e,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",zX,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",zX,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");let i=n.get("line","auto");"auto"===i&&-1===$X.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",zX);let s=n.get("position","auto");"auto"===s&&50===$X.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}(e,t)}function qX(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class HX{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new IX,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let e=t.buffer,r=0;for(e=qX(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;const n=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=r();const n=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let n=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(n?n=!1:e=r(),t.state){case"HEADER":/:/.test(e)?UX(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new RX(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{jX(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const r=-1!==e.indexOf("--\x3e");if(!e||r&&(n=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const VX=/\r\n|\n\r|\n|\r/g,GX=function(e,t,r=0){return e.slice(r,r+t.length)===t},KX=function(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function WX(e,t,r){return KX(e.toString())+KX(t.toString())+KX(r)}function YX(e,t,r,n,i,s,a){const o=new HX,l=gW(new Uint8Array(e)).trim().replace(VX,"\n").split("\n"),u=[],c=t?function(e,t=1){return RZ(e,_Z,1/t)}(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,p=0,m=!0;o.oncue=function(e){const s=r[n];let a=r.ccOffset;const o=(f-c)/9e4;if(null!=s&&s.new&&(void 0!==p?a=r.ccOffset=s.start:function(e,t,r){let n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(s=i)&&s.new;){var s;e.ccOffset+=n.start-i.start,n.new=!1,n=i,i=e[n.prevCC]}e.presentationOffset=r}(r,n,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));a=o-r.presentationOffset}const l=e.endTime-e.startTime,h=zZ(9e4*(e.startTime+a-p),9e4*i)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const m=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(m)),e.id||(e.id=WX(e.startTime,e.endTime,m)),e.endTime>0&&u.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?a(d):s(u)},l.forEach((e=>{if(m){if(GX(e,"X-TIMESTAMP-MAP=")){m=!1,e.slice(16).split(",").forEach((e=>{GX(e,"LOCAL:")?h=e.slice(6):GX(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))}));try{p=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(xK(t)&&xK(r)&&xK(n)&&xK(i)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*n,t+=36e5*i,t}(h)/1e3}catch(e){d=e}return}""===e&&(m=!1)}o.parse(e+"\n")})),o.flush()}const JX="stpp.ttml.im1t",ZX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,XX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,QX={left:"start",center:"center",right:"end",start:"start",end:"end"};function eQ(e,t,r,n){const i=NW(new Uint8Array(e),["mdat"]);if(0===i.length)return void n(new Error("Could not parse IMSC1 mdat"));const s=i.map((e=>gW(e))),a=function(e,t,r=1,n=!1){return RZ(e,t,1/r,n)}(t.baseTime,1,t.timescale);try{s.forEach((e=>r(function(e,t){const r=new DOMParser,n=r.parseFromString(e,"text/xml"),i=n.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce(((e,t)=>(e[t]=i.getAttribute(`ttp:${t}`)||s[t],e)),{}),o="preserve"!==i.getAttribute("xml:space"),l=rQ(tQ(i,"styling","style")),u=rQ(tQ(i,"layout","region")),c=tQ(i,"body","[begin]");return[].map.call(c,(e=>{const r=nQ(e,o);if(!r||!e.hasAttribute("begin"))return null;const n=aQ(e.getAttribute("begin"),a),i=aQ(e.getAttribute("dur"),a);let s=aQ(e.getAttribute("end"),a);if(null===n)throw sQ(e);if(null===s){if(null===i)throw sQ(e);s=n+i}const c=new RX(n-t,s-t,r);c.id=WX(c.startTime,c.endTime,c.text);const d=function(e,t,r){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&r.hasOwnProperty(a)&&(i=r[a]);return s.reduce(((r,s)=>{const a=iQ(t,n,s)||iQ(e,n,s)||iQ(i,n,s);return a&&(r[s]=a),r}),{})}(u[e.getAttribute("region")],l[e.getAttribute("style")],l),{textAlign:h}=d;if(h){const e=QX[h];e&&(c.lineAlign=e),c.align=h}return wK(c,d),c})).filter((e=>null!==e))}(e,a))))}catch(e){n(e)}}function tQ(e,t,r){const n=e.getElementsByTagName(t)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function rQ(e){return e.reduce(((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function nQ(e,t){return[].slice.call(e.childNodes).reduce(((e,r,n)=>{var i;return"br"===r.nodeName&&n?e+"\n":null!=(i=r.childNodes)&&i.length?nQ(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function iQ(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function sQ(e){return new Error(`Could not parse ttml timestamp ${e}`)}function aQ(e,t){if(!e)return null;let r=PX(e);return null===r&&(ZX.test(e)?r=function(e,t){const r=ZX.exec(e),n=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/t.frameRate}(e,t):XX.test(e)&&(r=function(e,t){const r=XX.exec(e),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/t.frameRate;case"t":return n/t.tickRate}return n}(e,t))),r}function oQ(e,t){return!!e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}class lQ{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(EK.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(EK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(EK.BUFFER_CODECS,this.onBufferCodecs,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(EK.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(EK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(EK.BUFFER_CODECS,this.onBufferCodecs,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const e=this.hls.levels;if(e.length){const t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter(((t,r)=>this.isLevelAllowed(t)&&r<=e));return this.clientRect=null,lQ.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}isLevelAllowed(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;let n=e.length-1;for(let a=0;a<e.length;a+=1){const o=e[a];if((o.width>=t||o.height>=r)&&(i=o,!(s=e[a+1])||i.width!==s.width||i.height!==s.height)){n=a;break}}var i,s;return n}}const uQ="[eme]";class cQ{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=cQ.CDMCleanupPromise?[cQ.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=kK.debug.bind(kK,uQ),this.log=kK.log.bind(kK,uQ),this.warn=kK.warn.bind(kK,uQ),this.error=kK.error.bind(kK,uQ),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(EK.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(EK.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(EK.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(EK.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,n=t[e];if(n)return n.licenseUrl;if(e===GK.WIDEVINE&&r)return r;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(e,t,r)=>!!e&&r.indexOf(e)===t,n=t.map((e=>e.audioCodec)).filter(r),i=t.map((e=>e.videoCodec)).filter(r);return n.length+i.length===0&&i.push("avc1.42e01e"),new Promise(((t,r)=>{const s=e=>{const a=e.shift();this.getMediaKeysPromise(a,n,i).then((e=>t({keySystem:a,mediaKeys:e}))).catch((t=>{e.length?s(e):r(t instanceof dQ?t:new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))};s(e)}))}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!=typeof r){let e=`Configured requestMediaKeySystemAccess is not a function ${r}`;return null===tW&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return r(e,t)}getMediaKeysPromise(e,t,r){const n=function(e,t,r,n){let i;switch(e){case GK.FAIRPLAY:i=["cenc","sinf"];break;case GK.WIDEVINE:case GK.PLAYREADY:i=["cenc"];break;case GK.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,r,n){return[{initDataTypes:e,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:t.map((e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null}))),videoCapabilities:r.map((e=>({contentType:`video/mp4; codecs="${e}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null})))}]}(i,t,r,n)}(e,t,r,this.config.drmSystemOptions),i=this.keySystemAccessPromises[e];let s=null==i?void 0:i.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(n)}`),s=this.requestMediaKeySystemAccess(e,n);const t=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),s.then((r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);const n=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=r.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),n.then((r=>r?this.setMediaKeysServerCertificate(t,e,r):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return s.then((()=>i.mediaKeys))}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${bW(e.keyId||[])}`);const n=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t),i="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,i,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return bW(e.keyId)}updateKeySession(e,t){var r;const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${bW((null==(r=e.decryptdata)?void 0:r.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),n.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise(((t,r)=>{const n=eW(this.config),i=e.map(ZK).filter((e=>!!e&&-1!==n.indexOf(e)));return this.getKeySystemSelectionPromise(i).then((({keySystem:e})=>{const n=QK(e);n?t(n):r(new Error(`Unable to find format for key-system "${e}"`))})).catch(r)}))}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),n=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);let i=this.keyIdToKeySessionPromise[r];return i||(i=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then((({keySystem:r,mediaKeys:i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(r,i).then((()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:r,mediaKeys:i,decryptdata:t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")}))))),i.catch((e=>this.handleError(e)))),i}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof dQ?this.hls.trigger(EK.ERROR,e.data):this.hls.trigger(EK.ERROR,{type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const t=ZK(e.keyFormat),r=t?[t]:eW(this.config);return this.attemptKeySystemAccess(r)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=eW(this.config)),0===e.length)throw new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:r}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===r)return;let n,i;if("sinf"===t&&this.config.drmSystems[GK.FAIRPLAY]){const e=DW(new Uint8Array(r));try{const t=qK(JSON.parse(e).sinf),r=OW(new Uint8Array(t));if(!r)return;n=r.subarray(8,24),i=GK.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},r=new DataView(e),n=r.getUint32(0);if(e.byteLength!==n&&n>44)return null;if(1886614376!==r.getUint32(4))return null;if(t.version=r.getUint32(8)>>>24,t.version>1)return null;t.systemId=bW(new Uint8Array(e,12,16));const i=r.getUint32(28);if(0===t.version){if(n-32<i)return null;t.data=new Uint8Array(e,32,i)}else if(1===t.version){t.kids=[];for(let r=0;r<i;r++)t.kids.push(new Uint8Array(e,32+16*r,16))}return t}(r);if(null===e)return;0===e.version&&e.systemId===XK&&e.data&&(n=e.data.subarray(8,24)),i=function(e){if(e===XK)return GK.WIDEVINE}(e.systemId)}if(!i||!n)return;const s=bW(n),{keyIdToKeySessionPromise:a,mediaKeySessions:o}=this;let l=a[s];for(let e=0;e<o.length;e++){const i=o[e],u=i.decryptdata;if(u.pssh||!u.keyId)continue;const c=bW(u.keyId);if(s===c||-1!==u.uri.replace(/-/g,"").indexOf(s)){l=a[c],delete a[c],u.pssh=new Uint8Array(r),u.keyId=n,l=a[s]=l.then((()=>this.generateRequestWithPreferredKeySession(i,t,r,"encrypted-event-key-match")));break}}l||(l=a[s]=this.getKeySystemSelectionPromise([i]).then((({keySystem:e,mediaKeys:i})=>{var a;this.throwIfDestroyed();const o=new $W("ISO-23001-7",s,null!=(a=QK(e))?a:"");return o.pssh=new Uint8Array(r),o.keyId=n,this.attemptSetMediaKeys(e,i).then((()=>{this.throwIfDestroyed();const n=this.createMediaKeySessionContext({decryptdata:o,keySystem:e,mediaKeys:i});return this.generateRequestWithPreferredKeySession(n,t,r,"encrypted-event-no-match")}))}))),l.catch((e=>this.handleError(e)))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(r).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(n),n.then((()=>{this.log(`Media-keys set for "${e}"`),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===r.indexOf(e)))}))}generateRequestWithPreferredKeySession(e,t,r,n){var i,s;const a=null==(i=this.config.drmSystems)||null==(s=i[e.keySystem])?void 0:s.generateRequest;if(a)try{const n=a.call(this.hls,t,r,e);if(!n)throw new Error("Invalid response from configured generateRequest filter");t=n.initDataType,r=e.decryptdata.pssh=n.initData?new Uint8Array(n.initData):null}catch(e){var o;if(this.warn(e.message),null!=(o=this.hls)&&o.config.debug)throw e}if(null===r)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${n}": ${l} (init data type: ${t} length: ${r?r.byteLength:null})`);const u=new eX;e.mediaKeysSession.onmessage=t=>{const r=e.mediaKeysSession;if(!r)return void u.emit("error",new Error("invalid state"));const{messageType:n,message:i}=t;this.log(`"${n}" message event for session "${r.sessionId}" message size: ${i.byteLength}`),"license-request"===n||"license-renewal"===n?this.renewLicense(e,i).catch((e=>{this.handleError(e),u.emit("error",e)})):"license-release"===n?e.keySystem===GK.FAIRPLAY&&(this.updateKeySession(e,VK("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${n}"`)},e.mediaKeysSession.onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void u.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const r=e.keyStatus;u.emit("keyStatus",r),"expired"===r&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};const c=new Promise(((e,t)=>{u.on("error",t),u.on("keyStatus",(r=>{r.startsWith("usable")?e():"output-restricted"===r?t(new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?t(new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${r}"`)):"expired"===r?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${r}"`)}))}));return e.mediaKeysSession.generateRequest(t,r).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)})).then((()=>c)).catch((t=>{throw u.removeAllListeners(),this.removeSession(e),t})).then((()=>(u.removeAllListeners(),e)))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach(((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${bW("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${bW(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}fetchServerCertificate(e){const t=this.config,r=new(0,t.loader)(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching serverCertificate for "${e}"`),new Promise(((i,s)=>{const a={responseType:"arraybuffer",url:n},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,n)=>{i(e.data)},onError:(t,r,i,o)=>{s(new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:vK({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${n}). Status: ${t.code} (${t.text})`))},onTimeout:(t,r,i)=>{s(new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(e,t,r)=>{s(new Error("aborted"))}};r.load(a,l,u)}))):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise(((n,i)=>{e.setServerCertificate(r).then((i=>{this.log(`setServerCertificate ${i?"success":"not supported by CDM"} (${null==r?void 0:r.byteLength}) on "${t}"`),n(e)})).catch((e=>{i(new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))))}setupLicenseXHR(e,t,r,n){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then((()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,n)})).catch((s=>{if(!r.decryptdata)throw s;return e.open("POST",t,!0),i.call(this.hls,e,t,r,n)})).then((r=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:r||n}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise(((n,i)=>{const s=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${s}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const r=this.config.licenseResponseCallback;if(r)try{t=r.call(this.hls,a,s,e)}catch(e){this.error(e)}n(t)}else{const o=r.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)i(new dQ({type:DK.KEY_SYSTEM_ERROR,details:SK.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:s,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${s}). Status: ${a.status} (${a.statusText})`));else{const r=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${r} attempts left`),this.requestLicense(e,t).then(n,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,s,e,t).then((({xhr:e,licenseChallenge:t})=>{e.send(t)}))}))}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},$W.clearKeyUriToKeyIdMap();const r=t.length;cQ.CDMCleanupPromise=Promise.all(t.map((e=>this.removeSession(e))).concat(null==e?void 0:e.setMediaKeys(null).catch((t=>{this.log(`Could not clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)})))).then((()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)})).catch((t=>{this.log(`Could not close sessions and clear media keys: ${t}. media.src: ${null==e?void 0:e.src}`)}))}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),t.onmessage=null,t.onkeystatuseschange=null,r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);return n>-1&&this.mediaKeySessions.splice(n,1),t.remove().catch((e=>{this.log(`Could not remove session: ${e}`)})).then((()=>t.close())).catch((e=>{this.log(`Could not close session: ${e}`)}))}}}cQ.CDMCleanupPromise=void 0;class dQ extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var hQ="m",fQ="a",pQ="v",mQ="av",gQ="i",yQ="tt";class vQ{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:hQ,su:!this.initialized})}catch(e){kK.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const t=e.frag,r=this.hls.levels[t.level],n=this.getObjectType(t),i={d:1e3*t.duration,ot:n};n!==pQ&&n!==fQ&&n!=mQ||(i.br=r.bitrate/1e3,i.tb=this.getTopBandwidth(n)/1e3,i.bl=this.getBufferLength(n)),this.apply(e,i)}catch(e){kK.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||vQ.uuid(),this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.registerListeners())}registerListeners(){const e=this.hls;e.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(EK.MEDIA_DETACHED,this.onMediaDetached,this),e.on(EK.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(EK.MEDIA_DETACHED,this.onMediaDetached,this),e.off(EK.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,n;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(n=t.tracks.video)?void 0:n.buffer}createData(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){wK(t,this.createData());const r=t.ot===gQ||t.ot===pQ||t.ot===mQ;if(this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering),this.useHeaders){const r=vQ.toHeaders(t);if(!Object.keys(r).length)return;e.headers||(e.headers={}),wK(e.headers,r)}else{const r=vQ.toQuery(t);if(!r)return;e.url=vQ.appendQueryToUri(e.url,r)}}getObjectType(e){const{type:t}=e;return"subtitle"===t?yQ:"initSegment"===e.sn?gQ:"audio"===t?fQ:"main"===t?this.hls.audioTracks.length?pQ:mQ:void 0}getTopBandwidth(e){let t,r=0;const n=this.hls;if(e===fQ)t=n.audioTracks;else{const e=n.maxAutoLevel,r=e>-1?e+1:n.levels.length;t=n.levels.slice(0,r)}for(const e of t)e.bitrate>r&&(r=e.bitrate);return r>0?r:NaN}getBufferLength(e){const t=this.hls.media,r=e===fQ?this.audioBuffer:this.videoBuffer;if(!r||!t)return NaN;return 1e3*CJ.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,n){t(e),this.loader.load(e,r,n)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,n){t(e),this.loader.load(e,r,n)}}}static uuid(){const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}static serialize(e){const t=[],r=e=>!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e,n=e=>Math.round(e),i=e=>100*n(e/100),s={br:n,d:n,bl:i,dl:i,mtp:i,nor:e=>encodeURIComponent(e),rtp:i,tb:n},a=Object.keys(e||{}).sort();for(const n of a){let i=e[n];if(!r(i))continue;if("v"===n&&1===i)continue;if("pr"==n&&1===i)continue;const a=s[n];a&&(i=a(i));const o=typeof i;let l;l="ot"===n||"sf"===n||"st"===n?`${n}=${i}`:"boolean"===o?n:"number"===o?`${n}=${i}`:`${n}=${JSON.stringify(i)}`,t.push(l)}return t.join(",")}static toHeaders(e){const t=Object.keys(e),r={},n=["Object","Request","Session","Status"],i=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const r of t){i[null!=s[r]?s[r]:1][r]=e[r]}for(let e=0;e<i.length;e++){const t=vQ.serialize(i[e]);t&&(r[`CMCD-${n[e]}`]=t)}return r}static toQuery(e){return`CMCD=${encodeURIComponent(vQ.serialize(e))}`}static appendQueryToUri(e,t){if(!t)return e;const r=e.includes("?")?"&":"?";return`${e}${r}${t}`}}function bQ(e,t,r,n){e&&Object.keys(t).forEach((i=>{const s=e.filter((e=>e.groupId===i)).map((e=>{const s=wK({},e);return s.details=void 0,s.attrs=new FK(s.attrs),s.url=s.attrs.URI=wQ(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),s.groupId=s.attrs["GROUP-ID"]=t[i],s.attrs["PATHWAY-ID"]=n,s}));e.push(...s)}))}function wQ(e,t,r,n){const{HOST:i,PARAMS:s,[r]:a}=n;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return i&&!o&&(l.host=i),s&&Object.keys(s).sort().forEach((e=>{e&&l.searchParams.set(e,s[e])})),l.href}const xQ=/^age:\s*[\d.]+\s*$/im;class EQ{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new RK,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then((()=>{if(!this.stats.aborted)return i(r,t.url)})).catch((e=>(r.open("GET",t.url,!0),i(r,t.url)))).then((()=>{this.stats.aborted||this.openAndSendXhr(r,t,e)})).catch((e=>{this.callbacks.onError({code:r.status,text:e.message},t,r,n)})):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const n=this.context.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:s}=r.loadPolicy;if(n)for(const t in n)e.setRequestHeader(t,n[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&xK(i)?i:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const n=t.readyState,i=this.config;if(!r.aborted&&n>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const n=t.status,s="text"!==t.responseType;if(n>=200&&n<300&&(s&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);const i=s?t.response:t.responseText,a="arraybuffer"===t.responseType?i.byteLength:i.length;if(r.loaded=r.total=a,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;const o=this.callbacks.onProgress;if(o&&o(r,e,i,t),!this.callbacks)return;const l={url:t.responseURL,data:i,code:n};this.callbacks.onSuccess(l,r,e,t)}else{const s=i.loadPolicy.errorRetry;YY(s,r.retry,!1,n)?this.retry(s):(kK.error(`${n} while loading ${e.url}`),this.callbacks.onError({code:n,text:t.statusText},e,t,r))}}}loadtimeout(){var e;const t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(YY(t,this.stats.retry,!0))this.retry(t);else{kK.warn(`timeout while loading ${this.context.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=KY(e,r.retry),r.retry++,kK.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&xQ.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const DQ=/(\d+)-(\d+)\/(\d+)/;class SQ{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||AQ,this.controller=new self.AbortController,this.stats=new RK}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const i=function(e,t){const r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(wK({},e.headers))};e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return r}(e,this.controller.signal),s=r.onProgress,a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&xK(l)?l:u,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),r.onTimeout(n,e,this.response)}),t.timeout),self.fetch(this.request).then((i=>{this.response=this.loader=i;const o=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),r.onTimeout(n,e,this.response)}),u-(o-n.loading.start)),!i.ok){const{status:e,statusText:t}=i;throw new TQ(t||"fetch, bad network response",e,i)}return n.loading.first=o,n.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=DQ.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(xK(e))return e}const r=e.get("Content-Length");if(r)return parseInt(r)}(i.headers)||n.total,s&&xK(t.highWaterMark)?this.loadProgressively(i,n,e,t.highWaterMark,s):a?i.arrayBuffer():"json"===e.responseType?i.json():i.text()})).then((i=>{const{response:a}=this;self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const l=i[o];l&&(n.loaded=n.total=l);const u={url:a.url,data:i,code:a.status};s&&!xK(t.highWaterMark)&&s(n,e,i,a),r.onSuccess(u,n,e,a)})).catch((t=>{if(self.clearTimeout(this.requestTimeout),n.aborted)return;const i=t&&t.code||0,s=t?t.message:null;r.onError({code:i,text:s},e,t?t.details:null,n)}))}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,n=0,i){const s=new oX,a=e.body.getReader(),o=()=>a.read().then((a=>{if(a.done)return s.dataLength&&i(t,r,s.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=a.value,u=l.length;return t.loaded+=u,u<n||s.dataLength?(s.push(l),s.dataLength>=n&&i(t,r,s.flush(),e)):i(t,r,l,e),o()})).catch((()=>Promise.reject()));return o()}}function AQ(e,t){return new self.Request(e.url,t)}class TQ extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const CQ=/\s/,NQ={newCue(e,t,r,n){const i=[];let s,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<n.rows.length;h++)if(s=n.rows[h],o=!0,l=0,u="",!s.isEmpty()){var d;for(let e=0;e<s.chars.length;e++)CQ.test(s.chars[e].uchar)&&o?l++:(u+=s.chars[e].uchar,o=!1);s.cueStartTime=t,t===r&&(r+=1e-4),l>=16?l--:l++;const n=qX(u.trim()),f=WX(t,r,n);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(a=new c(t,r,n),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(a))}return e&&i.length&&(i.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),i.forEach((t=>xY(e,t)))),i}},kQ=vK(vK({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:EQ,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;const t=e.config;this.bwEstimator=new aX(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(EK.FRAG_LOADING,this.onFragLoading,this),e.on(EK.FRAG_LOADED,this.onFragLoaded,this),e.on(EK.FRAG_BUFFERED,this.onFragBuffered,this),e.on(EK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(EK.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:e}=this;e.off(EK.FRAG_LOADING,this.onFragLoading,this),e.off(EK.FRAG_LOADED,this.onFragLoaded,this),e.off(EK.FRAG_BUFFERED,this.onFragBuffered,this),e.off(EK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(EK.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(e,t){var r;const n=t.frag;this.ignoreFragment(n)||(this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(e,t){this.clearTimer()}getTimeToLoadFrag(e,t,r,n){return e+r/t+(n?this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{total:n,bwEstimate:i}=t.stats;xK(n)&&xK(i)&&(this.lastLevelLoadSec=8*n/i),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{autoLevelEnabled:n,media:i}=r;if(!e||!i)return;const s=performance.now(),a=t?t.stats:e.stats,o=t?t.duration:e.duration,l=s-a.loading.start;if(a.aborted||a.loaded&&a.loaded===a.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!n||i.paused||!i.playbackRate||!i.readyState)return;const u=r.mainForwardBufferInfo;if(null===u)return;const c=this.bwEstimator.getEstimateTTFB(),d=Math.abs(i.playbackRate);if(l<=Math.max(c,o/(2*d)*1e3))return;const h=u.len/d;if(h>=2*o/d)return;const f=a.loading.first?a.loading.first-a.loading.start:-1,p=a.loaded&&f>-1,m=this.bwEstimator.getEstimate(),{levels:g,minAutoLevel:y}=r,v=g[e.level],b=a.total||Math.max(a.loaded,Math.round(o*v.maxBitrate/8));let w=l-f;w<1&&p&&(w=Math.min(l,8*a.loaded/m));const x=p?1e3*a.loaded/w:0,E=x?(b-a.loaded)/x:8*b/m+c/1e3;if(E<=h)return;const D=x?8*x:m;let S,A=Number.POSITIVE_INFINITY;for(S=e.level-1;S>y;S--){const e=g[S].maxBitrate;if(A=this.getTimeToLoadFrag(c/1e3,D,o*e,!g[S].details),A<h)break}A>=E||A>10*o||(r.nextLoadLevel=S,p?this.bwEstimator.sample(l-Math.min(c,f),a.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),kK.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${h.toFixed(3)} s\n      Estimated load time for current fragment: ${E.toFixed(3)} s\n      Estimated load time for down switch fragment: ${A.toFixed(3)} s\n      TTFB estimate: ${f}\n      Current BW estimate: ${xK(m)?(m/1024).toFixed(3):"Unknown"} Kb/s\n      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s\n      Aborting and switching to level ${S}`),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(EK.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a}))}onFragLoaded(e,{frag:t,part:r}){const n=r?r.stats:t.stats;if(t.type===pY&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:t.duration,i=this.hls.levels[t.level],s=(i.loaded?i.loaded.bytes:0)+n.loaded,a=(i.loaded?i.loaded.duration:0)+e;i.loaded={bytes:s,duration:a},i.realBitrate=Math.round(8*s/a)}if(t.bitrateTest){const e={stats:n,frag:t,part:r,id:t.type};this.onFragBuffered(EK.FRAG_BUFFERED,e),t.bitrateTest=!1}}}onFragBuffered(e,t){const{frag:r,part:n}=t,i=null!=n&&n.stats.loaded?n.stats:r.stats;if(i.aborted)return;if(this.ignoreFragment(r))return;const s=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==pY||"initSegment"===e.sn}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;let r=this.getNextABRAutoLevel();if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return-1!==e&&(r=Math.min(e,r)),r}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:n,config:i,minAutoLevel:s,media:a}=r,o=t?t.duration:e?e.duration:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,c=r.mainForwardBufferInfo,d=(c?c.len:0)/l;let h=this.findBestLevel(u,s,n,d,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(h>=0)return h;kK.trace(`[abr] ${d?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let f=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,m=i.abrBandWidthUpFactor;if(!d){const e=this.bitrateTestDelay;if(e){f=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-e,kK.trace(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),p=m=1}}return h=this.findBestLevel(u,s,n,d+f,p,m),Math.max(h,0)}findBestLevel(e,t,r,n,i,s){var a;const{fragCurrent:o,partCurrent:l,lastLoadedFragLevel:u}=this,{levels:c}=this.hls,d=c[u],h=!(null==d||null==(a=d.details)||!a.live),f=null==d?void 0:d.codecSet,p=l?l.duration:o?o.duration:0,m=this.bwEstimator.getEstimateTTFB()/1e3;let g=t,y=-1;for(let a=r;a>=t;a--){const t=c[a];if(!t||f&&t.codecSet!==f){t&&(g=Math.min(a,g),y=Math.max(a,y));continue}-1!==y&&kK.trace(`[abr] Skipped level(s) ${g}-${y} with CODECS:"${c[y].attrs.CODECS}"; not compatible with "${d.attrs.CODECS}"`);const r=t.details,o=(l?null==r?void 0:r.partTarget:null==r?void 0:r.averagetargetduration)||p;let v;v=a<=u?i*e:s*e;const b=c[a].maxBitrate,w=this.getTimeToLoadFrag(m,v,b*o,void 0===r);if(kK.trace(`[abr] level:${a} adjustedbw-bitrate:${Math.round(v-b)} avgDuration:${o.toFixed(1)} maxFetchDuration:${n.toFixed(1)} fetchDuration:${w.toFixed(1)}`),v>b&&(0===w||!xK(w)||h&&!this.bitrateTestDelay||w<n))return a}return-1}set nextAutoLevel(e){this._nextAutoLevel=e}},bufferController:class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:t}=this;kK.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(EK.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{kK.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{kK.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:t}=this;e&&e.src!==t&&kK.error(`Media element src was set while attaching MediaSource (${t} > ${e.src})`)},this.hls=e,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:e}=this;e.on(EK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(EK.BUFFER_RESET,this.onBufferReset,this),e.on(EK.BUFFER_APPENDING,this.onBufferAppending,this),e.on(EK.BUFFER_CODECS,this.onBufferCodecs,this),e.on(EK.BUFFER_EOS,this.onBufferEos,this),e.on(EK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(EK.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(EK.FRAG_PARSED,this.onFragParsed,this),e.on(EK.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(EK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(EK.BUFFER_RESET,this.onBufferReset,this),e.off(EK.BUFFER_APPENDING,this.onBufferAppending,this),e.off(EK.BUFFER_CODECS,this.onBufferCodecs,this),e.off(EK.BUFFER_EOS,this.onBufferEos,this),e.off(EK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(EK.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(EK.FRAG_PARSED,this.onFragParsed,this),e.off(EK.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new hX(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,kK.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media;if(r&&fX){const e=this.mediaSource=new fX;e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(e),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(kK.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){kK.warn(`[buffer-controller]: onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):kK.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(EK.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];try{t&&(this.removeBufferListeners(e),this.mediaSource&&this.mediaSource.removeSourceBuffer(t),this.sourceBuffer[e]=void 0)}catch(t){kK.warn(`[buffer-controller]: Failed to reset the ${e} buffer`,t)}})),this._initSourceBuffer()}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length;Object.keys(t).forEach((e=>{if(r){const r=this.tracks[e];if(r&&"function"==typeof r.buffer.changeType){const{id:n,codec:i,levelCodec:s,container:a,metadata:o}=t[e],l=(r.levelCodec||r.codec).replace(pX,"$1"),u=(s||i).replace(pX,"$1");if(l!==u){const t=`${a};codecs=${s||i}`;this.appendChangeType(e,t),kK.log(`[buffer-controller]: switching codec ${l} to ${u}`),this.tracks[e]={buffer:r.buffer,codec:i,container:a,levelCodec:s,metadata:o,id:n}}}}else this.pendingTracks[e]=t[e]})),r||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}appendChangeType(e,t){const{operationQueue:r}=this,n={execute:()=>{const n=this.sourceBuffer[e];n&&(kK.log(`[buffer-controller]: changing ${e} sourceBuffer type to ${t}`),n.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{kK.warn(`[buffer-controller]: Failed to change ${e} SourceBuffer type`,t)}};r.append(n,e)}onBufferAppending(e,t){const{hls:r,operationQueue:n,tracks:i}=this,{data:s,type:a,frag:o,part:l,chunkMeta:u}=t,c=u.buffering[a],d=self.performance.now();c.start=d;const h=o.stats.buffering,f=l?l.stats.buffering:null;0===h.start&&(h.start=d),f&&0===f.start&&(f.start=d);const p=i.audio;let m=!1;"audio"===a&&"audio/mpeg"===(null==p?void 0:p.container)&&(m=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const g=o.start,y={execute:()=>{if(c.executeStart=self.performance.now(),m){const e=this.sourceBuffer[a];if(e){const t=g-e.timestampOffset;Math.abs(t)>=.1&&(kK.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${g} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=g)}}this.appendExecutor(s,a)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===h.first&&(h.first=e),f&&0===f.first&&(f.first=e);const{sourceBuffer:t}=this,r={};for(const e in t)r[e]=CJ.getBuffered(t[e]);this.appendError=0,this.hls.trigger(EK.BUFFER_APPENDED,{type:a,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:r})},onError:e=>{kK.error(`[buffer-controller]: Error encountered while trying to append to the ${a} SourceBuffer`,e);const t={type:DK.MEDIA_ERROR,parent:o.type,details:SK.BUFFER_APPEND_ERROR,frag:o,part:l,chunkMeta:u,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=SK.BUFFER_FULL_ERROR:(this.appendError++,t.details=SK.BUFFER_APPEND_ERROR,this.appendError>r.config.appendErrorMaxRetry&&(kK.error(`[buffer-controller]: Failed ${r.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),t.fatal=!0)),r.trigger(EK.ERROR,t)}};n.append(y,a)}onBufferFlushing(e,t){const{operationQueue:r}=this,n=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(EK.BUFFER_FLUSHED,{type:e})},onError:t=>{kK.warn(`[buffer-controller]: Failed to remove from ${e} SourceBuffer`,t)}});t.type?r.append(n(t.type),t.type):this.getSourceBufferTypes().forEach((e=>{r.append(n(e),e)}))}onFragParsed(e,t){const{frag:r,part:n}=t,i=[],s=n?n.elementaryStreams:r.elementaryStreams;s[BK]?i.push("audiovideo"):(s[IK]&&i.push("audio"),s[PK]&&i.push("video"));0===i.length&&kK.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers((()=>{const e=self.performance.now();r.stats.buffering.end=e,n&&(n.stats.buffering.end=e);const t=n?n.stats:r.stats;this.hls.trigger(EK.FRAG_BUFFERED,{frag:r,part:n,stats:t,id:r.type})}),i)}onFragChanged(e,t){this.flushBackBuffer()}onBufferEos(e,t){this.getSourceBufferTypes().reduce(((e,r)=>{const n=this.sourceBuffer[r];return!n||t.type&&t.type!==r||(n.ending=!0,n.ended||(n.ended=!0,kK.log(`[buffer-controller]: ${r} sourceBuffer now EOS`))),e&&!(n&&!n.ended)}),!0)&&(kK.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)}));const{mediaSource:e}=this;e&&"open"===e.readyState?(kK.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&kK.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:e,details:t,media:r,sourceBuffer:n}=this;if(!r||null===t)return;const i=this.getSourceBufferTypes();if(!i.length)return;const s=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(!xK(s)||s<0)return;const a=r.currentTime,o=t.levelTargetDuration,l=Math.max(s,o),u=Math.floor(a/o)*o-l;i.forEach((r=>{const i=n[r];if(i){const n=CJ.getBuffered(i);if(n.length>0&&u>n.start(0)){if(e.trigger(EK.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live)e.trigger(EK.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(i.ended&&n.end(n.length-1)-a<2*o)return void kK.info(`[buffer-controller]: Cannot flush ${r} back buffer while SourceBuffer is in ended state`);e.trigger(EK.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:r})}}}))}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:r,mediaSource:n}=this,i=e.fragments[0].start+e.totalduration,s=r.duration,a=xK(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(kK.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(i>a&&i>s||!xK(s))&&(kK.log(`[buffer-controller]: Updating Media Source duration to ${i.toFixed(3)}`),n.duration=i)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){const n=Math.max(0,r[0].start),i=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,i)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,n=Object.keys(r).length;if(n&&!e||2===n){this.createSourceBuffers(r),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(EK.BUFFER_CREATED,{tracks:this.tracks}),e.forEach((e=>{t.executeNext(e)}));else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const n in e)if(!t[n]){const i=e[n];if(!i)throw Error(`source buffer exists for track ${n}, however track does not`);const s=i.levelCodec||i.codec,a=`${i.container};codecs=${s}`;kK.log(`[buffer-controller]: creating sourceBuffer(${a})`);try{const e=t[n]=r.addSourceBuffer(a),o=n;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[n]={buffer:e,codec:s,container:i.container,levelCodec:i.levelCodec,metadata:i.metadata,id:i.id}}catch(e){kK.error(`[buffer-controller]: error while trying to add sourceBuffer: ${e.message}`),this.hls.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:a})}}}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){const{operationQueue:t}=this;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){const r=new Error(`${e} SourceBuffer error`);kK.error(`[buffer-controller]: ${r}`,t),this.hls.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.BUFFER_APPENDING_ERROR,error:r,fatal:!1});const n=this.operationQueue.current(e);n&&n.onError(t)}removeExecutor(e,t,r){const{media:n,mediaSource:i,operationQueue:s,sourceBuffer:a}=this,o=a[e];if(!n||!i||!o)return kK.warn(`[buffer-controller]: Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void s.shiftAndExecuteNext(e);const l=xK(n.duration)?n.duration:1/0,u=xK(i.duration)?i.duration:1/0,c=Math.max(0,t),d=Math.min(r,l,u);d>c&&!o.ending?(o.ended=!1,kK.log(`[buffer-controller]: Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):s.shiftAndExecuteNext(e)}appendExecutor(e,t){const{operationQueue:r,sourceBuffer:n}=this,i=n[t];if(!i)return kK.warn(`[buffer-controller]: Attempting to append to the ${t} SourceBuffer, but it does not exist`),void r.shiftAndExecuteNext(t);i.ended=!1,i.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return kK.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:r}=this,n=t.map((e=>r.appendBlocker(e)));Promise.all(n).then((()=>{e(),t.forEach((e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||r.shiftAndExecuteNext(e)}))}))}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const n=this.sourceBuffer[e];if(!n)return;const i=r.bind(this,e);this.listeners[e].push({event:t,listener:i}),n.addEventListener(t,i)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach((e=>{t.removeEventListener(e.event,e.listener)}))}},capLevelController:lQ,errorController:class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=kK.log.bind(kK,"[info]:"),this.warn=kK.warn.bind(kK,"[warning]:"),this.error=kK.error.bind(kK,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(EK.ERROR,this.onError,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(EK.ERROR,this.onError,this),e.off(EK.ERROR,this.onErrorOut,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){this.playlistError=0}stopLoad(){}getVariantLevelIndex(e){return(null==e?void 0:e.type)===pY?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,n;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case SK.FRAG_LOAD_ERROR:case SK.FRAG_LOAD_TIMEOUT:case SK.KEY_LOAD_ERROR:case SK.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case SK.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:eJ,flags:nJ});case SK.FRAG_GAP:case SK.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=tJ);case SK.LEVEL_EMPTY_ERROR:case SK.LEVEL_PARSING_ERROR:{var a,o;const e=t.parent===pY?t.level:i.loadLevel;t.details===SK.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(o=a.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case SK.LEVEL_LOAD_ERROR:case SK.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case SK.AUDIO_TRACK_LOAD_ERROR:case SK.AUDIO_TRACK_LOAD_TIMEOUT:case SK.SUBTITLE_LOAD_ERROR:case SK.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const e=i.levels[i.loadLevel];if(e&&(s.type===hY&&s.groupId===e.audioGroupId||s.type===fY&&s.groupId===e.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=tJ,void(t.errorAction.flags=iJ)}return;case SK.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=i.levels[i.loadLevel],r=null==e?void 0:e.attrs["HDCP-LEVEL"];r&&(t.errorAction={action:tJ,flags:sJ,hdcpLevel:r})}return;case SK.BUFFER_ADD_CODEC_ERROR:case SK.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(n=t.level)?n:i.loadLevel));case SK.INTERNAL_EXCEPTION:case SK.BUFFER_APPENDING_ERROR:case SK.BUFFER_APPEND_ERROR:case SK.BUFFER_FULL_ERROR:case SK.LEVEL_SWITCH_ERROR:case SK.BUFFER_STALLED_ERROR:case SK.BUFFER_SEEK_OVER_HOLE:case SK.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:eJ,flags:nJ})}if(t.type===DK.KEY_SYSTEM_ERROR){const e=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,e))}}getPlaylistRetryOrSwitchAction(e,t){var r;const n=GY(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++,s=null==(r=e.response)?void 0:r.code;if(YY(n,i,VY(e),s))return{action:rJ,flags:nJ,retryConfig:n,retryCount:i};const a=this.getLevelSwitchAction(e,t);return n&&(a.retryConfig=n,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:s}=t.config,a=GY(e.details.startsWith("key")?s:i,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(n){var l;e.details!==SK.FRAG_GAP&&n.fragmentError++;const t=null==(l=e.response)?void 0:l.code;if(YY(a,o,VY(e),t))return{action:rJ,flags:nJ,retryConfig:a,retryCount:o}}const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=o),u}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const n=this.hls.levels[t];if(n&&(n.loadError++,r.autoLevelEnabled)){var i,s;let t=-1;const{levels:a,loadLevel:o,minAutoLevel:l,maxAutoLevel:u}=r,c=null==(i=e.frag)?void 0:i.type,{type:d,groupId:h}=null!=(s=e.context)?s:{};for(let r=a.length;r--;){const i=(r+o)%a.length;if(i!==o&&i>=l&&i<=u&&0===a[i].loadError){const r=a[i];if(e.details===SK.FRAG_GAP&&e.frag){const t=a[i].details;if(t){const r=ZY(e.frag,t.fragments,e.frag.start);if(null!=r&&r.gap)continue}}else{if(d===hY&&h===r.audioGroupId||d===fY&&h===r.textGroupId)continue;if(c===mY&&n.audioGroupId===r.audioGroupId||c===gY&&n.textGroupId===r.textGroupId)continue}t=i;break}}if(t>-1&&r.loadLevel!==t)return e.levelRetry=!0,this.playlistError=0,{action:tJ,flags:nJ,nextAutoLevel:t}}return{action:tJ,flags:iJ}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case eJ:break;case tJ:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===SK.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:n,hdcpLevel:i,nextAutoLevel:s}=r;switch(n){case nJ:this.switchLevel(e,s);break;case iJ:r.resolved||(r.resolved=this.redundantFailover(e));break;case sJ:i&&(t.maxHdcpLevel=FY[FY.indexOf(i)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}r.resolved||this.switchLevel(e,s)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(e){const{hls:t,penalizedRenditions:r}=this,n=e.parent===pY?e.level:t.loadLevel,i=t.levels[n],s=i.url.length,a=e.frag?e.frag.urlId:i.urlId;i.urlId!==a||e.frag&&!i.details||this.penalizeRendition(i,e);for(let o=1;o<s;o++){const l=(a+o)%s,u=r[l];if(!u||aJ(u,e,r[a]))return this.warn(`Switching to Redundant Stream ${l+1}/${s}: "${i.url[l]}" after ${e.details}`),this.playlistError=0,t.levels.forEach((e=>{e.urlId=l})),t.nextLoadLevel=n,!0}return!1}penalizeRendition(e,t){const{penalizedRenditions:r}=this,n=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};n.lastErrorPerfMs=performance.now(),n.errors.push(t),n.details=e.details,r[e.urlId]=n}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(EK.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(EK.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const n=performance.now();if(t){if(this.lastTime){const e=n-this.lastTime,i=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,a=1e3*i/e,o=this.hls;if(o.trigger(EK.FPS_DROP,{currentDropped:i,currentDecoded:s,totalDroppedFrames:r}),a>0&&i>o.config.fpsDroppedMonitoringThreshold*s){let e=o.currentLevel;kK.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(EK.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:tW,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:NQ,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends ZJ{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",gY),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(EK.ERROR,this.onError,this),e.on(EK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(EK.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(EK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(EK.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(EK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(EK.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(EK.ERROR,this.onError,this),e.off(EK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(EK.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(EK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(EK.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(EK.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(EK.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=$J,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:n}=t;if(this.fragPrevious=r,this.state=$J,!n)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let s;const a=r.start;for(let e=0;e<i.length;e++)if(a>=i[e].start&&a<=i[e].end){s=i[e];break}const o=r.start+r.duration;s?s.end=o:(s={start:a,end:o},i.push(s)),this.fragmentTracker.fragBuffered(r)}onBufferFlushing(e,t){const{startOffset:r,endOffset:n}=t;if(0===r&&n!==Number.POSITIVE_INFINITY){const e=n-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let r=0;r<t.length;)if(t[r].end<=e)t.shift();else{if(!(t[r].start<e))break;t[r].start=e,r++}})),this.fragmentTracker.removeFragmentsInRange(r,e,gY)}}onFragBuffered(e,t){var r;this.loadedmetadata||t.frag.type!==pY||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const r=t.frag;(null==r?void 0:r.type)===gY&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==UJ&&(this.state=$J))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){lX(this.levels,t)?this.levels=t.map((e=>new PY(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new PY(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,gY),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){if(this.currentTrackId=t.id,!this.levels.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{details:n,id:i}=t,{currentTrackId:s,levels:a}=this;if(!a.length)return;const o=a[s];if(i>=a.length||i!==s||!o)return;this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(n.live||null!=(r=o.details)&&r.live){const e=this.mainDetails;if(n.deltaUpdateFailed||!e)return;const t=e.fragments[0];o.details?(l=this.alignPlaylists(n,o.details),0===l&&t&&(l=t.start,jY(n,l))):n.hasProgramDateTime&&e.hasProgramDateTime?(LJ(n,e),l=n.fragments[0].start):t&&(l=t.start,jY(n,l))}if(o.details=n,this.levelLastLoaded=i,this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(o.details,l),this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===$J){ZY(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,n=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&n&&n.key&&n.iv&&"AES-128"===n.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).catch((e=>{throw i.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e})).then((r=>{const n=performance.now();i.trigger(EK.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:e,tdecrypt:n}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=$J}))}}doTick(){if(this.media){if(this.state===$J){const{currentTrackId:e,levels:t}=this,r=t[e];if(!t.length||!r||!r.details)return;const{config:n}=this,i=this.getLoadPosition(),s=CJ.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),{end:a,len:o}=s,l=this.getFwdBufferInfo(this.media,pY),u=r.details;if(o>this.getMaxBufferLength(null==l?void 0:l.len)+u.levelTargetDuration)return;const c=u.fragments,d=c.length,h=u.edge;let f=null;const p=this.fragPrevious;if(a<h){const e=n.maxFragLookUpTolerance,t=a>h-e?0:e;f=ZY(p,c,Math.max(c[0].start,a),t),!f&&p&&p.start<c[0].start&&(f=c[0])}else f=c[d-1];if(!f)return;if(f=this.mapToInitFragWhenRequired(f),"initSegment"!==f.sn){const e=c[f.sn-u.startSN-1];e&&e.cc===f.cc&&this.fragmentTracker.getState(e)===hJ&&(f=e)}this.fragmentTracker.getState(f)===hJ&&this.loadFragment(f,r,a)}}else this.state=$J}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new cX(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends oJ{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:e}=this;e.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(EK.LEVEL_LOADING,this.onLevelLoading,this),e.on(EK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(EK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(EK.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(EK.LEVEL_LOADING,this.onLevelLoading,this),e.off(EK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(EK.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(EK.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);dX(this.media.textTracks).forEach((e=>{EY(e)})),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,details:n}=t,{trackId:i}=this,s=this.tracksInGroup[i];if(!s)return void this.warn(`Invalid subtitle track id ${r}`);const a=s.details;s.details=t.details,this.log(`subtitle track ${r} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.textGroupIds)return;const r=t.textGroupIds[t.urlId],n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){const e=this.tracks.filter((e=>!r||e.groupId===r));this.tracksInGroup=e;const t=this.findTrackId(null==n?void 0:n.name)||this.findTrackId();this.groupId=r||null;const i={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${r}" group-id`),this.hls.trigger(EK.SUBTITLE_TRACKS_UPDATED,i),-1!==t&&this.setSubtitleTrack(t,n)}else this.shouldReloadPlaylist(n)&&this.setSubtitleTrack(this.trackId,n)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1}onError(e,t){!t.fatal&&t.context&&t.context.type===fY&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1;const t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,n=t.groupId;let i=t.url;if(e)try{i=e.addDirectives(i)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(EK.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:e||null})}}toggleTrackModes(e){const{media:t,trackId:r}=this;if(!t)return;const n=dX(t.textTracks),i=n.filter((e=>e.groupId===this.groupId));if(-1===e)[].slice.call(n).forEach((e=>{e.mode="disabled"}));else{const e=i[r];e&&(e.mode="disabled")}const s=i[e];s&&(s.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(e,t){var r;const n=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(this.trackId!==e&&this.toggleTrackModes(e),this.trackId===e&&(-1===e||null!=(r=n[e])&&r.details)||e<-1||e>=n.length)return;this.clearTimer();const i=n[e];if(this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:"")),this.trackId=e,i){const{id:e,groupId:r="",name:n,type:s,url:a}=i;this.hls.trigger(EK.SUBTITLE_TRACK_SWITCH,{id:e,groupId:r,name:n,type:s,url:a});const o=this.switchParams(i.url,null==t?void 0:t.details);this.loadPlaylist(o)}else this.hls.trigger(EK.SUBTITLE_TRACK_SWITCH,{id:e})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=-1;const t=dX(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},timelineController:class{constructor(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new _X(this,"textTrack1"),t=new _X(this,"textTrack2"),r=new _X(this,"textTrack3"),n=new _X(this,"textTrack4");this.cea608Parser1=new OX(1,e,t),this.cea608Parser2=new OX(3,r,n)}e.on(EK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(EK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(EK.FRAG_LOADING,this.onFragLoading,this),e.on(EK.FRAG_LOADED,this.onFragLoaded,this),e.on(EK.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(EK.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(EK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(EK.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(EK.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(EK.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(EK.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(EK.FRAG_LOADING,this.onFragLoading,this),e.off(EK.FRAG_LOADED,this.onFragLoaded,this),e.off(EK.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(EK.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(EK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(EK.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(EK.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(e,t,r,n,i){let s=!1;for(let e=i.length;e--;){const n=i[e],c=(a=n[0],o=n[1],l=t,u=r,Math.min(o,u)-Math.max(a,l));if(c>=0&&(n[0]=Math.min(n[0],t),n[1]=Math.max(n[1],r),s=!0,c/(r-t)>.5))return}var a,o,l,u;if(s||i.push([t,r]),this.config.renderTextTracksNatively){const i=this.captionsTracks[e];this.Cues.newCue(i,t,r,n)}else{const i=this.Cues.newCue(null,t,r,n);this.hls.trigger(EK.CUES_PARSED,{type:"captions",cues:i,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i}){const{unparsedVttFrags:s}=this;"main"===r&&(this.initPTS[t.cc]={baseTime:n,timescale:i}),s.length&&(this.unparsedVttFrags=[],s.forEach((e=>{this.onFragLoaded(EK.FRAG_LOADED,e)})))}getExistingTrack(e){const{media:t}=this;if(t)for(let r=0;r<t.textTracks.length;r++){const n=t.textTracks[r];if(n[e])return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:n}=this,{label:i,languageCode:s}=t[e],a=this.getExistingTrack(e);if(a)r[e]=a,EY(r[e]),wY(r[e],n);else{const t=this.createTextTrack("captions",i,s);t&&(t[e]=!0,r[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(EK.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,r){const n=this.media;if(n)return n.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach((t=>{EY(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)EY(t[e])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],n=r.some((e=>e.textCodec===JX));if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(lX(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const e=this.media?this.media.textTracks:null;this.tracks.forEach(((t,r)=>{let n;if(e&&r<e.length){let r=null;for(let n=0;n<e.length;n++)if(oQ(e[n],t)){r=e[n];break}r&&(n=r)}if(n)EY(n);else{const e=this._captionsOrSubtitlesFromCharacteristics(t);n=this.createTextTrack(e,t.name,t.lang),n&&(n.mode="disabled")}n&&(n.groupId=t.groupId,this.textTracks.push(n))}))}else if(this.tracks.length){const e=this.tracks.map((e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e})));this.hls.trigger(EK.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}_captionsOrSubtitlesFromCharacteristics(e){if(e.attrs.CHARACTERISTICS){const t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const r=`textTrack${t[1]}`,n=this.captionsProperties[r];n&&(n.label=e.name,e.lang&&(n.languageCode=e.lang),n.media=e)}))}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){const{cea608Parser1:r,cea608Parser2:n,lastSn:i,lastPartIndex:s}=this;if(this.enabled&&r&&n&&t.frag.type===pY){var a,o;const e=t.frag.sn,l=null!=(a=null==t||null==(o=t.part)?void 0:o.index)?a:-1;e===i+1||e===i&&l===s+1||(r.reset(),n.reset()),this.lastSn=e,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:r,payload:n}=t;if(r.type===gY)if(n.byteLength){const e=r.decryptdata,i="stats"in t;if(null==e||!e.encrypted||i){const e=this.tracks[r.level],i=this.vttCCs;i[r.cc]||(i[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),e&&e.textCodec===JX?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(EK.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;eQ(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),r.trigger(EK.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(t=>{kK.log(`Failed to parse IMSC1: ${t}`),r.trigger(EK.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}_parseVTTs(e){var t;const{frag:r,payload:n}=e,{initPTS:i,unparsedVttFrags:s}=this,a=i.length-1;if(!i[r.cc]&&-1===a)return void s.push(e);const o=this.hls;YX(null!=(t=r.initSegment)&&t.data?LW(r.initSegment.data,new Uint8Array(n)):n,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,(e=>{this._appendCues(e,r.level),o.trigger(EK.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})}),(t=>{const i="Missing initPTS for VTT MPEGTS"===t.message;i?s.push(e):this._fallbackToIMSC1(r,n),kK.log(`Failed to parse VTT cue: ${t}`),i&&a>r.cc||o.trigger(EK.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:t})}))}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||eQ(t,this.initPTS[e.cc],(()=>{r.textCodec=JX,this._parseIMSC1(e,t)}),(()=>{r.textCodec="wvtt"}))}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||"disabled"===r.mode)return;e.forEach((e=>xY(r,e)))}else{const n=this.tracks[t];if(!n)return;const i=n.default?"default":"subtitles"+t;r.trigger(EK.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===gY&&this.onFragLoaded(EK.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){const{cea608Parser1:r,cea608Parser2:n}=this;if(!this.enabled||!r||!n)return;const{frag:i,samples:s}=t;if(i.type!==pY||"NONE"!==this.closedCaptionsForLevel(i))for(let e=0;e<s.length;e++){const t=s[e].bytes;if(t){const i=this.extractCea608Data(t);r.addData(s[e].pts,i[0]),n.addData(s[e].pts,i[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:n,type:i}){const{media:s}=this;if(s&&!(s.currentTime<r)){if(!i||"video"===i){const{captionsTracks:e}=this;Object.keys(e).forEach((n=>DY(e[n],t,r)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==n){const{textTracks:e}=this;Object.keys(e).forEach((r=>DY(e[r],t,n)))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let n=2;for(let i=0;i<r;i++){const r=e[n++],i=127&e[n++],s=127&e[n++];if(0===i&&0===s)continue;if(0!=(4&r)){const e=3&r;0!==e&&1!==e||(t[e].push(i),t[e].push(s))}}return t}},audioStreamController:class extends ZJ{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",mY),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.on(EK.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(EK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(EK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(EK.ERROR,this.onError,this),e.on(EK.BUFFER_RESET,this.onBufferReset,this),e.on(EK.BUFFER_CREATED,this.onBufferCreated,this),e.on(EK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(EK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(EK.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(EK.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(EK.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.LEVEL_LOADED,this.onLevelLoaded,this),e.off(EK.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(EK.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(EK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(EK.ERROR,this.onError,this),e.off(EK.BUFFER_RESET,this.onBufferReset,this),e.off(EK.BUFFER_CREATED,this.onBufferCreated,this),e.off(EK.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(EK.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(EK.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i}){if("main"===r){const e=t.cc;this.initPTS[t.cc]={baseTime:n,timescale:i},this.log(`InitPTS for cc: ${e} found from main: ${n}`),this.videoTrackCC=e,this.state===YJ&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=UJ);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=$J):(this.loadedmetadata=!1,this.state=HJ),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case $J:this.doTickIdle();break;case HJ:{var e;const{levels:t,trackId:r}=this,n=null==t||null==(e=t[r])?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=YJ}break}case qJ:{var t;const e=performance.now(),r=this.retryDate;(!r||e>=r||null!=(t=this.media)&&t.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=$J);break}case YJ:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:n,complete:i}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=jJ;const e={frag:t,part:r,payload:n.flush(),networkDetails:null};this._handleFragmentLoadProgress(e),i&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),r=CJ.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);XY(r.end,this.config.maxFragLookUpTolerance,t)<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${r.end} is needed`),this.clearWaitingFragment())}}else this.state=$J}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=$J)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:n}=this,i=e.config;if(null==t||!t[n])return;if(!r&&(this.startFragRequested||!i.startFragPrefetch))return;const s=t[n],a=s.details;if(!a||a.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(a))return void(this.state=HJ);const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,IK,mY));const l=this.getFwdBufferInfo(o,mY);if(null===l)return;const{bufferedTrack:u,switchingTrack:c}=this;if(!c&&this._streamEnded(l,a))return e.trigger(EK.BUFFER_EOS,{type:"audio"}),void(this.state=KJ);const d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,pY),h=l.len,f=this.getMaxBufferLength(null==d?void 0:d.len);if(h>=f&&!c)return;const p=a.fragments[0].start;let m=l.end;if(c&&r){const e=this.getLoadPosition();u&&c.attrs!==u.attrs&&(m=e),a.PTSKnown&&e<p&&(l.end>p||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=p+.05)}let g=this.getNextFragment(m,a),y=!1;if(g&&this.isLoopLoading(g,m)&&(y=!!g.gap,g=this.getNextFragmentLoopLoading(g,a,l,pY,f)),!g)return void(this.bufferFlushed=!0);const v=d&&g.start>d.end+a.targetduration;if(v||(null==d||!d.len)&&l.len){const e=this.getAppendedFrag(g.start,pY);if(null===e)return;if(y||(y=!!e.gap||!!v&&0===d.len),v&&!y||y&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(g,s,m)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map((e=>new PY(e)))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=$J):(this.switchingTrack=null,this.bufferedTrack=t,this.state=UJ),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(EK.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:n}=this,{details:i,id:s}=t;if(!n)return void this.warn(`Audio tracks were reset while loading level ${s}`);this.log(`Track ${s} loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const a=n[s];let o=0;if(i.live||null!=(r=a.details)&&r.live){this.checkLiveUpdate(i);const e=this.mainDetails;if(i.deltaUpdateFailed||!e)return;!a.details&&i.hasProgramDateTime&&e.hasProgramDateTime?(LJ(i,e),o=i.fragments[0].start):o=this.alignPlaylists(i,a.details)}a.details=i,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(a.details,o),this.state!==HJ||this.waitForCdnTuneIn(i)||(this.state=$J),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:n,payload:i}=e,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const c=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new rX(this.hls,mY,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],f=null==(t=r.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=n?n.index:-1,s=-1!==t,a=new NJ(r.level,r.sn,r.stats.chunkCount,i.byteLength,t,s);d.push(i,f,c,"",r,n,u.totalduration,e,a,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new oX,complete:!1};e.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state=YJ}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r.type===mY)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==r.sn){this.fragPrevious=r;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(EK.AUDIO_TRACK_SWITCHED,vK({},e)))}this.fragBufferedComplete(r,n)}else if(!this.loadedmetadata&&r.type===pY){const e=this.videoBuffer||this.media;if(e){CJ.getBuffered(e).length&&(this.loadedmetadata=!0)}}}onError(e,t){var r;if(t.fatal)this.state=WJ;else switch(t.details){case SK.FRAG_GAP:case SK.FRAG_PARSING_ERROR:case SK.FRAG_DECRYPT_ERROR:case SK.FRAG_LOAD_ERROR:case SK.FRAG_LOAD_TIMEOUT:case SK.KEY_LOAD_ERROR:case SK.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(mY,t);break;case SK.AUDIO_TRACK_LOAD_ERROR:case SK.AUDIO_TRACK_LOAD_TIMEOUT:case SK.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==HJ||(null==(r=t.context)?void 0:r.type)!==hY||(this.state=$J);break;case SK.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case SK.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushed(e,{type:t}){t===IK&&(this.bufferFlushed=!0,this.state===KJ&&(this.state=$J))}_handleTransmuxComplete(e){var t;const r="audio",{hls:n}=this,{remuxResult:i,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:u}=a,{details:c}=u,{audio:d,text:h,id3:f,initSegment:p}=i;if(!this.fragContextChanged(o)&&c){if(this.state=VJ,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const e=o.initSegment||o;this._bufferInitSegment(p.tracks,e,s),n.trigger(EK.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:p.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:r,endDTS:n}=d;l&&(l.elementaryStreams[IK]={startPTS:e,endPTS:t,startDTS:r,endDTS:n}),o.setElementaryStreamInfo(IK,e,t,r,n),this.bufferFragmentData(d,o,l,s)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=wK({id:r,frag:o,details:c},f);n.trigger(EK.FRAG_PARSING_METADATA,e)}if(h){const e=wK({id:r,frag:o,details:c},h);n.trigger(EK.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,r){if(this.state!==VJ)return;e.video&&delete e.video;const n=e.audio;if(!n)return;n.levelCodec=n.codec,n.id="audio",this.log(`Init audio buffer, container:${n.container}, codecs[parsed]=[${n.codec}]`),this.hls.trigger(EK.BUFFER_CODECS,e);const i=n.initSegment;if(null!=i&&i.byteLength){const e={type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:i};this.hls.trigger(EK.BUFFER_APPENDING,e)}this.tick()}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);var i;(this.fragCurrent=e,this.switchingTrack||n===hJ||n===pJ)?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]?(this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=YJ):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}completeAudioSwitch(e){const{hls:t,media:r,bufferedTrack:n}=this,i=null==n?void 0:n.attrs,s=e.attrs;r&&i&&(i.CHANNELS!==s.CHANNELS||i.NAME!==s.NAME||i.LANGUAGE!==s.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(EK.AUDIO_TRACK_SWITCHED,vK({},e))}},audioTrackController:class extends oJ{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(EK.LEVEL_LOADING,this.onLevelLoading,this),e.on(EK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(EK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(EK.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(EK.LEVEL_LOADING,this.onLevelLoading,this),e.off(EK.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(EK.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(EK.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,s=this.tracksInGroup[r];if(!s||s.groupId!==n)return void this.warn(`Track with id:${r} and group:${n} not found in active group ${s.groupId}`);const a=s.details;s.details=t.details,this.log(`audio-track ${r} "${s.name}" lang:${s.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(null==t||!t.audioGroupIds)return;const r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;const e=this.tracks.filter((e=>!r||e.groupId===r));this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),this.tracksInGroup=e;const t={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group:${r}`),this.hls.trigger(EK.AUDIO_TRACKS_UPDATED,t),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&t.context.type===hY&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn("Invalid id passed to audio-track controller");this.clearTimer();const r=this.currentTrack;t[this.trackId];const n=t[e],{groupId:i,name:s}=n;if(this.log(`Switching to audio-track ${e} "${s}" lang:${n.lang} group:${i}`),this.trackId=e,this.currentTrack=n,this.selectDefaultTrack=!1,this.hls.trigger(EK.AUDIO_TRACK_SWITCHING,vK({},n)),n.details&&!n.details.live)return;const a=this.switchParams(n.url,null==r?void 0:r.details);this.loadPlaylist(a)}selectInitialTrack(){const e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{const t=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(EK.ERROR,{type:DK.MEDIA_ERROR,details:SK.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if(!this.selectDefaultTrack||n.default){if(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===n.attrs["STABLE-RENDITION-ID"])return n.id;if(e.name===n.name&&e.lang===n.lang)return n.id}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){const r=t.id,n=t.groupId;let i=t.url;if(e)try{i=e.addDirectives(i)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${n}`),this.clearTimer(),this.hls.trigger(EK.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:e||null})}}},emeController:cQ,cmcdController:vQ,contentSteeringController:class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=kK.log.bind(kK,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.on(EK.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.on(EK.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(EK.MANIFEST_LOADING,this.onManifestLoading,this),e.off(EK.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(EK.MANIFEST_PARSED,this.onManifestParsed,this),e.off(EK.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((null==r?void 0:r.action)===tJ&&r.flags===iJ){let e=this.pathwayPriority;const t=this.pathwayId;this.penalizedPathways[t]||(this.penalizedPathways[t]=performance.now()),!e&&this.levels&&(e=this.levels.reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])),e&&e.length>1&&(this.updatePathwayPriority(e),r.resolved=this.pathwayId!==t)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}updatePathwayPriority(e){let t;this.pathwayPriority=e;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach((e=>{n-r[e]>3e5&&delete r[e]}));for(let n=0;n<e.length;n++){const i=e[n];if(r[i])continue;if(i===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,this.hls.trigger(EK.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[s];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=s);break}}}clonePathways(e){const t=this.levels;if(!t)return;const r={},n={};e.forEach((e=>{const{ID:i,"BASE-ID":s,"URI-REPLACEMENT":a}=e;if(t.some((e=>e.pathwayId===i)))return;const o=this.getLevelsForPathway(s).map((e=>{const t=wK({},e);t.details=void 0,t.url=wQ(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a);const s=new FK(e.attrs);s["PATHWAY-ID"]=i;const o=s.AUDIO&&`${s.AUDIO}_clone_${i}`,l=s.SUBTITLES&&`${s.SUBTITLES}_clone_${i}`;o&&(r[s.AUDIO]=o,s.AUDIO=o),l&&(n[s.SUBTITLES]=l,s.SUBTITLES=l),t.attrs=s;const u=new PY(t);return cJ(u,"audio",o),cJ(u,"text",l),u}));t.push(...o),bQ(this.audioTracks,r,a,i),bQ(this.subtitleTracks,n,a,i)}))}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let n;this.loader&&this.loader.destroy(),this.loader=new r(t);try{n=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==n.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+e)}const i={responseType:"json",url:n.href},s=t.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,r,i)=>{this.log(`Loaded steering manifest: "${n}"`);const s=e.data;if(1!==s.VERSION)return void this.log(`Steering VERSION ${s.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(a)try{this.uri=new self.URL(a,n).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o),l&&this.updatePathwayPriority(l)},onError:(e,t,r,n)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let i=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,i);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(i=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,r)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(i,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout((()=>{this.loadSteeringManifest(e)}),t)}}});function MQ(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(MQ):Object.keys(e).reduce(((t,r)=>(t[r]=MQ(e[r]),t)),{}):e}function OQ(e){const t=e.loader;if(t!==SQ&&t!==EQ)kK.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=SQ,e.progressive=!0,e.enableSoftwareAES=!0,kK.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class FQ{static get version(){return"1.4.12"}static isSupported(){return function(){const e=KW();if(!e)return!1;const t=XJ(),r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!n}()}static get Events(){return EK}static get ErrorTypes(){return DK}static get ErrorDetails(){return SK}static get DefaultConfig(){return FQ.defaultConfig?FQ.defaultConfig:kQ}static set DefaultConfig(e){FQ.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new eX,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,function(e,t){if(self.console&&!0===e||"object"==typeof e){NK(e,"debug","log","info","warn","error");try{CK.log(`Debug logs enabled for "${t}" in hls.js version 1.4.12`)}catch(e){CK=TK}}else CK=TK}(e.debug||!1,"Hls instance");const t=this.config=function(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=MQ(e),n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const i=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[i],a=[];n.forEach((n=>{const o=`${e}Loading${n}`,l=t[o];if(void 0!==l&&s){a.push(o);const e=r[i].default;switch(t[i]={default:e},n){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),a.length&&kK.warn(`hls.js config: "${a.join('", "')}" setting(s) are deprecated, use "${i}": ${JSON.stringify(t[i])}`)})),vK(vK({},r),t)}(FQ.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&OQ(t);const{abrController:r,bufferController:n,capLevelController:i,errorController:s,fpsController:a}=t,o=new s(this),l=this.abrController=new r(this),u=this.bufferController=new n(this),c=this.capLevelController=new i(this),d=new a(this),h=new bY(this),f=new MY(this),p=t.contentSteeringController,m=p?new p(this):null,g=this.levelController=new uJ(this,m),y=new gJ(this),v=new SJ(this.config),b=this.streamController=new iX(this,y,v);c.setStreamController(b),d.setStreamController(b);const w=[h,g,b];m&&w.splice(1,0,m),this.networkControllers=w;const x=[l,u,c,d,f,y];this.audioTrackController=this.createController(t.audioTrackController,w);const E=t.audioStreamController;E&&w.push(new E(this,y,v)),this.subtitleTrackController=this.createController(t.subtitleTrackController,w);const D=t.subtitleStreamController;D&&w.push(new D(this,y,v)),this.createController(t.timelineController,x),v.emeController=this.emeController=this.createController(t.emeController,x),this.cmcdController=this.createController(t.cmcdController,x),this.latencyController=this.createController(OY,x),this.coreComponents=x,w.push(o);const S=o.onErrorOut;"function"==typeof S&&this.on(EK.ERROR,S,o)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,n){this._emitter.off(e,t,r,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){kK.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(EK.ERROR,{type:DK.OTHER_ERROR,details:SK.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){kK.log("destroy"),this.trigger(EK.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){kK.log("attachMedia"),this._media=e,this.trigger(EK.MEDIA_ATTACHING,{media:e})}detachMedia(){kK.log("detachMedia"),this.trigger(EK.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,n=this.url=gK.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});kK.log(`loadSource:${n}`),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(EK.MANIFEST_LOADING,{url:e})}startLoad(e=-1){kK.log(`startLoad(${e})`),this.networkControllers.forEach((t=>{t.startLoad(e)}))}stopLoad(){kK.log("stopLoad"),this.networkControllers.forEach((e=>{e.stopLoad()}))}swapAudioCodec(){kK.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){kK.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e,t=0){this.levelController.removeLevel(e,t)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){kK.log(`set currentLevel:${e}`),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){kK.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){kK.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){kK.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){return this.levelController.startLevel}set startLevel(e){kK.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(kK.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){FY.indexOf(e)>-1&&(this._maxHdcpLevel=e)}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let n;if(n=-1===t&&e&&e.length?e.length-1:t,r)for(let t=n;t--;){const n=e[t].attrs["HDCP-LEVEL"];if(n&&n<=r)return t}return n}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}FQ.defaultConfig=void 0;var LQ=r(1443),_Q=r.n(LQ);function RQ(e){return RQ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},RQ(e)}function IQ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function PQ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?IQ(Object(r),!0).forEach((function(t){BQ(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IQ(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function BQ(e,t,r){return(t=VQ(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UQ(e){return function(e){if(Array.isArray(e))return $Q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return $Q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $Q(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function zQ(){zQ=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var s=t&&t.prototype instanceof h?t:h,a=Object.create(s.prototype),o=new A(i||[]);return n(a,"_invoke",{value:x(e,r,o)}),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var m={};l(m,s,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,s)&&(m=y);var v=p.prototype=h.prototype=Object.create(m);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function i(n,s,a,o){var l=c(e[n],e,s);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==RQ(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,o)}),(function(e){i("throw",e,a,o)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,o)}))}o(l.arg)}var s;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return s=s?s.then(n,n):n()}})}function x(e,t,r){var n="suspendedStart";return function(i,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw s;return{value:void 0,done:!0}}for(r.method=i,r.arg=s;;){var a=r.delegate;if(a){var o=E(a,r);if(o){if(o===d)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function T(e){if(e||""===e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}throw new TypeError(RQ(e)+" is not iterable")}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,o,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(w.prototype),l(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var a=new w(u(t,r,n,i),s);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(v),l(v,o,"Generator"),l(v,s,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=T,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var o=r.call(s,"catchLoc"),l=r.call(s,"finallyLoc");if(o&&l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function jQ(e,t,r,n,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,i)}function qQ(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function a(e){jQ(s,n,i,a,o,"next",e)}function o(e){jQ(s,n,i,a,o,"throw",e)}a(void 0)}))}}function HQ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VQ(n.key),n)}}function VQ(e){var t=function(e,t){if("object"!==RQ(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==RQ(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===RQ(t)?t:String(t)}function GQ(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function KQ(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var WQ,YQ=!1,JQ=null,ZQ=null,XQ=!1,QQ=new WeakSet,e0=new WeakSet,t0=new WeakSet,r0=new WeakSet,n0=new WeakSet,i0=new WeakSet,s0=new WeakSet,a0=function(){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.el,i=void 0===n?"ytEmbed":n,s=r.autoEmbed,a=void 0===s||s,o=r.videoId,l=r.httpMethod,u=void 0===l?"post":l,c=r.httpUrl,d=r.httpPayload,h=void 0===d?{}:d,f=r.watchSeconds,p=void 0===f?0:f,m=r.isCompleted,g=void 0!==m&&m,y=r.isLive,v=void 0!==y&&y,b=r.autoplay,w=void 0!==b&&b;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),GQ(this,s0),GQ(this,i0),GQ(this,n0),GQ(this,r0),GQ(this,t0),GQ(this,e0),GQ(this,QQ),this.autoplay=w,this.startMuted=v,this.watchSeconds=p,this.isCompleted=g,this.bodyContent=document.querySelector(".body-content"),this.placeholder=document.querySelector("[video-placeholder]"),this.nextUpEl=document.getElementById("lessonVideoNextUp"),this.btnCompleted=document.querySelector("[btn-completed]"),this.btnNotCompleted=document.querySelector("[btn-not-completed]"),this.element=document.getElementById(i),this.elementInitialNodeName=this.element.nodeName,this.videoId=o,this.autoEmbed=a,this.http={method:u,url:c,payload:h},Gi.remove("playingId"),v&&(this.autoplay=!0),w)||(this.autoplay=null!==(t=window.$params.autoplay)&&void 0!==t?t:0,delete window.$params.autoplay);this.onInitVideo()}var t,r,n,i;return t=e,r=[{key:"isHlsVideo",get:function(){return"VIDEO"===this.elementInitialNodeName&&this.element.dataset.hlsUrl}},{key:"onInitVideo",value:(i=qQ(zQ().mark((function e(){var t,r,n,i,s=this,a=arguments;return zQ().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:this.autoplay,n=a.length>1&&void 0!==a[1]?a[1]:this.watchSeconds,ZQ=this.http.payload.postId,XQ=!1,window.player&&"function"==typeof window.player.destroy&&window.player.destroy(),e.next=7,KQ(this,QQ,o0).call(this,r);case 7:this.player=e.sent,this.player.on("playing",KQ(this,n0,h0).bind(this)),this.player.on("pause",KQ(this,n0,h0).bind(this)),this.player.on("ended",KQ(this,n0,h0).bind(this)),i=function(){s.isCompleted||!n||s.isLive||(s.player.currentTime=n),r&&player.play()},this.player.on("ready",(function(){return i()})),this.player.on("loadedmetadata",(function(){return i()})),this.nextUpEl&&this.player.on("timeupdate",KQ(this,r0,d0).bind(this)),null===(t=this.bodyContent)||void 0===t||t.addEventListener("click",KQ(this,s0,m0).bind(this));case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}],r&&HQ(t.prototype,r),n&&HQ(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o0(e){return l0.apply(this,arguments)}function l0(){return l0=qQ(zQ().mark((function e(t){var r,n,i,s;return zQ().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={muted:this.startMuted,volume:null!==(r=null===(n=window.player)||void 0===n?void 0:n.volume)&&void 0!==r?r:1,controls:["play-large","play","progress","duration","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed","loop"]},!this.isHlsVideo){e.next=7;break}return e.next=4,KQ(this,e0,u0).call(this,i);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=KQ(this,t0,c0).call(this,i);case 8:return s=e.t0,window.player=s,e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)}))),l0.apply(this,arguments)}function u0(e){var t=this;if(!FQ.isSupported()){this.element.src=this.element.dataset.hlsUrl;var r=KQ(this,t0,c0).call(this,e);return new Promise((function(e){return e(r)}))}var n=new FQ;return n.loadSource(this.element.dataset.hlsUrl),n.attachMedia(this.element),n.on(FQ.Events.LEVEL_SWITCHED,(function(e,t){document.querySelector('.plyr__menu__container [data-plyr="quality"][value="AUTO"] span').textContent=n.autoLevelEnabled?"Auto (".concat(n.levels[t.level].height,"p)"):"Auto"})),window.hls=n,new Promise((function(r){n.on(FQ.Events.MANIFEST_PARSED,(function(i,s){var a=["AUTO"].concat(UQ(n.levels.map((function(e){return e.height}))));e.quality={default:"AUTO",options:a,forced:!0,onChange:function(e){"AUTO"!==e?n.levels.map((function(t,r){t.height===e&&(n.currentLevel=r)})):n.currentLevel=-1}};var o=KQ(t,t0,c0).call(t,e);o.on("languagechange",(function(){return setTimeout((function(){return n.subtitleTrack=o.currentTrack}),50)})),r(o)}))}))}function c0(e){return new(_Q())(this.element,e)}function d0(e){if(this.nextUpEl){var t=e.detail.plyr,r=Math.floor(t.currentTime);r!==this.lastTimeUpdate&&(this.lastTimeUpdate=r,YQ&&this.nextUpEl.dispatchEvent(new CustomEvent("timeupdate",{detail:{player:t}})))}}function h0(e){var t=this,r=e.detail.plyr;if(YQ=r.playing,location.pathname===this.placeholder.dataset.path&&(XQ=YQ,ZQ=this.http.payload.postId),!this.isLive)if(this.player||(Gi.remove("playingId"),XQ=null,ZQ=null),YQ)Gi.get("playingId")||Gi.set("playingId",this.http.payload.postId),JQ=setInterval(qQ(zQ().mark((function e(){return zQ().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.duration<=0)){e.next=2;break}return e.abrupt("return");case 2:KQ(t,i0,f0).call(t,r.currentTime,r.duration);case 3:case"end":return e.stop()}}),e)}))),5e3);else{if(clearInterval(JQ),Gi.remove("playingId"),"number"!=typeof r.currentTime)return;KQ(this,i0,f0).call(this,r.currentTime,r.duration)}}function f0(e,t){return p0.apply(this,arguments)}function p0(){return p0=qQ(zQ().mark((function e(t,r){var n,i,s,a;return zQ().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.isAuthenticated){e.next=2;break}return e.abrupt("return");case 2:return n=Math.ceil(t/r*100),e.next=5,qe[this.http.method](this.http.url,PQ(PQ({},this.http.payload),{},{watchPercent:n,watchSeconds:Math.floor(t)}));case 5:if(i=e.sent,s=i.data,a=s.progression.isCompleted,this.btnCompleted&&this.btnNotCompleted){e.next=10;break}return e.abrupt("return");case 10:if(!a){e.next=14;break}return this.btnCompleted.classList.remove("hidden"),this.btnNotCompleted.classList.add("hidden"),e.abrupt("return");case 14:this.btnNotCompleted.classList.remove("hidden"),this.btnCompleted.classList.add("hidden");case 16:case"end":return e.stop()}}),e,this)}))),p0.apply(this,arguments)}function m0(e){var t,r=e.target.classList.contains("timestamp"),n=e.target.closest(".timestamp");if(r||n){var i=(r?e.target:n).textContent.split(":"),s=i[i.length];i.length>1&&(s=i.reduce((function(e,t,r){return r==i.length-1?e+parseInt(t):e+60*parseInt(t)}),0)),"function"==typeof(null===(t=this.player.embed)||void 0===t?void 0:t.seekTo)?this.player.embed.seekTo(s):this.player.currentTime=s,YQ||this.player.play(),window.scrollTo({top:this.element.offsetTop,behavior:"smooth"})}}var g0=void 0;function y0(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.querySelector("[video-placeholder]");if(t){var r="true"===t.dataset.isEnabledMiniPlayer,n=t.dataset.path==location.pathname;if(e&&r&&!t.classList.contains("no-access"))return n?t.classList.add("video-noactions"):t.classList.remove("video-noactions"),t.classList.add("video-small"),t.classList.remove("aspect-video"),void t.removeAttribute("style");var i=function(e){if(!e)return;var t=e.getBoundingClientRect();return{top:t.top+window.scrollY,left:t.left+window.scrollX,width:t.width,height:t.height}}(document.getElementById("videoPlayerPosition"));i&&(t.classList.add("aspect-video"),t.classList.remove("video-small","video-noactions"),t.style.position="absolute",t.style.padding=0,t.style.width=i.width+"px",t.style.hight=i.height+"px",t.style.left=i.left+"px",t.style.top=i.top+"px")}}up.compiler("#lessonVideoEmbed",(function(e){var t=!!window.player;if(!!document.getElementById("videoPlayerPosition")||!t){var r=e.dataset;if(y0(),new a0({el:"lessonVideoEmbed",isLive:"true"==r.isLive,isCompleted:"true"==r.isCompleted,videoId:r.videoId,watchSeconds:parseInt(r.watchSeconds||"0"),httpUrl:r.httpUrl,httpPayload:{postId:r.payloadPostId,collectionId:r.payloadCollectionId,userId:r.payloadUserId,route:r.payloadRoute}}),window.ResizeObserver){var n=new ResizeObserver((function(e){void 0!==g0&&y0(!g0)}));n.observe(document.body),function(){return n.unobserve(document.body)}}}})),up.compiler("#videoPlayerPosition",(function(e){"function"==typeof WQ&&WQ();var t=document.querySelector("[video-placeholder]");if(null==t||t.dispatchEvent(new CustomEvent("open")),!YQ){var r,n=null===(r=window.player)||void 0===r||null===(r=r.elements)||void 0===r?void 0:r.container;n&&(n.dataset.keepPlayer=!1)}if(window.IntersectionObserver){var i=new IntersectionObserver((function(e){e.forEach((function(e){g0=e.isIntersecting,y0(!e.isIntersecting)}))}),{rootMargin:"0px"});i.observe(e),WQ=function(){return i.unobserve(e)}}})),up.on("up:location:changed",(function(e){var t=document.querySelector("[video-placeholder]"),r=!!window.player;if(t)if(t.classList.contains("no-access"))t.dispatchEvent(new CustomEvent("close"));else if(r&&!["/users/menu","/signin","/signup","/histories/","/watchlist/"].some((function(t){return e.url.toLowerCase().includes(t)}))){var n="true"===t.dataset.isEnabledMiniPlayer,i=t.dataset.path==location.pathname,s=!ZQ||ZQ==t.dataset.postId;XQ&&n||i||!s||t.dispatchEvent(new CustomEvent("close"))}})),up.on("up:fragment:loaded",(function(e){setTimeout((function(){var e=document.querySelector("[up-main]"),t=Array.from(document.querySelectorAll("[up-main-header], [up-main-footer]"));e.classList.contains("lesson-wrapper")?t.map((function(e){return e.classList.add("lesson-wrapper")})):t.map((function(e){return e.classList.remove("lesson-wrapper")}))}),300);var t=e.request.url.toLowerCase();if(!["/users/menu","/signin","/signup","/histories/","/watchlist/"].some((function(e){return t.includes(e)}))){var r=["modal","drawer"].includes(e.request.mode),n=!e.response.text.includes('id="videoPlayerPosition"');y0(n&&!r),setTimeout((function(){return y0(n&&!r)}),600)}}));r(3166);function v0(e){return v0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v0(e)}function b0(){b0=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var s=t&&t.prototype instanceof h?t:h,a=Object.create(s.prototype),o=new A(i||[]);return n(a,"_invoke",{value:x(e,r,o)}),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var m={};l(m,s,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&r.call(y,s)&&(m=y);var v=p.prototype=h.prototype=Object.create(m);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function i(n,s,a,o){var l=c(e[n],e,s);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==v0(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,o)}),(function(e){i("throw",e,a,o)})):t.resolve(d).then((function(e){u.value=e,a(u)}),(function(e){return i("throw",e,a,o)}))}o(l.arg)}var s;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return s=s?s.then(n,n):n()}})}function x(e,t,r){var n="suspendedStart";return function(i,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw s;return{value:void 0,done:!0}}for(r.method=i,r.arg=s;;){var a=r.delegate;if(a){var o=E(a,r);if(o){if(o===d)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function T(e){if(e||""===e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}throw new TypeError(v0(e)+" is not iterable")}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,o,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(w.prototype),l(w.prototype,a,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var a=new w(u(t,r,n,i),s);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(v),l(v,o,"Generator"),l(v,s,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=T,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var o=r.call(s,"catchLoc"),l=r.call(s,"finallyLoc");if(o&&l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function w0(e,t,r,n,i,s,a){try{var o=e[s](a),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,i)}function x0(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function a(e){w0(s,n,i,a,o,"next",e)}function o(e){w0(s,n,i,a,o,"throw",e)}a(void 0)}))}}function E0(e){var t=new URL(e),r=new URLSearchParams(t.search);window.$params=Object.fromEntries(r.entries()),t.search&&(r.delete("autoplay"),t.search=r.toString(),window.history.replaceState({},document.title,t.toString()))}Gi.set("timezone",qi.now().zoneName),window.DateTime=qi,window.hideBanner=function(){var e=x0(b0().mark((function e(t){return b0().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return document.getElementById(t).remove(),e.next=3,qe.post("/api/session/set",{target:t,value:!1});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),window.onfocus=x0(b0().mark((function e(){var t,r;return b0().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qe.get("/api/user/check");case 2:t=e.sent,r=t.data,window.isAuthenticated&&!r&&(window.location="/go/auth/reset");case 5:case"end":return e.stop()}}),e)}))),E0(location.href),up.on("up:location:changed",(function(e){return E0(e.target.location.href)}))})()})();